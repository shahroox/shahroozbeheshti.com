/*
 ********************************************* !*\
   !*** ./node_modules/eventemitter3/index.js ***!
   \******************************************** no static exports found  ModuleConcatenation bailout: Module is not an ECMAScript module  ***************************************************** !*\
   !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
   \**************************************************** ************************************************** !*\
   !*** ./node_modules/webworkify-webpack/index.js ***!
   \************************************************* ******************************************** !*\
   !*** ./src/crypt/decrypter.js + 3 modules ***!
   \******************************************* exports provided: default  ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/hls.ts  ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.ts  ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.ts  ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.ts  ************************************************** !*\
   !*** ./src/demux/demuxer-inline.js + 12 modules ***!
   \************************************************* ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/hls.ts  ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/hls.ts  ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/hls.ts  ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number.js because of ./src/hls.ts  ************************************* !*\
   !*** ./src/demux/demuxer-worker.js ***!
   \************************************ ModuleConcatenation bailout: Module is referenced from these modules with unsupported syntax: ./src/demux/demuxer.js (referenced with require.resolve)  ../demux/demuxer-inline  ../events  ../utils/logger  eventemitter3  ************************** !*\
   !*** ./src/demux/id3.js ***!
   \************************* exports provided: default, utf8ArrayToStr  ../utils/get-self-scope  ********************************* !*\
   !*** ./src/demux/mp4demuxer.js ***!
   \******************************** *********************** !*\
   !*** ./src/errors.ts ***!
   \********************** exports provided: ErrorTypes, ErrorDetails  *********************** !*\
   !*** ./src/events.js ***!
   \********************** ********************************* !*\
   !*** ./src/hls.ts + 50 modules ***!
   \******************************** ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/demux/demuxer-worker.js  ModuleConcatenation bailout: Cannot concat with ./src/demux/demuxer-inline.js because of ./src/demux/demuxer-worker.js  ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/demux/demuxer-worker.js  ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/demux/demuxer-worker.js  ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/demux/demuxer-worker.js  ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/demux/demuxer-worker.js  ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number.js because of ./src/demux/demuxer-worker.js  ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/demux/demuxer-worker.js  ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/demux/demuxer-worker.js  ModuleConcatenation bailout: Cannot concat with ./node_modules/eventemitter3/index.js (<- Module is not an ECMAScript module)  ModuleConcatenation bailout: Cannot concat with ./node_modules/url-toolkit/src/url-toolkit.js (<- Module is not an ECMAScript module)  ../demux/demuxer-worker.js  ********************************* !*\
   !*** ./src/polyfills/number.js ***!
   \******************************** exports provided: isFiniteNumber, MAX_SAFE_INTEGER  ************************************* !*\
   !*** ./src/utils/get-self-scope.js ***!
   \************************************ exports provided: getSelfScope  ***************************** !*\
   !*** ./src/utils/logger.js ***!
   \**************************** exports provided: enableLogs, logger  ./get-self-scope */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(w){var f=0;return function(){return f<w.length?{done:!1,value:w[f++]}:{done:!0}}};$jscomp.arrayIterator=function(w){return{next:$jscomp.arrayIteratorImpl(w)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(w,f,ka){w!=Array.prototype&&w!=Object.prototype&&(w[f]=ka.value)};$jscomp.getGlobal=function(w){return"undefined"!=typeof window&&window===w?w:"undefined"!=typeof global&&null!=global?global:w};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(w,f){this.$jscomp$symbol$id_=w;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function w(ka){if(this instanceof w)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(ka||"")+"_"+f++,ka)}var f=0;return w}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var w=$jscomp.global.Symbol.iterator;w||(w=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[w]&&$jscomp.defineProperty(Array.prototype,w,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var w=$jscomp.global.Symbol.asyncIterator;w||(w=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(w){$jscomp.initSymbolIterator();w={next:w};w[$jscomp.global.Symbol.iterator]=function(){return this};return w};
(function(w,f){"object"===typeof exports&&"undefined"!==typeof module?f(exports,require("three")):"function"===typeof define&&define.amd?define(["exports","three"],f):(w=w||self,f(w.PANOLENS={},w.THREE))})(this,function(w,f){function ka(a){a||console.warn("PANOLENS.Widget: No container specified");f.EventDispatcher.call(this);this.DEFAULT_TRANSITION="all 0.27s ease";this.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch);this.PREVENT_EVENT_HANDLER=function(a){a.preventDefault();
a.stopPropagation()};this.container=a;this.mask=this.activeSubMenu=this.activeMainItem=this.mainMenu=this.settingElement=this.videoElement=this.fullscreenElement=this.barElement=null}function wa(a,b,c){a=void 0===a?16777215:a;b=void 0===b?!0:b;c=void 0===c?1500:c;this.dpr=window.devicePixelRatio;var d=this.createCanvas(),e=d.canvas;d=d.context;var t=new f.SpriteMaterial({color:a,map:this.createCanvasTexture(e)});f.Sprite.call(this,t);this.canvasWidth=e.width;this.canvasHeight=e.height;this.context=
d;this.color=a instanceof f.Color?a:new f.Color(a);this.autoSelect=b;this.dwellTime=c;this.rippleDuration=500;this.position.z=-10;this.center.set(.5,.5);this.scale.set(.5,.5,1);this.callback=this.timerId=this.startTimestamp=null;this.frustumCulled=!1;this.updateCanvasArcByProgress(0)}function ha(){var a=new f.PlaneBufferGeometry(3E3,3E3,1,1),b=new f.MeshBasicMaterial({color:0,side:f.DoubleSide,opacity:0,transparent:!0});this.subtype="hotspotPlane";f.Mesh.call(this,a,b);this.position.set(qa.X,qa.Y,
qa.Z);this.rotateX(-Math.PI/2)}function bb(a,b){return b={exports:{}},a(b,b.exports),b.exports}function xa(){var a=this;this.defaultOpacity=.7;var b=new f.RingGeometry(1.4,1,30),c=new f.MeshBasicMaterial({color:16777215,opacity:this.defaultOpacity,transparent:!0,side:f.DoubleSide});f.Mesh.call(this,b,c);this.type="floor_ring_cursor";this.enabled=!0;this.visible=!1;this.rotateX(-Math.PI/2);this.scale.set(25,25,25);this.fadeOut=(new z.Tween(this.material)).to({opacity:0});this.fadeIn=(new z.Tween(this.material)).to({opacity:this.defaultOpacity});
this.fadeTimeout=null;this.onMove=function(){a.visible?a.show():a.hide()}}function W(a,b,c){a=void 0===a?25:a;c=void 0===c?{}:c;this.hoverOpacity=void 0!==c.opacity?.7*c.opacity:.7;this.defaultOpacity=void 0!==c.opacity?.4*c.opacity:.4;this.options=Object.assign({isHide:!1},c);c=new f.TextureLoader;f.Mesh.call(this);this.type="floor_ring_infospot";this.animated=void 0!==b?b:!0;this.isHovering=!1;this.cursorStyle=this.toPanorama=this.element=null;this.mode=K.NORMAL;this.loaded=!1;this.scale.set(a,
a,a);this.rotateX(-Math.PI/2);this.container=null;this.originalRaycast=this.raycast;this.HANDLER_FOCUS=null;this.geometry=new f.CircleGeometry(1.4,30,1,2*Math.PI);this.material.depthTest=!1;this.material.transparent=!0;this.material.opacity=0;this.hoverEnterAnimation=new z.Tween;this.hoverLeaveAnimation=new z.Tween;a=function(a){this.material&&(this.material.color=new f.Color(16777215),this.material.needsUpdate=!0,this.material.alphaMap=a,this.loaded=!0,this.hoverEnterAnimation=(new z.Tween(this.material)).to({opacity:this.hoverOpacity},
100),this.hoverLeaveAnimation=(new z.Tween(this.material)).to({opacity:this.defaultOpacity}),this.options.isHide||this.show(100,!0))}.bind(this);this.showAnimation=(new z.Tween(this.material)).to({opacity:this.defaultOpacity},100).onStart(this.enableRaycast.bind(this,!0)).easing(z.Easing.Quartic.Out);this.hideAnimation=(new z.Tween(this.material)).to({opacity:0},100).onStart(this.enableRaycast.bind(this,!1)).easing(z.Easing.Quartic.Out);this.addEventListener("click",this.onClick);this.addEventListener("hover",
this.onHover);this.addEventListener("hoverenter",this.onHoverStart);this.addEventListener("hoverleave",this.onHoverEnd);this.addEventListener("panolens-dual-eye-effect",this.onDualEyeEffect);this.addEventListener("panolens-container",this.setContainer.bind(this));this.addEventListener("dismiss",this.onDismiss);this.addEventListener("panolens-infospot-focus",this.setFocusMethod);c.load("data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiBoZWlnaHQ9IjE0MCIgdmlld0JveD0iMCAwIDE0MCAxNDAiIHdpZHRoPSIxNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTAgMGgxNDB2MTQwaC0xNDB6IiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNzAiIGN5PSI3MCIgZmlsbD0iIzAwMCIgcj0iNTAiLz48L3N2Zz4=",
a)}function Y(a,b,c,d){a=void 0===a?300:a;d=void 0===d?{}:d;b=b||R.Info;f.Sprite.call(this);this.type="infospot";this.animated=void 0!==c?c:!0;this.isHovering=!1;this.maxOpacity=void 0!==d.opacity?1*d.opacity:1;this.minOpacity=0;this.frustumCulled=!1;this.cursorStyle=this.toPanorama=this.element=null;this.mode=K.NORMAL;this.loaded=!1;this.scale.set(a,a,1);this.rotation.y=Math.PI;this.container=null;this.originalRaycast=this.raycast;this.HANDLER_FOCUS=null;this.material.side=f.DoubleSide;this.material.depthTest=
!1;this.material.transparent=!0;this.material.opacity=0;this.scaleUpAnimation=new z.Tween;this.scaleDownAnimation=new z.Tween;c=function(d){if(this.material){this.material.map=d;this.material.needsUpdate=!0;this.loaded=this.material.map.needsUpdate=!0;this._parentRatio||(this._parentRatio=1);var b=d.image.width/d.image.height,c=new f.Vector3;d.image.width=d.image.naturalWidth||64;d.image.height=d.image.naturalHeight||64;this.scale.set(b/this._parentRatio*a,a,1);this.material.needsUpdate=!0;this.material.map.needsUpdate=
!0;c.copy(this.scale);this.scaleUpAnimation=(new z.Tween(this.scale)).to({x:1.3*c.x,y:1.3*c.y},500).easing(z.Easing.Elastic.Out);this.scaleDownAnimation=(new z.Tween(this.scale)).to({x:c.x,y:c.y},500).easing(z.Easing.Elastic.Out);this.show(500)}}.bind(this);this.showAnimation=(new z.Tween(this.material)).to({opacity:this.maxOpacity},500).onStart(this.enableRaycast.bind(this,!0)).easing(z.Easing.Quartic.Out);this.hideAnimation=(new z.Tween(this.material)).to({opacity:0},500).onStart(this.enableRaycast.bind(this,
!1)).easing(z.Easing.Quartic.Out);this.addEventListener("click",this.onClick);this.addEventListener("hover",this.onHover);this.addEventListener("hoverenter",this.onHoverStart);this.addEventListener("hoverleave",this.onHoverEnd);this.addEventListener("panolens-dual-eye-effect",this.onDualEyeEffect);this.addEventListener("panolens-container",this.setContainer.bind(this));this.addEventListener("dismiss",this.onDismiss);this.addEventListener("panolens-infospot-focus",this.setFocusMethod);Ca.load(b,c)}
function A(){this.edgeLength=1E4;f.Mesh.call(this,this.createGeometry(this.edgeLength),this.createMaterial());this.type="panorama";this.ImageQualityLow=1;this.ImageQualityFair=2;this.ImageQualityMedium=3;this.ImageQualityHigh=4;this.ImageQualitySuperHigh=5;this.animationDuration=1E3;this.defaultInfospotSize=350;this.container=void 0;this.loaded=!1;this.linkedSpots=[];this.isInfospotVisible=!1;this.linkingImageScale=this.linkingImageURL=void 0;this.scale.x*=-1;this.renderOrder=-1;this.active=this.visible=
!1;this.infospotAnimation=(new z.Tween(this)).to({},this.animationDuration/2);this.addEventListener("panolens-container",this.setContainer.bind(this));this.addEventListener("click",this.onClick.bind(this));this.setupTransitions()}function ba(a){A.call(this);this.src=a;this.type="image_panorama";this.floorPlane=null}function Pa(){var a=new f.BufferGeometry,b=new f.MeshBasicMaterial({color:0,opacity:0,transparent:!0});a.addAttribute("position",new f.BufferAttribute(new Float32Array,1));A.call(this,
a,b)}function Da(a){a=void 0===a?[]:a;A.call(this);this.images=a;this.type="cube_panorama"}function Qa(){for(var a=[],b=0;6>b;b++)a.push(R.WhiteTile);Da.call(this,a);this.type="basic_panorama"}function ya(a,b){b=void 0===b?{x:0,y:0,z:0}:b;this.subtype="slider_panorama";this.src=a;this.desiredWidth=a.width;this.desiredHeight=a.height;A.call(this);this.desiredPosition=b}function ia(a,b){b=void 0===b?{}:b;A.call(this);var c=document.createElement("video");this.hlsSource=a;Ra.isSupported()&&"m3u8"===
a.slice(-4)?(c.title=this.hlsSource,this.hls=new Ra({liveSyncDuration:1}),this.hls.loadSource(this.hlsSource),this.hls.attachMedia(c),this.setupHlsListeners(),this.isHls=!0):c.canPlayType("application/vnd.apple.mpegurl")&&(this.src=this.hlsSource,this.isHls=!1);this.src=a;this.options=Object.assign({videoElement:c,loop:!0,muted:!0,autoplay:!1,playsinline:!0,crossOrigin:"anonymous"},b);this.videoElement=this.options.videoElement;this.videoProgress=0;this.maxDuration=b.maxDuration;this.type="video_panorama";
this.floorPlane=null;this.addEventListener("leave",this.pauseVideo.bind(this));this.addEventListener("enter-fade-start",this.resumeVideoProgress.bind(this));this.addEventListener("video-toggle",this.toggleVideo.bind(this));this.addEventListener("video-time",this.setVideoCurrentTime.bind(this))}function ta(a,b){"image"===(void 0===a?"image":a)&&ba.call(this,b);this.EPS=1E-6;this.frameId=null;this.dragging=!1;this.userMouse=new f.Vector2;this.quatA=new f.Quaternion;this.quatB=new f.Quaternion;this.quatCur=
new f.Quaternion;this.quatSlerp=new f.Quaternion;this.vectorX=new f.Vector3(1,0,0);this.vectorY=new f.Vector3(0,1,0);this.type="little_planet";this.addEventListener("window-resize",this.onWindowResize)}function Ea(a,b){Fa.uniforms.threshold.value=a.threshold;Fa.uniforms.useTexture.value=a.useTexture;Fa.uniforms.tMixTexture.value=b;return new f.ShaderMaterial(Fa)}function Sa(a,b,c,d,e){var t=this;e=void 0===e?!1:e;var r={CROSSFADE:{id:0,label:"Crossfade",value:"crossfade",settings:{useTexture:!1,texture:3,
transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},PERLIN:{id:1,label:"Perlin",value:"perlin",settings:{useTexture:!0,texture:1,transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},SQUARES:{id:2,label:"Squares",value:"squares",settings:{useTexture:!0,texture:2,transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},CELLS:{id:3,label:"Cells",value:"cells",settings:{useTexture:!0,texture:3,transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},DISTORT:{id:4,label:"Distort",value:"distort",settings:{useTexture:!0,
texture:4,transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},GRADIENT:{id:5,label:"Gradient",value:"gradient",settings:{useTexture:!0,texture:5,transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},RADIAL:{id:6,label:"Radial",value:"radial",settings:{useTexture:!0,texture:6,transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},PARALLAX:{id:7,label:"Parallax",value:"parallax",settings:{useTexture:!1,texture:3,transitionSpeed:-3,smoothstep:{start:.3,end:.7}}},NONE:{id:8,label:"None",value:"none",settings:{useTexture:!1,
texture:0,transitionSpeed:-1E4,smoothstep:{start:.3,end:.7}}}};this.getTypeList=function(){return Object.keys(r).map(function(a){return Object.assign({},r[a])}).sort(function(a,d){return a.id-d.id})};this.getTypeRelatedParameters=function(a){switch(a){case r.PERLIN.value:return Object.assign({},r.PERLIN.settings);case r.SQUARES.value:return Object.assign({},r.SQUARES.settings);case r.CELLS.value:return Object.assign({},r.CELLS.settings);case r.DISTORT.value:return Object.assign({},r.DISTORT.settings);
case r.GRADIENT.value:return Object.assign({},r.GRADIENT.settings);case r.RADIAL.value:return Object.assign({},r.RADIAL.settings);case r.PARALLAX.value:return Object.assign({},r.PARALLAX.settings);case r.NONE.value:return Object.assign({},r.NONE.settings);default:return Object.assign({},r.CROSSFADE.settings)}};this.updateParams=function(a){var d=this.getTypeRelatedParameters(a&&a.type||r.CROSSFADE.value);this.transitionParams=Object.assign({textureThreshold:.3},r.CROSSFADE.settings,a,d)};this.updateParams(d);
this.transition=1;this.isInitiatorInfospot=e;this.clock=new f.Clock;this.transitionScene=new f.Scene;this.cameraOrtho=new f.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-10,10);this.texture=(new f.TextureLoader).load("/public/engine/textures/transition/transition"+this.transitionParams.texture+".png");this.quadmaterial=new Ea(this.transitionParams,this.texture);e=new f.PlaneBufferGeometry(window.innerWidth,window.innerHeight);this.quad=new f.Mesh(e,
this.quadmaterial);this.transitionScene.add(this.quad);this.fromScene=a;this.toScene=b;e=function(){t.quadmaterial.uniforms.tDiffuse2.value=b.fbo.texture};a&&null!=a.panorama&&a.panorama.loaded?this.quadmaterial.uniforms.tDiffuse1.value=a.fbo.texture:a&&a.panorama.addEventListener("ready",function(){t.quadmaterial.uniforms.tDiffuse1.value=a.fbo.texture});b&&null!=b.panorama&&b.panorama.loaded?this.quadmaterial.uniforms.tDiffuse2.value=b.fbo.texture:b&&b.panorama.addEventListener("ready",e);this.execute=
function(){this.transitionParams.animateTransition=!0;"parallax"!=this.transitionParams.type||!this.isInitiatorInfospot||"slider_panorama"==this.toScene.panorama.subtype||this.fromScene&&"slider_panorama"==this.fromScene.panorama.subtype||this.parallax()};this.destroy=function(){this.toScene.destroy();this.fromScene.destroy()};this.parallax=function(){var a=this.fromScene,d=this.toScene;if(a){var b=a.lastTouch.scene||{x:0,y:0,z:0},c=a.camera.position,e=new f.Vector3;e.subVectors(c,b).normalize();
c=new f.Vector3;a.camera.getWorldDirection(c);(new f.Vector3).subVectors(c,b.clone().normalize());b=e.multiply(new f.Vector3(-1,0,1));c=new f.Vector3;c=d.control.getRotations().h-a.control.getRotations().h;c=e.clone().applyAxisAngle(new f.Vector3(0,1,0),c).normalize();e=c.clone();c=d.panorama.position.clone();a=(new TWEEN.Tween(a.panorama.position)).to({x:2E3*b.x,y:2E3*b.y,z:2E3*b.z},1500).easing(TWEEN.Easing.Cubic.Out);d.panorama.position.set(-2E3*e.x,e.y,-2E3*e.z);d.panorama.position.needsUpdate=
!0;e=(new TWEEN.Tween(d.panorama.position)).to({x:c.x,y:c.y,z:c.z},1500).easing(TWEEN.Easing.Cubic.Out);a.start();e.start().onStart(function(){d.panorama.children.map(function(a){(a instanceof W||a instanceof Y)&&a.hide()})}).onComplete(function(){d.panorama.children.map(function(a){(a instanceof W||a instanceof Y)&&a.show()})})}};this.render=function(){if(null===this.fromScene){var a=d&&(d.controlEnabled||!1===d.controlEnabled)?d.controlEnabled:!0;this.toScene.render(!1);this.toScene&&this.toScene.control&&
(this.toScene.control.enabled=a);this.transitionParams.animateTransition=!1}else this.transitionParams.animateTransition&&(a=1+Math.sin(this.transitionParams.transitionSpeed*this.clock.getElapsedTime()/Math.PI),this.transition=f.Math.smoothstep(a,this.transitionParams.smoothstep.start,this.transitionParams.smoothstep.end)),this.quadmaterial.uniforms.mixRatio.value=this.transition,0==this.transition?(a=d&&(d.controlEnabled||!1===d.controlEnabled)?d.controlEnabled:!0,this.toScene.render(!1),this.toScene&&
this.toScene.control&&(this.toScene.control.enabled=a),this.fromScene&&this.fromScene.control&&(this.fromScene.control.enabled=!1),this.transitionParams.animateTransition=!1):1==this.transition?(a=d&&(d.controlEnabled||!1===d.controlEnabled)?d.controlEnabled:!0,this.fromScene.render(!1),this.toScene&&this.toScene.control&&(this.toScene.control.enabled=!1),this.fromScene&&this.fromScene.control&&(this.fromScene.control.enabled=a)):(a=d&&(d.controlEnabled||!1===d.controlEnabled)?d.controlEnabled:!0,
this.fromScene.render(!0),this.toScene.render(!0),this.toScene&&this.toScene.control&&(this.toScene.control.enabled=a),this.fromScene&&this.fromScene.control&&(this.fromScene.control.enabled=a),c.setRenderTarget(null),c.clear(),c.clearDepth(),c.render(this.transitionScene,this.cameraOrtho))}}function Ta(a){var b="100%",c="100%";a&&a.container&&a.container.style&&(b=a.container.style.width||"100%",c=a.container.style.height||"100%");var d=a&&a.container?a.container:document.createElement("div");d.classList.add("panolens-container");
d.style.width=b;d.style.height=c;d._width=window.innerWidth;d._height=window.innerHeight;a&&a.container||document.body.appendChild(d);this.container=d;this.options=Object.assign({container:this.container,autoHideInfospot:!0,horizontalView:!1,controlBar:!0,controlButtons:[],autoHideControlBar:!0,clickTolerance:10,cameraFov:60,reverseDragging:!1,enableReticle:!1,dwellTime:1500,autoReticleSelect:!0,viewIndicator:!1,indicatorSize:30,output:null,autoRotate:!1,autoRotateSpeed:2,autoRotateActivationDuration:5E3,
initialLookAt:new f.Vector3(0,0,-Number.MAX_SAFE_INTEGER),cameraInitialLookAt:null,momentum:!0,rotateSpeed:-1,dampingFactor:.1,defaultFov:60,controlEnabled:!0},a);this.renderer=new f.WebGLRenderer({antialias:!1});this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setSize(window.innerWidth,window.innerHeight);this.renderer.autoClear=!1;this.renderer.setClearColor(0,0);this.renderer.domElement.classList.add("panolens-canvas");this.renderer.domElement.style.display="block";this.container.style.backgroundColor=
"#000";this.container.appendChild(this.renderer.domElement);this.options.renderer=this.renderer;this.options.container=this.container;this.controlIndex=this.mode=null;this.autoRotate=this.options.autoRotate;this.targetViewer=this.viewer=null;this.viewersQueue=[];this.composer=null;this.animate()}function Ga(a){ta.call(this,"image",a);this.scale.x*=-1;this.subtype=this.type="image_little_planet"}function Ua(a,b){function c(){return 2*Math.PI/60/60*h.autoRotateSpeed}function d(a){if(!1!==h.enabled){a.preventDefault();
if(a.button===h.mouseButtons.ORBIT){if(!0===h.noRotate)return;L=M.ROTATE;D.set(a.clientX,a.clientY)}else if(a.button===h.mouseButtons.ZOOM){if(!0===h.noZoom)return;L=M.DOLLY;pa.set(a.clientX,a.clientY)}else if(a.button===h.mouseButtons.PAN){if(!0===h.noPan)return;L=M.PAN;G.set(a.clientX,a.clientY)}L!==M.NONE&&(document.addEventListener("mousemove",e,!1),document.addEventListener("mouseup",t,!1),h.dispatchEvent(U))}}function e(a){if(!1!==h.enabled){a.preventDefault();var d=h.domElement===document?
h.domElement.body:h.domElement;L===M.ROTATE?!0!==h.noRotate&&(J.set(a.clientX,a.clientY),F.subVectors(J,D),0==D.x&&0==D.y?(D.set(J.x,J.y),F.subVectors(J,D)):(h.rotateLeft(2*Math.PI*F.x/d.clientHeight*h.rotateSpeed),h.rotateUp(2*Math.PI*F.y/d.clientHeight*h.rotateSpeed),D.copy(J))):L===M.DOLLY?!0!==h.noZoom&&(w.set(a.clientX,a.clientY),z.subVectors(w,pa),0<z.y?h.dollyIn():0>z.y&&h.dollyOut(),pa.copy(w)):L===M.PAN&&!0!==h.noPan&&(E.set(a.clientX,a.clientY),ma.subVectors(E,G),h.pan(ma.x,ma.y),G.copy(E))}}
function t(){!1!==h.enabled&&(document.removeEventListener("mousemove",e,!1),document.removeEventListener("mouseup",t,!1),h.dispatchEvent(T),L=M.NONE)}function r(a){if(!1!==h.enabled&&!0!==h.noZoom&&L===M.NONE){a.preventDefault();a.stopPropagation();var d=0;void 0!==a.wheelDelta?d=a.wheelDelta:void 0!==a.detail&&(d=-a.detail);0<d?(h.object.fov=h.object.fov<h.maxFov?h.object.fov+1:h.maxFov,h.object.updateProjectionMatrix()):0>d&&(h.object.fov=h.object.fov>h.minFov?h.object.fov-1:h.minFov,h.object.updateProjectionMatrix());
h.dispatchEvent(na);h.dispatchEvent(U);h.dispatchEvent(T);h.dispatchEvent(x)}}function l(a){}function k(a){if(!1!==h.enabled&&!0!==h.noKeys&&!0!==h.noRotate){h.autoRotate&&(clearTimeout(this.autoRotateRequestId),h.autoRotate=!1,this.autoRotateRequestId=window.setTimeout(function(){h.autoRotate=!0},5E3));var d=h.momentum&&!h.autoRotate?h.momentumKeydownFactor*h.momentumFactor:h.momentumKeydownFactor;switch(a.keyCode){case h.keys.UP:h.rotateUp(h.rotateSpeed*d);break;case h.keys.BOTTOM:h.rotateUp(-h.rotateSpeed*
d);break;case h.keys.LEFT:h.rotateLeft(h.rotateSpeed*d);break;case h.keys.RIGHT:h.rotateLeft(-h.rotateSpeed*d)}}}function m(a){if(!1!==h.enabled){switch(a.touches.length){case 1:if(!0===h.noRotate)return;L=M.TOUCH_ROTATE;D.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(!0===h.noZoom)return;L=M.TOUCH_DOLLY;var d=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;pa.set(0,Math.sqrt(d*d+a*a));break;case 3:if(!0===h.noPan)return;L=M.TOUCH_PAN;G.set(a.touches[0].pageX,
a.touches[0].pageY);break;default:L=M.NONE}L!==M.NONE&&h.dispatchEvent(U)}}function n(a){if(!1!==h.enabled){a.preventDefault();a.stopPropagation();var d=h.domElement===document?h.domElement.body:h.domElement;switch(a.touches.length){case 1:var b=.38*h.rotateSpeed;if(!0===h.noRotate)break;if(L!==M.TOUCH_ROTATE)break;J.set(a.touches[0].pageX,a.touches[0].pageY);F.subVectors(J,D);h.rotateLeft(2*Math.PI*F.x/d.clientHeight*b);h.rotateUp(2*Math.PI*F.y/d.clientHeight*b);D.copy(J);break;case 2:if(!0===h.noZoom)break;
if(L!==M.TOUCH_DOLLY)break;d=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;w.set(0,Math.sqrt(d*d+a*a));z.subVectors(w,pa);0>z.y?(h.object.fov=h.object.fov<h.maxFov?h.object.fov+1:h.maxFov,h.object.updateProjectionMatrix()):0<z.y&&(h.object.fov=h.object.fov>h.minFov?h.object.fov-1:h.minFov,h.object.updateProjectionMatrix());pa.copy(w);h.dispatchEvent(na);h.dispatchEvent(x);break;case 3:if(!0===h.noPan)break;if(L!==M.TOUCH_PAN)break;E.set(a.touches[0].pageX,a.touches[0].pageY);
ma.subVectors(E,G);h.pan(ma.x,ma.y);G.copy(E);break;default:L=M.NONE}}}function y(){!1!==h.enabled&&(h.dispatchEvent(T),L=M.NONE)}this.object=a;this.domElement=void 0!==b?b:document;this.frameId=null;this.enabled=!0;this.center=this.target=new f.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.noRotate=!1;this.rotateSpeed=-.15;this.noPan=!0;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=
0;this.maxPolarAngle=Math.PI;this.momentumKeydownFactor=.05;this.speedLimit=.04;this.publicSphericalDelta=new f.Spherical;this.momentum=!0;this.momentumFactor=7.5;this.enableDamping=!0;this.dampingFactor=.03;this.minFov=30;this.maxFov=120;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:f.MOUSE.LEFT,ZOOM:f.MOUSE.MIDDLE,PAN:f.MOUSE.RIGHT};var h=this,D=new f.Vector2,J=new f.Vector2,F=new f.Vector2,G=new f.Vector2,
E=new f.Vector2,ma=new f.Vector2,O=new f.Vector3,P=new f.Vector3,pa=new f.Vector2,w=new f.Vector2,z=new f.Vector2,aa=0,X=0,za=0,A=0,ra=1,K=new f.Vector3,la=new f.Vector3,R=new f.Quaternion,M={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},L=M.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;var kb=(new f.Quaternion).setFromUnitVectors(a.up,new f.Vector3(0,1,0)),Db=kb.clone().inverse(),na={type:"change"},U={type:"start"},
T={type:"end"},x={type:"fov"};this.setLastQuaternion=function(a){R.copy(a);h.object.quaternion.copy(a)};this.getLastPosition=function(){return la};this.rotateLeft=function(a){void 0===a&&(a=c());a=this.momentum&&!this.autoRotate?a/=this.momentumFactor:a;A-=a};this.rotateUp=function(a){void 0===a&&(a=c());a=this.momentum&&!this.autoRotate?a/=this.momentumFactor:a;za-=a};this.rotateLeftStatic=function(a){this.enableDamping=!1;A-=a;this.update();this.enableDamping=!0};this.rotateUpStatic=function(a){this.enableDamping=
!1;za-=a;this.update();this.enableDamping=!0};this.centerTo=function(a,d){var b=h.enableDamping;h.enableDamping=!1;var x=this.object.position;P.copy(x).sub(this.target);P.applyQuaternion(kb);aa=Math.atan2(P.x,P.z);X=Math.atan2(Math.sqrt(P.x*P.x+P.z*P.z),P.y);this.autoRotate&&L===M.NONE&&this.rotateLeft(c());aa=a;X=d;h.publicSphericalDelta.data={theta:aa};aa=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,aa));X=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,X));X=Math.max(1E-7,
Math.min(Math.PI-1E-7,X));a=P.length()*ra;a=Math.max(this.minDistance,Math.min(this.maxDistance,a));this.target.add(K);P.x=a*Math.sin(X)*Math.sin(aa);P.y=a*Math.cos(X);P.z=a*Math.sin(X)*Math.cos(aa);P.applyQuaternion(Db);x.copy(this.target).add(P);this.object.lookAt(this.target);ra=1;K.set(0,0,0);if(1E-7<la.distanceToSquared(this.object.position)||1E-7<8*(1-R.dot(this.object.quaternion)))this.dispatchEvent(na),la.copy(this.object.position),R.copy(this.object.quaternion);h.enableDamping=b};this.getRotations=
function(){return{h:aa,v:X}};this.panLeft=function(a){var d=this.object.matrix.elements;O.set(d[0],d[1],d[2]);O.multiplyScalar(-a);K.add(O)};this.panUp=function(a){var d=this.object.matrix.elements;O.set(d[4],d[5],d[6]);O.multiplyScalar(a);K.add(O)};this.pan=function(a,d){var b=h.domElement===document?h.domElement.body:h.domElement;if(h.object instanceof f.PerspectiveCamera){var c=h.object.position.clone().sub(h.target).length();c*=Math.tan(h.object.fov/2*Math.PI/180);h.panLeft(2*a*c/b.clientHeight);
h.panUp(2*d*c/b.clientHeight)}else h.object instanceof f.OrthographicCamera?(h.panLeft(a*(h.object.right-h.object.left)/b.clientWidth),h.panUp(d*(h.object.top-h.object.bottom)/b.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,h.zoomSpeed));h.object instanceof f.PerspectiveCamera?ra/=a:h.object instanceof f.OrthographicCamera?(h.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*
a)),h.object.updateProjectionMatrix(),h.dispatchEvent(na)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")};this.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,h.zoomSpeed));h.object instanceof f.PerspectiveCamera?ra*=a:h.object instanceof f.OrthographicCamera?(h.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/a)),h.object.updateProjectionMatrix(),h.dispatchEvent(na)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")};
this.update=function(a){var d=this.object.position;P.copy(d).sub(this.target);P.applyQuaternion(kb);aa=Math.atan2(P.x,P.z);X=Math.atan2(Math.sqrt(P.x*P.x+P.z*P.z),P.y);this.autoRotate&&L===M.NONE&&this.rotateLeft(c());!0===this.enableDamping&&(A=f.Math.clamp(A,-this.speedLimit,this.speedLimit),za=f.Math.clamp(za,-this.speedLimit,this.speedLimit));aa+=A;X+=za;h.publicSphericalDelta.data={theta:aa};aa=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,aa));X=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,
X));X=Math.max(1E-7,Math.min(Math.PI-1E-7,X));var b=P.length()*ra;b=Math.max(this.minDistance,Math.min(this.maxDistance,b));this.target.add(K);P.x=b*Math.sin(X)*Math.sin(aa);P.y=b*Math.cos(X);P.z=b*Math.sin(X)*Math.cos(aa);P.applyQuaternion(Db);d.copy(this.target).add(P);this.object.lookAt(this.target);this.autoRotate||!0!==this.enableDamping||(!this.momentum||L!==M.ROTATE&&L!==M.TOUCH_ROTATE)&&L!==M.NONE?za=A=0:(A*=1-this.dampingFactor,za*=1-this.dampingFactor);ra=1;K.set(0,0,0);if(1E-7<la.distanceToSquared(this.object.position)||
1E-7<8*(1-R.dot(this.object.quaternion)))!0!==a&&this.dispatchEvent(na),la.copy(this.object.position),R.copy(this.object.quaternion)};this.reset=function(){L=M.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.object.zoom=this.zoom0;this.object.updateProjectionMatrix();this.dispatchEvent(na);this.update()};this.getPolarAngle=function(){return X};this.getAzimuthalAngle=function(){return aa};this.dispose=function(){this.domElement.removeEventListener("mousedown",d);
this.domElement.removeEventListener("mousewheel",r);this.domElement.removeEventListener("DOMMouseScroll",r);this.domElement.removeEventListener("touchstart",m);this.domElement.removeEventListener("touchend",y);this.domElement.removeEventListener("touchmove",n);window.removeEventListener("keyup",l);window.removeEventListener("keydown",k)};this.domElement.addEventListener("mousedown",d,{passive:!1});this.domElement.addEventListener("mousewheel",r,{passive:!1});this.domElement.addEventListener("DOMMouseScroll",
r,{passive:!1});this.domElement.addEventListener("touchstart",m,{passive:!1});this.domElement.addEventListener("touchend",y,{passive:!1});this.domElement.addEventListener("touchmove",n,{passive:!1});window.addEventListener("keyup",l,{passive:!1});window.addEventListener("keydown",k,{passive:!1});this.update()}function Va(a,b){var c=this,d=0,e=0,t=0,r=0;this.camera=a;this.camera.rotation.reorder("YXZ");this.domElement=void 0!==b?b:document;this.enabled=!0;this.deviceOrientation={alpha:null,beta:null,
gamma:null};this.initialViewOffsetAngle=this.alphaOffsetAngle=this.alpha=this.screenOrientation=0;var l=function(a){null==c.deviceOrientation.alpha&&a&&a.alpha&&(c.initialViewOffsetAngle=f.Math.degToRad(a.alpha));c.enabled&&(c.deviceOrientation=a)},k=function(){c.screenOrientation=window.orientation||0},m=function(a){c.enabled&&(a.preventDefault(),a.stopPropagation(),t=a.touches[0].pageX,r=a.touches[0].pageY)},n=function(a){c.enabled&&(a.preventDefault(),a.stopPropagation(),d+=f.Math.degToRad((a.touches[0].pageX-
t)/4),e+=f.Math.degToRad((r-a.touches[0].pageY)/4),c.updateAlphaOffsetAngle(d),t=a.touches[0].pageX,r=a.touches[0].pageY)};this.connect=function(){k();window.addEventListener("orientationchange",k,{passive:!0});window.addEventListener("deviceorientation",l,{passive:!0});window.addEventListener("deviceorientation",this.update.bind(this),{passive:!0});c.domElement.addEventListener("touchstart",m,{passive:!1});c.domElement.addEventListener("touchmove",n,{passive:!1});c.enabled=!0};this.disconnect=function(){window.removeEventListener("orientationchange",
k,!1);window.removeEventListener("deviceorientation",l,!1);window.removeEventListener("deviceorientation",this.update.bind(this),!1);c.domElement.removeEventListener("touchstart",m,!1);c.domElement.removeEventListener("touchmove",n,!1);c.enabled=!1};this.update=function(a){if(!1!==c.enabled){a=null!=c.deviceOrientation.alpha?f.Math.degToRad(c.deviceOrientation.alpha)+c.alphaOffsetAngle-c.initialViewOffsetAngle:c.alphaOffsetAngle;var d=null!=c.deviceOrientation.beta?f.Math.degToRad(c.deviceOrientation.beta):
1.6,b=null!=c.deviceOrientation.gamma?f.Math.degToRad(c.deviceOrientation.gamma):0,n=c.screenOrientation?f.Math.degToRad(c.screenOrientation):0,t=c.camera.quaternion,y=new f.Vector3(0,0,1),m=new f.Euler,k=new f.Quaternion,r=new f.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),l=new f.Quaternion,pa=new f.Quaternion;if(0==c.screenOrientation){var w=new f.Vector3(1,0,0);l.setFromAxisAngle(w,-e)}else 180==c.screenOrientation?(w=new f.Vector3(1,0,0),l.setFromAxisAngle(w,e)):90==c.screenOrientation?(w=new f.Vector3(0,
1,0),l.setFromAxisAngle(w,e)):-90==c.screenOrientation&&(w=new f.Vector3(0,1,0),l.setFromAxisAngle(w,-e));r.multiply(l);r.multiply(pa);m.set(d,a,-b,"YXZ");t.setFromEuler(m);t.multiply(r);t.multiply(k.setFromAxisAngle(y,-n));c.alpha=a}};this.updateAlphaOffsetAngle=function(a){this.alphaOffsetAngle=a;0==d&&(d=a);this.update()};this.getRotations=function(){return{h:c.alpha,v:0}};this.dispose=function(){this.disconnect()};this.connect()}function Ha(a,b,c){function d(){c.addEventListener("mousemove",t,
!1);c.addEventListener("mousedown",r,!1);c.addEventListener("mouseup",l,!1);c.addEventListener("mouseleave",l,!1);c.addEventListener("touchmove",k,!1);c.addEventListener("touchstart",m,!1);c.addEventListener("touchend",n,!1)}function e(){c.removeEventListener("mousemove",t,!1);c.removeEventListener("mousedown",r,!1);c.removeEventListener("mouseup",l,!1);c.removeEventListener("mouseleave",l,!1);c.removeEventListener("touchmove",k,!1);c.removeEventListener("touchstart",m,!1);c.removeEventListener("touchend",
n,!1)}function t(d){d.preventDefault();var e=c.getBoundingClientRect();J.x=(d.clientX-e.left)/e.width*2-1;J.y=2*-((d.clientY-e.top)/e.height)+1;D.setFromCamera(J,b);E&&O.enabled?(D.ray.intersectPlane(h,G)&&E.position.copy(G.sub(F)),O.dispatchEvent({type:"drag",object:E})):(D.setFromCamera(J,b),d=D.intersectObjects(a),0<d.length?(d=d[0].object,h.setFromNormalAndCoplanarPoint(b.getWorldDirection(h.normal),d.position),ma!==d&&(O.dispatchEvent({type:"hoveron",object:d}),c.style.cursor="pointer",ma=d)):
null!==ma&&(O.dispatchEvent({type:"hoveroff",object:ma}),c.style.cursor="auto",ma=null))}function r(d){d.preventDefault();D.setFromCamera(J,b);d=D.intersectObjects(a);0<d.length&&(E=d[0].object,D.ray.intersectPlane(h,G)&&F.copy(G).sub(E.position),c.style.cursor="move",O.dispatchEvent({type:"dragstart",object:E}))}function l(a){a.preventDefault();E&&(O.dispatchEvent({type:"dragend",object:E}),E=null);c.style.cursor="auto"}function k(a){a.preventDefault();a=a.changedTouches[0];var d=c.getBoundingClientRect();
J.x=(a.clientX-d.left)/d.width*2-1;J.y=2*-((a.clientY-d.top)/d.height)+1;D.setFromCamera(J,b);E&&O.enabled&&(D.ray.intersectPlane(h,G)&&E.position.copy(G.sub(F)),O.dispatchEvent({type:"drag",object:E}))}function m(d){d.preventDefault();d=d.changedTouches[0];var e=c.getBoundingClientRect();J.x=(d.clientX-e.left)/e.width*2-1;J.y=2*-((d.clientY-e.top)/e.height)+1;D.setFromCamera(J,b);d=D.intersectObjects(a);0<d.length&&(E=d[0].object,h.setFromNormalAndCoplanarPoint(b.getWorldDirection(h.normal),E.position),
D.ray.intersectPlane(h,G)&&F.copy(G).sub(E.position),c.style.cursor="move",O.dispatchEvent({type:"dragstart",object:E}))}function n(a){a.preventDefault();E&&(O.dispatchEvent({type:"dragend",object:E}),E=null);c.style.cursor="auto"}if(a.isCamera){console.warn("THREE.DragControls: Constructor now expects ( objects, camera, domElement )");var y=a;a=b;b=y}var h=new f.Plane,D=new f.Raycaster,J=new f.Vector2,F=new f.Vector3,G=new f.Vector3,E=null,ma=null,O=this;d();this.enabled=!0;this.activate=d;this.deactivate=
e;this.dispose=function(){e()};this.setObjects=function(){console.error("THREE.DragControls: setObjects() has been removed.")};this.on=function(a,d){console.warn("THREE.DragControls: on() has been deprecated. Use addEventListener() instead.");O.addEventListener(a,d)};this.off=function(a,d){console.warn("THREE.DragControls: off() has been deprecated. Use removeEventListener() instead.");O.removeEventListener(a,d)};this.notify=function(a){console.error("THREE.DragControls: notify() has been deprecated. Use dispatchEvent() instead.");
O.dispatchEvent({type:a})}}function Aa(a){this.format=null;this.eyeSep=void 0===a?.064:a;this.loffset=new f.Vector2;this.roffset=new f.Vector2}function Ia(a,b){b=void 0===b?new Aa:b;ba.call(this,a);this.stereo=b;this.type="stereo_image_panorama"}function Ja(a,b,c){b=void 0===b?{}:b;c=void 0===c?new Aa:c;ia.call(this,a,b);this.stereo=c;this.type="stereo_video_panorama"}function lb(a){var b=new f.OrthographicCamera(-1,1,1,-1,0,1),c=new f.Scene,d=new f.StereoCamera;d.aspect=.5;var e=new f.WebGLRenderTarget(512,
512,{minFilter:f.LinearFilter,magFilter:f.NearestFilter,format:f.RGBAFormat});e.scissorTest=!0;e.texture.generateMipmaps=!1;var t=new f.Vector2(.441,.156),r=(new f.PlaneBufferGeometry(1,1,10,20)).removeAttribute("normal").toNonIndexed(),l=r.attributes.position.array,k=r.attributes.uv.array;r.attributes.position.count*=2;r.attributes.uv.count*=2;var m=new Float32Array(2*l.length);m.set(l);m.set(l,l.length);var n=new Float32Array(2*k.length);n.set(k);n.set(k,k.length);k=new f.Vector2;l=l.length/3;for(var y=
0,h=m.length/3;y<h;y++){k.x=m[3*y];k.y=m[3*y+1];var D=k.dot(k);D=1.5+(t.x+t.y*D)*D;var J=y<l?0:1;m[3*y]=k.x/D*1.5-.5+J;m[3*y+1]=k.y/D*3;n[2*y]=.5*(n[2*y]+J)}r.attributes.position.array=m;r.attributes.uv.array=n;t=new f.MeshBasicMaterial({map:e.texture});r=new f.Mesh(r,t);c.add(r);this.setEyeSeparation=function(a){d.eyeSep=a};this.setSize=function(d,b){a.setSize(d,b);var c=a.getPixelRatio();e.setSize(d*c,b*c)};this.render=function(h,n,t){var J=t instanceof Ia||t instanceof Ja;h.updateMatrixWorld();
J&&this.setEyeSeparation(t.stereo.eyeSep);null===n.parent&&n.updateMatrixWorld();d.update(n);n=e.width/2;var D=e.height;a.autoClear&&a.clear();J&&t.updateTextureToLeft();e.scissor.set(0,0,n,D);e.viewport.set(0,0,n,D);a.setRenderTarget(e);a.render(h,d.cameraL);a.clearDepth();J&&t.updateTextureToRight();e.scissor.set(n,0,n,D);e.viewport.set(n,0,n,D);a.setRenderTarget(e);a.render(h,d.cameraR);a.clearDepth();a.setRenderTarget(null);a.render(c,b)}}function Ka(a){a=void 0===a?{}:a;this.options=Object.assign({container:this.setupContainer(a.container),
controlBar:!0,controlButtons:[],autoHideControlBar:!0,autoHideInfospot:!0,horizontalView:!1,clickTolerance:10,cameraFov:60,reverseDragging:!1,enableReticle:!1,dwellTime:1500,autoReticleSelect:!0,viewIndicator:!1,indicatorSize:30,output:null,autoRotate:!1,autoRotateSpeed:2,autoRotateActivationDuration:5E3,initialLookAt:new f.Vector3(0,0,-Number.MAX_SAFE_INTEGER),cameraInitialLookAt:null,momentum:!0,rotateSpeed:-1,dampingFactor:.1,defaultFov:60},a);this.viewerInstanceNumber=Math.floor(30*Math.random());
var b=this.options;a=b.container;var c=b.cameraFov,d=b.defaultFov,e=b.controlBar,t=b.viewIndicator,r=b.indicatorSize,l=b.enableReticle,k=b.reverseDragging,m=b.output,n=b.scene,y=b.camera;b=b.renderer;var h=a.clientWidth,D=a.clientHeight,J={minFilter:f.LinearFilter,magFilter:f.LinearFilter};this.fbo=new f.WebGLRenderTarget(h,D,J);this.reticleFbo=new f.WebGLRenderTarget(h,D,J);this.container=a;this.scene=this.setupScene(n);this.sceneReticle=new f.Scene;this.defaultFov=d;this.camera=this.setupCamera(c,
h/D,y);this.renderer=this.setupRenderer(b,a);this.reticle=this.addReticle(this.camera,this.sceneReticle);this.control=this.setupControls(this.camera,a);this.effect=this.setupEffects(this.renderer,a);this.lastTouch={plane:null,scene:null};this.containerCursor=oa.GRAB;this.CURSORS=oa;this.mode=K.NORMAL;this.pressObject=this.pressEntityObject=this.infospot=this.hoverObject=this.widget=this.panorama=null;this.raycaster=new f.Raycaster;this.raycasterPoint=new f.Vector2;this.userMouse=new f.Vector2;this.updateCallbacks=
[];this.requestAnimationId=null;this.cameraFrustum=new f.Frustum;this.cameraViewProjectionMatrix=new f.Matrix4;this.outputDivElement=this.autoRotateRequestId=null;this.touchSupported="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;this.tweenLeftAnimation=new z.Tween;this.tweenUpAnimation=new z.Tween;this.tweenCanvasOpacityOut=new z.Tween;this.tweenCanvasOpacityIn=new z.Tween;this.outputEnabled=!1;this.viewIndicatorSize=r;this.tempEnableReticle=l;this.setupTween();
this.handlerMouseUp=this.onMouseUp.bind(this);this.handlerMouseDown=this.onMouseDown.bind(this);this.handlerMouseMove=this.onMouseMove.bind(this);this.handlerWindowResize=this.onWindowResize.bind(this);this.handlerKeyDown=this.onKeyDown.bind(this);this.handlerKeyUp=this.onKeyUp.bind(this);this.handlerTap=this.onTap.bind(this,{clientX:h/2,clientY:D/2});e&&this.addDefaultControlBar(this.options.controlButtons);t&&this.addViewIndicator();k&&this.reverseDraggingDirection();l?this.enableReticleControl():
this.registerMouseAndTouchEvents();"overlay"===m&&this.addOutputElement();this.registerEventListeners();Wa?window.setInterval(this.animate.bind(this),1E3/60):this.animate.call(this);this.setupFloorCursor()}var mb="^0.105.2".replace(/[^0-9.]/g,""),da={ORBIT:0,DEVICEORIENTATION:1,OBJECT:2,DRAG:3},K={UNKNOWN:0,NORMAL:1,CARDBOARD:2,STEREO:3},sa={TAB:0,SBS:1},qa={X:0,Y:-200,Z:0},oa={DEFAULT:"default",POINTER:"pointer",GRAB:"-webkit-grab",CROSSHAIR:"crosshair"},R={Info:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADBklEQVR42u2bP08UQRiHnzFaSYCI/xoksdBIqGwIiYWRUBISExpCQ0ej38FWOmlIKKhoMPEbaCxsrrHiYrQgOSlQEaICrT+LHSPZzNzt3s3c3Hn7lHvLzvv82L2dm30XKioqKgYY062BJF0HpoA7wARwBbhsPz4DjoEG8AnYNcZ8Sx1Op8IXJM1KWpdUV3nq9m9nJV1I7VNGfEzSM0mNNqR9NOwxx1L7NRMflbQm6SSgeJ4TO8Zoat+8/LKkg4jieQ4kLaf2RtKwpJ0uiufZkTScSn5S0l5C+b/sSZrstvyMpKPU5uc4kjTTjkvpeYCkaeA1/+7hvcIZMGuMqUULQNIU8Aa4ltrWwyHwyBizGzwASSPAe+B2assW7AH3jTE/i+xcZoa12Qfy2Bo3i+5cKABl99zF1GYlWFTBeULLS0DZrOsDcDNggTXgc27bLWA64BhfgHvGmB8dHUXZ1DM0S45xliKMs9bKr+klIOkqsBrwv9JtVq1DewEAT4Ch1BYdMGQdygeg7Df4SmqDAKyoyXpCszPgITCeuvoAjFuX0gE8jljUdv7bCtiOOJ7XpdUZ8L/gdXHOA5QtYH5NXXVgbrgWWn1nwFTqaiPgdPIFcDd1tRFwOl307DwRuZgXwLvctgfA04hjOp18AcReZ6sZY16e3yDpUuQxnU6+S2AkcjEpcDr1zxOXSPgCKLSa0mc4nXwB/EpdbQScTr4AGqmrjYDTyRfAx9TVRsDp5Aug8LJyH+F0cgZg58z11BUHpO5ruGh2G3ybuuqAeF2aBfAqddUB8bq0OgP2U1cegH3aOQOMMb+BrdTVB2DLupQLwLIOnKY26IBT6+ClaQDGmO/ARmqLDtiwDn7HVkcY+EdjNoTlCI+tYhO2iUppm6HKslPUq2qQKHpUe8AFsjaUXuUQWCgqXyoAG8IuME/WkNRrnAHzZfqDSgdgQ6gBc2Td3b3CMTBXtkOsIzTIjZLnQhjcVtlcEIPZLJ0LoVvt8s/Va+3yuSAG84UJRxB98cpM9dJURUVFxSDzBxKde4Lk3/h2AAAAAElFTkSuQmCC",
Check:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTIxLDdMOSwxOUwzLjUsMTMuNUw0LjkxLDEyLjA5TDksMTYuMTdMMTkuNTksNS41OUwyMSw3WiIgLz48L3N2Zz4=",
WhiteTile:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIABAMAAAAGVsnJAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAB1WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KAtiABQAAACRQTFRFAAAAAAAABgYGBwcHHh4eKysrx8fHy8vLzMzM7OzsAAAABgYG+q7SZgAAAAp0Uk5TAP7+/v7+/v7+/iJx/a8AAAOwSURBVHja7d0hbsNAEAVQo6SFI6XEcALDcgNLvUBvEBQVhpkWVYWlhSsVFS7t5QIshRt695lEASZP+8c7a1kzDL1fz+/zyuvzp6FbvoddrL6uDd1yGZ5eXldeb18N3fIx7A+58prmhm65DfvDcd0952lu6JabFbD/zVprZj1lzcys+fj9z8xTZtbT8rv8yWlu6BYAIgAAAAAAAAAAAABAM6QXEAEAAAAAAAAAgJ2gnaAIiIA3Q2qAGgAAAAAAAAAAAAAAAAAAAAAAAAAAQJsADkVFAAAAAAA8Bj0GRUAEREAEREAEREAEREAEAAAAAAAAAAB2gnaCIiACPplRA9QANUAERAAAAEVQERQBERCBVlfAcZ3aeZobusUKMGBhV6KUElHGKBERJR6/fxExRkQZl9/lT8S1oVsuhqyYMmPKjCkzvfcCpsxohrwY0Q06EAEAAAAAAAAAAACgGdILiAAAAAAAAAAAwE7QTlAERMCbITVADQAAAAAAAAAAAAAAAAAAAAAAAAAAwKmwQ1ERAAAAAACPQY9BERABERABERABERABERABAAAAAAAAAICdoJ2gCIiAT2bUADVADRABEQAAQBFUBEVABERgEyvAlJm+V4ApM6bMmDJjyowpM6bMdN0LmDKjGfJiRDfoQAQAAAAAAAAAAACAZkgvIAIAAAAAAAAAADtBO0EREAFvhtQANQAAAAAAAAAAAAAAAAAAAAAAAAAAAKfCDkVFAAAAAAA8Bj0GRUAEREAEREAEREAEREAEAAAAAAAAAAB2gnaCIiACPplRA9QANUAERAAAAEVQERQBERCBTawAU2b6XgGmzJgyY8qMKTOmzJgy03UvYMqMZsiLEd2gAxEAAAAAAAAAAAAAmiG9gAgAAAAAAAAAAOwE7QRFQAS8GVID1AAAAAAAAAAAAAAAAAAAAAAAAAAAAJwKOxQVAQAAAADwGPQYFAEREAEREAEREAEREAERAAAAAAAAAADYCdoJioAI+GRGDVAD1AAREAEAABRBRVAEREAENrECTJnpewWYMmPKjCkzpsyYMmPKTNe9gCkzmiEvRnSDDkQAAAAAAAAAAAAAaIb0AiIAAAAAAAAAALATtBMUARHwZkgNUAMAAAAAAAAAAAAAAAAAAAAAAAAAAHAq7FBUBAAAAADAY9BjUAREQAREQAREQAREQAREAAAAAAAAAABgJ2gnKAIi4JMZNUANUANEQAQAAFAEFUEREAER2MQKMGWm7xVgyowpM50PWen9ugNGXz1XaocAFgAAAABJRU5ErkJggg==",
ViewIndicator:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBpZD0idmlldy1pbmRpY2F0b3IiIGhlaWdodD0iMzAiIHdpZHRoPSIzMCIgdmlld0JveD0iLTIuNSAtMSAzMCAzMCI+Cgk8c3R5bGUgdHlwZT0idGV4dC9jc3MiPi5zdDB7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLW1pdGVybGltaXQ6MTA7ZmlsbDpub25lO30uc3Qxe3N0cm9rZS13aWR0aDo2O3N0cm9rZS1taXRlcmxpbWl0OjEwO30KCTwvc3R5bGU+Cgk8Zz4KCQk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNIDEyLjUgMCBBIDEyLjUgMTIuNSAwIDAgMCAtMTIuNSAwIEEgMTIuNSAxMi41IDAgMCAwIDEyLjUgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0gMTMgMCBMIDEwIDIgTCAxNiAyIFoiPjwvcGF0aD4KCQk8cGF0aCBjbGFzcz0ic3QyIiBkPSJNIDIgMCBBIDIgMiAwIDAgMCAtMiAwIEEgMiAyIDAgMCAwIDIgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDEiIGlkPSJpbmRpY2F0b3IiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMTMsMTUuNSkiPjwvcGF0aD4KCTwvZz4KPC9zdmc+",
VideoPlay:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTgsNS4xNFYxOS4xNEwxOSwxMi4xNEw4LDUuMTRaIiAvPjwvc3ZnPg==",VideoPause:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE5LjE0SDE4VjUuMTRIMTRNNiwxOS4xNEgxMFY1LjE0SDZWMTkuMTRaIiAvPjwvc3ZnPg==",
VideoUnmute:"data:image/svg+xml;base64,PHN2ZyBpZD0iU3ZnanNTdmcxMDAxIiB3aWR0aD0iMjg4IiBoZWlnaHQ9IjI4OCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxuczpzdmdqcz0iaHR0cDovL3N2Z2pzLmNvbS9zdmdqcyI+PGRlZnMgaWQ9IlN2Z2pzRGVmczEwMDIiPjwvZGVmcz48ZyBpZD0iU3ZnanNHMTAwOCIgdHJhbnNmb3JtPSJtYXRyaXgoMC45MTY3LDAsMCwwLjkxNjcsMTIuMTc5NDIyNTcxNTYzNzIsMTIuMjM4MTQzMTg2NTY5MjMyKSI+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyODgiIGhlaWdodD0iMjg4IiB2ZXJzaW9uPSIxLjAiIHZpZXdCb3g9IjAgMCA3NSA3NSI+PHBhdGggZmlsbD0iI2ZmZmZmZiIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjUiIGQ9Ik0zOS4zODksMTMuNzY5IEwyMi4yMzUsMjguNjA2IEw2LDI4LjYwNiBMNiw0Ny42OTkgTDIxLjk4OSw0Ny42OTkgTDM5LjM4OSw2Mi43NSBMMzkuMzg5LDEzLjc2OXoiIGNsYXNzPSJjb2xvcjExMSBzdmdTaGFwZSBjb2xvclN0cm9rZTExMSBzdmdTdHJva2UiPjwvcGF0aD48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNDgsMjcuNmExOS41LDE5LjUgMCAwIDEgMCwyMS40TTU1LjEsMjAuNWEzMCwzMCAwIDAgMSAwLDM1LjZNNjEuNiwxNGEzOC44LDM4LjggMCAwIDEgMCw0OC42IiBjbGFzcz0iY29sb3JTdHJva2UxMTEgc3ZnU3Ryb2tlIj48L3BhdGg+PC9zdmc+PC9nPjwvc3ZnPg==",
VideoMute:"data:image/svg+xml;base64,PHN2ZyBzdHJva2Utd2lkdGg9IjUiIHN0cm9rZT0id2hpdGUiIHZpZXdCb3g9IjAgMCA3NSA3NSIgaGVpZ2h0PSI1MDAiIHdpZHRoPSI1MDAiIHZlcnNpb249IjEuMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZmlsbD0id2hpdGUiIGQ9Im0zOSwxNC0xNywxNUg2VjQ4SDIybDE3LDE1eiI+PC9wYXRoPgo8cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIGZpbGw9Im5vbmUiIGQ9Im00OSwyNiAyMCwyNG0wLTI0LTIwLDI0Ij48L3BhdGg+Cjwvc3ZnPg=="},Xa={load:function(a,b,c,d){b=void 0===b?function(){}:b;c=void 0===
c?function(){}:c;d=void 0===d?function(){}:d;f.Cache.enabled=!0;var e,t,r;for(y in R)R.hasOwnProperty(y)&&a===R[y]&&(r=y);var l=f.Cache.get(r?r:a);if(void 0!==l)return b&&setTimeout(function(){c({loaded:1,total:1});b(l)},0),l;var k=window.URL||window.webkitURL;var m=document.createElementNS("http://www.w3.org/1999/xhtml","img");var n=function(){k.revokeObjectURL(m.src);void 0==l&&f.Cache.add(r?r:a,m);b(m)};if(0===a.indexOf("data:"))return m.addEventListener("load",n,!1),m.src=a,m;m.crossOrigin=void 0!==
this.crossOrigin?this.crossOrigin:"";var y=new window.XMLHttpRequest;y.open("GET",a,!0);y.responseType="arraybuffer";y.addEventListener("error",d);y.addEventListener("progress",function(a){if(a){var d=a.loaded,b=a.total;a.lengthComputable&&c({loaded:d,total:b})}});y.addEventListener("loadend",function(a){a&&(e=new Uint8Array(a.currentTarget.response),t=new window.Blob([e]),m.addEventListener("load",n,!1),m.addEventListener("error",n,!1),m.src=k.createObjectURL(t))});y.send(null)}},Ca={load:function(a,
b,c,d){b=void 0===b?function(){}:b;var e=new f.Texture;Xa.load(a,function(d){e.image=d;d=0<a.search(/\.(jpg|jpeg)$/)||0===a.search(/^data:image\/jpeg/);e.format=d?f.RGBFormat:f.RGBAFormat;e.needsUpdate=!0;b(e)},c,d);return e}},Ya={load:function(a,b,c,d){b=void 0===b?function(){}:b;c=void 0===c?function(){}:c;var e;var t=new f.CubeTexture([]);var r=0;var l={};var k={};a.map(function(a,n){Xa.load(a,function(a){t.images[n]=a;r++;6===r&&(t.needsUpdate=!0,b(t))},function(a){l[n]={loaded:a.loaded,total:a.total};
k.loaded=0;e=k.total=0;for(var d in l)e++,k.loaded+=l[d].loaded,k.total+=l[d].total;6>e&&(k.total=k.total/e*6);c(k)},d)});return t}};ka.prototype=Object.assign(Object.create(f.EventDispatcher.prototype),{constructor:ka,addControlBar:function(){if(this.container){var a=this,b,c;var d=document.createElement("div");d.classList.add("videoWidgetBar");d.style.width="200px";d.style.height="44px";d.style.left="50%";d.style.transform=d.style.webkitTransform=d.style.msTransform="translate(-100px, -100%)";d.style.bottom=
"120px";d.style.background="-webkit-linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))";d.style.background="-moz-linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))";d.style.background="-o-linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))";d.style.background="-ms-linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))";d.style.background="linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))";d.style.transition=this.DEFAULT_TRANSITION;d.style.pointerEvents="none";d.style.position=
"absolute";d.isHidden=!1;d.toggle=function(){d.isHidden=!d.isHidden;b=d.isHidden?"translate(-100px, 0)":"translate(-100px, -100%)";c=d.isHidden?0:1;d.style.transform=d.style.webkitTransform=d.style.msTransform=b;d.style.opacity=c};var e=this.createDefaultMenu();this.mainMenu=this.createMainMenu(e);d.appendChild(this.mainMenu);this.mask=e=this.createMask();this.container.appendChild(e);d.dispose=function(){a.fullscreenElement&&(d.removeChild(a.fullscreenElement),a.fullscreenElement.dispose(),a.fullscreenElement=
null);a.settingElement&&(d.removeChild(a.settingElement),a.settingElement.dispose(),a.settingElement=null);a.videoElement&&(d.removeChild(a.videoElement),a.videoElement.dispose(),a.videoElement=null)};this.container.appendChild(d);this.mask.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0);this.mask.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,!0);this.mask.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0);this.mask.addEventListener(a.TOUCH_ENABLED?"touchend":"click",
function(d){d.preventDefault();d.stopPropagation();a.mask.hide();a.settingElement.deactivate()},!1);this.addEventListener("control-bar-toggle",d.toggle);this.barElement=d}else console.warn("Widget container not set")},createDefaultMenu:function(){var a=this;var b=function(b,d){return function(){a.dispatchEvent({type:"panolens-viewer-handler",method:b,data:d})}};return[{title:"Control",subMenu:[{title:this.TOUCH_ENABLED?"Touch":"Mouse",handler:b("enableControl",da.ORBIT)},{title:"Sensor",handler:b("enableControl",
da.DEVICEORIENTATION)}]},{title:"Mode",subMenu:[{title:"Normal",handler:b("disableEffect")},{title:"Cardboard",handler:b("enableEffect",K.CARDBOARD)},{title:"Stereoscopic",handler:b("enableEffect",K.STEREO)}]}]},addControlButton:function(a){switch(a){case "fullscreen":this.fullscreenElement=a=this.createFullscreenButton();break;case "setting":this.settingElement=a=this.createSettingButton();break;case "video":this.videoElement=a=this.createVideoControl();break;default:return}a&&this.barElement.appendChild(a)},
createMask:function(){var a=document.createElement("div");a.classList.add("videoWidgetMask");a.style.position="absolute";a.style.top=0;a.style.left=0;a.style.width="100%";a.style.height="100%";a.style.background="transparent";a.style.display="none";a.show=function(){this.style.display="block"};a.hide=function(){this.style.display="none"};return a},createSettingButton:function(){var a=this;var b=this.createCustomItem({style:{backgroundImage:'url("'+R.Setting+'")',webkitTransition:this.DEFAULT_TRANSITION,
transition:this.DEFAULT_TRANSITION},onTap:function(b){b.preventDefault();b.stopPropagation();a.mainMenu.toggle();this.activated?this.deactivate():this.activate()}});b.activate=function(){this.style.transform="rotate3d(0,0,1,90deg)";this.activated=!0;a.mask.show()};b.deactivate=function(){this.style.transform="rotate3d(0,0,0,0)";this.activated=!1;a.mask.hide();a.mainMenu&&a.mainMenu.visible&&a.mainMenu.hide();a.activeSubMenu&&a.activeSubMenu.visible&&a.activeSubMenu.hide();a.mainMenu&&a.mainMenu._width&&
(a.mainMenu.changeSize(a.mainMenu._width),a.mainMenu.unslideAll())};b.activated=!1;return b},createFullscreenButton:function(){function a(){d&&(c=!c,t.style.backgroundImage=c?'url("'+R.FullscreenLeave+'")':'url("'+R.FullscreenEnter+'")');b.dispatchEvent({type:"panolens-viewer-handler",method:"onWindowResize"});d=!0}var b=this,c=!1,d=!0,e=this.container;if(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled){document.addEventListener("fullscreenchange",
a,!1);document.addEventListener("webkitfullscreenchange",a,!1);document.addEventListener("mozfullscreenchange",a,!1);document.addEventListener("MSFullscreenChange",a,!1);var t=this.createCustomItem({style:{backgroundImage:'url("'+R.FullscreenEnter+'")'},onTap:function(a){a.preventDefault();a.stopPropagation();d=!1;c?(document.exitFullscreen&&document.exitFullscreen(),document.msExitFullscreen&&document.msExitFullscreen(),document.mozCancelFullScreen&&document.mozCancelFullScreen(),document.webkitExitFullscreen&&
document.webkitExitFullscreen(),c=!1):(e.requestFullscreen&&e.requestFullscreen(),e.msRequestFullscreen&&e.msRequestFullscreen(),e.mozRequestFullScreen&&e.mozRequestFullScreen(),e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),c=!0);this.style.backgroundImage=c?'url("'+R.FullscreenLeave+'")':'url("'+R.FullscreenEnter+'")'}});if(!document.querySelector("panolens-style-addon")){var f=document.createElement("style");f.id="panolens-style-addon";f.innerHTML=":-webkit-full-screen { width: 100% !important; height: 100% !important }";
document.body.appendChild(f)}return t}},createVideoControl:function(){var a=document.createElement("span");a.style.display="none";a.show=function(){a.style.display=""};a.hide=function(){a.style.display="none";a.controlButton.paused=!0;a.controlButton.update()};a.controlButton=this.createVideoControlButton();a.soundButton=this.createVideoSoundButton();a.seekBar=this.createVideoControlSeekbar();a.appendChild(a.controlButton);a.appendChild(a.seekBar);a.appendChild(a.soundButton);a.dispose=function(){a.removeChild(a.controlButton);
a.removeChild(a.seekBar);a.controlButton.dispose();a.controlButton=null;a.seekBar.dispose();a.seekBar=null};this.addEventListener("video-control-show",a.show);this.addEventListener("video-control-hide",a.hide);return a},createVideoControlButton:function(){var a=this,b=this.createCustomItem({style:{float:"left",backgroundImage:'url("'+R.VideoPlay+'")'},onTap:function(c){c.preventDefault();c.stopPropagation();a.dispatchEvent({type:"panolens-viewer-handler",method:"toggleVideoPlay",data:!this.paused});
this.paused=!this.paused;b.update()}});b.paused=!0;b.update=function(a){this.paused=void 0!==a?a:this.paused;this.style.backgroundImage='url("'+(this.paused?R.VideoPlay:R.VideoPause)+'")'};return b},createVideoSoundButton:function(){var a=this,b=this.createCustomItem({style:{float:"left",backgroundImage:'url("'+R.VideoMute+'")'},onTap:function(c){c.preventDefault();c.stopPropagation();a.dispatchEvent({type:"panolens-viewer-handler",method:"toggleVideoSound"});this.muted=!this.muted;b.update()}});
this.muted=!0;b.update=function(a){this.muted=void 0!==a?a:this.muted;this.style.backgroundImage='url("'+(this.muted?R.VideoUnmute:R.VideoMute)+'")'};return b},createVideoControlSeekbar:function(){function a(a){a.stopPropagation();t=!0;f=a.clientX||a.changedTouches&&a.changedTouches[0].clientX;l=parseInt(m.style.width)/100;e.container.addEventListener("mousemove",b,{passive:!0});e.container.addEventListener("mouseup",c,{passive:!0});e.container.addEventListener("touchmove",b,{passive:!0});e.container.addEventListener("touchend",
c,{passive:!0})}function b(a){t&&(k=((a.clientX||a.changedTouches&&a.changedTouches[0].clientX)-f)/y.clientWidth,k=l+k,k=1<k?1:0>k?0:k,y.setProgress(k),e.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:k}))}function c(a){a.stopPropagation();t=!1;d()}function d(){e.container.removeEventListener("mousemove",b,!1);e.container.removeEventListener("mouseup",c,!1);e.container.removeEventListener("touchmove",b,!1);e.container.removeEventListener("touchend",c,!1)}var e=this,
t=!1,f,l,k;var m=document.createElement("div");m.style.width="0%";m.style.height="100%";m.style.backgroundColor="#fff";var n=document.createElement("div");n.style.float="right";n.style.width="14px";n.style.height="14px";n.style.transform="translate(7px, -5px)";n.style.borderRadius="50%";n.style.backgroundColor="#ddd";n.addEventListener("mousedown",a,{passive:!0});n.addEventListener("touchstart",a,{passive:!0});m.appendChild(n);var y=this.createCustomItem({style:{float:"left",width:"110px",display:"flex",
height:"4px",marginTop:"20px",backgroundColor:"rgba(188,188,188,0.8)"},onTap:function(a){a.preventDefault();a.stopPropagation();if(a.target!==n){var d=a.changedTouches&&0<a.changedTouches.length?(a.changedTouches[0].pageX-a.target.getBoundingClientRect().left)/this.clientWidth:a.offsetX/this.clientWidth;e.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:d});y.setProgress(a.offsetX/this.clientWidth)}},onDispose:function(){d();n=m=null}});y.appendChild(m);y.setProgress=
function(a){m.style.width=100*a+"%"};this.addEventListener("video-update",function(a){y.setProgress(a.percentage)});y.progressElement=m;y.progressElementControl=n;return y},createMenuItem:function(a){var b=this,c=document.createElement("a");c.textContent=a;c.style.display="block";c.style.padding="10px";c.style.textDecoration="none";c.style.cursor="pointer";c.style.pointerEvents="auto";c.style.transition=this.DEFAULT_TRANSITION;c.slide=function(a){this.style.transform="translateX("+(a?"":"-")+"100%)"};
c.unslide=function(){this.style.transform="translateX(0)"};c.setIcon=function(a){this.icon&&(this.icon.style.backgroundImage="url("+a+")")};c.setSelectionTitle=function(a){this.selection&&(this.selection.textContent=a)};c.addSelection=function(a){var d=document.createElement("span");d.style.fontSize="13px";d.style.fontWeight="300";d.style.float="right";this.selection=d;this.setSelectionTitle(a);this.appendChild(d);return this};c.addIcon=function(a,b,c){a=void 0===a?R.ChevronRight:a;b=void 0===b?!1:
b;c=void 0===c?!1:c;var d=document.createElement("span");d.style.float=b?"left":"right";d.style.width="17px";d.style.height="17px";d.style["margin"+(b?"Right":"Left")]="12px";d.style.backgroundSize="cover";c&&(d.style.transform="rotateZ(180deg)");this.icon=d;this.setIcon(a);this.appendChild(d);return this};c.addSubMenu=function(a,c){this.subMenu=b.createSubMenu(a,c);return this};c.addEventListener("mouseenter",function(){this.style.backgroundColor="#e0e0e0"},!1);c.addEventListener("mouseleave",function(){this.style.backgroundColor=
"#fafafa"},!1);return c},createMenuItemHeader:function(a){a=this.createMenuItem(a);a.style.borderBottom="1px solid #333";a.style.paddingBottom="15px";return a},createMainMenu:function(a){function b(a){a.preventDefault();a.stopPropagation();var d=c.mainMenu,b=this.subMenu;d.hide();d.slideAll();d.parentElement.appendChild(b);c.activeMainItem=this;c.activeSubMenu=b;window.requestAnimationFrame(function(){d.changeSize(b.clientWidth);b.show();b.unslideAll()})}var c=this,d=this.createMenu();d._width=200;
d.changeSize(d._width);for(var e=0;e<a.length;e++){var t=d.addItem(a[e].title);t.style.paddingLeft="20px";t.addIcon().addEventListener(c.TOUCH_ENABLED?"touchend":"click",b,!1);a[e].subMenu&&0<a[e].subMenu.length&&t.addSelection(a[e].subMenu[0].title).addSubMenu(a[e].title,a[e].subMenu)}return d},createSubMenu:function(a,b){function c(a){a.preventDefault();a.stopPropagation();e=d.mainMenu;e.changeSize(e._width);e.unslideAll();e.show();t.slideAll(!0);t.hide();"header"!==this.type&&(t.setActiveItem(this),
d.activeMainItem.setSelectionTitle(this.textContent),this.handler&&this.handler())}var d=this,e,t=this.createMenu();t.items=b;t.activeItem=null;t.addHeader(a).addIcon(void 0,!0,!0).addEventListener(d.TOUCH_ENABLED?"touchend":"click",c,!1);for(a=0;a<b.length;a++){var f=t.addItem(b[a].title);f.style.fontWeight=300;f.handler=b[a].handler;f.addIcon(" ",!0);f.addEventListener(d.TOUCH_ENABLED?"touchend":"click",c,!1);t.activeItem||t.setActiveItem(f)}t.slideAll(!0);return t},createMenu:function(){var a=
this,b=document.createElement("span"),c=b.style;c.padding="5px 0";c.position="fixed";c.bottom="100%";c.right="14px";c.backgroundColor="#fafafa";c.fontFamily="Helvetica Neue";c.fontSize="14px";c.visibility="hidden";c.opacity=0;c.boxShadow="0 0 12pt rgba(0,0,0,0.25)";c.borderRadius="2px";c.overflow="hidden";c.willChange="width, height, opacity";c.pointerEvents="auto";c.transition=this.DEFAULT_TRANSITION;b.visible=!1;b.changeSize=function(a,b){a&&(this.style.width=a+"px");b&&(this.style.height=b+"px")};
b.show=function(){this.style.opacity=1;this.style.visibility="visible";this.visible=!0};b.hide=function(){this.style.opacity=0;this.style.visibility="hidden";this.visible=!1};b.toggle=function(){this.visible?this.hide():this.show()};b.slideAll=function(a){for(var d=0;d<b.children.length;d++)b.children[d].slide&&b.children[d].slide(a)};b.unslideAll=function(){for(var a=0;a<b.children.length;a++)b.children[a].unslide&&b.children[a].unslide()};b.addHeader=function(d){d=a.createMenuItemHeader(d);d.type=
"header";this.appendChild(d);return d};b.addItem=function(d){d=a.createMenuItem(d);d.type="item";this.appendChild(d);return d};b.setActiveItem=function(a){this.activeItem&&this.activeItem.setIcon(" ");a.setIcon(R.Check);this.activeItem=a};b.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0);b.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,!0);b.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0);return b},createCustomItem:function(a){a=void 0===a?{}:a;var b=this,c=a.element||
document.createElement("span"),d=a.onDispose;c.style.cursor="pointer";c.style.float="right";c.style.width="44px";c.style.height="100%";c.style.backgroundSize="60%";c.style.backgroundRepeat="no-repeat";c.style.backgroundPosition="center";c.style.webkitUserSelect=c.style.MozUserSelect=c.style.userSelect="none";c.style.position="relative";c.style.pointerEvents="auto";c.addEventListener(b.TOUCH_ENABLED?"touchstart":"mouseenter",function(){c.style.filter=c.style.webkitFilter="drop-shadow(0 0 5px rgba(255,255,255,1))"},
{passive:!0});c.addEventListener(b.TOUCH_ENABLED?"touchend":"mouseleave",function(){c.style.filter=c.style.webkitFilter=""},{passive:!0});this.mergeStyleOptions(c,a.style);a.onTap&&c.addEventListener(b.TOUCH_ENABLED?"touchend":"click",a.onTap,!1);c.dispose=function(){c.removeEventListener(b.TOUCH_ENABLED?"touchend":"click",a.onTap,!1);if(d)a.onDispose()};return c},mergeStyleOptions:function(a,b){b=void 0===b?{}:b;for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c]);return a},dispose:function(){this.barElement&&
(this.container.removeChild(this.barElement),this.barElement.dispose(),this.barElement=null)}});wa.prototype=Object.assign(Object.create(f.Sprite.prototype),{constructor:wa,setColor:function(a){this.material.color.copy(a instanceof f.Color?a:new f.Color(a))},createCanvasTexture:function(a){a=new f.CanvasTexture(a);a.minFilter=f.LinearFilter;a.magFilter=f.LinearFilter;a.generateMipmaps=!1;return a},createCanvas:function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=this.dpr;a.width=
32*c;a.height=32*c;b.scale(c,c);b.shadowBlur=5;b.shadowColor="rgba(200,200,200,0.9)";return{canvas:a,context:b}},updateCanvasArcByProgress:function(a){var b=this.context,c=this.canvasWidth,d=this.canvasHeight,e=this.material,t=this.dpr,f=a*Math.PI*2,l=this.color.getStyle(),k=.5*c/t;t=.5*d/t;b.clearRect(0,0,c,d);b.beginPath();0===a?(b.arc(k,t,c/16,0,2*Math.PI),b.fillStyle=l,b.fill()):(b.arc(k,t,c/4-3,-Math.PI/2,-Math.PI/2+f),b.strokeStyle=l,b.lineWidth=3,b.stroke());b.closePath();e.map.needsUpdate=
!0},ripple:function(){var a=this,b=this.context,c=this.canvasWidth,d=this.canvasHeight,e=this.material,t=this.rippleDuration,f=performance.now(),l=this.color,k=this.dpr,m=.5*c/k,n=.5*d/k,y=function(){var h=window.requestAnimationFrame(y),D=(performance.now()-f)/t,J=0<1-D?1-D:0,r=D*c*.5/k;b.clearRect(0,0,c,d);b.beginPath();b.arc(m,n,r,0,2*Math.PI);b.fillStyle="rgba("+255*l.r+", "+255*l.g+", "+255*l.b+", "+J+")";b.fill();b.closePath();1<=D&&(window.cancelAnimationFrame(h),a.updateCanvasArcByProgress(0),
a.dispatchEvent({type:"reticle-ripple-end"}));e.map.needsUpdate=!0};this.dispatchEvent({type:"reticle-ripple-start"});y()},show:function(){this.visible=!0},hide:function(){this.visible=!1},start:function(a){this.autoSelect&&(this.dispatchEvent({type:"reticle-start"}),this.startTimestamp=performance.now(),this.callback=a,this.update())},end:function(){this.startTimestamp&&(window.cancelAnimationFrame(this.timerId),this.updateCanvasArcByProgress(0),this.startTimestamp=this.timerId=this.callback=null,
this.dispatchEvent({type:"reticle-end"}))},update:function(){this.timerId=window.requestAnimationFrame(this.update.bind(this));var a=(performance.now()-this.startTimestamp)/this.dwellTime;this.updateCanvasArcByProgress(a);this.dispatchEvent({type:"reticle-update",progress:a});1<=a&&(window.cancelAnimationFrame(this.timerId),this.callback&&this.callback(),this.end(),this.ripple())}});ha.prototype=Object.assign(Object.create(f.Mesh.prototype),{constructor:ha,dispose:function(){var a=this.geometry,b=
this.material,c=b.map;this.parent&&this.parent.remove(this);c&&(c.dispose(),b.map=null);a&&(a.dispose(),this.geometry=null);b&&(b.dispose(),this.material=null)}});var nb="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},z=bb(function(a,b){b=function(){this._tweens={};this._tweensAddedDuringUpdate={}};b.prototype={getAll:function(){return Object.keys(this._tweens).map(function(a){return this._tweens[a]}.bind(this))},
removeAll:function(){this._tweens={}},add:function(a){this._tweens[a.getId()]=a;this._tweensAddedDuringUpdate[a.getId()]=a},remove:function(a){delete this._tweens[a.getId()];delete this._tweensAddedDuringUpdate[a.getId()]},update:function(a,b){var d=Object.keys(this._tweens);if(0===d.length)return!1;for(a=void 0!==a?a:c.now();0<d.length;){this._tweensAddedDuringUpdate={};for(var e=0;e<d.length;e++){var f=this._tweens[d[e]];f&&!1===f.update(a)&&(f._isPlaying=!1,b||delete this._tweens[d[e]])}d=Object.keys(this._tweensAddedDuringUpdate)}return!0}};
var c=new b;c.Group=b;c._nextId=0;c.nextId=function(){return c._nextId++};c.now="undefined"===typeof self&&"undefined"!==typeof process&&process.hrtime?function(){var a=process.hrtime();return 1E3*a[0]+a[1]/1E6}:"undefined"!==typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()};c.Tween=function(a,b){this._object=a;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat=
{};this._duration=1E3;this._repeat=0;this._repeatDelayTime=void 0;this._reversed=this._isPlaying=this._yoyo=!1;this._delayTime=0;this._startTime=null;this._easingFunction=c.Easing.Linear.None;this._interpolationFunction=c.Interpolation.Linear;this._chainedTweens=[];this._onStartCallback=null;this._onStartCallbackFired=!1;this._onStopCallback=this._onCompleteCallback=this._onRepeatCallback=this._onUpdateCallback=null;this._group=b||c;this._id=c.nextId()};c.Tween.prototype={getId:function(){return this._id},
isPlaying:function(){return this._isPlaying},to:function(a,b){this._valuesEnd=Object.create(a);void 0!==b&&(this._duration=b);return this},duration:function(a){this._duration=a;return this},start:function(a){this._group.add(this);this._isPlaying=!0;this._onStartCallbackFired=!1;this._startTime=void 0!==a?"string"===typeof a?c.now()+parseFloat(a):a:c.now();this._startTime+=this._delayTime;for(var d in this._valuesEnd){if(this._valuesEnd[d]instanceof Array){if(0===this._valuesEnd[d].length)continue;
this._valuesEnd[d]=[this._object[d]].concat(this._valuesEnd[d])}void 0!==this._object[d]&&(this._valuesStart[d]=this._object[d],!1===this._valuesStart[d]instanceof Array&&(this._valuesStart[d]*=1),this._valuesStartRepeat[d]=this._valuesStart[d]||0)}return this},stop:function(){if(!this._isPlaying)return this;this._group.remove(this);this._isPlaying=!1;null!==this._onStopCallback&&this._onStopCallback(this._object);this.stopChainedTweens();return this},end:function(){this.update(Infinity);return this},
stopChainedTweens:function(){for(var a=0,b=this._chainedTweens.length;a<b;a++)this._chainedTweens[a].stop()},group:function(a){this._group=a;return this},delay:function(a){this._delayTime=a;return this},repeat:function(a){this._repeat=a;return this},repeatDelay:function(a){this._repeatDelayTime=a;return this},yoyo:function(a){this._yoyo=a;return this},easing:function(a){this._easingFunction=a;return this},interpolation:function(a){this._interpolationFunction=a;return this},chain:function(){this._chainedTweens=
arguments;return this},onStart:function(a){this._onStartCallback=a;return this},onUpdate:function(a){this._onUpdateCallback=a;return this},onRepeat:function(a){this._onRepeatCallback=a;return this},onComplete:function(a){this._onCompleteCallback=a;return this},onStop:function(a){this._onStopCallback=a;return this},update:function(a){var d;if(a<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0);
var b=(a-this._startTime)/this._duration;b=0===this._duration||1<b?1:b;var c=this._easingFunction(b);for(d in this._valuesEnd)if(void 0!==this._valuesStart[d]){var f=this._valuesStart[d]||0,k=this._valuesEnd[d];k instanceof Array?this._object[d]=this._interpolationFunction(k,c):("string"===typeof k&&(k="+"===k.charAt(0)||"-"===k.charAt(0)?f+parseFloat(k):parseFloat(k)),"number"===typeof k&&(this._object[d]=f+(k-f)*c))}null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,b);if(1===b)if(0<
this._repeat){isFinite(this._repeat)&&this._repeat--;for(d in this._valuesStartRepeat)"string"===typeof this._valuesEnd[d]&&(this._valuesStartRepeat[d]+=parseFloat(this._valuesEnd[d])),this._yoyo&&(b=this._valuesStartRepeat[d],this._valuesStartRepeat[d]=this._valuesEnd[d],this._valuesEnd[d]=b),this._valuesStart[d]=this._valuesStartRepeat[d];this._yoyo&&(this._reversed=!this._reversed);this._startTime=void 0!==this._repeatDelayTime?a+this._repeatDelayTime:a+this._delayTime;null!==this._onRepeatCallback&&
this._onRepeatCallback(this._object)}else{null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);a=0;for(d=this._chainedTweens.length;a<d;a++)this._chainedTweens[a].start(this._startTime+this._duration);return!1}return!0}};c.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>
(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===
a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){return 0===a?0:1===a?1:-Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)},Out:function(a){return 0===a?0:1===a?
1:Math.pow(2,-10*a)*Math.sin(5*(a-.1)*Math.PI)+1},InOut:function(a){if(0===a)return 0;if(1===a)return 1;a*=2;return 1>a?-.5*Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI):.5*Math.pow(2,-10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)+1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-c.Easing.Bounce.Out(1-a)},Out:function(a){return a<
1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*c.Easing.Bounce.In(2*a):.5*c.Easing.Bounce.Out(2*a-1)+.5}}};c.Interpolation={Linear:function(a,b){var d=a.length-1,e=d*b,f=Math.floor(e),k=c.Interpolation.Utils.Linear;return 0>b?k(a[0],a[1],e):1<b?k(a[d],a[d-1],d-e):k(a[f],a[f+1>d?d:f+1],e-f)},Bezier:function(a,b){for(var d=0,e=a.length-1,f=Math.pow,k=c.Interpolation.Utils.Bernstein,m=0;m<=
e;m++)d+=f(1-b,e-m)*f(b,m)*a[m]*k(e,m);return d},CatmullRom:function(a,b){var d=a.length-1,e=d*b,f=Math.floor(e),k=c.Interpolation.Utils.CatmullRom;return a[0]===a[d]?(0>b&&(f=Math.floor(e=d*(1+b))),k(a[(f-1+d)%d],a[f],a[(f+1)%d],a[(f+2)%d],e-f)):0>b?a[0]-(k(a[0],a[0],a[1],a[1],-e)-a[0]):1<b?a[d]-(k(a[d],a[d],a[d-1],a[d-1],e-d)-a[d]):k(a[f?f-1:0],a[f],a[d<f+1?d:f+1],a[d<f+2?d:f+2],e-f)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var d=c.Interpolation.Utils.Factorial;return d(a)/
d(b)/d(a-b)},Factorial:function(){var a=[1];return function(b){var c=1;if(a[b])return a[b];for(var d=b;1<d;d--)c*=d;return a[b]=c}}(),CatmullRom:function(a,b,c,f,l){a=.5*(c-a);f=.5*(f-b);var d=l*l;return(2*b-2*c+a+f)*l*d+(-3*b+3*c-2*a-f)*d+a*l+b}}};a.exports=c});xa.prototype=Object.assign(Object.create(f.Mesh.prototype),{constructor:xa,show:function(){this.visible||(this.fadeOut.stop(),this.fadeIn.start(),this.visible=!0)},hide:function(){this.visible&&(this.fadeIn.stop(),this.fadeOut.start(),this.visible=
!1)},enable:function(){this.enabled||(this.fadeOut.stop(),this.fadeIn.start(),this.enabled=this.visible=!0)},disable:function(){this.enabled&&(this.fadeOut.stop(),this.fadeIn.start(),this.enabled=this.visible=!1)}});W.prototype=Object.assign(Object.create(f.Mesh.prototype),{constructor:W,setContainer:function(a){if(a instanceof HTMLElement)var b=a;else a&&a.container&&(b=a.container);b&&this.element&&b.appendChild(this.element);this.container=b},getContainer:function(){return this.container},onClick:function(a){this.element&&
this.getContainer()&&(this.onHoverStart(a),this.lockHoverElement())},onDismiss:function(){this.element&&(this.unlockHoverElement(),this.onHoverEnd())},onHover:function(a){if(this.isVisible&&!this.isHovering)this.onHoverStart(a)},onHoverStart:function(a){if(this.loaded&&!this.isHovering&&this.isVisible&&this.getContainer()){var b=this.cursorStyle||(this.mode===K.NORMAL?oa.POINTER:oa.DEFAULT),c=this.hoverEnterAnimation,d=this.hoverLeaveAnimation,e=this.element;this.isHovering=!0;this.container.style.cursor=
b;this.animated&&(d.stop(),c.start());e&&0<=a.mouseEvent.clientX&&0<=a.mouseEvent.clientY&&(a=e.left,b=e.right,c=e.style,this.mode===K.CARDBOARD||this.mode===K.STEREO?(c.display="none",a.style.display="block",b.style.display="block",e._width=a.clientWidth,e._height=a.clientHeight):(c.display="block",a&&(a.style.display="none"),b&&(b.style.display="none"),e._width=e.clientWidth,e._height=e.clientHeight))}},onHoverEnd:function(){if(this.getContainer()){var a=this.hoverLeaveAnimation,b=this.hoverEnterAnimation,
c=this.element;this.isHovering=!1;this.container.style.cursor=oa.GRAB;this.animated&&(b.stop(),a.start());c&&!this.element.locked&&(a=c.left,b=c.right,c.style.display="none",a&&(a.style.display="none"),b&&(b.style.display="none"),this.unlockHoverElement())}},onDualEyeEffect:function(a){if(this.getContainer()){this.mode=a.mode;a=this.element;var b=this.container.clientWidth/2;var c=this.container.clientHeight/2;a&&(a.left||a.right||(a.left=a.cloneNode(!0),a.right=a.cloneNode(!0)),this.mode===K.CARDBOARD||
this.mode===K.STEREO?(a.left.style.display=a.style.display,a.right.style.display=a.style.display,a.style.display="none"):(a.style.display=a.left.style.display,a.left.style.display="none",a.right.style.display="none"),this.translateElement(b,c),this.container.appendChild(a.left),this.container.appendChild(a.right))}},translateElement:function(a,b){if(this.element&&this.element._width&&this.element._height&&this.getContainer()){var c=this.container;var d=this.element;var e=d._width/2;var f=d._height/
2;var r=void 0!==d.verticalDelta?d.verticalDelta:40;var l=a-e;var k=b-f-r;this.mode!==K.CARDBOARD&&this.mode!==K.STEREO||!d.left||!d.right||a===c.clientWidth/2&&b===c.clientHeight/2?this.setElementStyle("transform",d,"translate("+l+"px, "+k+"px)"):(l=c.clientWidth/4-e+(a-c.clientWidth/2),k=c.clientHeight/2-f-r+(b-c.clientHeight/2),this.setElementStyle("transform",d.left,"translate("+l+"px, "+k+"px)"),l+=c.clientWidth/2,this.setElementStyle("transform",d.right,"translate("+l+"px, "+k+"px)"))}},setElementStyle:function(a,
b,c){b=b.style;"transform"===a&&(b.webkitTransform=b.msTransform=b.transform=c)},setText:function(a){this.element&&(this.element.textContent=a)},setCursorHoverStyle:function(a){this.cursorStyle=a},addHoverText:function(a,b){b=void 0===b?40:b;this.element||(this.element=document.createElement("div"),this.element.style.display="none",this.element.style.color="#fff",this.element.style.top=0,this.element.style.maxWidth="50%",this.element.style.maxHeight="50%",this.element.style.textShadow="0 0 3px #000000",
this.element.style.fontFamily='"Trebuchet MS", Helvetica, sans-serif',this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=b);this.setText(a)},addHoverElement:function(a,b){b=void 0===b?40:b;this.element||(this.element=a.cloneNode(!0),this.element.style.display="none",this.element.style.top=0,this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=b)},removeHoverElement:function(){this.element&&
(this.element.left&&(this.container.removeChild(this.element.left),this.element.left=null),this.element.right&&(this.container.removeChild(this.element.right),this.element.right=null),this.container.removeChild(this.element),this.element=null)},lockHoverElement:function(){this.element&&(this.element.locked=!0)},unlockHoverElement:function(){this.element&&(this.element.locked=!1)},enableRaycast:function(a){this.raycast=void 0===a||a?this.originalRaycast:function(){}},show:function(a){a=void 0===a?
0:a;var b=this.hideAnimation,c=this.showAnimation,d=this.material,e=this.defaultOpacity;this.animated&&this.loaded?(b.stop(),c.delay(a).start()):(this.enableRaycast(!0),d.opacity=e);this.isVisible=!0},hide:function(a){a=void 0===a?0:a;var b=this.hideAnimation,c=this.showAnimation,d=this.material;this.animated&&this.loaded?(c.stop(),b.delay(a).start()):(this.enableRaycast(!1),d.opacity=0);this.isVisible=!1},setFocusMethod:function(a){a&&(this.HANDLER_FOCUS=a.method)},focus:function(a,b){this.HANDLER_FOCUS&&
(this.HANDLER_FOCUS(this.position,a,b),this.onDismiss())},dispose:function(){var a=this.geometry,b=this.material,c=b.map;this.removeHoverElement();this.parent&&this.parent.remove(this);c&&(c.dispose(),b.map=null);a&&(a.dispose(),this.geometry=null);b&&(b.dispose(),this.material=null)}});Y.prototype=Object.assign(Object.create(f.Sprite.prototype),{constructor:Y,setContainer:function(a){if(a instanceof HTMLElement)var b=a;else a&&a.container&&(b=a.container);b&&this.element&&b.appendChild(this.element);
this.container=b},getContainer:function(){return this.container},onClick:function(a){this.element&&this.getContainer()&&(this.onHoverStart(a),this.lockHoverElement())},onDismiss:function(){this.element&&(this.unlockHoverElement(),this.onHoverEnd())},onHover:function(a){if(!this.isHovering)this.onHoverStart(a)},onHoverStart:function(a){if(this.loaded&&this.getContainer()){var b=this.cursorStyle||(this.mode===K.NORMAL?oa.POINTER:oa.DEFAULT),c=this.scaleDownAnimation,d=this.scaleUpAnimation,e=this.element;
this.isHovering=!0;this.container.style.cursor=b;this.animated&&(c.stop(),d.start());e&&0<=a.mouseEvent.clientX&&0<=a.mouseEvent.clientY&&(a=e.left,b=e.right,c=e.style,this.mode===K.CARDBOARD||this.mode===K.STEREO?(c.display="none",a.style.display="block",b.style.display="block",e._width=a.clientWidth,e._height=a.clientHeight):(c.display="block",a&&(a.style.display="none"),b&&(b.style.display="none"),e._width=e.clientWidth,e._height=e.clientHeight))}},onHoverEnd:function(){if(this.getContainer()){var a=
this.scaleDownAnimation,b=this.scaleUpAnimation,c=this.element;this.isHovering=!1;this.container.style.cursor=oa.GRAB;this.animated&&(b.stop(),a.start());c&&!this.element.locked&&(a=c.left,b=c.right,c.style.display="none",a&&(a.style.display="none"),b&&(b.style.display="none"),this.unlockHoverElement())}},onDualEyeEffect:function(a){if(this.getContainer()){this.mode=a.mode;a=this.element;var b=this.container.clientWidth/2;var c=this.container.clientHeight/2;a&&(a.left||a.right||(a.left=a.cloneNode(!0),
a.right=a.cloneNode(!0)),this.mode===K.CARDBOARD||this.mode===K.STEREO?(a.left.style.display=a.style.display,a.right.style.display=a.style.display,a.style.display="none"):(a.style.display=a.left.style.display,a.left.style.display="none",a.right.style.display="none"),this.translateElement(b,c),this.container.appendChild(a.left),this.container.appendChild(a.right))}},translateElement:function(a,b){if(this.element&&this.element._width&&this.element._height&&this.getContainer()){var c=this.container;
var d=this.element;var e=d._width/2;var f=d._height/2;var r=void 0!==d.verticalDelta?d.verticalDelta:40;var l=a-e;var k=b-f-r;this.mode!==K.CARDBOARD&&this.mode!==K.STEREO||!d.left||!d.right||a===c.clientWidth/2&&b===c.clientHeight/2?this.setElementStyle("transform",d,"translate("+l+"px, "+k+"px)"):(l=c.clientWidth/4-e+(a-c.clientWidth/2),k=c.clientHeight/2-f-r+(b-c.clientHeight/2),this.setElementStyle("transform",d.left,"translate("+l+"px, "+k+"px)"),l+=c.clientWidth/2,this.setElementStyle("transform",
d.right,"translate("+l+"px, "+k+"px)"))}},setElementStyle:function(a,b,c){b=b.style;"transform"===a&&(b.webkitTransform=b.msTransform=b.transform=c)},setText:function(a){this.element&&(this.element.textContent=a)},setCursorHoverStyle:function(a){this.cursorStyle=a},addHoverText:function(a,b){b=void 0===b?40:b;this.element||(this.element=document.createElement("div"),this.element.style.display="none",this.element.style.color="#fff",this.element.style.top=0,this.element.style.maxWidth="50%",this.element.style.maxHeight=
"50%",this.element.style.textShadow="0 0 3px #000000",this.element.style.fontFamily='"Trebuchet MS", Helvetica, sans-serif',this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=b);this.setText(a)},addHoverElement:function(a,b){b=void 0===b?40:b;this.element||(this.element=a.cloneNode(!0),this.element.style.display="none",this.element.style.top=0,this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=
b)},removeHoverElement:function(){this.element&&(this.element.left&&(this.container.removeChild(this.element.left),this.element.left=null),this.element.right&&(this.container.removeChild(this.element.right),this.element.right=null),this.container.removeChild(this.element),this.element=null)},lockHoverElement:function(){this.element&&(this.element.locked=!0)},unlockHoverElement:function(){this.element&&(this.element.locked=!1)},enableRaycast:function(a){this.raycast=void 0===a||a?this.originalRaycast:
function(){}},show:function(a){a=void 0===a?0:a;var b=this.hideAnimation,c=this.showAnimation,d=this.material,e=this.maxOpacity;this.animated?(b.stop(),c.delay(a).start()):(this.enableRaycast(!0),d.opacity=e)},hide:function(a){a=void 0===a?0:a;var b=this.hideAnimation,c=this.showAnimation,d=this.material;this.animated?(c.stop(),b.delay(a).start()):(this.enableRaycast(!1),d.opacity=0)},setFocusMethod:function(a){a&&(this.HANDLER_FOCUS=a.method)},focus:function(a,b){this.HANDLER_FOCUS&&(this.HANDLER_FOCUS(this.position,
a,b),this.onDismiss())},dispose:function(){var a=this.geometry,b=this.material,c=b.map;this.removeHoverElement();this.parent&&this.parent.remove(this);c&&(c.dispose(),b.map=null);a&&(a.dispose(),this.geometry=null);b&&(b.dispose(),this.material=null)}});var ob={tEquirect:{value:new f.Texture},repeat:{value:new f.Vector2(1,1)},offset:{value:new f.Vector2(0,0)},opacity:{value:1}},pb={tEquirect:{value:new f.Texture},repeat:{value:new f.Vector2(1,1)},offset:{value:new f.Vector2(0,0)},opacity:{value:1}};
A.prototype=Object.assign(Object.create(f.Mesh.prototype),{constructor:A,createGeometry:function(a){return"slider_panorama"==this.subtype?new f.PlaneBufferGeometry(1,1):"image_little_planet"==this.subtype?new f.BoxBufferGeometry(a,a,a):new f.SphereBufferGeometry(5050,100,80)},createMaterial:function(a,b){a=void 0===a?new f.Vector2(1,1):a;b=void 0===b?new f.Vector2(0,0):b;if("slider_panorama"==this.subtype){var c="\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n\n            varying vec2 texcoord;\n            uniform sampler2D tEquirect;\n\n            void main()\n            {\n                /* Set color of the fragment */\n                gl_FragColor = texture2D(tEquirect, texcoord);}\n                \n    ";
var d="\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n\n            varying vec2 texcoord;\n\n            void main()\n            {\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n                texcoord  = uv;\n            }\n    ";var e=f.UniformsUtils.clone(pb)}else c="\n        uniform sampler2D tEquirect;\n        uniform vec2 repeat;\n        uniform vec2 offset;\n        uniform float opacity;\n        varying vec3 vWorldDirection;\n        #include <common>\n        void main() {\n            vec3 direction = normalize( vWorldDirection );\n            vec2 sampleUV;\n            sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n            sampleUV.x = atan( -direction.z, -direction.x ) * RECIPROCAL_PI2 + 0.5;\n            sampleUV *= repeat;\n            sampleUV += offset;\n            sampleUV.x = fract(sampleUV.x);\n            sampleUV.y = fract(sampleUV.y);\n            gl_FragColor = vec4(texture2D( tEquirect, sampleUV ).rgb, opacity);\n        }\n    ",
d="\n        varying vec3 vWorldDirection;\n        #include <common>\n        void main() {\n            vWorldDirection = transformDirection( position, modelMatrix );\n            #include <begin_vertex>\n            #include <project_vertex>\n        }\n    ",e=f.UniformsUtils.clone(ob);e.repeat.value.copy(a);e.offset.value.copy(b);e.opacity.value=0;return new f.ShaderMaterial({fragmentShader:c,vertexShader:d,uniforms:e,side:f.DoubleSide,transparent:!0})},add:function(a){if(1<arguments.length){for(var b=
0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a instanceof Y||a instanceof W)(b=this.container)&&a.dispatchEvent({type:"panolens-container",container:b}),a.dispatchEvent({type:"panolens-infospot-focus",method:function(a,b,e){this.dispatchEvent({type:"panolens-viewer-handler",method:"tweenControlCenter",data:[a,b,e]})}.bind(this)});f.Object3D.prototype.add.call(this,a);this.dispatchEvent({type:"addChild"})},getTexture:function(){return this.material.uniforms.tEquirect.value},load:function(a){a=
void 0===a?!0:a;this.dispatchEvent({type:"load-start"});if(a)this.onLoad()},onClick:function(a){a.intersects&&0===a.intersects.length&&this.traverse(function(a){a.dispatchEvent({type:"dismiss"})})},setContainer:function(a){if(a instanceof HTMLElement)var b=a;else a&&a.container&&(b=a.container);b&&(this.children.forEach(function(a){(a instanceof Y&&a.dispatchEvent||a instanceof W&&a.dispatchEvent)&&a.dispatchEvent({type:"panolens-container",container:b})}),this.container=b)},onLoad:function(){this.loaded=
!0;this.dispatchEvent({type:"loaded"});this.dispatchEvent({type:"ready"})},onProgress:function(a){this.dispatchEvent({type:"progress",progress:a})},onError:function(){this.dispatchEvent({type:"error"})},getZoomLevel:function(){return 800>=window.innerWidth?this.ImageQualityFair:800<window.innerWidth&&1280>=window.innerWidth?this.ImageQualityMedium:1280<window.innerWidth&&1920>=window.innerWidth?this.ImageQualityHigh:1920<window.innerWidth?this.ImageQualitySuperHigh:this.ImageQualityLow},updateTexture:function(a){this.material.uniforms.tEquirect.value=
a},toggleInfospotVisibility:function(a,b){b=void 0!==b?b:0;var c=void 0!==a?a:this.isInfospotVisible?!1:!0;this.traverse(function(a){if(a instanceof Y||a instanceof W)c?a.show(b):a.hide(b)});this.isInfospotVisible=c;this.infospotAnimation.onComplete(function(){this.dispatchEvent({type:"infospot-animation-complete",visible:c})}.bind(this)).delay(b).start()},reset:function(){this.children.length=0},setupTransitions:function(){this.fadeInAnimation=new z.Tween;this.fadeOutAnimation=new z.Tween;this.enterTransition=
(new z.Tween(this)).easing(z.Easing.Quartic.Out).onComplete(function(){this.dispatchEvent({type:"enter-complete"})}.bind(this)).start();this.leaveTransition=(new z.Tween(this)).easing(z.Easing.Quartic.Out)},fadeIn:function(a){a=void 0===a?this.animationDuration:a;var b=this.material.uniforms.opacity,c=function(){this.visible=!0;this.dispatchEvent({type:"enter-fade-start"})}.bind(this),d=function(){this.toggleInfospotVisibility(!0,a/2);this.dispatchEvent({type:"enter-fade-complete"})}.bind(this);this.fadeOutAnimation.stop();
this.fadeInAnimation=(new z.Tween(b)).to({value:1},a).easing(z.Easing.Quartic.Out).onStart(c).onComplete(d).start()},fadeOut:function(a){a=void 0===a?this.animationDuration:a;var b=this.material.uniforms.opacity,c=function(){this.visible=!1;this.dispatchEvent({type:"leave-complete"})}.bind(this);this.fadeInAnimation.stop();this.fadeOutAnimation=(new z.Tween(b)).to({value:0},a).easing(z.Easing.Quartic.Out).onComplete(c).start()},onEnter:function(){var a=this.animationDuration;this.dispatchEvent({type:"enter"});
this.leaveTransition.stop();this.enterTransition.to({},a).onStart(function(){this.dispatchEvent({type:"enter-start"});this.loaded?this.dispatchEvent({type:"ready"}):this.load()}.bind(this)).start();this.children.forEach(function(a){a.dispatchEvent({type:"panorama-enter"})});this.active=!0},onLeave:function(){var a=this.animationDuration;this.enterTransition.stop();this.leaveTransition.to({},a).onStart(function(){this.dispatchEvent({type:"leave-start"});this.fadeOut(a);this.toggleInfospotVisibility(!1)}.bind(this)).start();
this.dispatchEvent({type:"leave"});this.traverse(function(a){return a.dispatchEvent({type:"panorama-leave"})});this.active=!1},dispose:function(){function a(b){for(var c=b.geometry,e=b.material,f=b.children.length-1;0<=f;f--)a(b.children[f]),b.remove(b.children[f]);(b instanceof Y||b instanceof W)&&b.dispose();c&&(c.dispose(),b.geometry=null);e&&(e.dispose(),b.material=null)}var b=this.material;b&&b.uniforms&&b.uniforms.tEquirect&&b.uniforms.tEquirect.value.dispose();this.infospotAnimation.stop();
this.fadeInAnimation.stop();this.fadeOutAnimation.stop();this.enterTransition.stop();this.leaveTransition.stop();this.dispatchEvent({type:"panolens-viewer-handler",method:"onPanoramaDispose",data:this});a(this);this.parent&&this.parent.remove(this)}});ba.prototype=Object.assign(Object.create(A.prototype),{constructor:ba,load:function(a){A.prototype.load.call(this,!1);a=a||this.src;if(!a)console.warn("Image source undefined");else if("string"===typeof a)Ca.load(a,this.onLoad.bind(this),this.onProgress.bind(this),
this.onError.bind(this));else if(a instanceof HTMLImageElement)this.onLoad(new f.Texture(a))},onLoad:function(a){a.minFilter=a.magFilter=f.LinearFilter;a.needsUpdate=!0;this.updateTexture(a);window.requestAnimationFrame(A.prototype.onLoad.bind(this))},reset:function(){A.prototype.reset.call(this)},add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}a instanceof ha&&(this.floorPlane=a);A.prototype.add.call(this,a)},addFloorPlane:function(){this.floorPlane&&
this.floorPlane instanceof ha||(this.floorPlane=new ha,this.add(this.floorPlane))},removeFloorPlane:function(){this.floorPlane&&this.floorPlane instanceof ha&&(this.floorPlane.dispose(),this.floorPlane=null)},dispose:function(){f.Cache.remove(this.src);this.floorPlane=null;A.prototype.dispose.call(this)}});Pa.prototype=Object.assign(Object.create(A.prototype),{constructor:Pa});Da.prototype=Object.assign(Object.create(A.prototype),{constructor:Da,createMaterial:function(){var a=f.ShaderLib.cube,b=
a.fragmentShader,c=a.vertexShader;a=f.UniformsUtils.clone(a.uniforms);a.opacity.value=0;return new f.ShaderMaterial({fragmentShader:b,vertexShader:c,uniforms:a,side:f.BackSide,transparent:!0,opacity:0})},load:function(){A.prototype.load.call(this,!1);Ya.load(this.images,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this))},onLoad:function(a){this.material.uniforms.tCube.value=a;A.prototype.onLoad.call(this)},getTexture:function(){return this.material.uniforms.tCube.value},dispose:function(){var a=
this.material.uniforms.tCube.value;this.images.forEach(function(a){f.Cache.remove(a)});a instanceof f.CubeTexture&&a.dispose();A.prototype.dispose.call(this)}});Qa.prototype=Object.assign(Object.create(Da.prototype),{constructor:Qa});ya.prototype=Object.assign(Object.create(A.prototype),{constructor:ya,hide:function(){},load:function(a){a=a||this.src;if(!a)console.warn("Image source undefined");else if("string"===typeof a)Ca.load(a,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this));
else if(a instanceof HTMLImageElement)this.onLoad(new f.Texture(a))},onLoad:function(a){a.minFilter=a.magFilter=f.LinearFilter;a.needsUpdate=!0;this.updateTexture(a);window.requestAnimationFrame(A.prototype.onLoad.bind(this))},reset:function(){A.prototype.reset.call(this)},dispose:function(){if(this.material){var a=this.material.map;a&&a.dispose()}f.Cache.remove(this.src);A.prototype.dispose.call(this)}});var Za=window.navigator.userAgent||window.navigator.vendor||window.opera,qb=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(Za)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(Za.substr(0,
4)),cb=/(android)/i.test(Za),Ra=function(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a}(bb(function(a,b){"undefined"!==typeof window&&function(b,d){a.exports=d()}(nb,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};a[d].call(e.exports,e,e.exports,b);e.l=!0;return e.exports}var c={};b.m=a;b.c=c;b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{enumerable:!0,get:d})};b.r=function(a){$jscomp.initSymbol();
$jscomp.initSymbol();"undefined"!==typeof Symbol&&Symbol.toStringTag&&($jscomp.initSymbol(),Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}));Object.defineProperty(a,"__esModule",{value:!0})};b.t=function(a,c){c&1&&(a=b(a));if(c&8||c&4&&"object"===typeof a&&a&&a.__esModule)return a;var d=Object.create(null);b.r(d);Object.defineProperty(d,"default",{enumerable:!0,value:a});if(c&2&&"string"!=typeof a)for(var e in a)b.d(d,e,function(b){return a[b]}.bind(null,e));return d};b.n=function(a){var c=
a&&a.__esModule?function(){return a["default"]}:function(){return a};b.d(c,"a",c);return c};b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};b.p="/dist/";return b(b.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(a,b,e){function c(){}function d(a,b,c){this.fn=a;this.context=b;this.once=c||!1}function f(a,b,c,e,n){if("function"!==typeof c)throw new TypeError("The listener must be a function");c=new d(c,e||a,n);b=y?y+b:b;a._events[b]?a._events[b].fn?a._events[b]=
[a._events[b],c]:a._events[b].push(c):(a._events[b]=c,a._eventsCount++);return a}function k(a,b){0===--a._eventsCount?a._events=new c:delete a._events[b]}function m(){this._events=new c;this._eventsCount=0}var n=Object.prototype.hasOwnProperty,y="~";Object.create&&(c.prototype=Object.create(null),(new c).__proto__||(y=!1));m.prototype.eventNames=function(){var a=[],b,c;if(0===this._eventsCount)return a;for(c in b=this._events)n.call(b,c)&&a.push(y?c.slice(1):c);return Object.getOwnPropertySymbols?
a.concat(Object.getOwnPropertySymbols(b)):a};m.prototype.listeners=function(a){a=this._events[y?y+a:a];if(!a)return[];if(a.fn)return[a.fn];for(var b=0,c=a.length,d=Array(c);b<c;b++)d[b]=a[b].fn;return d};m.prototype.listenerCount=function(a){return(a=this._events[y?y+a:a])?a.fn?1:a.length:0};m.prototype.emit=function(a,b,c,d,e,n){var h=y?y+a:a;if(!this._events[h])return!1;h=this._events[h];var f=arguments.length,J;if(h.fn){h.once&&this.removeListener(a,h.fn,void 0,!0);switch(f){case 1:return h.fn.call(h.context),
!0;case 2:return h.fn.call(h.context,b),!0;case 3:return h.fn.call(h.context,b,c),!0;case 4:return h.fn.call(h.context,b,c,d),!0;case 5:return h.fn.call(h.context,b,c,d,e),!0;case 6:return h.fn.call(h.context,b,c,d,e,n),!0}var m=1;for(J=Array(f-1);m<f;m++)J[m-1]=arguments[m];h.fn.apply(h.context,J)}else{var D=h.length;for(m=0;m<D;m++)switch(h[m].once&&this.removeListener(a,h[m].fn,void 0,!0),f){case 1:h[m].fn.call(h[m].context);break;case 2:h[m].fn.call(h[m].context,b);break;case 3:h[m].fn.call(h[m].context,
b,c);break;case 4:h[m].fn.call(h[m].context,b,c,d);break;default:if(!J){var k=1;for(J=Array(f-1);k<f;k++)J[k-1]=arguments[k]}h[m].fn.apply(h[m].context,J)}}return!0};m.prototype.on=function(a,b,c){return f(this,a,b,c,!1)};m.prototype.once=function(a,b,c){return f(this,a,b,c,!0)};m.prototype.removeListener=function(a,b,c,d){a=y?y+a:a;if(!this._events[a])return this;if(!b)return k(this,a),this;var h=this._events[a];if(h.fn)h.fn!==b||d&&!h.once||c&&h.context!==c||k(this,a);else{for(var e=0,n=[],f=h.length;e<
f;e++)(h[e].fn!==b||d&&!h[e].once||c&&h[e].context!==c)&&n.push(h[e]);n.length?this._events[a]=1===n.length?n[0]:n:k(this,a)}return this};m.prototype.removeAllListeners=function(a){a?(a=y?y+a:a,this._events[a]&&k(this,a)):(this._events=new c,this._eventsCount=0);return this};m.prototype.off=m.prototype.removeListener;m.prototype.addListener=m.prototype.on;m.prefixed=y;m.EventEmitter=m;a.exports=m},"./node_modules/url-toolkit/src/url-toolkit.js":function(a,b,e){(function(b){var c=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,
d=/^([^\/?#]*)(.*)$/,e=/(?:\/|^)\.(?=\/)/g,f=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,n={buildAbsoluteURL:function(a,b,c){c=c||{};a=a.trim();b=b.trim();if(!b){if(!c.alwaysNormalize)return a;c=n.parseURL(a);if(!c)throw Error("Error trying to parse base URL.");c.path=n.normalizePath(c.path);return n.buildURLFromParts(c)}var e=n.parseURL(b);if(!e)throw Error("Error trying to parse relative URL.");if(e.scheme){if(!c.alwaysNormalize)return b;e.path=n.normalizePath(e.path);return n.buildURLFromParts(e)}b=
n.parseURL(a);if(!b)throw Error("Error trying to parse base URL.");!b.netLoc&&b.path&&"/"!==b.path[0]&&(a=d.exec(b.path),b.netLoc=a[1],b.path=a[2]);b.netLoc&&!b.path&&(b.path="/");a={scheme:b.scheme,netLoc:e.netLoc,path:null,params:e.params,query:e.query,fragment:e.fragment};e.netLoc||(a.netLoc=b.netLoc,"/"!==e.path[0]&&(e.path?(b=b.path,b=b.substring(0,b.lastIndexOf("/")+1)+e.path,a.path=n.normalizePath(b)):(a.path=b.path,e.params||(a.params=b.params,e.query||(a.query=b.query)))));null===a.path&&
(a.path=c.alwaysNormalize?n.normalizePath(e.path):e.path);return n.buildURLFromParts(a)},parseURL:function(a){return(a=c.exec(a))?{scheme:a[1]||"",netLoc:a[2]||"",path:a[3]||"",params:a[4]||"",query:a[5]||"",fragment:a[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(e,"");a.length!==(a=a.replace(f,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};a.exports=n})()},"./node_modules/webworkify-webpack/index.js":function(a,
b,e){function c(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};a[d].call(e.exports,e,e.exports,b);e.l=!0;return e.exports}var c={};b.m=a;b.c=c;b.i=function(a){return a};b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})};b.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})};b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};b.d(c,"a",c);return c};b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,
b)};b.p="/";b.oe=function(a){console.error(a);throw a;};var d=b(b.s=ENTRY_MODULE);return d.default||d}function d(a){return(a+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(a){return Object.keys(a).reduce(function(b,c){return b||0<a[c].length},!1)}function k(a,b){b={main:[b]};for(var c={main:[]},h={main:{}};f(b);)for(var n=Object.keys(b),m=0;m<n.length;m++){var k=n[m],t=b[k].pop();h[k]=h[k]||{};if(!h[k][t]&&a[k][t]){h[k][t]=!0;c[k]=c[k]||[];c[k].push(t);var l,r=a,w=a[k][t];t=k;k={};k[t]=[];
w=w.toString();if(l=w.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)){for(var P=l[1],pa=new RegExp("(\\\\n|\\W)"+d(P)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");l=pa.exec(w);)"dll-reference"!==l[3]&&k[t].push(l[3]);for(pa=new RegExp("\\("+d(P)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");l=pa.exec(w);)r[l[2]]||(k[t].push(l[1]),r[l[2]]=e(l[1]).m),k[l[2]]=k[l[2]]||[],k[l[2]].push(l[4]);r=Object.keys(k);
for(t=0;t<r.length;t++)for(w=0;w<k[r[t]].length;w++)!isNaN(1*k[r[t]][w])&&(k[r[t]][w]*=1)}r=Object.keys(k);for(t=0;t<r.length;t++)b[r[t]]=b[r[t]]||[],b[r[t]]=b[r[t]].concat(k[r[t]])}}return c}a.exports=function(a,b){b=b||{};var d={main:e.m},h=b.all?{main:Object.keys(d.main)}:k(d,a),f="";Object.keys(h).filter(function(a){return"main"!==a}).forEach(function(a){for(var b=0;h[a][b];)b++;h[a].push(b);d[a][b]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })";f=
f+"var "+a+" = ("+c.toString().replace("ENTRY_MODULE",JSON.stringify(b))+")({"+h[a].map(function(b){return""+JSON.stringify(b)+": "+d[a][b].toString()}).join(",")+"});\n"});f=f+"new (("+c.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+h.main.map(function(a){return""+JSON.stringify(a)+": "+d.main[a].toString()}).join(",")+"}))(self);";a=new window.Blob([f],{type:"text/javascript"});if(b.bare)return a;b=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(a);a=new window.Worker(b);
a.objectURL=b;return a}},"./src/crypt/decrypter.js":function(a,b,e){e.r(b);var c=function(){function a(a,b){this.subtle=a;this.aesIV=b}a.prototype.decrypt=function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)};return a}(),d=function(){function a(a,b){this.subtle=a;this.key=b}a.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])};return a}(),f=function(){function a(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54];this.subMix=
[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.sBox=new Uint32Array(256);this.invSBox=new Uint32Array(256);this.key=new Uint32Array(0);this.initTable()}var b=a.prototype;b.uint8ArrayToUint32Array_=function(a){a=new DataView(a);for(var b=new Uint32Array(4),c=0;4>c;c++)b[c]=a.getUint32(4*c);return b};b.initTable=function(){var a=this.sBox,b=this.invSBox,c=
this.subMix,d=c[0],e=c[1],h=c[2];c=c[3];var f=this.invSubMix,n=f[0],k=f[1],m=f[2];f=f[3];var t=new Uint32Array(256),y=0,l=0,D;for(D=0;256>D;D++)t[D]=128>D?D<<1:D<<1^283;for(D=0;256>D;D++){var r=l^l<<1^l<<2^l<<3^l<<4;r=r>>>8^r&255^99;a[y]=r;b[r]=y;var w=t[y],z=t[w],A=t[z],M=257*t[r]^16843008*r;d[y]=M<<24|M>>>8;e[y]=M<<16|M>>>16;h[y]=M<<8|M>>>24;c[y]=M;M=16843009*A^65537*z^257*w^16843008*y;n[r]=M<<24|M>>>8;k[r]=M<<16|M>>>16;m[r]=M<<8|M>>>24;f[r]=M;y?(y=w^t[t[t[A^w]]],l^=t[t[l]]):y=l=1}};b.expandKey=
function(a){a=this.uint8ArrayToUint32Array_(a);for(var b=!0,c=0;c<a.length&&b;)b=a[c]===this.key[c],c++;if(!b){this.key=a;var d=this.keySize=a.length;if(4!==d&&6!==d&&8!==d)throw Error("Invalid aes key size="+d);b=this.ksRows=4*(d+6+1);c=this.keySchedule=new Uint32Array(b);var e=this.invKeySchedule=new Uint32Array(b),f=this.sBox,h=this.rcon;var n=this.invSubMix;var k=n[0],m=n[1],t=n[2],y=n[3];for(n=0;n<b;n++)if(n<d)var l=c[n]=a[n];else 0===n%d?(l=l<<8|l>>>24,l=f[l>>>24]<<24|f[l>>>16&255]<<16|f[l>>>
8&255]<<8|f[l&255],l^=h[n/d|0]<<24):6<d&&4===n%d&&(l=f[l>>>24]<<24|f[l>>>16&255]<<16|f[l>>>8&255]<<8|f[l&255]),c[n]=l=(c[n-d]^l)>>>0;for(a=0;a<b;a++)n=b-a,l=a&3?c[n]:c[n-4],e[a]=4>a||4>=n?l:k[f[l>>>24]]^m[f[l>>>16&255]]^t[f[l>>>8&255]]^y[f[l&255]],e[a]>>>=0}};b.networkToHostOrderSwap=function(a){return a<<24|(a&65280)<<8|(a&16711680)>>8|a>>>24};b.decrypt=function(a,b,c,d){var e=this.keySize+6,f=this.invKeySchedule,h=this.invSBox,n=this.invSubMix,k=n[0],m=n[1],l=n[2];n=n[3];var t=this.uint8ArrayToUint32Array_(c);
c=t[0];var y=t[1],D=t[2];t=t[3];a=new Int32Array(a);for(var r=new Int32Array(a.length),J,w,E,F,G,z,A,K,U,T,x,N,Z,I=this.networkToHostOrderSwap;b<a.length;){K=I(a[b]);U=I(a[b+1]);T=I(a[b+2]);x=I(a[b+3]);G=K^f[0];z=x^f[1];A=T^f[2];F=U^f[3];N=4;for(Z=1;Z<e;Z++)J=k[G>>>24]^m[z>>16&255]^l[A>>8&255]^n[F&255]^f[N],w=k[z>>>24]^m[A>>16&255]^l[F>>8&255]^n[G&255]^f[N+1],E=k[A>>>24]^m[F>>16&255]^l[G>>8&255]^n[z&255]^f[N+2],F=k[F>>>24]^m[G>>16&255]^l[z>>8&255]^n[A&255]^f[N+3],G=J,z=w,A=E,N+=4;J=h[G>>>24]<<24^
h[z>>16&255]<<16^h[A>>8&255]<<8^h[F&255]^f[N];w=h[z>>>24]<<24^h[A>>16&255]<<16^h[F>>8&255]<<8^h[G&255]^f[N+1];E=h[A>>>24]<<24^h[F>>16&255]<<16^h[G>>8&255]<<8^h[z&255]^f[N+2];F=h[F>>>24]<<24^h[G>>16&255]<<16^h[z>>8&255]<<8^h[A&255]^f[N+3];r[b]=I(J^c);r[b+1]=I(F^y);r[b+2]=I(E^D);r[b+3]=I(w^t);c=K;y=U;D=T;t=x;b+=4}d?(b=r.buffer,b=(e=(d=b.byteLength)&&(new DataView(b)).getUint8(d-1))?b.slice(0,d-e):b):b=r.buffer;return b};b.destroy=function(){this.rcon=this.invKeySchedule=this.keySchedule=this.invSubMix=
this.subMix=this.invSBox=this.sBox=this.ksRows=this.keySize=this.key=void 0};return a}(),k=e("./src/errors.ts"),m=e("./src/utils/logger.js"),n=e("./src/events.js");a=e("./src/utils/get-self-scope.js");var y=Object(a.getSelfScope)();a=function(){function a(a,b,c){c=(void 0===c?{}:c).removePKCS7Padding;c=void 0===c?!0:c;this.logEnabled=!0;this.observer=a;this.config=b;if(this.removePKCS7Padding=c)try{var d=y.crypto;d&&(this.subtle=d.subtle||d.webkitSubtle)}catch(ma){}this.disableWebCrypto=!this.subtle}
var b=a.prototype;b.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES};b.decrypt=function(a,b,e,h){var n=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(m.logger.log("JS AES decrypt"),this.logEnabled=!1);var k=this.decryptor;k||(this.decryptor=k=new f);k.expandKey(b);h(k.decrypt(a,0,e,this.removePKCS7Padding))}else{this.logEnabled&&(m.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var t=this.subtle;this.key!==b&&(this.key=b,this.fastAesKey=
new d(t,b));this.fastAesKey.expandKey().then(function(d){(new c(t,e)).decrypt(a,d).catch(function(c){n.onWebCryptoError(c,a,b,e,h)}).then(function(a){h(a)})}).catch(function(c){n.onWebCryptoError(c,a,b,e,h)})}};b.onWebCryptoError=function(a,b,c,d,e){this.config.enableSoftwareAES?(m.logger.log("WebCrypto Error, disable WebCrypto API"),this.logEnabled=this.disableWebCrypto=!0,this.decrypt(b,c,d,e)):(m.logger.error("decrypting error : "+a.message),this.observer.trigger(n["default"].ERROR,{type:k.ErrorTypes.MEDIA_ERROR,
details:k.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:a.message}))};b.destroy=function(){var a=this.decryptor;a&&(a.destroy(),this.decryptor=void 0)};return a}();b["default"]=a},"./src/demux/demuxer-inline.js":function(a,b,e){function c(a,b){return b+1<a.length&&255===a[b]&&240===(a[b+1]&246)?!0:!1}function d(a,b){if(c(a,b)){var d=a[b+1]&1?7:9;if(b+d>=a.length)return!1;var e=(a[b+3]&3)<<11|a[b+4]<<3|(a[b+5]&224)>>>5;if(e<=d)return!1;b+=e;if(b===a.length||b+1<a.length&&255===a[b]&&240===(a[b+1]&
246))return!0}return!1}function f(a,b,c,d,e){if(!a.samplerate){var x=navigator.userAgent.toLowerCase();var f=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];var N=((c[d+2]&192)>>>6)+1;var h=(c[d+2]&60)>>>2;if(h>f.length-1)b.trigger(D["default"].ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h}),e=void 0;else{b=(c[d+2]&1)<<2;b|=(c[d+3]&192)>>>6;E.logger.log("manifest codec:"+e+",ADTS data:type:"+N+
",sampleingIndex:"+h+"["+f[h]+"Hz],channelConfig:"+b);if(/firefox/i.test(x))6<=h?(N=5,c=Array(4),x=h-3):(N=2,c=Array(2),x=h);else if(-1!==x.indexOf("android"))N=2,c=Array(2),x=h;else if(N=5,c=Array(4),e&&(-1!==e.indexOf("mp4a.40.29")||-1!==e.indexOf("mp4a.40.5"))||!e&&6<=h)x=h-3;else{if(e&&-1!==e.indexOf("mp4a.40.2")&&(6<=h&&1===b||/vivaldi/i.test(x))||!e&&1===b)N=2,c=Array(2);x=h}c[0]=N<<3;c[0]|=(h&14)>>1;c[1]|=(h&1)<<7;c[1]|=b<<3;5===N&&(c[1]|=(x&14)>>1,c[2]=(x&1)<<7,c[2]|=8,c[3]=0);e={config:c,
samplerate:f[h],channelCount:b,codec:"mp4a.40."+N,manifestCodec:e}}a.config=e.config;a.samplerate=e.samplerate;a.channelCount=e.channelCount;a.codec=e.codec;a.manifestCodec=e.manifestCodec;E.logger.log("parsed codec:"+a.codec+",rate:"+e.samplerate+",nb channel:"+e.channelCount)}}function k(a,b,c,d,e){var x=9216E4/a.samplerate;var h=b.length;var f=b[c+1]&1?7:9;var N=(b[c+3]&3)<<11|b[c+4]<<3|(b[c+5]&224)>>>5;N-=f;x=0<N&&c+f+N<=h?{headerLength:f,frameLength:N,stamp:d+e*x}:void 0;if(x)return e=x.stamp,
d=x.headerLength,x=x.frameLength,b={unit:b.subarray(c+d,c+d+x),pts:e,dts:e},a.samples.push(b),{sample:b,length:x+d}}function m(a,b,c,d){void 0===c&&(c=1);void 0===d&&(d=!1);a=a*b*c;return d?Math.round(a):a}function n(a,b){void 0===b&&(b=!1);return m(a,1E3,1/9E4,b)}function y(a,b){void 0===b&&(b=1);return m(a,9E4,1/b)}function h(a,b){var c;if(void 0===b)return a;for(c=b<a?-8589934592:8589934592;4294967296<Math.abs(a-b);)a+=c;return a}e.r(b);var D=e("./src/events.js"),J=e("./src/errors.ts"),w=e("./src/crypt/decrypter.js"),
z=e("./src/polyfills/number.js"),E=e("./src/utils/logger.js");a=e("./src/utils/get-self-scope.js");var A=e("./src/demux/id3.js"),K=function(){function a(a,b,c){this.observer=a;this.config=c;this.remuxer=b}var b=a.prototype;b.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9E4}};b.resetTimeStamp=function(){};a.probe=function(a){if(!a)return!1;for(var b=(A["default"].getID3Data(a,
0)||[]).length,c=a.length;b<c;b++)if(d(a,b))return E.logger.log("ADTS sync word found !"),!0;return!1};b.append=function(a,b,d,e){var x=this._audioTrack,h=A["default"].getID3Data(a,0)||[],N=A["default"].getTimeStamp(h);N=Object(z.isFiniteNumber)(N)?90*N:9E4*b;for(var n=0,I=N,T=a.length,m=h.length,Z=[{pts:I,dts:I,data:h}];m<T-1;)if(c(a,m)&&m+5<T)if(f(x,this.observer,a,m,x.manifestCodec),h=k(x,a,m,N,n))m+=h.length,I=h.sample.pts,n++;else{E.logger.log("Unable to parse AAC frame");break}else A["default"].isHeader(a,
m)?(h=A["default"].getID3Data(a,m),Z.push({pts:I,dts:I,data:h}),m+=h.length):m++;this.remuxer.remux(x,{samples:[]},{samples:Z,inputTimeScale:9E4},{samples:[]},b,d,e)};b.destroy=function(){};return a}(),P=e("./src/demux/mp4demuxer.js"),R={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,
48E3,32E3,22050,24E3,16E3,11025,12E3,8E3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(a,b,c,d,e){if(!(c+24>b.length)){var x=this.parseHeader(b,c);if(x&&c+x.frameLength<=b.length)return d+=9E4*x.samplesPerFrame/x.sampleRate*e,b={unit:b.subarray(c,c+x.frameLength),pts:d,dts:d},a.config=[],a.channelCount=x.channelCount,a.samplerate=x.sampleRate,a.samples.push(b),{sample:b,length:x.frameLength}}},parseHeader:function(a,b){var c=
a[b+1]>>3&3,d=a[b+1]>>1&3,e=a[b+2]>>4&15,h=a[b+2]>>2&3,f=a[b+2]>>1&1;if(1!==c&&0!==e&&15!==e&&3!==h){h=R.SamplingRateMap[3*(3===c?0:2===c?1:2)+h];a=3===a[b+3]>>6?1:2;var n=R.SamplesCoefficients[c][d],k=R.BytesInSlot[d];b=8*n*k;c=parseInt(1E3*n*R.BitratesMap[14*(3===c?3-d:3===d?3:4)+e-1]/h+f,10)*k;return{sampleRate:h,channelCount:a,frameLength:c,samplesPerFrame:b}}},isHeaderPattern:function(a,b){return 255===a[b]&&224===(a[b+1]&224)&&0!==(a[b+1]&6)},isHeader:function(a,b){return b+1<a.length&&this.isHeaderPattern(a,
b)?!0:!1},probe:function(a,b){if(b+1<a.length&&this.isHeaderPattern(a,b)){var c=this.parseHeader(a,b),d=4;c&&c.frameLength&&(d=c.frameLength);b+=d;if(b===a.length||b+1<a.length&&this.isHeaderPattern(a,b))return!0}return!1}},Y=R,ba=function(){function a(a){this.data=a;this.bytesAvailable=a.byteLength;this.bitsAvailable=this.word=0}var b=a.prototype;b.loadWord=function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4);b=Math.min(4,b);if(0===b)throw Error("no bytes available");
d.set(a.subarray(c,c+b));this.word=(new DataView(d.buffer)).getUint32(0);this.bitsAvailable=8*b;this.bytesAvailable-=b};b.skipBits=function(a){if(!(this.bitsAvailable>a)){a-=this.bitsAvailable;var b=a>>3;a-=b>>3;this.bytesAvailable-=b;this.loadWord()}this.word<<=a;this.bitsAvailable-=a};b.readBits=function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;32<a&&E.logger.error("Cannot read more than 32 bits at a time");this.bitsAvailable-=b;0<this.bitsAvailable?this.word<<=b:0<this.bytesAvailable&&
this.loadWord();b=a-b;return 0<b&&this.bitsAvailable?c<<b|this.readBits(b):c};b.skipLZ=function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!==(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;this.loadWord();return a+this.skipLZ()};b.skipUEG=function(){this.skipBits(1+this.skipLZ())};b.skipEG=function(){this.skipBits(1+this.skipLZ())};b.readUEG=function(){var a=this.skipLZ();return this.readBits(a+1)-1};b.readEG=function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)};
b.readBoolean=function(){return 1===this.readBits(1)};b.readUByte=function(){return this.readBits(8)};b.readUShort=function(){return this.readBits(16)};b.readUInt=function(){return this.readBits(32)};b.skipScalingList=function(a){var b=8,c=8,d;for(d=0;d<a;d++)0!==c&&(c=this.readEG(),c=(b+c+256)%256),b=0===c?b:c};b.readSPS=function(){var a=0,b=0,c=0,d=0,e=this.readUByte.bind(this);var h=this.readBits.bind(this);var f=this.readUEG.bind(this),n=this.readBoolean.bind(this),k=this.skipBits.bind(this);
var m=this.skipEG.bind(this);var t=this.skipUEG.bind(this);var T=this.skipScalingList.bind(this);e();var l=e();h(5);k(3);e();t();if(100===l||110===l||122===l||244===l||44===l||83===l||86===l||118===l||128===l)if(l=f(),3===l&&k(1),t(),t(),k(1),n()){var U=3!==l?8:12;for(l=0;l<U;l++)n()&&(6>l?T(16):T(64))}t();T=f();if(0===T)f();else if(1===T)for(k(1),m(),m(),T=f(),l=0;l<T;l++)m();t();k(1);m=f();t=f();h=h(1);0===h&&k(1);k(1);n()&&(a=f(),b=f(),c=f(),d=f());f=[1,1];if(n()&&n())switch(e()){case 1:f=[1,1];
break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:f=[e()<<8|e(),e()<<8|e()]}return{width:Math.ceil(16*(m+1)-2*a-2*b),height:(2-h)*(t+1)*16-(h?2:4)*(c+d),pixelRatio:f}};b.readSliceType=function(){this.readUByte();
this.readUEG();return this.readUEG()};return a}(),aa=function(){function a(a,b,c,d){this.decryptdata=c;this.discardEPB=d;this.decrypter=new w["default"](a,b,{removePKCS7Padding:!1})}var b=a.prototype;b.decryptBuffer=function(a,b){this.decrypter.decrypt(a,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,b)};b.decryptAacSample=function(a,b,c,d){var x=a[b].unit,e=x.subarray(16,x.length-x.length%16);e=e.buffer.slice(e.byteOffset,e.byteOffset+e.length);var f=this;this.decryptBuffer(e,function(e){e=
new Uint8Array(e);x.set(e,16);d||f.decryptAacSamples(a,b+1,c)})};b.decryptAacSamples=function(a,b,c){for(;;b++){if(b>=a.length){c();break}if(!(32>a[b].unit.length)){var d=this.decrypter.isSync();this.decryptAacSample(a,b,c,d);if(!d)break}}};b.getAvcEncryptedData=function(a){for(var b=new Int8Array(16*Math.floor((a.length-48)/160)+16),c=0,d=32;d<=a.length-16;d+=160,c+=16)b.set(a.subarray(d,d+16),c);return b};b.getAvcDecryptedUnit=function(a,b){b=new Uint8Array(b);for(var c=0,d=32;d<=a.length-16;d+=
160,c+=16)a.set(b.subarray(c,c+16),d);return a};b.decryptAvcSample=function(a,b,c,d,e,f){var x=this.discardEPB(e.data),h=this.getAvcEncryptedData(x),n=this;this.decryptBuffer(h.buffer,function(h){e.data=n.getAvcDecryptedUnit(x,h);f||n.decryptAvcSamples(a,b,c+1,d)})};b.decryptAvcSamples=function(a,b,c,d){for(;;b++,c=0){if(b>=a.length){d();break}for(var e=a[b].units;!(c>=e.length);c++){var x=e[c];if(!(48>=x.data.length||1!==x.type&&5!==x.type)){var f=this.decrypter.isSync();this.decryptAvcSample(a,
b,c,d,x,f);if(!f)return}}}};return a}(),X={video:1,audio:2,id3:3,text:4},ia=function(){function a(a,b,c,d){this.observer=a;this.config=c;this.typeSupported=d;this.remuxer=b;this.sampleAes=null;this.pmtUnknownTypes={}}var b=a.prototype;b.setDecryptData=function(a){this.sampleAes=null!=a&&null!=a.key&&"SAMPLE-AES"===a.method?new aa(this.observer,this.config,a,this.discardEPB):null};a.probe=function(b){b=a._syncOffset(b);if(0>b)return!1;b&&E.logger.warn("MPEG2-TS detected but first sync word found @ offset "+
b+", junk ahead ?");return!0};a._syncOffset=function(a){for(var b=Math.min(1E3,a.length-564),c=0;c<b;){if(71===a[c]&&71===a[c+188]&&71===a[c+376])return c;c++}return-1};a.createTrack=function(a,b){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:X[a],pid:-1,inputTimeScale:9E4,sequenceNumber:0,samples:[],dropped:"video"===a?0:void 0,isAAC:"audio"===a?!0:void 0,duration:"audio"===a?b:void 0}};b.resetInitSegment=function(b,c,d,e){this.pmtParsed=!1;this._pmtId=-1;this.pmtUnknownTypes=
{};this._avcTrack=a.createTrack("video",e);this._audioTrack=a.createTrack("audio",e);this._id3Track=a.createTrack("id3",e);this._txtTrack=a.createTrack("text",e);this.avcSample=this.aacLastPTS=this.aacOverFlow=null;this.audioCodec=c;this.videoCodec=d;this._duration=e};b.resetTimeStamp=function(){};b.append=function(b,c,d,e){var x,f=b.length,h,n=!1;this.pmtUnknownTypes={};this.contiguous=d;var N=this.pmtParsed,k=this._avcTrack,m=this._audioTrack,I=this._id3Track,l=k.pid,t=m.pid,U=I.pid,y=this._pmtId,
T=k.pesData,Z=m.pesData,r=I.pesData,w=this._parsePAT,F=this._parsePMT.bind(this),z=this._parsePES,A=this._parseAVCPES.bind(this),G=this._parseAACPES.bind(this),M=this._parseMPEGPES.bind(this),P=this._parseID3PES.bind(this),K=a._syncOffset(b);f-=(f+K)%188;for(x=K;x<f;x+=188)if(71===b[x]){var L=!!(b[x+1]&64);var R=((b[x+1]&31)<<8)+b[x+2];var O=(b[x+3]&48)>>4;if(1<O){if(O=x+5+b[x+4],O===x+188)continue}else O=x+4;switch(R){case l:L&&(T&&(h=z(T))&&A(h,!1),T={data:[],size:0});T&&(T.data.push(b.subarray(O,
x+188)),T.size+=x+188-O);break;case t:L&&(Z&&(h=z(Z))&&(m.isAAC?G(h):M(h)),Z={data:[],size:0});Z&&(Z.data.push(b.subarray(O,x+188)),Z.size+=x+188-O);break;case U:L&&(r&&(h=z(r))&&P(h),r={data:[],size:0});r&&(r.data.push(b.subarray(O,x+188)),r.size+=x+188-O);break;case 0:L&&(O+=b[O]+1);y=this._pmtId=w(b,O);break;case y:L&&(O+=b[O]+1);L=F(b,O,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);l=L.avc;0<l&&(k.pid=l);t=L.audio;0<t&&(m.pid=t,m.isAAC=L.isAAC);U=L.id3;0<U&&(I.pid=
U);n&&!N&&(E.logger.log("reparse from beginning"),n=!1,x=K-188);N=this.pmtParsed=!0;break;case 17:case 8191:break;default:n=!0}}else this.observer.trigger(D["default"].ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});T&&(h=z(T))?(A(h,!0),k.pesData=null):k.pesData=T;Z&&(h=z(Z))?(m.isAAC?G(h):M(h),m.pesData=null):(Z&&Z.size&&E.logger.log("last AAC PES packet truncated,might overlap between fragments"),m.pesData=Z);r&&
(h=z(r))?(P(h),I.pesData=null):I.pesData=r;null==this.sampleAes?this.remuxer.remux(m,k,I,this._txtTrack,c,d,e):this.decryptAndRemux(m,k,I,this._txtTrack,c,d,e)};b.decryptAndRemux=function(a,b,c,d,e,h,f){if(a.samples&&a.isAAC){var x=this;this.sampleAes.decryptAacSamples(a.samples,0,function(){x.decryptAndRemuxAvc(a,b,c,d,e,h,f)})}else this.decryptAndRemuxAvc(a,b,c,d,e,h,f)};b.decryptAndRemuxAvc=function(a,b,c,d,e,h,f){if(b.samples){var x=this;this.sampleAes.decryptAvcSamples(b.samples,0,0,function(){x.remuxer.remux(a,
b,c,d,e,h,f)})}else this.remuxer.remux(a,b,c,d,e,h,f)};b.destroy=function(){this._initPTS=this._initDTS=void 0;this._duration=0};b._parsePAT=function(a,b){return(a[b+10]&31)<<8|a[b+11]};b._trackUnknownPmt=function(a,b,c){var d=this.pmtUnknownTypes[a]||0;0===d&&(this.pmtUnknownTypes[a]=0,b.call(E.logger,c));this.pmtUnknownTypes[a]++;return d};b._parsePMT=function(a,b,c,d){var e={audio:-1,avc:-1,id3:-1,isAAC:!0};var h=b+3+((a[b+1]&15)<<8|a[b+2])-4;for(b+=12+((a[b+10]&15)<<8|a[b+11]);b<h;){var f=(a[b+
1]&31)<<8|a[b+2];switch(a[b]){case 207:if(!d){this._trackUnknownPmt(a[b],E.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===e.audio&&(e.audio=f);break;case 21:-1===e.id3&&(e.id3=f);break;case 219:if(!d){this._trackUnknownPmt(a[b],E.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===e.avc&&(e.avc=f);break;case 3:case 4:c?-1===e.audio&&(e.audio=f,e.isAAC=!1):this._trackUnknownPmt(a[b],E.logger.warn,
"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(a[b],E.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(a[b],E.logger.log,"Unknown stream type:"+a[b])}b+=((a[b+3]&15)<<8|a[b+4])+5}return e};b._parsePES=function(a){var b=0,c,d=a.data;if(!a||0===a.size)return null;for(;19>d[0].length&&1<d.length;){var e=new Uint8Array(d[0].length+d[1].length);e.set(d[0]);e.set(d[1],d[0].length);d[0]=e;d.splice(1,1)}e=d[0];if(1===(e[0]<<16)+
(e[1]<<8)+e[2]){if((c=(e[4]<<8)+e[5])&&c>a.size-6)return null;var f=e[7];if(f&192){var h=536870912*(e[9]&14)+4194304*(e[10]&255)+16384*(e[11]&254)+128*(e[12]&255)+(e[13]&254)/2;if(f&64){var x=536870912*(e[14]&14)+4194304*(e[15]&255)+16384*(e[16]&254)+128*(e[17]&255)+(e[18]&254)/2;54E5<h-x&&(E.logger.warn(Math.round((h-x)/9E4)+"s delta between PTS and DTS, align them"),h=x)}else x=h}f=e[8];var n=f+9;if(a.size<=n)return null;a.size-=n;a=new Uint8Array(a.size);for(var k=0,m=d.length;k<m;k++){e=d[k];
var l=e.byteLength;if(n)if(n>l){n-=l;continue}else e=e.subarray(n),l-=n,n=0;a.set(e,b);b+=l}c&&(c-=f+3);return{data:a,pts:h,dts:x,len:c}}return null};b.pushAccesUnit=function(a,b){if(a.units.length&&a.frame){var c=b.samples,d=c.length;if(isNaN(a.pts))if(d){var e=c[d-1];a.pts=e.pts;a.dts=e.dts}else{b.dropped++;return}!this.config.forceKeyFrameOnDiscontinuity||!0===a.key||b.sps&&(d||this.contiguous)?(a.id=d,c.push(a)):b.dropped++}a.debug.length&&E.logger.log(a.pts+"/"+a.dts+":"+a.debug)};b._parseAVCPES=
function(a,b){var c=this,d=this._avcTrack,e=this._parseAVCNALu(a.data),f,h=this.avcSample,x,n=!1,k,m=this.pushAccesUnit.bind(this),N=function(a,b,c,d){return{key:a,pts:b,dts:c,units:[],debug:d}};a.data=null;h&&e.length&&!d.audFound&&(m(h,d),h=this.avcSample=N(!1,a.pts,a.dts,""));e.forEach(function(b){switch(b.type){case 1:x=!0;h||(h=c.avcSample=N(!0,a.pts,a.dts,""));h.frame=!0;var e=b.data;n&&4<e.length&&(e=(new ba(e)).readSliceType(),2===e||4===e||7===e||9===e)&&(h.key=!0);break;case 5:x=!0;h||(h=
c.avcSample=N(!0,a.pts,a.dts,""));h.key=!0;h.frame=!0;break;case 6:x=!0;f=new ba(c.discardEPB(b.data));f.readUByte();e=!1;for(var l;!e&&1<f.bytesAvailable;){var t=0;do l=f.readUByte(),t+=l;while(255===l);var U=0;do l=f.readUByte(),U+=l;while(255===l);if(4===t&&0!==f.bytesAvailable){if(e=!0,181===f.readUByte()&&49===f.readUShort()&&1195456820===f.readUInt()&&3===f.readUByte()){l=f.readUByte();U=f.readUByte();t=31&l;l=[l,U];for(k=0;k<t;k++)l.push(f.readUByte()),l.push(f.readUByte()),l.push(f.readUByte());
c._insertSampleInOrder(c._txtTrack.samples,{type:3,pts:a.pts,bytes:l})}}else if(5===t&&0!==f.bytesAvailable){if(e=!0,16<U){l=[];for(k=0;16>k;k++)l.push(f.readUByte().toString(16)),3!==k&&5!==k&&7!==k&&9!==k||l.push("-");U-=16;var T=new Uint8Array(U);for(k=0;k<U;k++)T[k]=f.readUByte();c._insertSampleInOrder(c._txtTrack.samples,{pts:a.pts,payloadType:t,uuid:l.join(""),userDataBytes:T,userData:Object(A.utf8ArrayToStr)(T.buffer)})}}else if(U<f.bytesAvailable)for(k=0;k<U;k++)f.readUByte()}break;case 7:n=
x=!0;if(!d.sps){f=new ba(b.data);e=f.readSPS();d.width=e.width;d.height=e.height;d.pixelRatio=e.pixelRatio;d.sps=[b.data];d.duration=c._duration;e=b.data.subarray(1,4);t="avc1.";for(k=0;3>k;k++)l=e[k].toString(16),2>l.length&&(l="0"+l),t+=l;d.codec=t}break;case 8:x=!0;d.pps||(d.pps=[b.data]);break;case 9:x=!1;d.audFound=!0;h&&m(h,d);h=c.avcSample=N(!1,a.pts,a.dts,"");break;case 12:x=!1;break;default:x=!1,h&&(h.debug+="unknown NAL "+b.type+" ")}h&&x&&h.units.push(b)});b&&h&&(m(h,d),this.avcSample=
null)};b._insertSampleInOrder=function(a,b){var c=a.length;if(0<c)if(b.pts>=a[c-1].pts)a.push(b);else for(--c;0<=c;c--){if(b.pts<a[c].pts){a.splice(c,0,b);break}}else a.push(b)};b._getLastNalUnit=function(){var a=this.avcSample;a&&0!==a.units.length||(a=this._avcTrack.samples,a=a[a.length-1]);if(a){var b=a.units;b=b[b.length-1]}return b};b._parseAVCNALu=function(a){var b=0,c=a.byteLength,d,e=this._avcTrack,f=d=e.naluState||0,h=[],n=-1;if(-1===d){n=0;var x=a[0]&31;d=0;b=1}for(;b<c;){var k=a[b++];if(d)if(1===
d)d=k?0:2;else if(k)if(1===k){if(0<=n)k={data:a.subarray(n,b-d-1),type:x},h.push(k);else if(k=this._getLastNalUnit())if(f&&b<=4-f&&k.state&&(k.data=k.data.subarray(0,k.data.byteLength-f)),d=b-d-1,0<d){var m=new Uint8Array(k.data.byteLength+d);m.set(k.data,0);m.set(a.subarray(0,d),k.data.byteLength);k.data=m}b<c?(d=a[b]&31,n=b,x=d,d=0):d=-1}else d=0;else d=3;else d=k?0:1}0<=n&&0<=d&&(k={data:a.subarray(n,c),type:x,state:d},h.push(k));0===h.length&&(b=this._getLastNalUnit())&&(c=new Uint8Array(b.data.byteLength+
a.byteLength),c.set(b.data,0),c.set(a,b.data.byteLength),b.data=c);e.naluState=d;return h};b.discardEPB=function(a){for(var b=a.byteLength,c=[],d=1,e;d<b-2;)0===a[d]&&0===a[d+1]&&3===a[d+2]?(c.push(d+2),d+=2):d++;if(0===c.length)return a;b-=c.length;e=new Uint8Array(b);var f=0;for(d=0;d<b;f++,d++)f===c[0]&&(f++,c.shift()),e[d]=a[f];return e};b._parseAACPES=function(a){var b=this._audioTrack,d=a.data;a=a.pts;var e=this.aacOverFlow,h=this.aacLastPTS,n;if(e){var x=new Uint8Array(e.byteLength+d.byteLength);
x.set(e,0);x.set(d,e.byteLength);d=x}x=0;for(n=d.length;x<n-1&&!c(d,x);x++);if(x){if(x<n-1){var m="AAC PES did not start with ADTS header,offset:"+x;var l=!1}else m="no ADTS header found in AAC PES",l=!0;E.logger.warn("parsing error:"+m);this.observer.trigger(D["default"].ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:l,reason:m});if(l)return}f(b,this.observer,d,x,this.audioCodec);m=0;l=9216E4/b.samplerate;e&&h&&(e=h+l,1<Math.abs(e-a)&&(E.logger.log("AAC: align PTS for overlapping frames by "+
Math.round((e-a)/90)),a=e));for(;x<n;)if(c(d,x)){if(x+5<n&&(e=k(b,d,x,a,m))){x+=e.length;var t=e.sample.pts;m++;continue}break}else x++;this.aacOverFlow=e=x<n?d.subarray(x,n):null;this.aacLastPTS=t};b._parseMPEGPES=function(a){var b=a.data,c=b.length,d=0,e=0;for(a=a.pts;e<c;)if(Y.isHeader(b,e)){var f=Y.appendFrame(this._audioTrack,b,e,a,d);if(f)e+=f.length,d++;else break}else e++};b._parseID3PES=function(a){this._id3Track.samples.push(a)};return a}(),da=function(){function a(a,b,c){this.observer=
a;this.config=c;this.remuxer=b}var b=a.prototype;b.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9E4}};b.resetTimeStamp=function(){};a.probe=function(a){var b,c;if((b=A["default"].getID3Data(a,0))&&void 0!==A["default"].getTimeStamp(b))for(b=b.length,c=Math.min(a.length-1,b+100);b<c;b++)if(Y.probe(a,b))return E.logger.log("MPEG Audio sync word found !"),!0;return!1};
b.append=function(a,b,c,d){var e=A["default"].getID3Data(a,0)||[],f=A["default"].getTimeStamp(e);f=void 0!==f?90*f:9E4*b;for(var h=e.length,n=a.length,x=0,k=0,m=this._audioTrack,l=[{pts:f,dts:f,data:e}];h<n;)if(Y.isHeader(a,h))if(e=Y.appendFrame(m,a,h,f,x))h+=e.length,k=e.sample.pts,x++;else break;else A["default"].isHeader(a,h)?(e=A["default"].getID3Data(a,h),l.push({pts:k,dts:k,data:e}),h+=e.length):h++;this.remuxer.remux(m,{samples:[]},{samples:l,inputTimeScale:9E4},{samples:[]},b,c,d)};b.destroy=
function(){};return a}(),ra=function(){function a(){}a.getSilentFrame=function(a,b){switch(a){case "mp4a.40.2":if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,
200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b||3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,
90,90,90,90,94])}return null};return a}(),W=Math.pow(2,32)-1,la=function(){function a(){}a.init=function(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};for(var b in a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),
b.charCodeAt(3)]);b=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);var c=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:b,audio:c};b=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);c=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=c;a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);a.VMHD=new Uint8Array([0,0,
0,1,0,0,0,0,0,0,0,0]);a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);c=new Uint8Array([105,115,111,109]);var d=new Uint8Array([97,118,99,49]),e=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,c,e,c,d);a.DINF=a.box(a.types.dinf,a.box(a.types.dref,b))};a.box=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=8,d=b.length,e=d,f;d--;)c+=b[d].byteLength;f=new Uint8Array(c);f[0]=c>>24&255;f[1]=c>>16&255;f[2]=c>>8&255;f[3]=c&255;f.set(a,4);d=0;for(c=8;d<
e;d++)f.set(b[d],c),c+=b[d].byteLength;return f};a.hdlr=function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])};a.mdat=function(b){return a.box(a.types.mdat,b)};a.mdhd=function(b,c){c*=b;var d=Math.floor(c/(W+1));c=Math.floor(c%(W+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,b&255,d>>24,d>>16&255,d>>8&255,d&255,c>>24,c>>16&255,c>>8&255,c&255,85,196,0,0]))};a.mdia=function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),
a.hdlr(b.type),a.minf(b))};a.mfhd=function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,b&255]))};a.minf=function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))};a.moof=function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))};a.moov=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,
b[0].duration)].concat(d).concat(a.mvex(b)))};a.mvex=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))};a.mvhd=function(b,c){c*=b;var d=Math.floor(c/(W+1));c=Math.floor(c%(W+1));b=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,b&255,d>>24,d>>16&255,d>>8&255,d&255,c>>24,c>>16&255,c>>8&255,c&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,b)};a.sdtp=function(b){b=b.samples||[];var c=new Uint8Array(4+b.length),d;for(d=0;d<b.length;d++){var e=b[d].flags;c[d+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy}return a.box(a.types.sdtp,c)};a.stbl=function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))};a.avc1=function(b){var c=[],d=[],e;for(e=0;e<b.sps.length;e++){var f=
b.sps[e];var h=f.byteLength;c.push(h>>>8&255);c.push(h&255);c=c.concat(Array.prototype.slice.call(f))}for(e=0;e<b.pps.length;e++)f=b.pps[e],h=f.byteLength,d.push(h>>>8&255),d.push(h&255),d=d.concat(Array.prototype.slice.call(f));c=a.box(a.types.avcC,new Uint8Array([1,c[3],c[4],c[5],255,224|b.sps.length].concat(c).concat([b.pps.length]).concat(d)));d=b.width;e=b.height;f=b.pixelRatio[0];b=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&
255,d&255,e>>8&255,e&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,b>>24,b>>16&255,b>>8&255,b&255])))};a.esds=function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,
1,2]))};a.mp4a=function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,c&255,0,0]),a.box(a.types.esds,a.esds(b)))};a.mp3=function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,c&255,0,0]))};a.stsd=function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):
a.box(a.types.stsd,a.STSD,a.avc1(b))};a.tkhd=function(b){var c=b.id,d=b.duration*b.timescale,e=b.width;b=b.height;var f=Math.floor(d/(W+1));d=Math.floor(d%(W+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,c&255,0,0,0,0,f>>24,f>>16&255,f>>8&255,f&255,d>>24,d>>16&255,d>>8&255,d&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,e&255,0,0,b>>8&255,b&255,0,0]))};a.traf=
function(b,c){var d=a.sdtp(b),e=b.id,f=Math.floor(c/(W+1));c=Math.floor(c%(W+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,f>>24,f>>16&255,f>>8&255,f&255,c>>24,c>>16&255,c>>8&255,c&255])),a.trun(b,d.length+16+20+8+16+8+8),d)};a.trak=function(b){b.duration=b.duration||4294967295;return a.box(a.types.trak,a.tkhd(b),a.mdia(b))};a.trex=function(b){b=b.id;return a.box(a.types.trex,new Uint8Array([0,
0,0,0,b>>24,b>>16&255,b>>8&255,b&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))};a.trun=function(b,c){b=b.samples||[];var d=b.length,e=12+16*d,f=new Uint8Array(e);c+=8+e;f.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,d&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255],0);for(c=0;c<d;c++){var h=b[c];e=h.duration;var n=h.size;var k=h.flags;h=h.cts;f.set([e>>>24&255,e>>>16&255,e>>>8&255,e&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,k.isLeading<<2|k.dependsOn,k.isDependedOn<<6|k.hasRedundancy<<4|k.paddingValue<<1|k.isNonSync,
k.degradPrio&61440,k.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*c)}return a.box(a.types.trun,f)};a.initSegment=function(b){a.types||a.init();b=a.moov(b);var c=new Uint8Array(a.FTYP.byteLength+b.byteLength);c.set(a.FTYP);c.set(b,a.FTYP.byteLength);return c};return a}(),ha=y(10),M=y(.2),L=null,ka=function(){function a(a,b,c,d){this.observer=a;this.config=b;this.typeSupported=c;this.ISGenerated=!1;null===L&&(L=(a=navigator.userAgent.match(/Chrome\/(\d+)/i))?parseInt(a[1]):0)}var b=a.prototype;
b.destroy=function(){};b.resetTimeStamp=function(a){this._initPTS=this._initDTS=a};b.resetInitSegment=function(){this.ISGenerated=!1};b.getVideoStartPts=function(a){var b=!1;a=a.reduce(function(a,c){var d=c.pts-a;return-4294967296>d?(b=!0,h(a,c.pts)):0<d?a:c.pts},a[0].pts);b&&E.logger.debug("PTS rollover detected");return a};b.remux=function(a,b,c,d,e,f,n){this.ISGenerated||this.generateIS(a,b,e);if(this.ISGenerated){var k=a.samples.length,m=b.samples.length,l=e,t=e;if(k&&m){var x=this.getVideoStartPts(b.samples);
x=(h(a.samples[0].pts,x)-x)/b.inputTimeScale;l+=Math.max(0,x);t+=Math.max(0,-x)}if(k){if(a.timescale||(E.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(a,b,e)),l=this.remuxAudio(a,l,f,n),m){var y;l&&(y=l.endPTS-l.startPTS);b.timescale||(E.logger.warn("regenerate InitSegment as video detected"),this.generateIS(a,b,e));this.remuxVideo(b,t,f,y)}}else m&&(b=this.remuxVideo(b,t,f,0,n))&&a.codec&&this.remuxEmptyAudio(a,l,f,b)}c.samples.length&&this.remuxID3(c,e);d.samples.length&&
this.remuxText(d,e);this.observer.trigger(D["default"].FRAG_PARSED)};b.generateIS=function(a,b,c){var d=this.observer,e=a.samples,f=b.samples,n=this.typeSupported,k="audio/mp4",m={},l={tracks:m},t=void 0===this._initPTS,x,y;t&&(x=y=Infinity);a.config&&e.length&&(a.timescale=a.samplerate,E.logger.log("audio sampling rate : "+a.samplerate),a.isAAC||(n.mpeg?(k="audio/mpeg",a.codec=""):n.mp3&&(a.codec="mp3")),m.audio={container:k,codec:a.codec,initSegment:!a.isAAC&&n.mpeg?new Uint8Array:la.initSegment([a]),
metadata:{channelCount:a.channelCount}},t&&(x=y=e[0].pts-Math.round(a.inputTimeScale*c)));b.sps&&b.pps&&f.length?(a=b.inputTimeScale,b.timescale=a,m.video={container:"video/mp4",codec:b.codec,initSegment:la.initSegment([b]),metadata:{width:b.width,height:b.height}},t&&(b=this.getVideoStartPts(f),c=Math.round(a*c),y=Math.min(y,h(f[0].dts,b)-c),x=Math.min(x,b-c),this.observer.trigger(D["default"].INIT_PTS_FOUND,{initPTS:x}))):t&&m.audio&&this.observer.trigger(D["default"].INIT_PTS_FOUND,{initPTS:x});
Object.keys(m).length?(d.trigger(D["default"].FRAG_PARSING_INIT_SEGMENT,l),this.ISGenerated=!0,t&&(this._initPTS=x,this._initDTS=y)):d.trigger(D["default"].ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})};b.remuxVideo=function(a,b,c,d){var e=a.timescale,f=a.samples,k=[],m=f.length,l=this._initPTS,t=8,x=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,r=0;var w=!1;var I=this.nextAvcDts;if(0!==m){c||(I=b*e,b=f[0].pts-
h(f[0].dts,f[0].pts),I-=b);for(b=0;b<m;b++){var F=f[b];F.pts=h(F.pts-l,I);F.dts=h(F.dts-l,I);F.dts>F.pts&&(r=Math.max(Math.min(r,F.pts-F.dts),-1*M));F.dts<f[0<b?b-1:b].dts&&(w=!0)}w&&f.sort(function(a,b){var c=a.pts-b.pts;return a.dts-b.dts||c||a.id-b.id});l=f[0].dts;w=f[m-1].dts;b=Math.round((w-l)/(m-1));if(0>r){if(r<-2*b)for(E.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+n(-b,!0)+" ms"),l=r,w=0;w<m;w++)f[w].dts=l=Math.max(l,f[w].pts-b),f[w].pts=Math.max(l,f[w].pts);
else for(E.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+n(r,!0)+" ms to overcome this issue"),l=0;l<m;l++)f[l].dts+=r;l=f[0].dts;w=f[m-1].dts}c&&(w=l-I,(c=w>b)||-1>w)&&(c?E.logger.warn("AVC: "+n(w,!0)+" ms ("+w+"dts) hole between fragments detected, filling it"):E.logger.warn("AVC: "+n(-w,!0)+" ms ("+w+"dts) overlapping between fragments detected"),l=I,c=f[0].pts-w,f[0].dts=l,f[0].pts=c,E.logger.log("Video: First PTS/DTS adjusted: "+n(c,!0)+"/"+n(l,!0)+", delta: "+n(w,!0)+" ms"));
L&&75>L&&(l=Math.max(0,l));for(w=I=c=0;w<m;w++){r=f[w];b=r.units;F=b.length;for(var z=0,A=0;A<F;A++)z+=b[A].data.length;I+=z;c+=F;r.length=z;r.dts=Math.max(r.dts,l);r.pts=Math.max(r.pts,r.dts,0);x=Math.min(r.pts,x);y=Math.max(r.pts,y)}w=f[m-1].dts;I=I+4*c+8;try{var N=new Uint8Array(I)}catch(fd){this.observer.trigger(D["default"].ERROR,{type:J.ErrorTypes.MUX_ERROR,details:J.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:I,reason:"fail allocating video mdat "+I});return}c=new DataView(N.buffer);c.setUint32(0,
I);N.set(la.types.mdat,4);for(I=0;I<m;I++){r=f[I];var G=r.units;b=0;F=void 0;F=0;for(z=G.length;F<z;F++){var O=G[F];A=O.data;O=O.data.byteLength;c.setUint32(t,O);t+=4;N.set(A,t);t+=O;b+=4+O}I<m-1?G=f[I+1].dts-r.dts:(G=this.config,F=r.dts-f[0<I?I-1:I].dts,G.stretchShortVideoTrack?(z=(d?x+d*e:this.nextAudioPts)-r.pts,z>Math.floor(G.maxBufferHole*e)?(G=z-F,0>G&&(G=F),E.logger.log("It is approximately "+n(z,!1)+" ms to the next segment; using duration "+n(G,!1)+" ms for the last video frame.")):G=F):
G=F);F=Math.round(r.pts-r.dts);k.push({size:b,duration:G,cts:F,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r.key?2:1,isNonSync:r.key?0:1}})}this.nextAvcDts=w+G;d=a.dropped;a.nbNalu=0;a.dropped=0;k.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")&&(f=k[0].flags,f.dependsOn=2,f.isNonSync=0);a.samples=k;f=la.moof(a.sequenceNumber++,l,a);a.samples=[];a={data1:f,data2:N,startPTS:x/e,endPTS:(y+G)/e,startDTS:l/e,endDTS:this.nextAvcDts/e,type:"video",hasAudio:!1,
hasVideo:!0,nb:k.length,dropped:d};this.observer.trigger(D["default"].FRAG_PARSING_DATA,a);return a}};b.remuxAudio=function(a,b,c,d){var e=a.inputTimeScale,f=e/a.timescale,k=(a.isAAC?1024:1152)*f,m=this._initPTS,l=!a.isAAC&&this.typeSupported.mpeg,t,y=l?0:8,r=a.samples,x=[],w=this.nextAudioPts;c|=r.length&&w&&(d&&.1>Math.abs(b-w/e)||Math.abs(r[0].pts-w-m)<20*k);r.forEach(function(a){a.pts=a.dts=h(a.pts-m,b*e)});r=r.filter(function(a){return 0<=a.pts});if(0!==r.length){c||(w=d?Math.max(0,b*e):r[0].pts);
if(a.isAAC)for(var F=this.config.maxAudioFramesDrift,z=0,G=w;z<r.length;){var A=r[z],I=A.pts;d=I-G;if(d<=-F*k)c||0<z?(E.logger.warn("Dropping 1 audio frame @ "+n(G,!0)/1E3+"s due to "+n(d,!0)+" ms overlap."),r.splice(z,1)):(E.logger.warn("Audio frame @ "+n(I,!0)/1E3+"s overlaps nextAudioPts by "+n(d,!0)+" ms."),G=I+k,z++);else{if(d>=F*k&&d<ha&&G){I=Math.round(d/k);E.logger.warn("Injecting "+I+" audio frames @ "+n(G,!0)/1E3+"s due to "+n(d,!0)+" ms gap.");for(var N=0;N<I;N++){var O=Math.max(G,0);d=
ra.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);d||(E.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),d=A.unit.subarray());r.splice(z,0,{unit:d,pts:O,dts:O});G+=k;z++}}A.pts=A.dts=G;G+=k;z++}}d=r.length;for(F=0;d--;)F+=r[d].unit.byteLength;z=0;for(G=r.length;z<G;z++){d=r[z];A=d.unit;I=d.pts;if(void 0!==t&&K)K.duration=Math.round((I-t)/f);else{d=I-w;N=0;if(c&&a.isAAC&&d){if(0<d&&d<ha)N=Math.round((I-w)/k),E.logger.log(n(d,!0)+" ms hole between AAC samples detected,filling it"),
0<N&&((d=ra.getSilentFrame(a.manifestCodec||a.codec,a.channelCount))||(d=A.subarray()),F+=N*d.length);else if(-12>d){E.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+n(w,!0)+" ms / "+n(I,!0)+" ms / "+n(-d,!0)+" ms");F-=A.byteLength;continue}I=w}var M=I;if(0<F){F+=y;try{var L=new Uint8Array(F)}catch(gd){this.observer.trigger(D["default"].ERROR,{type:J.ErrorTypes.MUX_ERROR,details:J.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:F,reason:"fail allocating audio mdat "+F});return}l||
((new DataView(L.buffer)).setUint32(0,F),L.set(la.types.mdat,4))}else return;for(t=0;t<N;t++){d=ra.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);d||(E.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),d=A.subarray());L.set(d,y);y+=d.byteLength;var K={size:d.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};x.push(K)}}L.set(A,y);K=A.byteLength;y+=K;K={size:K,cts:0,duration:0,flags:{isLeading:0,
isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};x.push(K);t=I}w=0;d=x.length;2<=d&&(w=x[d-2].duration,K.duration=w);return d?(this.nextAudioPts=w=t+f*w,a.samples=x,f=l?new Uint8Array:la.moof(a.sequenceNumber++,M/f,a),a.samples=[],a=M/e,M=w/e,L={data1:f,data2:L,startPTS:a,endPTS:M,startDTS:a,endDTS:M,type:"audio",hasAudio:!0,hasVideo:!1,nb:d},this.observer.trigger(D["default"].FRAG_PARSING_DATA,L),L):null}};b.remuxEmptyAudio=function(a,b,c,d){var e=a.inputTimeScale,f=this.nextAudioPts;f=
(void 0!==f?f:d.startDTS*e)+this._initDTS;var h=e/(a.samplerate?a.samplerate:e)*1024;d=Math.ceil((d.endDTS*e+this._initDTS-f)/h);e=ra.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);E.logger.warn("remux empty Audio");if(e){for(var n=[],k=0;k<d;k++){var m=f+k*h;n.push({unit:e,pts:m,dts:m})}a.samples=n;this.remuxAudio(a,b,c)}else E.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")};b.remuxID3=function(a,b){var c=a.samples.length;if(c){for(var d=
a.inputTimeScale,e=this._initPTS,f=this._initDTS,n=0;n<c;n++){var k=a.samples[n];k.pts=h(k.pts-e,b*d)/d;k.dts=h(k.dts-f,b*d)/d}this.observer.trigger(D["default"].FRAG_PARSING_METADATA,{samples:a.samples});a.samples=[]}};b.remuxText=function(a,b){var c=a.samples.length,d=a.inputTimeScale,e=this._initPTS;if(c){for(var f=0;f<c;f++){var n=a.samples[f];n.pts=h(n.pts-e,b*d)/d}a.samples.sort(function(a,b){return a.pts-b.pts});this.observer.trigger(D["default"].FRAG_PARSING_USERDATA,{samples:a.samples})}a.samples=
[]};return a}(),oa=function(){function a(a){this.observer=a}var b=a.prototype;b.destroy=function(){};b.resetTimeStamp=function(){};b.resetInitSegment=function(){};b.remux=function(a,b,c,d,e,f,h,n){c=this.observer;d="";a&&(d+="audio");b&&(d+="video");c.trigger(D["default"].FRAG_PARSING_DATA,{data1:n,startPTS:e,startDTS:e,type:d,hasAudio:!!a,hasVideo:!!b,nb:1,dropped:0});c.trigger(D["default"].FRAG_PARSED)};return a}();e=Object(a.getSelfScope)();try{var na=e.performance.now.bind(e.performance)}catch(U){E.logger.debug("Unable to use Performance API on this environment"),
na=e.Date.now}e=function(){function a(a,b,c,d){this.observer=a;this.typeSupported=b;this.config=c;this.vendor=d}var b=a.prototype;b.destroy=function(){var a=this.demuxer;a&&a.destroy()};b.push=function(a,b,c,d,e,f,h,n,k,m,l,t){var r=this;if(0<a.byteLength&&null!=b&&null!=b.key&&"AES-128"===b.method){var y=this.decrypter;null==y&&(y=this.decrypter=new w["default"](this.observer,this.config));var x=na();y.decrypt(a,b.key.buffer,b.iv.buffer,function(a){var y=na();r.observer.trigger(D["default"].FRAG_DECRYPTED,
{stats:{tstart:x,tdecrypt:y}});r.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,f,h,n,k,m,l,t)})}else this.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,f,h,n,k,m,l,t)};b.pushDecrypted=function(a,b,c,d,e,f,h,n,k,m,l,t){var r=this.demuxer,y=this.remuxer;if(!r||h||n){for(var x=this.observer,w=this.typeSupported,F=this.config,z=[{demux:ia,remux:ka},{demux:P["default"],remux:oa},{demux:K,remux:ka},{demux:da,remux:ka}],G,E=0,A=z.length;E<A&&(G=z[E],!G.demux.probe(a));E++);if(!G){x.trigger(D["default"].ERROR,
{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});return}y&&y instanceof G.remux||(y=new G.remux(x,F,w,this.vendor));r&&r instanceof G.demux||(r=new G.demux(x,y,F,w),this.probe=G.demux.probe);this.demuxer=r;this.remuxer=y}if(h||n)r.resetInitSegment(c,d,e,m),y.resetInitSegment();h&&(r.resetTimeStamp(t),y.resetTimeStamp(t));"function"===typeof r.setDecryptData&&r.setDecryptData(b);r.append(a,f,k,l)};return a}();b["default"]=
e},"./src/demux/demuxer-worker.js":function(a,b,e){e.r(b);var c=e("./src/demux/demuxer-inline.js"),d=e("./src/events.js"),f=e("./src/utils/logger.js"),k=e("./node_modules/eventemitter3/index.js");b["default"]=function(a){var b=new k.EventEmitter;b.trigger=function(a){for(var c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b.emit.apply(b,[a,a].concat(d))};b.off=function(a){for(var c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b.removeListener.apply(b,[a].concat(d))};
var e=function(b,c){a.postMessage({event:b,data:c})};a.addEventListener("message",function(d){d=d.data;switch(d.cmd){case "init":var h=JSON.parse(d.config);a.demuxer=new c["default"](b,d.typeSupported,h,d.vendor);Object(f.enableLogs)(h.debug);e("init",null);break;case "demux":a.demuxer.push(d.data,d.decryptdata,d.initSegment,d.audioCodec,d.videoCodec,d.timeOffset,d.discontinuity,d.trackSwitch,d.contiguous,d.duration,d.accurateTimeOffset,d.defaultInitPTS)}});b.on(d["default"].FRAG_DECRYPTED,e);b.on(d["default"].FRAG_PARSING_INIT_SEGMENT,
e);b.on(d["default"].FRAG_PARSED,e);b.on(d["default"].ERROR,e);b.on(d["default"].FRAG_PARSING_METADATA,e);b.on(d["default"].FRAG_PARSING_USERDATA,e);b.on(d["default"].INIT_PTS_FOUND,e);b.on(d["default"].FRAG_PARSING_DATA,function(b,c){var d=[];b={event:b,data:c};c.data1&&(b.data1=c.data1.buffer,d.push(c.data1.buffer),delete c.data1);c.data2&&(b.data2=c.data2.buffer,d.push(c.data2.buffer),delete c.data2);a.postMessage(b,d)})}},"./src/demux/id3.js":function(a,b,e){e.r(b);e.d(b,"utf8ArrayToStr",function(){return f});
var c=e("./src/utils/get-self-scope.js");a=function(){function a(){}a.isHeader=function(a,b){return b+10<=a.length&&73===a[b]&&68===a[b+1]&&51===a[b+2]&&255>a[b+3]&&255>a[b+4]&&128>a[b+6]&&128>a[b+7]&&128>a[b+8]&&128>a[b+9]?!0:!1};a.isFooter=function(a,b){return b+10<=a.length&&51===a[b]&&68===a[b+1]&&73===a[b+2]&&255>a[b+3]&&255>a[b+4]&&128>a[b+6]&&128>a[b+7]&&128>a[b+8]&&128>a[b+9]?!0:!1};a.getID3Data=function(b,c){for(var d=c,e=0;a.isHeader(b,c);){e+=10;var f=a._readSize(b,c+6);e+=f;a.isFooter(b,
c+10)&&(e+=10);c+=e}if(0<e)return b.subarray(d,d+e)};a._readSize=function(a,b){var c=(a[b]&127)<<21;c|=(a[b+1]&127)<<14;c|=(a[b+2]&127)<<7;return c|=a[b+3]&127};a.getTimeStamp=function(b){b=a.getID3Frames(b);for(var c=0;c<b.length;c++){var d=b[c];if(a.isTimeStampFrame(d))return a._readTimeStamp(d)}};a.isTimeStampFrame=function(a){return a&&"PRIV"===a.key&&"com.apple.streaming.transportStreamTimestamp"===a.info};a._getFrameData=function(b){var c=String.fromCharCode(b[0],b[1],b[2],b[3]),d=a._readSize(b,
4);return{type:c,size:d,data:b.subarray(10,10+d)}};a.getID3Frames=function(b){for(var c=0,d=[];a.isHeader(b,c);){var e=a._readSize(b,c+6);c+=10;for(e=c+e;c+8<e;){var f=a._getFrameData(b.subarray(c)),k=a._decodeFrame(f);k&&d.push(k);c+=f.size+10}a.isFooter(b,c)&&(c+=10)}return d};a._decodeFrame=function(b){return"PRIV"===b.type?a._decodePrivFrame(b):"W"===b.type[0]?a._decodeURLFrame(b):a._decodeTextFrame(b)};a._readTimeStamp=function(a){if(8===a.data.byteLength){var b=new Uint8Array(a.data);a=b[3]&
1;b=(b[4]<<23)+(b[5]<<15)+(b[6]<<7)+b[7];b/=45;a&&(b+=4.772185884E7);return Math.round(b)}};a._decodePrivFrame=function(b){if(!(2>b.size)){var c=a._utf8ArrayToStr(b.data,!0),d=new Uint8Array(b.data.subarray(c.length+1));return{key:b.type,info:c,data:d.buffer}}};a._decodeTextFrame=function(b){if(!(2>b.size)){if("TXXX"===b.type){var c=1,d=a._utf8ArrayToStr(b.data.subarray(c),!0);c+=d.length+1;c=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:c}}d=a._utf8ArrayToStr(b.data.subarray(1));
return{key:b.type,data:d}}};a._decodeURLFrame=function(b){if("WXXX"===b.type){if(!(2>b.size)){var c=1,d=a._utf8ArrayToStr(b.data.subarray(c),!0);c+=d.length+1;c=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:c}}}else return d=a._utf8ArrayToStr(b.data),{key:b.type,data:d}};a._utf8ArrayToStr=function(a,b){void 0===b&&(b=!1);var e=Object(c.getSelfScope)();d||"undefined"===typeof e.TextDecoder||(d=new e.TextDecoder("utf-8"));if(e=d)return a=e.decode(a),b?(b=a.indexOf("\x00"),-1!==
b?a.substring(0,b):a):a.replace(/\0/g,"");e=a.length;for(var f,k,n,l="",t=0;t<e;){f=a[t++];if(0===f&&b)break;else if(0===f||3===f)continue;switch(f>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(f);break;case 12:case 13:k=a[t++];l+=String.fromCharCode((f&31)<<6|k&63);break;case 14:k=a[t++],n=a[t++],l+=String.fromCharCode((f&15)<<12|(k&63)<<6|(n&63)<<0)}}return l};return a}();var d,f=a._utf8ArrayToStr;b["default"]=a},"./src/demux/mp4demuxer.js":function(a,b,e){e.r(b);
var c=e("./src/utils/logger.js"),d=e("./src/events.js"),f=Math.pow(2,32)-1;a=function(){function a(a,b){this.observer=a;this.remuxer=b}var b=a.prototype;b.resetTimeStamp=function(a){this.initPTS=a};b.resetInitSegment=function(b,c,e,f){if(b&&b.byteLength){var h=this.initData=a.parseInitSegment(b);null==c&&(c="mp4a.40.5");null==e&&(e="avc1.42e01e");var l={};h.audio&&h.video?l.audiovideo={container:"video/mp4",codec:c+","+e,initSegment:f?b:null}:(h.audio&&(l.audio={container:"audio/mp4",codec:c,initSegment:f?
b:null}),h.video&&(l.video={container:"video/mp4",codec:e,initSegment:f?b:null}));this.observer.trigger(d["default"].FRAG_PARSING_INIT_SEGMENT,{tracks:l})}else c&&(this.audioCodec=c),e&&(this.videoCodec=e)};a.probe=function(b){return 0<a.findBox({data:b,start:0,end:Math.min(b.length,16384)},["moof"]).length};a.bin2str=function(a){return String.fromCharCode.apply(null,a)};a.readUint16=function(a,b){a.data&&(b+=a.start,a=a.data);a=a[b]<<8|a[b+1];return 0>a?65536+a:a};a.readUint32=function(a,b){a.data&&
(b+=a.start,a=a.data);a=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3];return 0>a?4294967296+a:a};a.writeUint32=function(a,b,c){a.data&&(b+=a.start,a=a.data);a[b]=c>>24;a[b+1]=c>>16&255;a[b+2]=c>>8&255;a[b+3]=c&255};a.findBox=function(b,c){var d=[];if(b.data){var e=b.start;var f=b.end;b=b.data}else e=0,f=b.byteLength;if(!c.length)return null;for(;e<f;){var l=a.readUint32(b,e);var k=a.bin2str(b.subarray(e+4,e+8));l=1<l?e+l:f;k===c[0]&&(1===c.length?d.push({data:b,start:e+8,end:l}):(e=a.findBox({data:b,start:e+
8,end:l},c.slice(1)),e.length&&(d=d.concat(e))));e=l}return d};a.parseSegmentIndex=function(b){var c=a.findBox(b,["moov"])[0];c=c?c.end:null;b=a.findBox(b,["sidx"]);if(!b||!b[0])return null;var d=[];b=b[0];var e=b.data[0];var f=0===e?8:16;var l=a.readUint32(b,f);f+=4;f=(0===e?f+8:f+16)+2;var k=b.end+0,t=a.readUint16(b,f);f+=2;for(var n=0;n<t;n++){var m=a.readUint32(b,f);f+=4;var r=m&2147483647;if(1===(m&2147483648)>>>31){console.warn("SIDX has hierarchical references (not supported)");return}m=a.readUint32(b,
f);f+=4;d.push({referenceSize:r,subsegmentDuration:m,info:{duration:m/l,start:k,end:k+r-1}});k+=r;f+=4}return{earliestPresentationTime:0,timescale:l,version:e,referencesCount:t,references:d,moovEndOffset:c}};a.parseInitSegment=function(b){var d=[];a.findBox(b,["moov","trak"]).forEach(function(b){var e=a.findBox(b,["tkhd"])[0];if(e){var f=e.data[e.start];e=a.readUint32(e,0===f?12:20);var h=a.findBox(b,["mdia","mdhd"])[0];h&&(f=h.data[h.start],f=a.readUint32(h,0===f?12:20),h=a.findBox(b,["mdia","hdlr"])[0])&&
(h={soun:"audio",vide:"video"}[a.bin2str(h.data.subarray(h.start+8,h.start+12))])&&(b=a.findBox(b,["mdia","minf","stbl","stsd"]),b.length&&(b=b[0],b=a.bin2str(b.data.subarray(b.start+12,b.start+16)),c.logger.log("MP4Demuxer:"+h+":"+b+" found")),d[e]={timescale:f,type:h},d[h]={timescale:f,id:e})}});return d};a.getStartDTS=function(b,c){c=a.findBox(c,["moof","traf"]);c=[].concat.apply([],c.map(function(c){return a.findBox(c,["tfhd"]).map(function(d){d=a.readUint32(d,4);d=b[d].timescale||9E4;return a.findBox(c,
["tfdt"]).map(function(b){var c=b.data[b.start];var d=a.readUint32(b,4);1===c&&(d*=Math.pow(2,32),d+=a.readUint32(b,8));return d})[0]/d})}));c=Math.min.apply(null,c);return isFinite(c)?c:0};a.offsetStartDTS=function(b,c,d){a.findBox(c,["moof","traf"]).map(function(c){return a.findBox(c,["tfhd"]).map(function(e){e=a.readUint32(e,4);var h=b[e].timescale||9E4;a.findBox(c,["tfdt"]).map(function(b){var c=b.data[b.start],e=a.readUint32(b,4);0===c?a.writeUint32(b,4,e-d*h):(e*=Math.pow(2,32),e+=a.readUint32(b,
8),e-=d*h,e=Math.max(e,0),c=Math.floor(e%(f+1)),a.writeUint32(b,4,Math.floor(e/(f+1))),a.writeUint32(b,8,c))})})})};b.append=function(b,c,e,f){var h=this.initData;h||(this.resetInitSegment(b,this.audioCodec,this.videoCodec,!1),h=this.initData);var l=this.initPTS;void 0===l&&(this.initPTS=l=a.getStartDTS(h,b)-c,this.observer.trigger(d["default"].INIT_PTS_FOUND,{initPTS:l}));a.offsetStartDTS(h,b,l);c=a.getStartDTS(h,b);this.remuxer.remux(h.audio,h.video,null,null,c,e,f,b)};b.destroy=function(){};return a}();
b["default"]=a},"./src/errors.ts":function(a,b,e){e.r(b);e.d(b,"ErrorTypes",function(){return c});e.d(b,"ErrorDetails",function(){return d});var c;(function(a){a.NETWORK_ERROR="networkError";a.MEDIA_ERROR="mediaError";a.KEY_SYSTEM_ERROR="keySystemError";a.MUX_ERROR="muxError";a.OTHER_ERROR="otherError"})(c||(c={}));var d;(function(a){a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys";a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess";a.KEY_SYSTEM_NO_SESSION="keySystemNoSession";a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed";
a.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData";a.MANIFEST_LOAD_ERROR="manifestLoadError";a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut";a.MANIFEST_PARSING_ERROR="manifestParsingError";a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError";a.LEVEL_EMPTY_ERROR="levelEmptyError";a.LEVEL_LOAD_ERROR="levelLoadError";a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut";a.LEVEL_SWITCH_ERROR="levelSwitchError";a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError";a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut";
a.FRAG_LOAD_ERROR="fragLoadError";a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut";a.FRAG_DECRYPT_ERROR="fragDecryptError";a.FRAG_PARSING_ERROR="fragParsingError";a.REMUX_ALLOC_ERROR="remuxAllocError";a.KEY_LOAD_ERROR="keyLoadError";a.KEY_LOAD_TIMEOUT="keyLoadTimeOut";a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError";a.BUFFER_APPEND_ERROR="bufferAppendError";a.BUFFER_APPENDING_ERROR="bufferAppendingError";a.BUFFER_STALLED_ERROR="bufferStalledError";a.BUFFER_FULL_ERROR="bufferFullError";a.BUFFER_SEEK_OVER_HOLE=
"bufferSeekOverHole";a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall";a.INTERNAL_EXCEPTION="internalException"})(d||(d={}))},"./src/events.js":function(a,b,e){e.r(b);b["default"]={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",
BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",
AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",
FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",
ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":function(a,b,e){function c(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}function d(a,b,v){b&&c(a.prototype,b);v&&c(a,v);return a}function f(a,b){for(var c=0;c<b.length;c++){var g=
b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}function k(a,b,c){b&&f(a.prototype,b);c&&f(a,c);return a}function m(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}function n(a,b,c){b&&m(a.prototype,b);c&&m(a,c);return a}function w(a,b){return MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+a+'"')}function h(a,b){var c=
a[b];for(--b;0<=b;b--){var g=a[b];g.programDateTime=c.programDateTime-1E3*g.duration;c=g}}function z(a,b){if(a.rawProgramDateTime)a.programDateTime=Date.parse(a.rawProgramDateTime);else if(null===b||void 0===b?0:b.programDateTime)a.programDateTime=b.endProgramDateTime;Object(Q.isFiniteNumber)(a.programDateTime)||(a.programDateTime=null,a.rawProgramDateTime=null)}function A(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function F(a,b){a.prototype=Object.create(b.prototype);
a.prototype.constructor=a;a.__proto__=b}function G(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function E(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function K(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function O(a,b,c){switch(b){case "audio":a.audioGroupIds||(a.audioGroupIds=[]);a.audioGroupIds.push(c);break;case "text":a.textGroupIds||(a.textGroupIds=[]),a.textGroupIds.push(c)}}
function P(a,b,c){var g=a[b];a=a[c];var u=a.startPTS;Object(Q.isFiniteNumber)(u)?c>b?(g.duration=u-g.start,0>g.duration&&p.logger.warn("negative duration computed for frag "+g.sn+",level "+g.level+", there should be some duration drift between playlist and fragment!")):(a.duration=g.start-u,0>a.duration&&p.logger.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):a.start=c>b?g.start+(g.cc===a.cc&&g.minEndPTS?
g.minEndPTS-g.start:g.duration):Math.max(g.start-a.duration,0)}function R(a,b,c,g,u,d){var v=c,H=g;if(Object(Q.isFiniteNumber)(b.startPTS)){var e=Math.abs(b.startPTS-c);Object(Q.isFiniteNumber)(b.deltaPTS)?b.deltaPTS=Math.max(e,b.deltaPTS):b.deltaPTS=e;v=Math.max(c,b.startPTS);c=Math.min(c,b.startPTS);H=Math.min(g,b.endPTS);g=Math.max(g,b.endPTS);u=Math.min(u,b.startDTS);d=Math.max(d,b.endDTS)}e=c-b.start;b.start=b.startPTS=c;b.maxStartPTS=v;b.endPTS=g;b.minEndPTS=H;b.startDTS=u;b.endDTS=d;b.duration=
g-c;c=b.sn;if(!a||c<a.startSN||c>a.endSN)return 0;c-=a.startSN;g=a.fragments;g[c]=b;for(b=c;0<b;b--)P(g,b,b-1);for(b=c;b<g.length-1;b++)P(g,b,b+1);a.PTSKnown=!0;return e}function W(a,b){b.initSegment&&a.initSegment&&(b.initSegment=a.initSegment);var c=0,g;aa(a,b,function(a,u){c=a.cc-u.cc;Object(Q.isFiniteNumber)(a.startPTS)&&(u.start=u.startPTS=a.startPTS,u.endPTS=a.endPTS,u.duration=a.duration,u.backtracked=a.backtracked,u.dropped=a.dropped,g=u);b.PTSKnown=!0});if(b.PTSKnown){if(c){p.logger.log("discontinuity sliding from playlist, take drift into account");
for(var u=b.fragments,d=0;d<u.length;d++)u[d].cc+=c}g?R(b,g,g.startPTS,g.endPTS,g.startDTS,g.endDTS):X(a,b);b.PTSKnown=a.PTSKnown}}function Y(a,b,c){void 0===c&&(c=0);var g=-1;aa(a,b,function(a,b,c){b.start=a.start;g=c});a=b.fragments;if(0>g)a.forEach(function(a){a.start+=c});else for(b=g+1;b<a.length;b++)a[b].start=a[b-1].start+a[b-1].duration}function aa(a,b,c){if(a&&b)for(var g=Math.min(a.endSN,b.endSN)-b.startSN,u=b.startSN-a.startSN,d=Math.max(a.startSN,b.startSN)-b.startSN;d<=g;d++){var v=a.fragments[u+
d],e=b.fragments[d];if(!v||!e)break;c(v,e,d)}}function X(a,b){var c=b.startSN-a.startSN;a=a.fragments;b=b.fragments;if(!(0>c||c>a.length))for(var g=0;g<b.length;g++)b[g].start+=a[c].start}function ba(a,b,c){var g=1E3*(b.averagetargetduration?b.averagetargetduration:b.targetduration),u=g/2;a&&b.endSN===a.endSN&&(g=u);c&&(g=Math.max(u,g-(window.performance.now()-c)));return Math.round(g)}function ia(a,b){return eb.search(a,function(a){return a.cc<b?1:a.cc>b?-1:0})}function da(a,b){b.fragments.forEach(function(b){if(b){var g=
b.start+a;b.start=b.startPTS=g;b.endPTS=g+b.duration}});b.PTSKnown=!0}function ha(a,b,c){var g=!1;c&&c.details&&b&&(b.endCC>b.startCC||a&&a.cc<b.startCC)&&(g=!0);if(g){a=c.details.fragments;c=b.fragments;if(c.length&&a.length){g=null;for(var u=0;u<a.length;u+=1){var d=a[u];if(d&&d.cc===c[0].cc){g=d;break}}a=g;if(!a||a&&!a.startPTS)p.logger.log("No frag in previous level to align on"),a=void 0}else p.logger.log("No fragments to align"),a=void 0;a&&(p.logger.log("Adjusting PTS using last level due to CC increase within current level"),
da(a.start,b))}}function la(a,b){b&&b.fragments.length&&a.hasProgramDateTime&&b.hasProgramDateTime&&(b=(a.fragments[0].programDateTime-b.fragments[0].programDateTime)/1E3+b.fragments[0].start,Object(Q.isFiniteNumber)(b)&&(p.logger.log("adjusting PTS using programDateTime delta, sliding:"+b.toFixed(3)),da(b,a)))}function ka(a,b,c){if(null===b||!Array.isArray(a)||!a.length||!Object(Q.isFiniteNumber)(b)||b<(a[0].programDateTime||0)||b>=(a[a.length-1].endProgramDateTime||0))return null;c=c||0;for(var g=
0;g<a.length;++g){var u=a[g];if((u.endProgramDateTime||0)-1E3*Math.min(c,u.duration+(u.deltaPTS?u.deltaPTS:0))>b)return u}return null}function M(a,b,c,g){void 0===c&&(c=0);void 0===g&&(g=0);var u=null;a?u=b[a.sn-b[0].sn+1]:0===c&&0===b[0].start&&(u=b[0]);return u&&0===L(c,g,u)?u:(a=eb.search(b,L.bind(null,c,g)))?a:u}function L(a,b,c){void 0===a&&(a=0);void 0===b&&(b=0);b=Math.min(b,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.start+c.duration-b<=a?1:c.start-b>a&&c.start?-1:0}function oa(a){if(void 0===
a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function ta(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function na(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function U(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}function T(a,b,c){b&&U(a.prototype,b);c&&U(a,c);
return a}function x(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function N(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}function Z(a,b,c){b&&N(a.prototype,b);c&&N(a,c);return a}function I(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function sa(a,b){try{var c=new Event("addtrack")}catch(g){c=document.createEvent("Event"),
c.initEvent("addtrack",!1,!1)}c.track=a;b.dispatchEvent(c)}function qa(a){if(null===a||void 0===a?0:a.cues)for(;0<a.cues.length;)a.removeCue(a.cues[0])}function xa(a,b){if(b<a[0].endTime)return a[0];if(b>a[a.length-1].endTime)return a[a.length-1];for(var c=0,g=a.length-1;c<=g;){var u=Math.floor((g+c)/2);if(b<a[u].endTime)g=u-1;else if(b>a[u].endTime)c=u+1;else return a[u]}return a[c].endTime-b<b-a[g].endTime?a[c]:a[g]}function ya(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=
a;a.__proto__=b}function wa(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}function Ca(a,b,c){b&&wa(a.prototype,b);c&&wa(a,c);return a}function Da(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Fa(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function Ha(a,b){a.prototype=Object.create(b.prototype);
a.prototype.constructor=a;a.__proto__=b}function Aa(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}function Pa(a,b,c){b&&Aa(a.prototype,b);c&&Aa(a,c);return a}function Qa(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function Ra(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function Ea(a,b){for(var c=0;c<b.length;c++){var g=
b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}function Sa(a,b,c){b&&Ea(a.prototype,b);c&&Ea(a,c);return a}function Ta(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function Ga(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}function Ua(a,b,c){b&&Ga(a.prototype,b);c&&Ga(a,c);return a}function Va(a,
b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function Ia(){this.window=window;this.state="INITIAL";this.buffer="";this.decoder=new ic;this.regionList=[]}function Ja(){this.values=Object.create(null)}function Ka(a,b,c,g){a=g?a.split(g):[a];for(var u in a)"string"===typeof a[u]&&(g=a[u].split(c),2===g.length&&b(g[0],g[1]))}function Xa(a,b,c){function g(){var b;if(b=a.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/))if(b[3]){var g=b[3].replace(":","");b=3600*(b[1]|0)+60*
(b[2]|0)+(g|0)+(b[4]|0)/1E3}else b=59<b[1]?3600*(b[1]|0)+60*(b[2]|0)+(b[4]|0)/1E3:60*(b[1]|0)+(b[2]|0)+(b[4]|0)/1E3;else b=null;if(null===b)throw Error("Malformed timestamp: "+d);a=a.replace(/^[^\sa-zA-Z-]+/,"");return b}function u(){a=a.replace(/^\s+/,"")}var d=a;u();b.startTime=g();u();if("--\x3e"!==a.substr(0,3))throw Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+d);a=a.substr(3);u();b.endTime=g();u();(function(a,b){var g=new Ja;Ka(a,function(a,b){switch(a){case "region":for(var u=
c.length-1;0<=u;u--)if(c[u].id===b){g.set(a,c[u].region);break}break;case "vertical":g.alt(a,b,["rl","lr"]);break;case "line":b=b.split(",");u=b[0];g.integer(a,u);g.percent(a,u)&&g.set("snapToLines",!1);g.alt(a,u,["auto"]);2===b.length&&g.alt("lineAlign",b[1],["start",gb,"end"]);break;case "position":b=b.split(",");g.percent(a,b[0]);2===b.length&&g.alt("positionAlign",b[1],["start",gb,"end","line-left","line-right","auto"]);break;case "size":g.percent(a,b);break;case "align":g.alt(a,b,["start",gb,
"end","left","right"])}},/:/,/\s/);b.region=g.get("region",null);b.vertical=g.get("vertical","");a=g.get("line","auto");"auto"===a&&-1===rb.line&&(a=-1);b.line=a;b.lineAlign=g.get("lineAlign","start");b.snapToLines=g.get("snapToLines",!0);b.size=g.get("size",100);b.align=g.get("align",gb);a=g.get("position","auto");"auto"===a&&50===rb.position&&(a="start"===b.align||"left"===b.align?0:"end"===b.align||"right"===b.align?100:50);b.position=a})(a,b)}function Za(a,b,c,g){for(var u=[],d,v,e,f,h=window.VTTCue||
TextTrackCue,C=0;C<g.rows.length;C++)if(d=g.rows[C],v=!0,e=0,f="",!d.isEmpty()){for(var La=0;La<d.chars.length;La++)d.chars[La].uchar.match(/\s/)&&v?e++:(f+=d.chars[La].uchar,v=!1);d.cueStartTime=b;b===c&&(c+=1E-4);d=new h(b,c,f.trim().replace(/<br(?: \/)?>/gi,"\n"));16<=e?e--:e++;navigator.userAgent.match(/Firefox\//)?d.line=C+1:d.line=7<C?C-2:C+1;d.align="left";d.position=Math.max(0,Math.min(100,e/32*100));u.push(d);a&&a.addCue(d)}return u}function db(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return a}function bb(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function Wa(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}function Ya(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}function cb(a,b,c){b&&Ya(a.prototype,b);c&&Ya(a,c);return a}function lb(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=
b}function sb(a){for(var b=[],c=0;c<a.length;c++){var g=a[c];"subtitles"===g.kind&&g.label&&b.push(a[c])}return b}function mb(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function nb(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function Gb(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}
function ob(a,b,c){b&&Gb(a.prototype,b);c&&Gb(a,c);return a}function pb(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}function Hb(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(a);b&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable}));c.push.apply(c,g)}return c}function Ib(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?Hb(Object(c),!0).forEach(function(b){var g=
c[b];b in a?Object.defineProperty(a,b,{value:g,enumerable:!0,configurable:!0,writable:!0}):a[b]=g}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):Hb(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function Jb(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(a);b&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable}));c.push.apply(c,
g)}return c}function Kb(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?Jb(Object(c),!0).forEach(function(b){var g=c[b];b in a?Object.defineProperty(a,b,{value:g,enumerable:!0,configurable:!0,writable:!0}):a[b]=g}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):Jb(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function ea(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return a}function Lb(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}function Mb(a,b,c){b&&Lb(a.prototype,b);c&&Lb(a,c);return a}function qb(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.__proto__=b}e.r(b);e.d(b,"default",function(){return Nb});var tb={};e.r(tb);e.d(tb,"newCue",function(){return Za});var hb=e("./node_modules/url-toolkit/src/url-toolkit.js"),B=e("./src/errors.ts"),
Q=e("./src/polyfills/number.js"),q=e("./src/events.js"),p=e("./src/utils/logger.js"),Bb={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},ca=function(){function a(a){this.useGenericHandler=this.handledEvents=this.hls=void 0;this.hls=a;this.onEvent=this.onEvent.bind(this);for(var b=arguments.length,u=Array(1<b?b-1:0),c=1;c<b;c++)u[c-1]=arguments[c];this.handledEvents=u;this.useGenericHandler=!0;this.registerListeners()}var b=a.prototype;b.destroy=function(){this.onHandlerDestroying();
this.unregisterListeners();this.onHandlerDestroyed()};b.onHandlerDestroying=function(){};b.onHandlerDestroyed=function(){};b.isEventHandler=function(){return"object"===typeof this.handledEvents&&this.handledEvents.length&&"function"===typeof this.onEvent};b.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if(Bb[a])throw Error("Forbidden event-name: "+a);this.hls.on(a,this.onEvent)},this)};b.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,
this.onEvent)},this)};b.onEvent=function(a,b){this.onEventGeneric(a,b)};b.onEventGeneric=function(a,b){try{var g="on"+a.replace("hls","");if("function"!==typeof this[g])throw Error("Event "+a+" has no generic handler in this "+this.constructor.name+" class (tried "+g+")");this[g].bind(this,b).call()}catch(H){p.logger.error("An internal error happened while handling event "+a+'. Error message: "'+H.message+'". Here is a stacktrace:',H),this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.OTHER_ERROR,
details:B.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,err:H})}};return a}(),fa;(function(a){a.MANIFEST="manifest";a.LEVEL="level";a.AUDIO_TRACK="audioTrack";a.SUBTITLE_TRACK="subtitleTrack"})(fa||(fa={}));var Ma;(function(a){a.MAIN="main";a.AUDIO="audio";a.SUBTITLE="subtitle"})(Ma||(Ma={}));var Cb=e("./src/demux/mp4demuxer.js"),Ob=function(){function a(a,b){this._uri=null;this.reluri=this.baseuri=void 0;this.iv=this.key=this.method=null;this.baseuri=a;this.reluri=b}d(a,[{key:"uri",get:function(){!this._uri&&
this.reluri&&(this._uri=Object(hb.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0}));return this._uri}}]);return a}(),ua;(function(a){a.AUDIO="audio";a.VIDEO="video"})(ua||(ua={}));var ib=function(){function a(){var a;this._decryptdata=this._byteRange=this._url=null;this._elementaryStreams=(a={},a[ua.AUDIO]=!1,a[ua.VIDEO]=!1,a);this.deltaPTS=0;this.title=this.programDateTime=this.rawProgramDateTime=null;this.tagList=[];this.start=this.duration=this.baseurl=this.relurl=this.type=this.cc=
void 0;this.level=this.urlId=this.sn=0;this.loader=this.levelkey=void 0}var b=a.prototype;b.setByteRange=function(a,b){a=a.split("@",2);var g=[];g[0]=1===a.length?b?b.byteRangeEndOffset:0:parseInt(a[1]);g[1]=parseInt(a[0])+g[0];this._byteRange=g};b.addElementaryStream=function(a){this._elementaryStreams[a]=!0};b.hasElementaryStream=function(a){return!0===this._elementaryStreams[a]};b.createInitializationVector=function(a){for(var b=new Uint8Array(16),u=12;16>u;u++)b[u]=a>>8*(15-u)&255;return b};b.setDecryptDataFromLevelKey=
function(a,b){var g=a;(null===a||void 0===a?0:a.method)&&a.uri&&!a.iv&&(g=new Ob(a.baseuri,a.reluri),g.method=a.method,g.iv=this.createInitializationVector(b));return g};k(a,[{key:"url",get:function(){!this._url&&this.relurl&&(this._url=Object(hb.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0}));return this._url},set:function(a){this._url=a}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},
{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var a=this.sn;"number"!==typeof a&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&p.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),a=0);this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,a)}return this._decryptdata}},
{key:"endProgramDateTime",get:function(){if(null===this.programDateTime||!Object(Q.isFiniteNumber)(this.programDateTime))return null;var a=Object(Q.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1E3*a}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}]);return a}(),kc=function(){function a(a){this.endSN=this.endCC=0;this.fragments=[];this.initSegment=null;this.live=!0;this.needSidxRanges=!1;this.startSN=
this.startCC=0;this.startTimeOffset=null;this.totalduration=this.targetduration=0;this.type=null;this.url=a;this.version=null}n(a,[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(Q.isFiniteNumber)(this.fragments[0].programDateTime))}}]);return a}(),lc=/^(\d+)x(\d+)$/,Pb=/\s*(.+?)\s*=((?:".*?")|.*?)(?:,|$)/g,Na=function(){function a(b){"string"===typeof b&&(b=a.parseAttrList(b));for(var g in b)b.hasOwnProperty(g)&&(this[g]=b[g])}var b=a.prototype;b.decimalInteger=function(a){a=
parseInt(this[a],10);return a>Number.MAX_SAFE_INTEGER?Infinity:a};b.hexadecimalInteger=function(a){if(this[a]){a=(this[a]||"0x").slice(2);a=(a.length&1?"0":"")+a;for(var b=new Uint8Array(a.length/2),u=0;u<a.length/2;u++)b[u]=parseInt(a.slice(2*u,2*u+2),16);return b}return null};b.hexadecimalIntegerAsNumber=function(a){a=parseInt(this[a],16);return a>Number.MAX_SAFE_INTEGER?Infinity:a};b.decimalFloatingPoint=function(a){return parseFloat(this[a])};b.enumeratedString=function(a){return this[a]};b.decimalResolution=
function(a){a=lc.exec(this[a]);if(null!==a)return{width:parseInt(a[1],10),height:parseInt(a[2],10)}};a.parseAttrList=function(a){var b,u={};for(Pb.lastIndex=0;null!==(b=Pb.exec(a));){var c=b[2];0===c.indexOf('"')&&c.lastIndexOf('"')===c.length-1&&(c=c.slice(1,-1));u[b[1]]=c}return u};return a}(),mc={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,
Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},Qb=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,Rb=/#EXT-X-MEDIA:(.*)/g,Sb=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,
/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),nc=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,oc=/\.(mp4|m4s|m4v|m4a)$/i,$a=function(){function a(){}a.findGroup=function(a,
b){for(var g=0;g<a.length;g++){var u=a[g];if(u.id===b)return u}};a.convertAVC1ToAVCOTI=function(a){var b=a.split(".");2<b.length&&(a=b.shift()+".",a+=parseInt(b.shift()).toString(16),a+=("000"+parseInt(b.shift()).toString(16)).substr(-4));return a};a.resolve=function(a,b){return hb.buildAbsoluteURL(b,a,{alwaysNormalize:!0})};a.parseMasterPlaylist=function(b,c){function g(a,b){["video","audio"].forEach(function(g){var u=a.filter(function(a){var b=mc[g];return!!b&&!0===b[a.slice(0,4)]});if(u.length){var c=
u.filter(function(a){return 0===a.lastIndexOf("avc1",0)||0===a.lastIndexOf("mp4a",0)});b[g+"Codec"]=0<c.length?c[0]:u[0];a=a.filter(function(a){return-1===u.indexOf(a)})}});b.unknownCodecs=a}var u=[],d={},e=!1;Qb.lastIndex=0;for(var v;null!=(v=Qb.exec(b));)if(v[1]){var f={},h=f.attrs=new Na(v[1]);f.url=a.resolve(v[2],c);if(v=h.decimalResolution("RESOLUTION"))f.width=v.width,f.height=v.height;f.bitrate=h.decimalInteger("AVERAGE-BANDWIDTH")||h.decimalInteger("BANDWIDTH");f.name=h.NAME;g([].concat((h.CODECS||
"").split(/[ ,]+/)),f);f.videoCodec&&-1!==f.videoCodec.indexOf("avc1")&&(f.videoCodec=a.convertAVC1ToAVCOTI(f.videoCodec));u.push(f)}else v[3]&&(f=new Na(v[3]),f["DATA-ID"]&&(e=!0,d[f["DATA-ID"]]=f));return{levels:u,sessionData:e?d:null}};a.parseMasterPlaylistMedia=function(b,c,g,u){void 0===u&&(u=[]);var d,e=[],v=0;for(Rb.lastIndex=0;null!==(d=Rb.exec(b));){var f=new Na(d[1]);f.TYPE===g&&(d={attrs:f,id:v++,groupId:f["GROUP-ID"],instreamId:f["INSTREAM-ID"],name:f.NAME||f.LANGUAGE,type:g,default:"YES"===
f.DEFAULT,autoselect:"YES"===f.AUTOSELECT,forced:"YES"===f.FORCED,lang:f.LANGUAGE},f.URI&&(d.url=a.resolve(f.URI,c)),u.length&&(f=a.findGroup(u,d.groupId),d.audioCodec=f?f.codec:u[0].codec),e.push(d))}return e};a.parseLevelPlaylist=function(a,b,g,u,c){var d=0,H=0,e=new kc(b),v=0,f=null,C=new ib,k,l,t=null;for(Sb.lastIndex=0;null!==(k=Sb.exec(a));)if(l=k[1])C.duration=parseFloat(l),k=(" "+k[2]).slice(1),C.title=k||null,C.tagList.push(k?["INF",l,k]:["INF",l]);else if(k[3])Object(Q.isFiniteNumber)(C.duration)&&
(l=d++,C.type=u,C.start=H,m&&(C.levelkey=m),C.sn=l,C.level=g,C.cc=v,C.urlId=c,C.baseurl=b,C.relurl=(" "+k[3]).slice(1),z(C,f),e.fragments.push(C),f=C,H+=C.duration,C=new ib);else if(k[4])k=(" "+k[4]).slice(1),f?C.setByteRange(k,f):C.setByteRange(k);else if(k[5])C.rawProgramDateTime=(" "+k[5]).slice(1),C.tagList.push(["PROGRAM-DATE-TIME",C.rawProgramDateTime]),null===t&&(t=e.fragments.length);else if(k=k[0].match(nc)){for(l=1;l<k.length&&"undefined"===typeof k[l];l++);var n=(" "+k[l+1]).slice(1),q=
(" "+k[l+2]).slice(1);switch(k[l]){case "#":C.tagList.push(q?[n,q]:[n]);break;case "PLAYLIST-TYPE":e.type=n.toUpperCase();break;case "MEDIA-SEQUENCE":d=e.startSN=parseInt(n);break;case "TARGETDURATION":e.targetduration=parseFloat(n);break;case "VERSION":e.version=parseInt(n);break;case "EXTM3U":break;case "ENDLIST":e.live=!1;break;case "DIS":v++;C.tagList.push(["DIS"]);break;case "DISCONTINUITY-SEQ":v=parseInt(n);break;case "KEY":k=new Na(n);l=k.enumeratedString("METHOD");n=k.URI;q=k.hexadecimalInteger("IV");
if("com.apple.streamingkeydelivery"===(k.KEYFORMAT||"identity")){p.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}if(l){var m=new Ob(b,n);n&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(l)&&(m.method=l,m.key=null,m.iv=q)}break;case "START":k=(new Na(n)).decimalFloatingPoint("TIME-OFFSET");Object(Q.isFiniteNumber)(k)&&(e.startTimeOffset=k);break;case "MAP":k=new Na(n);C.relurl=k.URI;k.BYTERANGE&&C.setByteRange(k.BYTERANGE);C.baseurl=b;C.level=g;C.type=u;
C.sn="initSegment";e.initSegment=C;C=new ib;C.rawProgramDateTime=e.initSegment.rawProgramDateTime;break;default:p.logger.warn("line parsed but not handled: "+k)}}else p.logger.warn("No matches on slow regex match for level playlist!");(C=f)&&!C.relurl&&(e.fragments.pop(),H-=C.duration);e.totalduration=H;e.averagetargetduration=H/e.fragments.length;e.endSN=d-1;e.startCC=e.fragments[0]?e.fragments[0].cc:0;e.endCC=v;!e.initSegment&&e.fragments.length&&e.fragments.every(function(a){return oc.test(a.relurl)})&&
(p.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),C=new ib,C.relurl=e.fragments[0].relurl,C.baseurl=b,C.level=g,C.type=u,C.sn="initSegment",e.initSegment=C,e.needSidxRanges=!0);t&&h(e.fragments,t);return e};return a}(),Tb=window.performance,sc=function(a){function b(b){b=a.call(this,b,q["default"].MANIFEST_LOADING,q["default"].LEVEL_LOADING,q["default"].AUDIO_TRACK_LOADING,q["default"].SUBTITLE_TRACK_LOADING)||this;b.loaders={};return b}
A(b,a);b.canHaveQualityLevels=function(a){return a!==fa.AUDIO_TRACK&&a!==fa.SUBTITLE_TRACK};b.mapContextToLevelType=function(a){switch(a.type){case fa.AUDIO_TRACK:return Ma.AUDIO;case fa.SUBTITLE_TRACK:return Ma.SUBTITLE;default:return Ma.MAIN}};b.getResponseUrl=function(a,b){a=a.url;if(void 0===a||0===a.indexOf("data:"))a=b.url;return a};var c=b.prototype;c.createInternalLoader=function(a){var b=this.hls.config,g=b.loader;b=new (b.pLoader||g)(b);a.loader=b;return this.loaders[a.type]=b};c.getInternalLoader=
function(a){return this.loaders[a.type]};c.resetInternalLoader=function(a){this.loaders[a]&&delete this.loaders[a]};c.destroyInternalLoaders=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy();this.resetInternalLoader(a)}};c.destroy=function(){this.destroyInternalLoaders();a.prototype.destroy.call(this)};c.onManifestLoading=function(a){this.load({url:a.url,type:fa.MANIFEST,level:0,id:null,responseType:"text"})};c.onLevelLoading=function(a){this.load({url:a.url,type:fa.LEVEL,
level:a.level,id:a.id,responseType:"text"})};c.onAudioTrackLoading=function(a){this.load({url:a.url,type:fa.AUDIO_TRACK,level:null,id:a.id,responseType:"text"})};c.onSubtitleTrackLoading=function(a){this.load({url:a.url,type:fa.SUBTITLE_TRACK,level:null,id:a.id,responseType:"text"})};c.load=function(a){var b=this.hls.config;p.logger.debug("Loading playlist of type "+a.type+", level: "+a.level+", id: "+a.id);var g=this.getInternalLoader(a);if(g){var c=g.context;if(c&&c.url===a.url)return p.logger.trace("playlist request ongoing"),
!1;p.logger.warn("aborting previous loader for type: "+a.type);g.abort()}switch(a.type){case fa.MANIFEST:c=b.manifestLoadingMaxRetry;var d=b.manifestLoadingTimeOut;var e=b.manifestLoadingRetryDelay;var v=b.manifestLoadingMaxRetryTimeout;break;case fa.LEVEL:e=v=c=0;d=b.levelLoadingTimeOut;break;default:c=b.levelLoadingMaxRetry,d=b.levelLoadingTimeOut,e=b.levelLoadingRetryDelay,v=b.levelLoadingMaxRetryTimeout}g=this.createInternalLoader(a);b={timeout:d,maxRetry:c,retryDelay:e,maxRetryDelay:v};c={onSuccess:this.loadsuccess.bind(this),
onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};p.logger.debug("Calling internal loader delegate for URL: "+a.url);g.load(a,b,c);return!0};c.loadsuccess=function(a,b,c,d){void 0===d&&(d=null);if(c.isSidxRequest)this._handleSidxRequest(a,c),this._handlePlaylistLoaded(a,b,c,d);else{this.resetInternalLoader(c.type);if("string"!==typeof a.data)throw Error('expected responseType of "text" for PlaylistLoader');var g=a.data;b.tload=Tb.now();0!==g.indexOf("#EXTM3U")?this._handleManifestParsingError(a,
c,"no EXTM3U delimiter",d):0<g.indexOf("#EXTINF:")||0<g.indexOf("#EXT-X-TARGETDURATION:")?this._handleTrackOrLevelPlaylist(a,b,c,d):this._handleMasterPlaylist(a,b,c,d)}};c.loaderror=function(a,b,c){void 0===c&&(c=null);this._handleNetworkError(b,c,!1,a)};c.loadtimeout=function(a,b,c){void 0===c&&(c=null);this._handleNetworkError(b,c,!0)};c._handleMasterPlaylist=function(a,c,d,e){var g=this.hls,u=a.data,H=b.getResponseUrl(a,d),v=$a.parseMasterPlaylist(u,H),f=v.levels;v=v.sessionData;if(f.length){a=
f.map(function(a){return{id:a.attrs.AUDIO,codec:a.audioCodec}});a=$a.parseMasterPlaylistMedia(u,H,"AUDIO",a);d=$a.parseMasterPlaylistMedia(u,H,"SUBTITLES");u=$a.parseMasterPlaylistMedia(u,H,"CLOSED-CAPTIONS");if(a.length){var V=!1;a.forEach(function(a){a.url||(V=!0)});!1===V&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(p.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),a.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},
url:""}))}g.trigger(q["default"].MANIFEST_LOADED,{levels:f,audioTracks:a,subtitles:d,captions:u,url:H,stats:c,networkDetails:e,sessionData:v})}else this._handleManifestParsingError(a,d,"no level found in manifest",e)};c._handleTrackOrLevelPlaylist=function(a,c,d,e){var g=this.hls,u=d.id,H=d.level,v=d.type,f=b.getResponseUrl(a,d),V=Object(Q.isFiniteNumber)(u)?u:0,h=Object(Q.isFiniteNumber)(H)?H:V,C=b.mapContextToLevelType(d);V=$a.parseLevelPlaylist(a.data,f,h,C,V);V.tload=c.tload;V.fragments.length?
(v===fa.MANIFEST&&g.trigger(q["default"].MANIFEST_LOADED,{levels:[{url:f,details:V}],audioTracks:[],url:f,stats:c,networkDetails:e,sessionData:null}),c.tparsed=Tb.now(),V.needSidxRanges?this.load({url:V.initSegment.url,isSidxRequest:!0,type:v,level:H,levelDetails:V,id:u,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"}):(d.levelDetails=V,this._handlePlaylistLoaded(a,c,d,e))):g.trigger(q["default"].ERROR,{type:B.ErrorTypes.NETWORK_ERROR,details:B.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:f,
reason:"no fragments found in level",level:"number"===typeof d.level?d.level:void 0})};c._handleSidxRequest=function(a,b){if("string"===typeof a.data)throw Error("sidx request must be made with responseType of array buffer");if(a=Cb["default"].parseSegmentIndex(new Uint8Array(a.data))){var g=b.levelDetails;a.references.forEach(function(a,b){a=a.info;g&&(b=g.fragments[b],0===b.byteRange.length&&b.setByteRange(String(1+a.end-a.start)+"@"+String(a.start)))});g&&g.initSegment.setByteRange(String(a.moovEndOffset)+
"@0")}};c._handleManifestParsingError=function(a,b,c,d){this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.NETWORK_ERROR,details:B.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a.url,reason:c,networkDetails:d})};c._handleNetworkError=function(a,b,c,d){void 0===c&&(c=!1);void 0===d&&(d=null);p.logger.info("A network error occured while loading a "+a.type+"-type playlist");var g=this.getInternalLoader(a);switch(a.type){case fa.MANIFEST:var u=c?B.ErrorDetails.MANIFEST_LOAD_TIMEOUT:B.ErrorDetails.MANIFEST_LOAD_ERROR;
c=!0;break;case fa.LEVEL:u=c?B.ErrorDetails.LEVEL_LOAD_TIMEOUT:B.ErrorDetails.LEVEL_LOAD_ERROR;c=!1;break;case fa.AUDIO_TRACK:u=c?B.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:B.ErrorDetails.AUDIO_TRACK_LOAD_ERROR;c=!1;break;default:c=!1}g&&(g.abort(),this.resetInternalLoader(a.type));a={type:B.ErrorTypes.NETWORK_ERROR,details:u,fatal:c,url:a.url,loader:g,context:a,networkDetails:b};d&&(a.response=d);this.hls.trigger(q["default"].ERROR,a)};c._handlePlaylistLoaded=function(a,c,d,e){var g=d.type,u=d.level,
H=d.id,v=d.levelDetails;if(v&&v.targetduration)if(b.canHaveQualityLevels(d.type))this.hls.trigger(q["default"].LEVEL_LOADED,{details:v,level:u||0,id:H||0,stats:c,networkDetails:e});else switch(g){case fa.AUDIO_TRACK:this.hls.trigger(q["default"].AUDIO_TRACK_LOADED,{details:v,id:H,stats:c,networkDetails:e});break;case fa.SUBTITLE_TRACK:this.hls.trigger(q["default"].SUBTITLE_TRACK_LOADED,{details:v,id:H,stats:c,networkDetails:e})}else this._handleManifestParsingError(a,d,"invalid target duration",e)};
return b}(ca),tc=function(a){function b(b){b=a.call(this,b,q["default"].FRAG_LOADING)||this;b.loaders={};return b}F(b,a);var c=b.prototype;c.destroy=function(){var b=this.loaders,c;for(c in b){var d=b[c];d&&d.destroy()}this.loaders={};a.prototype.destroy.call(this)};c.onFragLoading=function(a){var b=a.frag,g=b.type,c=this.loaders,d=this.hls.config,e=d.fLoader,v=d.loader;b.loaded=0;if(a=c[g])p.logger.warn("abort previous fragment loader for type: "+g),a.abort();a=c[g]=b.loader=d.fLoader?new e(d):new v(d);
g={url:b.url,frag:b,responseType:"arraybuffer",progressData:!1};c=b.byteRangeStartOffset;b=b.byteRangeEndOffset;Object(Q.isFiniteNumber)(c)&&Object(Q.isFiniteNumber)(b)&&(g.rangeStart=c,g.rangeEnd=b);d={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:d.fragLoadingMaxRetryTimeout};b={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)};a.load(g,d,b)};c.loadsuccess=function(a,b,c,d){void 0===
d&&(d=null);a=a.data;c=c.frag;c.loader=void 0;this.loaders[c.type]=void 0;this.hls.trigger(q["default"].FRAG_LOADED,{payload:a,frag:c,stats:b,networkDetails:d})};c.loaderror=function(a,b,c){void 0===c&&(c=null);var g=b.frag,u=g.loader;u&&u.abort();this.loaders[g.type]=void 0;this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.NETWORK_ERROR,details:B.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b.frag,response:a,networkDetails:c})};c.loadtimeout=function(a,b,c){void 0===c&&(c=null);a=b.frag;var g=
a.loader;g&&g.abort();this.loaders[a.type]=void 0;this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.NETWORK_ERROR,details:B.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b.frag,networkDetails:c})};c.loadprogress=function(a,b,c,d){void 0===d&&(d=null);b=b.frag;b.loaded=a.loaded;this.hls.trigger(q["default"].FRAG_LOAD_PROGRESS,{frag:b,stats:a,networkDetails:d})};return b}(ca),uc=function(a){function b(b){b=a.call(this,b,q["default"].KEY_LOADING)||this;b.loaders={};b.decryptkey=null;b.decrypturl=
null;return b}G(b,a);var c=b.prototype;c.destroy=function(){for(var b in this.loaders){var c=this.loaders[b];c&&c.destroy()}this.loaders={};a.prototype.destroy.call(this)};c.onKeyLoading=function(a){a=a.frag;var b=a.type,g=this.loaders[b];if(a.decryptdata){var c=a.decryptdata.uri;if(c!==this.decrypturl||null===this.decryptkey){var d=this.hls.config;g&&(p.logger.warn("abort previous key loader for type:"+b),g.abort());c?(a.loader=this.loaders[b]=new d.loader(d),this.decrypturl=c,this.decryptkey=null,
b={url:c,frag:a,responseType:"arraybuffer"},d={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:d.fragLoadingRetryDelay,maxRetryDelay:d.fragLoadingMaxRetryTimeout},g={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},a.loader.load(b,d,g)):p.logger.warn("key uri is falsy")}else this.decryptkey&&(a.decryptdata.key=this.decryptkey,this.hls.trigger(q["default"].KEY_LOADED,{frag:a}))}else p.logger.warn("Missing decryption data on fragment in onKeyLoading")};
c.loadsuccess=function(a,b,c){b=c.frag;b.decryptdata?(this.decryptkey=b.decryptdata.key=new Uint8Array(a.data),b.loader=void 0,delete this.loaders[b.type],this.hls.trigger(q["default"].KEY_LOADED,{frag:b})):p.logger.error("after key load, decryptdata unset")};c.loaderror=function(a,b){b=b.frag;var g=b.loader;g&&g.abort();delete this.loaders[b.type];this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.NETWORK_ERROR,details:B.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:b,response:a})};c.loadtimeout=
function(a,b){a=b.frag;(b=a.loader)&&b.abort();delete this.loaders[a.type];this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.NETWORK_ERROR,details:B.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:a})};return b}(ca),vc=function(a){function b(b){var g=a.call(this,b,q["default"].BUFFER_APPENDED,q["default"].FRAG_BUFFERED,q["default"].FRAG_LOADED)||this;g.bufferPadding=.2;g.fragments=Object.create(null);g.timeRanges=Object.create(null);g.config=b.config;return g}E(b,a);var c=b.prototype;c.destroy=function(){this.fragments=
Object.create(null);this.timeRanges=Object.create(null);this.config=null;ca.prototype.destroy.call(this);a.prototype.destroy.call(this)};c.getBufferedFrag=function(a,b){var g=this.fragments,c=Object.keys(g).filter(function(c){c=g[c];if(c.body.type!==b||!c.buffered)return!1;c=c.body;return c.startPTS<=a&&a<=c.endPTS});if(0===c.length)return null;c=c.pop();return g[c].body};c.detectEvictedFragments=function(a,b){var g=this;Object.keys(this.fragments).forEach(function(c){if((c=g.fragments[c])&&c.buffered){var u=
c.range[a];if(u){u=u.time;for(var d=0;d<u.length;d++){var e=u[d];if(!g.isTimeBuffered(e.startPTS,e.endPTS,b)){g.removeFragment(c.body);break}}}}})};c.detectPartialFragments=function(a){var b=this,g=this.getFragmentKey(a),c=this.fragments[g];c&&(c.buffered=!0,Object.keys(this.timeRanges).forEach(function(g){a.hasElementaryStream(g)&&(c.range[g]=b.getBufferedTimes(a.startPTS,a.endPTS,b.timeRanges[g]))}))};c.getBufferedTimes=function(a,b,c){for(var g=[],u,d,e=!1,H=0;H<c.length;H++)if(u=c.start(H)-this.bufferPadding,
d=c.end(H)+this.bufferPadding,a>=u&&b<=d){g.push({startPTS:Math.max(a,c.start(H)),endPTS:Math.min(b,c.end(H))});break}else if(a<d&&b>u)g.push({startPTS:Math.max(a,c.start(H)),endPTS:Math.min(b,c.end(H))}),e=!0;else if(b<=u)break;return{time:g,partial:e}};c.getFragmentKey=function(a){return a.type+"_"+a.level+"_"+a.urlId+"_"+a.sn};c.getPartialFragment=function(a){var b=this,g,c,d,e=null,v=0;Object.keys(this.fragments).forEach(function(u){u=b.fragments[u];b.isPartial(u)&&(c=u.body.startPTS-b.bufferPadding,
d=u.body.endPTS+b.bufferPadding,a>=c&&a<=d&&(g=Math.min(a-c,d-a),v<=g&&(e=u.body,v=g)))});return e};c.getState=function(a){a=this.getFragmentKey(a);a=this.fragments[a];var b="NOT_LOADED";void 0!==a&&(b=a.buffered?!0===this.isPartial(a)?"PARTIAL":"OK":"APPENDING");return b};c.isPartial=function(a){return!0===a.buffered&&(void 0!==a.range.video&&!0===a.range.video.partial||void 0!==a.range.audio&&!0===a.range.audio.partial)};c.isTimeBuffered=function(a,b,c){for(var g,u,d=0;d<c.length;d++){g=c.start(d)-
this.bufferPadding;u=c.end(d)+this.bufferPadding;if(a>=g&&b<=u)return!0;if(b<=g)break}return!1};c.onFragLoaded=function(a){a=a.frag;Object(Q.isFiniteNumber)(a.sn)&&!a.bitrateTest&&(this.fragments[this.getFragmentKey(a)]={body:a,range:Object.create(null),buffered:!1})};c.onBufferAppended=function(a){var b=this;this.timeRanges=a.timeRanges;Object.keys(this.timeRanges).forEach(function(a){b.detectEvictedFragments(a,b.timeRanges[a])})};c.onFragBuffered=function(a){this.detectPartialFragments(a.frag)};
c.hasFragment=function(a){a=this.getFragmentKey(a);return void 0!==this.fragments[a]};c.removeFragment=function(a){a=this.getFragmentKey(a);delete this.fragments[a]};c.removeAllFragments=function(){this.fragments=Object.create(null)};return b}(ca),eb={search:function(a,b){for(var c=0,g=a.length-1,u,d;c<=g;){u=(c+g)/2|0;d=a[u];var e=b(d);if(0<e)c=u+1;else if(0>e)g=u-1;else return d}return null}},ja=function(){function a(){}a.isBuffered=function(a,b){try{if(a){var g=a.buffered;for(a=0;a<g.length;a++)if(b>=
g.start(a)&&b<=g.end(a))return!0}}catch(u){}return!1};a.bufferInfo=function(a,b,g){try{if(a){var c=a.buffered;a=[];var d;for(d=0;d<c.length;d++)a.push({start:c.start(d),end:c.end(d)});return this.bufferedInfo(a,b,g)}}catch(V){}return{len:0,start:b,end:b,nextStart:void 0}};a.bufferedInfo=function(a,b,g){a.sort(function(a,b){var g=a.start-b.start;return g?g:b.end-a.end});var c=[];if(g)for(var d=0;d<a.length;d++){var e=c.length;if(e){var v=c[e-1].end;a[d].start-v<g?a[d].end>v&&(c[e-1].end=a[d].end):
c.push(a[d])}else c.push(a[d])}else c=a;a=0;e=d=b;for(v=0;v<c.length;v++){var f=c[v].start,h=c[v].end;if(b+g>=f&&b<h)d=f,e=h,a=e-b;else if(b+g<f){var C=f;break}}return{len:a,start:d,end:e,nextStart:C}};return a}(),wc=e("./node_modules/eventemitter3/index.js"),xc=e("./node_modules/webworkify-webpack/index.js"),Ub=e("./src/demux/demuxer-inline.js"),yc=e("./src/utils/get-self-scope.js"),Vb=function(a){function b(){return a.apply(this,arguments)||this}K(b,a);b.prototype.trigger=function(a){for(var b=
arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];this.emit.apply(this,[a,a].concat(c))};return b}(wc.EventEmitter),Wb=Object(yc.getSelfScope)(),ub=window.MediaSource||window.WebKitMediaSource||{isTypeSupported:function(){return!1}},vb=function(){function a(a,b){var g=this;this.hls=a;this.id=b;var c=this.observer=new Vb,d=a.config,e=function(b,c){c=c||{};c.frag=g.frag;c.id=g.id;a.trigger(b,c)};c.on(q["default"].FRAG_DECRYPTED,e);c.on(q["default"].FRAG_PARSING_INIT_SEGMENT,e);c.on(q["default"].FRAG_PARSING_DATA,
e);c.on(q["default"].FRAG_PARSED,e);c.on(q["default"].ERROR,e);c.on(q["default"].FRAG_PARSING_METADATA,e);c.on(q["default"].FRAG_PARSING_USERDATA,e);c.on(q["default"].INIT_PTS_FOUND,e);e={mp4:ub.isTypeSupported("video/mp4"),mpeg:ub.isTypeSupported("audio/mpeg"),mp3:ub.isTypeSupported('audio/mp4; codecs="mp3"')};var v=navigator.vendor;if(d.enableWorker&&"undefined"!==typeof Worker){p.logger.log("demuxing in webworker");try{var f=this.w=xc("./src/demux/demuxer-worker.js");this.onwmsg=this.onWorkerMessage.bind(this);
f.addEventListener("message",this.onwmsg);f.onerror=function(b){a.trigger(q["default"].ERROR,{type:B.ErrorTypes.OTHER_ERROR,details:B.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:b.message+" ("+b.filename+":"+b.lineno+")"}})};f.postMessage({cmd:"init",typeSupported:e,vendor:v,id:b,config:JSON.stringify(d)})}catch(jc){p.logger.warn("Error in worker:",jc),p.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),f&&Wb.URL.revokeObjectURL(f.objectURL),
this.demuxer=new Ub["default"](c,e,d,v),this.w=void 0}}else this.demuxer=new Ub["default"](c,e,d,v)}var b=a.prototype;b.destroy=function(){var a=this.w;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null;else if(a=this.demuxer)a.destroy(),this.demuxer=null;if(a=this.observer)a.removeAllListeners(),this.observer=null};b.push=function(a,b,c,d,e,f,h,k){var g=this.w,u=Object(Q.isFiniteNumber)(e.startPTS)?e.startPTS:e.start,H=e.decryptdata,v=this.frag,V=!(v&&e.cc===v.cc),va=!(v&&
e.level===v.level);v=v&&e.sn===v.sn+1;v=!va&&v;V&&p.logger.log(this.id+":discontinuity detected");va&&p.logger.log(this.id+":switch detected");this.frag=e;g?g.postMessage({cmd:"demux",data:a,decryptdata:H,initSegment:b,audioCodec:c,videoCodec:d,timeOffset:u,discontinuity:V,trackSwitch:va,contiguous:v,duration:f,accurateTimeOffset:h,defaultInitPTS:k},a instanceof ArrayBuffer?[a]:[]):(e=this.demuxer)&&e.push(a,H,b,c,d,u,V,va,v,f,h,k)};b.onWorkerMessage=function(a){a=a.data;var b=this.hls;switch(a.event){case "init":Wb.URL.revokeObjectURL(this.w.objectURL);
break;case q["default"].FRAG_PARSING_DATA:a.data.data1=new Uint8Array(a.data1),a.data2&&(a.data.data2=new Uint8Array(a.data2));default:a.data=a.data||{},a.data.frag=this.frag,a.data.id=this.id,b.trigger(a.event,a.data)}};return a}(),Xb={toString:function(a){for(var b="",c=a.length,g=0;g<c;g++)b+="["+a.start(g).toFixed(3)+","+a.end(g).toFixed(3)+"]";return b}},zc=function(){function a(a,b,c,d){this.config=a;this.media=b;this.fragmentTracker=c;this.hls=d;this.nudgeRetry=0;this.stallReported=!1;this.stalled=
null;this.seeking=this.moved=!1}var b=a.prototype;b.poll=function(a){var b=this.config,c=this.media,d=this.stalled,e=c.currentTime,f=c.seeking,v=this.seeking&&!f,h=!this.seeking&&f;this.seeking=f;if(e!==a)this.moved=!0,null!==d&&(this.stallReported&&(b=self.performance.now()-d,p.logger.warn("playback not stuck anymore @"+e+", after "+Math.round(b)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0);else{if(h||v)this.stalled=null;if(!c.paused&&!c.ended&&0!==c.playbackRate&&c.buffered.length&&
(a=ja.bufferInfo(c,e,0),v=a.nextStart||0,0<a.len||v)){if(f){h=2<a.len;var k=!v||2<v-e&&!this.fragmentTracker.getPartialFragment(e);if(h||k)return;this.moved=!1}if(!this.moved&&this.stalled&&(v=Math.max(v,a.start||0)-e,0<v&&2>=v)){this._trySkipBufferHole(null);return}v=self.performance.now();null===d?this.stalled=v:(d=v-d,!f&&250<=d&&this._reportStall(a.len),e=ja.bufferInfo(c,e,b.maxBufferHole),this._tryFixBufferStall(e,d))}}};b._tryFixBufferStall=function(a,b){var g=this.config,c=this.fragmentTracker.getPartialFragment(this.media.currentTime);
(!c||!this._trySkipBufferHole(c))&&a.len>g.maxBufferHole&&b>1E3*g.highBufferWatchdogPeriod&&(p.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())};b._reportStall=function(a){var b=this.hls,c=this.media;this.stallReported||(this.stallReported=!0,p.logger.warn("Playback stalling at @"+c.currentTime+" due to low buffer (buffer="+a+")"),b.trigger(q["default"].ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:a}))};
b._trySkipBufferHole=function(a){for(var b=this.config,c=this.hls,d=this.media,e=d.currentTime,f=0,v=0;v<d.buffered.length;v++){var h=d.buffered.start(v);if(e+b.maxBufferHole>=f&&e<h)return b=Math.max(h+.05,d.currentTime+.1),p.logger.warn("skipping hole, adjusting currentTime from "+e+" to "+b),this.moved=!0,this.stalled=null,d.currentTime=b,a&&c.trigger(q["default"].ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+
e+" to "+b,frag:a}),b;f=d.buffered.end(v)}return 0};b._tryNudgeBuffer=function(){var a=this.config,b=this.hls,c=this.media,d=c.currentTime,e=(this.nudgeRetry||0)+1;this.nudgeRetry=e;e<a.nudgeMaxRetry?(a=d+e*a.nudgeOffset,p.logger.warn("Nudging 'currentTime' from "+d+" to "+a),c.currentTime=a,b.trigger(q["default"].ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})):(p.logger.error("Playhead still not moving while enough data buffered @"+d+" after "+a.nudgeMaxRetry+
" nudges"),b.trigger(q["default"].ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0}))};return a}(),Yb=function(a){function b(b){var g=arguments.length;for(var c=Array(1<g?g-1:0),d=1;d<g;d++)c[d-1]=arguments[d];g=a.call.apply(a,[this,b].concat(c))||this;g._boundTick=void 0;g._tickTimer=null;g._tickInterval=null;g._tickCallCount=0;g._boundTick=g.tick.bind(oa(g));return g}ta(b,a);var c=b.prototype;c.onHandlerDestroying=function(){this.clearNextTick();this.clearInterval()};
c.hasInterval=function(){return!!this._tickInterval};c.hasNextTick=function(){return!!this._tickTimer};c.setInterval=function(a){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,a),!0)};c.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1};c.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1};c.tick=function(){this._tickCallCount++;1===
this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)};c.doTick=function(){};return b}(ca),wb=function(a){function b(){return a.apply(this,arguments)||this}na(b,a);var c=b.prototype;c.doTick=function(){};c.startLoad=function(){};c.stopLoad=function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragmentTracker.removeFragment(a));this.demuxer&&(this.demuxer.destroy(),this.demuxer=null);
this.fragPrevious=this.fragCurrent=null;this.clearInterval();this.clearNextTick();this.state="STOPPED"};c._streamEnded=function(a,b){var g=this.fragCurrent,c=this.fragmentTracker;return b.live||!g||g.backtracked||g.sn!==b.endSN||a.nextStart?!1:(a=c.getState(g),"PARTIAL"===a||"OK"===a)};c.onMediaSeeking=function(){var a=this.config,b=this.media,c=this.state,d=b?b.currentTime:null,e=ja.bufferInfo(this.mediaBuffer||b,d,this.config.maxBufferHole);p.logger.log("media seeking to "+(Object(Q.isFiniteNumber)(d)?
d.toFixed(3):d));"FRAG_LOADING"===c?(c=this.fragCurrent,0===e.len&&c&&(a=a.maxFragLookUpTolerance,e=c.start+c.duration+a,d<c.start-a||d>e?(c.loader&&(p.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),c.loader.abort()),this.fragPrevious=this.fragCurrent=null,this.state="IDLE"):p.logger.log("seeking outside of buffer but within currently loaded fragment range"))):"ENDED"===c&&(0===e.len&&(this.fragCurrent=this.fragPrevious=null),this.state="IDLE");b&&(this.lastCurrentTime=
d);this.loadedmetadata||(this.nextLoadPosition=this.startPosition=d);this.tick()};c.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0};c.onHandlerDestroying=function(){this.stopLoad();a.prototype.onHandlerDestroying.call(this)};c.onHandlerDestroyed=function(){this.state="STOPPED";this.fragmentTracker=null};c.computeLivePosition=function(a,b){return a+Math.max(0,b.totalduration-(void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*b.targetduration))};
return b}(Yb),Ac=function(a){function b(b,c){var g=a.call(this,b,q["default"].MEDIA_ATTACHED,q["default"].MEDIA_DETACHING,q["default"].MANIFEST_LOADING,q["default"].MANIFEST_PARSED,q["default"].LEVEL_LOADED,q["default"].LEVELS_UPDATED,q["default"].KEY_LOADED,q["default"].FRAG_LOADED,q["default"].FRAG_LOAD_EMERGENCY_ABORTED,q["default"].FRAG_PARSING_INIT_SEGMENT,q["default"].FRAG_PARSING_DATA,q["default"].FRAG_PARSED,q["default"].ERROR,q["default"].AUDIO_TRACK_SWITCHING,q["default"].AUDIO_TRACK_SWITCHED,
q["default"].BUFFER_CREATED,q["default"].BUFFER_APPENDED,q["default"].BUFFER_FLUSHED)||this;g.fragmentTracker=c;g.config=b.config;g.audioCodecSwap=!1;g._state="STOPPED";g.stallReported=!1;g.gapController=null;g.altAudio=!1;g.audioOnly=!1;g.bitrateTest=!1;return g}x(b,a);var c=b.prototype;c.startLoad=function(a){if(this.levels){var b=this.lastCurrentTime,g=this.hls;this.stopLoad();this.setInterval(100);this.level=-1;this.fragLoadError=0;if(!this.startFragRequested){var c=g.startLevel;-1===c&&(g.config.testBandwidth?
(c=0,this.bitrateTest=!0):c=g.nextAutoLevel);this.level=g.nextLoadLevel=c;this.loadedmetadata=!1}0<b&&-1===a&&(p.logger.log("override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b);this.state="IDLE";this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a;this.tick()}else this.forceStartLoad=!0,this.state="STOPPED"};c.stopLoad=function(){this.forceStartLoad=!1;a.prototype.stopLoad.call(this)};c.doTick=function(){switch(this.state){case "BUFFER_FLUSHING":this.fragLoadError=0;break;
case "IDLE":this._doTickIdle();break;case "WAITING_LEVEL":var a=this.levels[this.level];a&&a.details&&(this.state="IDLE");break;case "FRAG_LOADING_WAITING_RETRY":a=window.performance.now();var b=this.retryDate;if(!b||a>=b||this.media&&this.media.seeking)p.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state="IDLE"}this._checkBuffer();this._checkFragmentChanged()};c._doTickIdle=function(){var a=this.hls,b=a.config,c=this.media;if(void 0!==this.levelLastLoaded&&(c||
!this.startFragRequested&&b.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var d=this.loadedmetadata?c.currentTime:this.nextLoadPosition;var e=a.nextLoadLevel,f=this.levels[e];if(f){var v=f.bitrate;v=v?Math.max(8*b.maxBufferSize/v,b.maxBufferLength):b.maxBufferLength;v=Math.min(v,b.maxMaxBufferLength);b=ja.bufferInfo(this.mediaBuffer?this.mediaBuffer:c,d,d<b.maxBufferHole?Math.max(2,b.maxBufferHole):b.maxBufferHole);c=b.len;c>=v||(p.logger.trace("buffer length of "+
c.toFixed(3)+" is below max of "+v.toFixed(3)+". checking for more payload ..."),this.level=a.nextLoadLevel=e,a=f.details,!a||a.live&&this.levelLastLoaded!==e?this.state="WAITING_LEVEL":this._streamEnded(b,a)?(d={},this.altAudio&&(d.type="video"),this.hls.trigger(q["default"].BUFFER_EOS,d),this.state="ENDED"):this._fetchPayloadOrEos(d,b,a))}}};c._fetchPayloadOrEos=function(a,b,c){var g=this.fragPrevious,d=c.fragments,u=d.length;if(0!==u){var e=d[0].start,f=d[u-1].start+d[u-1].duration;b=b.end;if(c.initSegment&&
!c.initSegment.data)var H=c.initSegment;else if(c.live){H=this.config.initialLiveManifestSize;if(u<H){p.logger.warn("Can not start playback of a level, reason: not enough fragments "+u+" < "+H);return}H=this._ensureFragmentAtLivePoint(c,b,e,f,g,d);if(null===H)return}else b<e&&(H=d[0]);H||(H=this._findFragment(e,g,u,d,b,f,c));H&&(H.encrypted?this._loadKey(H,c):this._loadFragment(H,c,a,b))}};c._ensureFragmentAtLivePoint=function(a,b,c,d,e,f){var g=this.hls.config,u=this.media,H=Infinity;void 0!==g.liveMaxLatencyDuration?
H=g.liveMaxLatencyDuration:Object(Q.isFiniteNumber)(g.liveMaxLatencyDurationCount)&&(H=g.liveMaxLatencyDurationCount*a.targetduration);b<Math.max(c-g.maxFragLookUpTolerance,d-H)&&(b=c=this.liveSyncPosition=this.computeLivePosition(c,a),u&&!u.paused&&u.readyState&&u.duration>c&&c>u.currentTime&&(p.logger.log("buffer end: "+b.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+c.toFixed(3)),u.currentTime=c),this.nextLoadPosition=c);if(a.PTSKnown&&b>d&&u&&
u.readyState)return null;if(this.startFragRequested&&!a.PTSKnown&&e)if(a.hasProgramDateTime){p.logger.log("live playlist, switching playlist, load frag with same PDT: "+e.programDateTime);var v=ka(f,e.endProgramDateTime,g.maxFragLookUpTolerance)}else b=e.sn+1,b>=a.startSN&&b<=a.endSN&&(a=f[b-a.startSN],e.cc===a.cc&&(v=a,p.logger.log("live playlist, switching playlist, load frag with next SN: "+v.sn))),v||(v=eb.search(f,function(a){return e.cc-a.cc}))&&p.logger.log("live playlist, switching playlist, load frag with same CC: "+
v.sn);return v};c._findFragment=function(a,b,c,d,e,f,v){a=this.hls.config;if(f=e<f?M(b,d,e,e>f-a.maxFragLookUpTolerance?0:a.maxFragLookUpTolerance):d[c-1]){c=f.sn-v.startSN;var g=b&&f.level===b.level;e=d[c-1];d=d[c+1];b&&f.sn===b.sn&&(g&&!f.backtracked?f.sn<v.endSN?(v=b.deltaPTS)&&v>a.maxBufferHole&&b.dropped&&c?(f=e,p.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):
(f=d,"OK"!==this.fragmentTracker.getState(f)&&p.logger.log("Re-loading fragment with SN: "+f.sn)):f=null:f.backtracked&&(d&&d.backtracked?(p.logger.warn("Already backtracked from fragment "+d.sn+", will not backtrack to fragment "+f.sn+". Loading fragment "+d.sn),f=d):(p.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),f.dropped=0,e?(f=e,f.backtracked=!0):c&&(f=null))))}return f};c._loadKey=function(a,b){p.logger.log("Loading key for "+a.sn+" of ["+b.startSN+
"-"+b.endSN+"], level "+this.level);this.state="KEY_LOADING";this.hls.trigger(q["default"].KEY_LOADING,{frag:a})};c._loadFragment=function(a,b,c,d){var g=this.fragmentTracker.getState(a);this.fragCurrent=a;"initSegment"!==a.sn&&(this.startFragRequested=!0);Object(Q.isFiniteNumber)(a.sn)&&!a.bitrateTest&&(this.nextLoadPosition=a.start+a.duration);a.backtracked||"NOT_LOADED"===g||"PARTIAL"===g?(a.autoLevel=this.hls.autoLevelEnabled,a.bitrateTest=this.bitrateTest,p.logger.log("Loading "+a.sn+" of ["+
b.startSN+"-"+b.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(c.toFixed(3))+", bufferEnd: "+parseFloat(d.toFixed(3))),this.hls.trigger(q["default"].FRAG_LOADING,{frag:a}),this.demuxer||(this.demuxer=new vb(this.hls,"main")),this.state="FRAG_LOADING"):"APPENDING"===g&&this._reduceMaxBufferLength(a.duration)&&this.fragmentTracker.removeFragment(a)};c.getBufferedFrag=function(a){return this.fragmentTracker.getBufferedFrag(a,Ma.MAIN)};c.followingBufferedFrag=
function(a){return a?this.getBufferedFrag(a.endPTS+.5):null};c._checkFragmentChanged=function(){var a,b=this.media;if(b&&b.readyState&&!1===b.seeking){var c=b.currentTime;c>this.lastCurrentTime&&(this.lastCurrentTime=c);ja.isBuffered(b,c)?a=this.getBufferedFrag(c):ja.isBuffered(b,c+.1)&&(a=this.getBufferedFrag(c+.1));a&&a!==this.fragPlaying&&(this.hls.trigger(q["default"].FRAG_CHANGED,{frag:a}),c=a.level,this.fragPlaying&&this.fragPlaying.level===c||this.hls.trigger(q["default"].LEVEL_SWITCHED,{level:c}),
this.fragPlaying=a)}};c.immediateLevelSwitch=function(){p.logger.log("immediateLevelSwitch");if(!this.immediateSwitch){this.immediateSwitch=!0;var a=this.media,b;a?(b=a.paused)||a.pause():b=!0;this.previouslyPaused=b}(a=this.fragCurrent)&&a.loader&&a.loader.abort();this.fragCurrent=null;this.flushMainBuffer(0,Number.POSITIVE_INFINITY)};c.immediateLevelSwitchEnd=function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,0<a.currentTime&&ja.isBuffered(a,a.currentTime)&&(a.currentTime-=
1E-4),this.previouslyPaused||a.play())};c.nextLevelSwitch=function(){var a=this.media;if(a&&a.readyState){var b;(b=this.getBufferedFrag(a.currentTime))&&1<b.startPTS&&this.flushMainBuffer(0,b.startPTS-1);if(a.paused)b=0;else{b=this.levels[this.hls.nextLoadLevel];var c=this.fragLastKbps;b=c&&this.fragCurrent?this.fragCurrent.duration*b.bitrate/(1E3*c)+1:0}if(a=this.getBufferedFrag(a.currentTime+b))if(b=this.followingBufferedFrag(a))(c=this.fragCurrent)&&c.loader&&c.loader.abort(),this.fragCurrent=
null,this.flushMainBuffer(Math.max(a.endPTS,b.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,b.duration)),Number.POSITIVE_INFINITY)}};c.flushMainBuffer=function(a,b){this.state="BUFFER_FLUSHING";a={startOffset:a,endOffset:b};this.altAudio&&(a.type="video");this.hls.trigger(q["default"].BUFFER_FLUSHING,a)};c.onMediaAttached=function(a){a=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);this.onvended=this.onMediaEnded.bind(this);
a.addEventListener("seeking",this.onvseeking);a.addEventListener("seeked",this.onvseeked);a.addEventListener("ended",this.onvended);var b=this.config;this.levels&&b.autoStartLoad&&this.hls.startLoad(b.startPosition);this.gapController=new zc(b,a,this.fragmentTracker,this.hls)};c.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(p.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.levels;b&&b.forEach(function(a){a.details&&
a.details.fragments.forEach(function(a){a.backtracked=void 0})});a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null);this.fragmentTracker.removeAllFragments();this.media=this.mediaBuffer=null;this.loadedmetadata=!1;this.stopLoad()};c.onMediaSeeked=function(){var a=this.media;a=a?a.currentTime:void 0;Object(Q.isFiniteNumber)(a)&&p.logger.log("media seeked to "+
a.toFixed(3));this.tick()};c.onManifestLoading=function(){p.logger.log("trigger BUFFER_RESET");this.hls.trigger(q["default"].BUFFER_RESET);this.fragmentTracker.removeAllFragments();this.stalled=!1;this.startPosition=this.lastCurrentTime=0};c.onManifestParsed=function(a){var b=!1,g=!1,c;a.levels.forEach(function(a){if(c=a.audioCodec)-1!==c.indexOf("mp4a.40.2")&&(b=!0),-1!==c.indexOf("mp4a.40.5")&&(g=!0)});(this.audioCodecSwitch=b&&g)&&p.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC");
this.altAudio=a.altAudio;this.levels=a.levels;this.startFragRequested=!1;a=this.config;(a.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(a.startPosition)};c.onLevelLoaded=function(a){var b=a.details,g=a.level,c=this.levels[this.levelLastLoaded],d=this.levels[g];a=b.totalduration;var e=0;p.logger.log("level "+g+" loaded ["+b.startSN+","+b.endSN+"],duration:"+a);if(b.live||d.details&&d.details.live){var f=d.details;f&&0<b.fragments.length?(W(f,b),e=b.fragments[0].start,this.liveSyncPosition=
this.computeLivePosition(e,f),b.PTSKnown&&Object(Q.isFiniteNumber)(e)?p.logger.log("live playlist sliding:"+e.toFixed(3)):(p.logger.log("live playlist - outdated PTS, unknown sliding"),ha(this.fragPrevious,b,c),!b.PTSKnown&&c&&la(b,c.details))):(p.logger.log("live playlist - first load, unknown sliding"),b.PTSKnown=!1,ha(this.fragPrevious,b,c),!b.PTSKnown&&c&&la(b,c.details))}else b.PTSKnown=!1;d.details=b;this.levelLastLoaded=g;this.hls.trigger(q["default"].LEVEL_UPDATED,{details:b,level:g});if(!1===
this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime)g=b.startTimeOffset,Object(Q.isFiniteNumber)(g)?(0>g&&(p.logger.log("negative start time offset "+g+", count from end of last fragment"),g=e+a+g),p.logger.log("start time offset found in playlist, adjust startPosition to "+g),this.startPosition=g):b.live?(this.startPosition=this.computeLivePosition(e,b),p.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition;
this.nextLoadPosition=this.startPosition}"WAITING_LEVEL"===this.state&&(this.state="IDLE");this.tick()};c.onKeyLoaded=function(){"KEY_LOADING"===this.state&&(this.state="IDLE",this.tick())};c.onFragLoaded=function(a){var b=this.fragCurrent,g=this.hls,c=this.levels,d=this.media,e=a.frag;if("FRAG_LOADING"===this.state&&b&&"main"===e.type&&e.level===b.level&&e.sn===b.sn){var f=a.stats;c=c[b.level];var v=c.details;this.bitrateTest=!1;this.stats=f;p.logger.log("Loaded "+b.sn+" of ["+v.startSN+" ,"+v.endSN+
"],level "+b.level);e.bitrateTest&&g.nextLoadLevel?(this.state="IDLE",this.startFragRequested=!1,f.tparsed=f.tbuffered=window.performance.now(),g.trigger(q["default"].FRAG_BUFFERED,{stats:f,frag:b,id:"main"}),this.tick()):"initSegment"===e.sn?(this.state="IDLE",f.tparsed=f.tbuffered=window.performance.now(),v.initSegment.data=a.payload,g.trigger(q["default"].FRAG_BUFFERED,{stats:f,frag:b,id:"main"}),this.tick()):(p.logger.log("Parsing "+b.sn+" of ["+v.startSN+" ,"+v.endSN+"],level "+b.level+", cc "+
b.cc),this.state="PARSING",this.pendingBuffering=!0,this.appended=!1,e.bitrateTest&&(e.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:e})),g=!(d&&d.seeking)&&(v.PTSKnown||!v.live),d=v.initSegment?v.initSegment.data:[],e=this._getAudioCodec(c),(this.demuxer=this.demuxer||new vb(this.hls,"main")).push(a.payload,d,e,c.videoCodec,b,v.totalduration,g))}this.fragLoadError=0};c.onFragParsingInitSegment=function(a){var b=this.fragCurrent,g=a.frag;if(b&&"main"===a.id&&g.sn===b.sn&&g.level===b.level&&
"PARSING"===this.state){b=a.tracks;var c;this.audioOnly=b.audio&&!b.video;this.altAudio&&!this.audioOnly&&delete b.audio;if(g=b.audio){var d=this.levels[this.level].audioCodec,e=navigator.userAgent.toLowerCase();d&&this.audioCodecSwap&&(p.logger.log("swapping playlist audio codec"),d=-1!==d.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");this.audioCodecSwitch&&1!==g.metadata.channelCount&&-1===e.indexOf("firefox")&&(d="mp4a.40.5");-1!==e.indexOf("android")&&"audio/mpeg"!==g.container&&(d="mp4a.40.2",
p.logger.log("Android: force audio codec to "+d));g.levelCodec=d;g.id=a.id}if(g=b.video)g.levelCodec=this.levels[this.level].videoCodec,g.id=a.id;this.hls.trigger(q["default"].BUFFER_CODECS,b);for(c in b)if(g=b[c],p.logger.log("main track:"+c+",container:"+g.container+",codecs[level/parsed]=["+g.levelCodec+"/"+g.codec+"]"),a=g.initSegment)this.pendingBuffering=this.appended=!0,this.hls.trigger(q["default"].BUFFER_APPENDING,{type:c,data:a,parent:"main",content:"initSegment"});this.tick()}};c.onFragParsingData=
function(a){var b=this,c=this.fragCurrent,g=a.frag;if(c&&"main"===a.id&&g.sn===c.sn&&g.level===c.level&&("audio"!==a.type||!this.altAudio)&&"PARSING"===this.state){g=this.levels[this.level];Object(Q.isFiniteNumber)(a.endPTS)||(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+c.duration);!0===a.hasAudio&&c.addElementaryStream(ua.AUDIO);!0===a.hasVideo&&c.addElementaryStream(ua.VIDEO);p.logger.log("Parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+
"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb+",dropped:"+(a.dropped||0));if("video"===a.type)if(c.dropped=a.dropped,c.dropped)if(c.backtracked)p.logger.warn("Already backtracked on this fragment, appending with the gap",c.sn);else{var d=g.details;if(d&&c.sn===d.startSN)p.logger.warn("missing video frame(s) on first frag, appending with gap",c.sn);else{p.logger.warn("missing video frame(s), backtracking fragment",c.sn);this.fragmentTracker.removeFragment(c);c.backtracked=!0;this.nextLoadPosition=a.startPTS;
this.state="IDLE";this.fragPrevious=c;this.demuxer&&(this.demuxer.destroy(),this.demuxer=null);this.tick();return}}else c.backtracked=!1;c=R(g.details,c,a.startPTS,a.endPTS,a.startDTS,a.endDTS);var e=this.hls;e.trigger(q["default"].LEVEL_PTS_UPDATED,{details:g.details,level:this.level,drift:c,type:a.type,start:a.startPTS,end:a.endPTS});[a.data1,a.data2].forEach(function(c){c&&c.length&&"PARSING"===b.state&&(b.appended=!0,b.pendingBuffering=!0,e.trigger(q["default"].BUFFER_APPENDING,{type:a.type,data:c,
parent:"main",content:"data"}))});this.tick()}};c.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&"PARSING"===this.state&&(this.stats.tparsed=window.performance.now(),this.state="PARSED",this._checkAppendedParsed())};c.onAudioTrackSwitching=function(a){var b=this.altAudio,c=a.id;a.url||(this.mediaBuffer!==this.media&&(p.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,
a=this.fragCurrent,a.loader&&(p.logger.log("switching to main audio track, cancel main fragment load"),a.loader.abort()),this.fragPrevious=this.fragCurrent=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state="IDLE"),a=this.hls,b&&a.trigger(q["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(q["default"].AUDIO_TRACK_SWITCHED,{id:c}))};c.onAudioTrackSwitched=function(a){if(a=!!this.hls.audioTracks[a.id].url){var b=this.videoBuffer;
b&&this.mediaBuffer!==b&&(p.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=b)}this.altAudio=a;this.tick()};c.onBufferCreated=function(a){a=a.tracks;var b=!1,c;for(c in a){var g=a[c];if("main"===g.id){var d=c;var e=g;"video"===c&&(this.videoBuffer=a[c].buffer)}else b=!0}b&&e?(p.logger.log("alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=e.buffer):this.mediaBuffer=this.media};c.onBufferAppended=
function(a){if("main"===a.parent){var b=this.state;if("PARSING"===b||"PARSED"===b)this.pendingBuffering=0<a.pending,this._checkAppendedParsed()}};c._checkAppendedParsed=function(){if(!("PARSED"!==this.state||this.appended&&this.pendingBuffering)){var a=this.fragCurrent;if(a){p.logger.log("main buffered : "+Xb.toString((this.mediaBuffer?this.mediaBuffer:this.media).buffered));this.fragPrevious=a;var b=this.stats;b.tbuffered=window.performance.now();this.fragLastKbps=Math.round(8*b.total/(b.tbuffered-
b.tfirst));this.hls.trigger(q["default"].FRAG_BUFFERED,{stats:b,frag:a,id:"main"});this.state="IDLE"}(this.loadedmetadata||0>=this.startPosition)&&this.tick()}};c.onError=function(a){var b=a.frag||this.fragCurrent;if(!b||"main"===b.type)switch(b=!!this.media&&ja.isBuffered(this.media,this.media.currentTime)&&ja.isBuffered(this.media,this.media.currentTime+.5),a.details){case B.ErrorDetails.FRAG_LOAD_ERROR:case B.ErrorDetails.FRAG_LOAD_TIMEOUT:case B.ErrorDetails.KEY_LOAD_ERROR:case B.ErrorDetails.KEY_LOAD_TIMEOUT:a.fatal||
(this.fragLoadError+1<=this.config.fragLoadingMaxRetry?(a=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout),p.logger.warn("mediaController: frag loading failed, retry in "+a+" ms"),this.retryDate=window.performance.now()+a,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state="FRAG_LOADING_WAITING_RETRY"):(p.logger.error("mediaController: "+a.details+" reaches max retry, redispatch as fatal ..."),
a.fatal=!0,this.state="ERROR"));break;case B.ErrorDetails.LEVEL_LOAD_ERROR:case B.ErrorDetails.LEVEL_LOAD_TIMEOUT:"ERROR"!==this.state&&(a.fatal?(this.state="ERROR",p.logger.warn("streamController: "+a.details+",switch to "+this.state+" state ...")):a.levelRetry||"WAITING_LEVEL"!==this.state||(this.state="IDLE"));break;case B.ErrorDetails.BUFFER_FULL_ERROR:"main"!==a.parent||"PARSING"!==this.state&&"PARSED"!==this.state||(b?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state="IDLE"):
(p.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}};c._reduceMaxBufferLength=function(a){var b=this.config;return b.maxMaxBufferLength>=a?(b.maxMaxBufferLength/=2,p.logger.warn("main:reduce max buffer length to "+b.maxMaxBufferLength+"s"),!0):!1};c._checkBuffer=function(){var a=this.media;a&&0!==a.readyState&&(a=(this.mediaBuffer?this.mediaBuffer:a).buffered,!this.loadedmetadata&&a.length?
(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,a))};c.onFragLoadEmergencyAborted=function(){this.state="IDLE";this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);this.tick()};c.onBufferFlushed=function(){var a=this.mediaBuffer?this.mediaBuffer:this.media;a&&this.fragmentTracker.detectEvictedFragments(this.audioOnly?ua.AUDIO:ua.VIDEO,a.buffered);this.state="IDLE";
this.fragPrevious=null};c.onLevelsUpdated=function(a){this.levels=a.levels};c.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap};c._seekToStartPos=function(){var a=this.media,b=a.currentTime,c=this.startPosition;if(b!==c&&0<=c)if(a.seeking)p.logger.log("could not seek to "+c+", already seeking at "+b);else{var d=(a.buffered.length?a.buffered.start(0):0)-c;0<d&&d<this.config.maxBufferHole&&(p.logger.log("adjusting start position by "+d+" to match buffer start"),this.startPosition=
c+=d);p.logger.log("seek to target start position "+c+" from current time "+b+". ready state "+a.readyState);a.currentTime=c}};c._getAudioCodec=function(a){a=this.config.defaultAudioCodec||a.audioCodec;this.audioCodecSwap&&(p.logger.log("swapping playlist audio codec"),a&&(a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"));return a};T(b,[{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a;p.logger.log("main stream-controller: "+b+"->"+a);this.hls.trigger(q["default"].STREAM_STATE_TRANSITION,
{previousState:b,nextState:a})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var a=this.media;return a&&(a=this.getBufferedFrag(a.currentTime))?a.level:-1}},{key:"nextBufferedFrag",get:function(){var a=this.media;return a?this.followingBufferedFrag(this.getBufferedFrag(a.currentTime)):null}},{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=
a}}]);return b}(wb),Zb,Bc=function(a){function b(b){b=a.call(this,b,q["default"].MANIFEST_LOADED,q["default"].LEVEL_LOADED,q["default"].AUDIO_TRACK_SWITCHED,q["default"].FRAG_LOADED,q["default"].ERROR)||this;b.canload=!1;b.currentLevelIndex=null;b.manualLevelIndex=-1;b.timer=null;Zb=/chrome|firefox/.test(navigator.userAgent.toLowerCase());return b}I(b,a);var c=b.prototype;c.onHandlerDestroying=function(){this.clearTimer();this.manualLevelIndex=-1};c.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),
this.timer=null)};c.startLoad=function(){var a=this._levels;this.canload=!0;this.levelRetryCount=0;a&&a.forEach(function(a){a.loadError=0;var b=a.details;b&&b.live&&(a.details=void 0)});null!==this.timer&&this.loadLevel()};c.stopLoad=function(){this.canload=!1};c.onManifestLoaded=function(a){var b=[],c=[],g={},d=null,e=!1,f=!1;a.levels.forEach(function(a){var c=a.attrs;a.loadError=0;a.fragmentError=!1;e=e||!!a.videoCodec;f=f||!!a.audioCodec;Zb&&a.audioCodec&&-1!==a.audioCodec.indexOf("mp4a.40.34")&&
(a.audioCodec=void 0);(d=g[a.bitrate])?d.url.push(a.url):(a.url=[a.url],a.urlId=0,g[a.bitrate]=a,b.push(a));c&&(c.AUDIO&&O(d||a,"audio",c.AUDIO),c.SUBTITLES&&O(d||a,"text",c.SUBTITLES))});e&&f&&(b=b.filter(function(a){return!!a.videoCodec}));b=b.filter(function(a){var b=a.audioCodec;a=a.videoCodec;return(!b||w(b,"audio"))&&(!a||w(a,"video"))});a.audioTracks&&(c=a.audioTracks.filter(function(a){return!a.audioCodec||w(a.audioCodec,"audio")}),c.forEach(function(a,b){a.id=b}));if(0<b.length){var v=b[0].bitrate;
b.sort(function(a,b){return a.bitrate-b.bitrate});this._levels=b;for(var h=0;h<b.length;h++)if(b[h].bitrate===v){this._firstLevel=h;p.logger.log("manifest loaded,"+b.length+" level(s) found, first bitrate:"+v);break}this.hls.trigger(q["default"].MANIFEST_PARSED,{levels:b,audioTracks:c,firstLevel:this._firstLevel,stats:a.stats,audio:f,video:e,altAudio:!(f&&!e)&&c.some(function(a){return!!a.url})})}else this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,
fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})};c.setLevelInternal=function(a){var b=this._levels,c=this.hls;if(0<=a&&a<b.length){this.clearTimer();if(this.currentLevelIndex!==a){p.logger.log("switching to level "+a);this.currentLevelIndex=a;var g=b[a];g.level=a;c.trigger(q["default"].LEVEL_SWITCHING,g)}b=b[a];g=b.details;if(!g||g.live)g=b.urlId,c.trigger(q["default"].LEVEL_LOADING,{url:b.url[g],level:a,id:g})}else c.trigger(q["default"].ERROR,{type:B.ErrorTypes.OTHER_ERROR,
details:B.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})};c.onError=function(a){if(a.fatal)a.type===B.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var b=!1,c=!1;switch(a.details){case B.ErrorDetails.FRAG_LOAD_ERROR:case B.ErrorDetails.FRAG_LOAD_TIMEOUT:case B.ErrorDetails.KEY_LOAD_ERROR:case B.ErrorDetails.KEY_LOAD_TIMEOUT:var g=a.frag.level;c=!0;break;case B.ErrorDetails.LEVEL_LOAD_ERROR:case B.ErrorDetails.LEVEL_LOAD_TIMEOUT:g=a.context.level;b=!0;break;case B.ErrorDetails.REMUX_ALLOC_ERROR:g=
a.level,b=!0}void 0!==g&&this.recoverLevel(a,g,b,c)}};c.recoverLevel=function(a,b,c,d){var g=this,u=this.hls.config,e=a.details,f=this._levels[b];f.loadError++;f.fragmentError=d;if(c)if(this.levelRetryCount+1<=u.levelLoadingMaxRetry)u=Math.min(Math.pow(2,this.levelRetryCount)*u.levelLoadingRetryDelay,u.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return g.loadLevel()},u),a.levelRetry=!0,this.levelRetryCount++,p.logger.warn("level controller, "+e+", retry in "+u+" ms, current retry count is "+
this.levelRetryCount);else{p.logger.error("level controller, cannot recover from "+e+" error");this.currentLevelIndex=null;this.clearTimer();a.fatal=!0;return}if(c||d)a=f.url.length,1<a&&f.loadError<a?(f.urlId=(f.urlId+1)%a,f.details=void 0,p.logger.warn("level controller, "+e+" for level "+b+": switching to redundant URL-id "+f.urlId)):-1===this.manualLevelIndex?(b=0===b?this._levels.length-1:b-1,p.logger.warn("level controller, "+e+": switch to "+b),this.hls.nextAutoLevel=this.currentLevelIndex=
b):d&&(p.logger.warn("level controller, "+e+": reload a fragment"),this.currentLevelIndex=null)};c.onFragLoaded=function(a){a=a.frag;void 0!==a&&"main"===a.type&&(a=this._levels[a.level],void 0!==a&&(a.fragmentError=!1,this.levelRetryCount=a.loadError=0))};c.onLevelLoaded=function(a){var b=this,c=a.level,g=a.details;c===this.currentLevelIndex&&(c=this._levels[c],c.fragmentError||(this.levelRetryCount=c.loadError=0),g.live?(a=ba(c.details,g,a.stats.trequest),p.logger.log("live playlist, reload in "+
Math.round(a)+" ms"),this.timer=setTimeout(function(){return b.loadLevel()},a)):this.clearTimer())};c.onAudioTrackSwitched=function(a){a=this.hls.audioTracks[a.id].groupId;var b=this.hls.levels[this.currentLevelIndex];if(b&&b.audioGroupIds){for(var c=-1,g=0;g<b.audioGroupIds.length;g++)if(b.audioGroupIds[g]===a){c=g;break}c!==b.urlId&&(b.urlId=c,this.startLoad())}};c.loadLevel=function(){p.logger.debug("call to loadLevel");if(null!==this.currentLevelIndex&&this.canload){var a=this._levels[this.currentLevelIndex];
if("object"===typeof a&&0<a.url.length){var b=this.currentLevelIndex,c=a.urlId;a=a.url[c];p.logger.log("Attempt loading level index "+b+" with URL-id "+c);this.hls.trigger(q["default"].LEVEL_LOADING,{url:a,level:b,id:c})}}};c.removeLevel=function(a,b){var c=this.levels.filter(function(c,g){return g!==a?!0:1<c.url.length&&void 0!==b?(c.url=c.url.filter(function(a,c){return c!==b}),c.urlId=0,!0):!1}).map(function(a,b){var c=a.details;c&&c.fragments&&c.fragments.forEach(function(a){a.level=b});return a});
this._levels=c;this.hls.trigger(q["default"].LEVELS_UPDATED,{levels:c})};Z(b,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(a){var b=this._levels;b&&(a=Math.min(a,b.length-1),this.currentLevelIndex===a&&b[a].details||this.setLevelInternal(a))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a;void 0===this._startLevel&&(this._startLevel=a);-1!==a&&(this.level=a)}},{key:"firstLevel",
get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a;-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=a)}}]);return b}(ca),xb=e("./src/demux/id3.js"),
Cc=function(a){function b(b){b=a.call(this,b,q["default"].MEDIA_ATTACHED,q["default"].MEDIA_DETACHING,q["default"].FRAG_PARSING_METADATA,q["default"].LIVE_BACK_BUFFER_REACHED)||this;b.id3Track=void 0;b.media=void 0;return b}ya(b,a);var c=b.prototype;c.destroy=function(){ca.prototype.destroy.call(this)};c.onMediaAttached=function(a){this.media=a.media};c.onMediaDetaching=function(){qa(this.id3Track);this.media=this.id3Track=void 0};c.getID3Track=function(a){for(var b=0;b<a.length;b++){var c=a[b];if("metadata"===
c.kind&&"id3"===c.label)return sa(c,this.media),c}return this.media.addTextTrack("metadata","id3")};c.onFragParsingMetadata=function(a){var b=a.frag;a=a.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var c=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,g=0;g<a.length;g++){var d=xb["default"].getID3Frames(a[g].data);if(d){var e=Math.max(a[g].pts,0),f=g<a.length-1?a[g+1].pts:b.endPTS;f||(f=b.start+b.duration);0>=f-e&&(f=e+.25);
for(var v=0;v<d.length;v++){var h=d[v];if(!xb["default"].isTimeStampFrame(h)){var k=new c(e,f,"");k.value=h;this.id3Track.addCue(k)}}}}};c.onLiveBackBufferReached=function(a){var b=this.id3Track;if(b&&b.cues&&b.cues.length&&(a=xa(b.cues,a.bufferEnd)))for(;b.cues[0]!==a;)b.removeCue(b.cues[0])};return b}(ca),$b=function(){function a(a){this.totalWeight_=this.estimate_=this.alpha_=void 0;this.alpha_=a?Math.exp(Math.log(.5)/a):0;this.totalWeight_=this.estimate_=0}var b=a.prototype;b.sample=function(a,
b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_;this.totalWeight_+=a};b.getTotalWeight=function(){return this.totalWeight_};b.getEstimate=function(){return this.alpha_?this.estimate_/(1-Math.pow(this.alpha_,this.totalWeight_)):this.estimate_};return a}(),Dc=function(){function a(a,b,c,d){this.fast_=this.slow_=this.minDelayMs_=this.minWeight_=this.defaultEstimate_=this.hls=void 0;this.hls=a;this.defaultEstimate_=d;this.minWeight_=.001;this.minDelayMs_=50;this.slow_=new $b(b);
this.fast_=new $b(c)}var b=a.prototype;b.sample=function(a,b){a=Math.max(a,this.minDelayMs_);a/=1E3;b=8*b/a;this.fast_.sample(a,b);this.slow_.sample(a,b)};b.canEstimate=function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_};b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_};b.destroy=function(){};return a}(),Ec=window.performance,Fc=function(a){function b(b){var c=a.call(this,b,q["default"].FRAG_LOADING,
q["default"].FRAG_LOADED,q["default"].FRAG_BUFFERED,q["default"].ERROR)||this;c.lastLoadedFragLevel=0;c._nextAutoLevel=-1;c.hls=b;c.timer=null;c._bwEstimator=null;c.onCheck=c._abandonRulesCheck.bind(Da(c));return c}Fa(b,a);var c=b.prototype;c.destroy=function(){this.clearTimer();ca.prototype.destroy.call(this)};c.onFragLoading=function(a){var b=a.frag;if("main"===b.type&&(this.timer||(this.fragCurrent=b,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){a=this.hls;var c=a.config;if(a.levels[b.level].details.live){b=
c.abrEwmaFastLive;var g=c.abrEwmaSlowLive}else b=c.abrEwmaFastVoD,g=c.abrEwmaSlowVoD;this._bwEstimator=new Dc(a,g,b,c.abrEwmaDefaultEstimate)}};c._abandonRulesCheck=function(){var a=this.hls,b=a.media,c=this.fragCurrent;if(c){var d=c.loader;if(!d||d.stats&&d.stats.aborted)p.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;else{var e=d.stats;if(b&&e&&(!b.paused&&0!==b.playbackRate||!b.readyState)&&c.autoLevel&&c.level){var f=Ec.now()-e.trequest,
v=Math.abs(b.playbackRate);if(f>500*c.duration/v){var h=a.levels,k=Math.max(1,e.bw?e.bw/8:1E3*e.loaded/f),l=h[c.level];if(l){l=l.realBitrate?Math.max(l.realBitrate,l.bitrate):l.bitrate;var C=b.currentTime;l=((e.total?e.total:Math.max(e.loaded,Math.round(c.duration*l/8)))-e.loaded)/k;b=(ja.bufferInfo(b,C,a.config.maxBufferHole).end-C)/v;if(b<2*c.duration/v&&l>b){v=a.minAutoLevel;for(C=c.level-1;C>v&&!(c.duration*(h[C].realBitrate?Math.max(h[C].realBitrate,h[C].bitrate):h[C].bitrate)/(6.4*k)<b);C--);
void 0<l&&(p.logger.warn("loading too slow, abort fragment loading and switch to level "+C+":fragLoadedDelay["+C+"]<fragLoadedDelay["+(c.level-1)+"];bufferStarvationDelay:"+(void 0).toFixed(1)+"<"+l.toFixed(1)+":"+b.toFixed(1)),a.nextLoadLevel=C,this._bwEstimator.sample(f,e.loaded),d.abort(),this.clearTimer(),a.trigger(q["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,stats:e}))}}}}}}};c.onFragLoaded=function(a){var b=a.frag;if("main"===b.type&&Object(Q.isFiniteNumber)(b.sn)){this.clearTimer();this.lastLoadedFragLevel=
b.level;this._nextAutoLevel=-1;if(this.hls.config.abrMaxWithRealBitrate){b=this.hls.levels[b.level];var c=(b.loaded?b.loaded.bytes:0)+a.stats.loaded,g=(b.loaded?b.loaded.duration:0)+a.frag.duration;b.loaded={bytes:c,duration:g};b.realBitrate=Math.round(8*c/g)}a.frag.bitrateTest&&(b=a.stats,b.tparsed=b.tbuffered=b.tload,this.onFragBuffered(a))}};c.onFragBuffered=function(a){var b=a.stats;a=a.frag;if(!0!==b.aborted&&"main"===a.type&&Object(Q.isFiniteNumber)(a.sn)&&(!a.bitrateTest||b.tload===b.tbuffered)){var c=
b.tparsed-b.trequest;p.logger.log("latency/loading/parsing/append/kbps:"+Math.round(b.tfirst-b.trequest)+"/"+Math.round(b.tload-b.tfirst)+"/"+Math.round(b.tparsed-b.tload)+"/"+Math.round(b.tbuffered-b.tparsed)+"/"+Math.round(8*b.loaded/(b.tbuffered-b.trequest)));this._bwEstimator.sample(c,b.loaded);b.bwEstimate=this._bwEstimator.getEstimate();this.bitrateTestDelay=a.bitrateTest?c/1E3:0}};c.onError=function(a){switch(a.details){case B.ErrorDetails.FRAG_LOAD_ERROR:case B.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}};
c.clearTimer=function(){clearInterval(this.timer);this.timer=null};c._findBestLevel=function(a,b,c,d,e,f,v,h,k){for(;e>=d;e--){var g=k[e];if(g){var u=g.details;g=u?u.totalduration/u.fragments.length:b;u=u?u.live:!1;var H=e<=a?v*c:h*c;var l=k[e].realBitrate?Math.max(k[e].realBitrate,k[e].bitrate):k[e].bitrate,V=l*g/H;p.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+e+"/"+Math.round(H)+"/"+l+"/"+g+"/"+f+"/"+V);if(H>l&&(!V||u&&!this.bitrateTestDelay||V<f))return e}}return-1};
Ca(b,[{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,b=this._bwEstimator;if(!(-1===a||b&&b.canEstimate()))return a;b=this._nextABRAutoLevel;-1!==a&&(b=Math.min(a,b));return b},set:function(a){this._nextAutoLevel=a}},{key:"_nextABRAutoLevel",get:function(){var a=this.hls,b=a.maxAutoLevel,c=a.levels,d=a.config,e=a.minAutoLevel,f=a.media;a=this.lastLoadedFragLevel;var v=this.fragCurrent?this.fragCurrent.duration:0,h=f?f.currentTime:0,k=f&&0!==f.playbackRate?Math.abs(f.playbackRate):1,
l=this._bwEstimator?this._bwEstimator.getEstimate():d.abrEwmaDefaultEstimate;f=(ja.bufferInfo(f,h,d.maxBufferHole).end-h)/k;h=this._findBestLevel(a,v,l,e,b,f,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c);if(0<=h)return h;p.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");h=v?Math.min(v,d.maxStarvationDelay):d.maxStarvationDelay;k=d.abrBandWidthFactor;var C=d.abrBandWidthUpFactor;if(0===f){var t=this.bitrateTestDelay;t&&(h=(v?Math.min(v,d.maxLoadingDelay):
d.maxLoadingDelay)-t,p.logger.trace("bitrate test took "+Math.round(1E3*t)+"ms, set first fragment max fetchDuration to "+Math.round(1E3*h)+" ms"),k=C=1)}h=this._findBestLevel(a,v,l,e,b,f+h,k,C,c);return Math.max(h,0)}}]);return b}(ca),ac=window.MediaSource||window.WebKitMediaSource,Gc=function(a){function b(b){var c=a.call(this,b,q["default"].MEDIA_ATTACHING,q["default"].MEDIA_DETACHING,q["default"].MANIFEST_PARSED,q["default"].BUFFER_RESET,q["default"].BUFFER_APPENDING,q["default"].BUFFER_CODECS,
q["default"].BUFFER_EOS,q["default"].BUFFER_FLUSHING,q["default"].LEVEL_PTS_UPDATED,q["default"].LEVEL_UPDATED)||this;c._msDuration=null;c._levelDuration=null;c._levelTargetDuration=10;c._live=null;c._objectUrl=null;c._needsFlush=!1;c._needsEos=!1;c.config=void 0;c.audioTimestampOffset=void 0;c.bufferCodecEventsExpected=0;c._bufferCodecEventsTotal=0;c.media=null;c.mediaSource=null;c.segments=[];c.parent=void 0;c.appending=!1;c.appended=0;c.appendError=0;c.flushBufferCounter=0;c.tracks={};c.pendingTracks=
{};c.sourceBuffer={};c.flushRange=[];c._onMediaSourceOpen=function(){p.logger.log("media source opened");c.hls.trigger(q["default"].MEDIA_ATTACHED,{media:c.media});var a=c.mediaSource;a&&a.removeEventListener("sourceopen",c._onMediaSourceOpen);c.checkPendingTracks()};c._onMediaSourceClose=function(){p.logger.log("media source closed")};c._onMediaSourceEnded=function(){p.logger.log("media source ended")};c._onSBUpdateEnd=function(){if(c.audioTimestampOffset&&c.sourceBuffer.audio){var a=c.sourceBuffer.audio;
p.logger.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+c.audioTimestampOffset);a.timestampOffset=c.audioTimestampOffset;delete c.audioTimestampOffset}c._needsFlush&&c.doFlush();c._needsEos&&c.checkEos();c.appending=!1;var b=c.parent;a=c.segments.reduce(function(a,c){return c.parent===b?a+1:a},0);var g={},d=c.sourceBuffer,e;for(e in d){var u=d[e];if(!u)throw Error("handling source buffer update end error: source buffer for "+e+" uninitilized and unable to update buffered TimeRanges.");
g[e]=u.buffered}c.hls.trigger(q["default"].BUFFER_APPENDED,{parent:b,pending:a,timeRanges:g});c._needsFlush||c.doAppending();c.updateMediaElementDuration();0===a&&c.flushLiveBackBuffer()};c._onSBUpdateError=function(a){p.logger.error("sourceBuffer error:",a);c.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})};c.config=b.config;return c}Ha(b,a);var c=b.prototype;c.destroy=function(){ca.prototype.destroy.call(this)};c.onLevelPtsUpdated=
function(a){var b=this.tracks.audio;if("audio"===a.type&&b&&"audio/mpeg"===b.container){b=this.sourceBuffer.audio;if(!b)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(.1<Math.abs(b.timestampOffset-a.start)){var c=b.updating;try{b.abort()}catch(V){p.logger.warn("can not abort audio buffer: "+V)}c?this.audioTimestampOffset=a.start:(p.logger.warn("change mpeg audio timestamp offset from "+b.timestampOffset+" to "+a.start),b.timestampOffset=a.start)}}};c.onManifestParsed=
function(a){var b=2;if(a.audio&&!a.video||!a.altAudio)b=1;this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=b;p.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")};c.onMediaAttaching=function(a){if((a=this.media=a.media)&&ac){var b=this.mediaSource=new ac;b.addEventListener("sourceopen",this._onMediaSourceOpen);b.addEventListener("sourceended",this._onMediaSourceEnded);b.addEventListener("sourceclose",this._onMediaSourceClose);a.src=window.URL.createObjectURL(b);
this._objectUrl=a.src}};c.onMediaDetaching=function(){p.logger.log("media source detaching");var a=this.mediaSource;if(a){if("open"===a.readyState)try{a.endOfStream()}catch(u){p.logger.warn("onMediaDetaching:"+u.message+" while calling endOfStream")}a.removeEventListener("sourceopen",this._onMediaSourceOpen);a.removeEventListener("sourceended",this._onMediaSourceEnded);a.removeEventListener("sourceclose",this._onMediaSourceClose);this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),
this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):p.logger.warn("media.src was changed by a third party - skip cleanup"));this._objectUrl=this.media=this.mediaSource=null;this.bufferCodecEventsExpected=this._bufferCodecEventsTotal;this.pendingTracks={};this.tracks={};this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0}this.hls.trigger(q["default"].MEDIA_DETACHED)};c.checkPendingTracks=function(){var a=this.bufferCodecEventsExpected,b=this.pendingTracks,
c=Object.keys(b).length;if(c&&!a||2===c)this.createSourceBuffers(b),this.pendingTracks={},this.doAppending()};c.onBufferReset=function(){var a=this.sourceBuffer,b;for(b in a){var c=a[b];try{c&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(c),c.removeEventListener("updateend",this._onSBUpdateEnd),c.removeEventListener("error",this._onSBUpdateError))}catch(V){}}this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0};c.onBufferCodecs=function(a){var b=this;Object.keys(this.sourceBuffer).length||
(Object.keys(a).forEach(function(c){b.pendingTracks[c]=a[c]}),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())};c.createSourceBuffers=function(a){var b=this.sourceBuffer,c=this.mediaSource;if(!c)throw Error("createSourceBuffers called when mediaSource was null");for(var g in a)if(!b[g]){var d=a[g];if(!d)throw Error("source buffer exists for track "+g+", however track does not");var e=d.levelCodec||
d.codec,f=d.container+";codecs="+e;p.logger.log("creating sourceBuffer("+f+")");try{var v=b[g]=c.addSourceBuffer(f);v.addEventListener("updateend",this._onSBUpdateEnd);v.addEventListener("error",this._onSBUpdateError);this.tracks[g]={buffer:v,codec:e,id:d.id,container:d.container,levelCodec:d.levelCodec}}catch(Fb){p.logger.error("error while trying to add sourceBuffer:"+Fb.message),this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,
err:Fb,mimeType:f})}}this.hls.trigger(q["default"].BUFFER_CREATED,{tracks:this.tracks})};c.onBufferAppending=function(a){this._needsFlush||(this.segments?this.segments.push(a):this.segments=[a],this.doAppending())};c.onBufferEos=function(a){for(var b in this.sourceBuffer)if(!a.type||a.type===b){var c=this.sourceBuffer[b];c&&!c.ended&&(c.ended=!0,p.logger.log(b+" sourceBuffer now EOS"))}this.checkEos()};c.checkEos=function(){var a=this.sourceBuffer,b=this.mediaSource;if(b&&"open"===b.readyState){for(var c in a){var d=
a[c];if(d){if(!d.ended)return;if(d.updating){this._needsEos=!0;return}}}p.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{b.endOfStream()}catch(va){p.logger.warn("exception while calling mediaSource.endOfStream()")}}this._needsEos=!1};c.onBufferFlushing=function(a){a.type?this.flushRange.push({start:a.startOffset,end:a.endOffset,type:a.type}):(this.flushRange.push({start:a.startOffset,end:a.endOffset,type:"video"}),this.flushRange.push({start:a.startOffset,
end:a.endOffset,type:"audio"}));this.flushBufferCounter=0;this.doFlush()};c.flushLiveBackBuffer=function(){if(this._live){var a=this.config.liveBackBufferLength;if(isFinite(a)&&!(0>a))if(this.media){var b=this.media.currentTime,c=this.sourceBuffer,d=Object.keys(c);a=b-Math.max(a,this._levelTargetDuration);for(b=d.length-1;0<=b;b--){var e=d[b],f=c[e];if(f){var v=f.buffered;0<v.length&&a>v.start(0)&&this.removeBufferRange(e,f,0,a)&&this.hls.trigger(q["default"].LIVE_BACK_BUFFER_REACHED,{bufferEnd:a})}}}else p.logger.error("flushLiveBackBuffer called without attaching media")}};
c.onLevelUpdated=function(a){a=a.details;0<a.fragments.length&&(this._levelDuration=a.totalduration+a.fragments[0].start,this._levelTargetDuration=a.averagetargetduration||a.targetduration||10,this._live=a.live,this.updateMediaElementDuration())};c.updateMediaElementDuration=function(){var a=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(c in this.sourceBuffer){var b=this.sourceBuffer[c];
if(b&&!0===b.updating)return}var c=this.media.duration;null===this._msDuration&&(this._msDuration=this.mediaSource.duration);if(!0===this._live&&!0===a.liveDurationInfinity)p.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=Infinity;else if(this._levelDuration>this._msDuration&&this._levelDuration>c||!Object(Q.isFiniteNumber)(c))p.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=
this._levelDuration}};c.doFlush=function(){for(;this.flushRange.length;){var a=this.flushRange[0];if(this.flushBuffer(a.start,a.end,a.type))this.flushRange.shift(),this.flushBufferCounter=0;else{this._needsFlush=!0;return}}if(0===this.flushRange.length){this._needsFlush=!1;a=0;var b=this.sourceBuffer;try{for(var c in b){var d=b[c];d&&(a+=d.buffered.length)}}catch(va){p.logger.error("error while accessing sourceBuffer.buffered")}this.appended=a;this.hls.trigger(q["default"].BUFFER_FLUSHED)}};c.doAppending=
function(){var a=this.config,b=this.hls,c=this.segments,d=this.sourceBuffer;if(Object.keys(d).length)if(!this.media||this.media.error)this.segments=[],p.logger.error("trying to append although a media error occured, flush segment and abort");else if(!this.appending){var e=c.shift();if(e)try{var f=d[e.type];f?f.updating?c.unshift(e):(f.ended=!1,this.parent=e.parent,f.appendBuffer(e.data),this.appendError=0,this.appended++,this.appending=!0):this._onSBUpdateEnd()}catch(fb){p.logger.error("error while trying to append buffer:"+
fb.message),c.unshift(e),c={type:B.ErrorTypes.MEDIA_ERROR,parent:e.parent,details:"",fatal:!1},22===fb.code?(this.segments=[],c.details=B.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,c.details=B.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>a.appendErrorMaxRetry&&(p.logger.log("fail "+a.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],c.fatal=!0)),b.trigger(q["default"].ERROR,c)}}};c.flushBuffer=function(a,b,c){var g=this.sourceBuffer;if(!Object.keys(g).length)return!0;
var d="null";this.media&&(d=this.media.currentTime.toFixed(3));p.logger.log("flushBuffer,pos/start/end: "+d+"/"+a+"/"+b);if(this.flushBufferCounter>=this.appended)return p.logger.warn("abort flushing too many retries"),!0;if(g=g[c]){g.ended=!1;if(g.updating)return p.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(c,g,a,b))return this.flushBufferCounter++,!1}p.logger.log("buffer flushed");return!0};c.removeBufferRange=function(a,b,c,d){try{for(var g=0;g<b.buffered.length;g++){var e=
b.buffered.start(g),u=b.buffered.end(g),f=Math.max(e,c),v=Math.min(u,d);if(.5<Math.min(v,u)-f)return c="null",this.media&&(c=this.media.currentTime.toString()),p.logger.log("sb remove "+a+" ["+f+","+v+"], of ["+e+","+u+"], pos:"+c),b.remove(f,v),!0}}catch(pc){p.logger.warn("removeBufferRange failed",pc)}return!1};return b}(ca),Hc=function(a){function b(b){b=a.call(this,b,q["default"].FPS_DROP_LEVEL_CAPPING,q["default"].MEDIA_ATTACHING,q["default"].MANIFEST_PARSED,q["default"].LEVELS_UPDATED,q["default"].BUFFER_CODECS,
q["default"].MEDIA_DETACHING)||this;b.autoLevelCapping=Number.POSITIVE_INFINITY;b.firstLevel=null;b.levels=[];b.media=null;b.restrictedLevels=[];b.timer=null;b.clientRect=null;return b}Qa(b,a);var c=b.prototype;c.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.clientRect=this.media=null,this.stopCapping())};c.onFpsDropLevelCapping=function(a){b.isLevelAllowed(a.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(a.droppedLevel)};c.onMediaAttaching=function(a){this.media=
a.media instanceof window.HTMLVideoElement?a.media:null};c.onManifestParsed=function(a){var b=this.hls;this.restrictedLevels=[];this.levels=a.levels;this.firstLevel=a.firstLevel;b.config.capLevelToPlayerSize&&a.video&&this.startCapping()};c.onBufferCodecs=function(a){this.hls.config.capLevelToPlayerSize&&a.video&&this.startCapping()};c.onLevelsUpdated=function(a){this.levels=a.levels};c.onMediaDetaching=function(){this.stopCapping()};c.detectPlayerSize=function(){if(this.media){var a=this.levels?
this.levels.length:0;if(a){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(a-1);b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch();this.autoLevelCapping=b.autoLevelCapping}}};c.getMaxLevel=function(a){var c=this;if(!this.levels)return-1;var g=this.levels.filter(function(g,d){return b.isLevelAllowed(d,c.restrictedLevels)&&d<=a});this.clientRect=null;return b.getMaxLevelByMediaSize(g,this.mediaWidth,this.mediaHeight)};c.startCapping=function(){this.timer||(this.autoLevelCapping=
Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1E3),this.detectPlayerSize())};c.stopCapping=function(){this.restrictedLevels=[];this.firstLevel=null;this.autoLevelCapping=Number.POSITIVE_INFINITY;this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)};c.getDimensions=function(){if(this.clientRect)return this.clientRect;var a=this.media,b={width:0,height:0};if(a){var c=a.getBoundingClientRect();
b.width=c.width;b.height=c.height;b.width||b.height||(b.width=c.right-c.left||a.width||0,b.height=c.bottom-c.top||a.height||0)}return this.clientRect=b};b.isLevelAllowed=function(a,b){void 0===b&&(b=[]);return-1===b.indexOf(a)};b.getMaxLevelByMediaSize=function(a,b,c){if(!a||a&&!a.length)return-1;for(var g=a.length-1,d=0;d<a.length;d+=1){var e=a[d],f;if(f=e.width>=b||e.height>=c)f=(f=a[d+1])?e.width!==f.width||e.height!==f.height:!0;if(f){g=d;break}}return g};Pa(b,[{key:"mediaWidth",get:function(){return this.getDimensions().width*
b.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*b.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var a=1;try{a=window.devicePixelRatio}catch(u){}return a}}]);return b}(ca),Ic=window.performance,Jc=function(a){function b(b){return a.call(this,b,q["default"].MEDIA_ATTACHING)||this}Ra(b,a);var c=b.prototype;c.destroy=function(){this.timer&&clearInterval(this.timer);this.isVideoPlaybackQualityAvailable=!1};c.onMediaAttaching=function(a){var b=
this.hls.config;b.capLevelOnFPSDrop&&("function"===typeof(this.video=a.media instanceof window.HTMLVideoElement?a.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod))};c.checkFPS=function(a,b,c){a=Ic.now();if(b){if(this.lastTime){var g=c-this.lastDroppedFrames,d=b-this.lastDecodedFrames,e=1E3*g/(a-this.lastTime),f=this.hls;f.trigger(q["default"].FPS_DROP,{currentDropped:g,
currentDecoded:d,totalDroppedFrames:c});0<e&&g>f.config.fpsDroppedMonitoringThreshold*d&&(g=f.currentLevel,p.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),0<g&&(-1===f.autoLevelCapping||f.autoLevelCapping>=g)&&(--g,f.trigger(q["default"].FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:f.currentLevel}),f.autoLevelCapping=g,f.streamController.nextLevelSwitch()))}this.lastTime=a;this.lastDroppedFrames=c;this.lastDecodedFrames=b}};c.checkFPSInterval=function(){var a=this.video;
if(a)if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)};return b}(ca),Kc=function(){function a(a){a&&a.xhrSetup&&(this.xhrSetup=a.xhrSetup)}var b=a.prototype;b.destroy=function(){this.abort();this.loader=null};b.abort=function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort());window.clearTimeout(this.requestTimeout);this.requestTimeout=
null;window.clearTimeout(this.retryTimeout);this.retryTimeout=null};b.load=function(a,b,c){this.context=a;this.config=b;this.callbacks=c;this.stats={trequest:window.performance.now(),retry:0};this.retryDelay=b.retryDelay;this.loadInternal()};b.loadInternal=function(){var a=this.context;var b=this.loader=new window.XMLHttpRequest;var c=this.stats;c.tfirst=0;c.loaded=0;c=this.xhrSetup;try{if(c)try{c(b,a.url)}catch(H){b.open("GET",a.url,!0),c(b,a.url)}b.readyState||b.open("GET",a.url,!0)}catch(H){this.callbacks.onError({code:b.status,
text:H.message},a,b);return}a.rangeEnd&&b.setRequestHeader("Range","bytes="+a.rangeStart+"-"+(a.rangeEnd-1));b.onreadystatechange=this.readystatechange.bind(this);b.onprogress=this.loadprogress.bind(this);b.responseType=a.responseType;this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout);b.send()};b.readystatechange=function(a){a=a.currentTarget;var b=a.readyState,c=this.stats,d=this.context,e=this.config;!c.aborted&&2<=b&&(window.clearTimeout(this.requestTimeout),
0===c.tfirst&&(c.tfirst=Math.max(window.performance.now(),c.trequest)),4===b?(b=a.status,200<=b&&300>b?(c.tload=Math.max(c.tfirst,window.performance.now()),"arraybuffer"===d.responseType?(e=a.response,b=e.byteLength):(e=a.responseText,b=e.length),c.loaded=c.total=b,this.callbacks.onSuccess({url:a.responseURL,data:e},c,d,a)):c.retry>=e.maxRetry||400<=b&&499>b?(p.logger.error(b+" while loading "+d.url),this.callbacks.onError({code:b,text:a.statusText},d,a)):(p.logger.warn(b+" while loading "+d.url+
", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,e.maxRetryDelay),c.retry++)):this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),e.timeout))};b.loadtimeout=function(){p.logger.warn("timeout while loading "+this.context.url);this.callbacks.onTimeout(this.stats,this.context,null)};b.loadprogress=function(a){var b=a.currentTarget,c=this.stats;c.loaded=a.loaded;
a.lengthComputable&&(c.total=a.total);(a=this.callbacks.onProgress)&&a(c,this.context,null,b)};return a}(),Lc=function(a){function b(b){b=a.call(this,b,q["default"].MANIFEST_LOADING,q["default"].MANIFEST_PARSED,q["default"].AUDIO_TRACK_LOADED,q["default"].AUDIO_TRACK_SWITCHED,q["default"].LEVEL_LOADED,q["default"].ERROR)||this;b._trackId=-1;b._selectDefaultTrack=!0;b.tracks=[];b.trackIdBlacklist=Object.create(null);b.audioGroupId=null;return b}Ta(b,a);var c=b.prototype;c.onManifestLoading=function(){this.tracks=
[];this._trackId=-1;this._selectDefaultTrack=!0};c.onManifestParsed=function(a){a=this.tracks=a.audioTracks||[];this.hls.trigger(q["default"].AUDIO_TRACKS_UPDATED,{audioTracks:a});this._selectAudioGroup(this.hls.nextLoadLevel)};c.onAudioTrackLoaded=function(a){a.id>=this.tracks.length?p.logger.warn("Invalid audio track id:",a.id):(p.logger.log("audioTrack "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.hasInterval()&&this.setInterval(1E3*a.details.targetduration),!a.details.live&&
this.hasInterval()&&this.clearInterval())};c.onAudioTrackSwitched=function(a){(a=this.tracks[a.id].groupId)&&this.audioGroupId!==a&&(this.audioGroupId=a)};c.onLevelLoaded=function(a){this._selectAudioGroup(a.level)};c.onError=function(a){a.type===B.ErrorTypes.NETWORK_ERROR&&(a.fatal&&this.clearInterval(),a.details===B.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(p.logger.warn("Network failure on audio-track id:",a.context.id),this._handleLoadError()))};c._setAudioTrack=function(a){if(this._trackId===a&&
this.tracks[this._trackId].details)p.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(0>a||a>=this.tracks.length)p.logger.warn("Invalid id passed to audio-track controller");else{var b=this.tracks[a];p.logger.log("Now switching to audio-track index "+a);this.clearInterval();this._trackId=a;this.hls.trigger(q["default"].AUDIO_TRACK_SWITCHING,{id:b.id,type:b.type,url:b.url});this._loadTrackDetailsIfNeeded(b)}};c.doTick=function(){this._updateTrack(this._trackId)};
c._selectAudioGroup=function(a){(a=this.hls.levels[a])&&a.audioGroupIds&&(a=a.audioGroupIds[a.urlId],this.audioGroupId!==a&&(this.audioGroupId=a,this._selectInitialAudioTrack()))};c._selectInitialAudioTrack=function(){var a=this,b=this.tracks;if(b.length){var c=this.tracks[this._trackId],d=null;c&&(d=c.name);this._selectDefaultTrack&&(c=b.filter(function(a){return a.default}),c.length?b=c:p.logger.warn("No default audio tracks defined"));var e=!1;c=function(){b.forEach(function(b){e||a.audioGroupId&&
b.groupId!==a.audioGroupId||d&&d!==b.name||(a._setAudioTrack(b.id),e=!0)})};c();e||(d=null,c());e||(p.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}};c._needsTrackLoading=function(a){var b=a.details;a=a.url;return!b||b.live?!!a:!1};c._loadTrackDetailsIfNeeded=function(a){if(this._needsTrackLoading(a)){var b=a.url;a=a.id;p.logger.log("loading audio-track playlist for id: "+
a);this.hls.trigger(q["default"].AUDIO_TRACK_LOADING,{url:b,id:a})}};c._updateTrack=function(a){0>a||a>=this.tracks.length||(this.clearInterval(),this._trackId=a,p.logger.log("trying to update audio-track "+a),this._loadTrackDetailsIfNeeded(this.tracks[a]))};c._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var a=this._trackId,b=this.tracks[a],c=b.name,d=b.language;p.logger.warn("Loading failed on audio track id: "+a+", group-id: "+b.groupId+', name/language: "'+c+'" / "'+d+'"');
b=a;for(var e=0;e<this.tracks.length;e++)if(!this.trackIdBlacklist[e]&&this.tracks[e].name===c){b=e;break}b===a?p.logger.warn('No fallback audio-track found for name/language: "'+c+'" / "'+d+'"'):(p.logger.log("Attempting audio-track fallback id:",b,"group-id:",this.tracks[b].groupId),this._setAudioTrack(b))};Sa(b,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(a){this._setAudioTrack(a);this._selectDefaultTrack=!1}}]);return b}(Yb),
ab=window.performance,Mc=function(a){function b(b,c){var d=a.call(this,b,q["default"].MEDIA_ATTACHED,q["default"].MEDIA_DETACHING,q["default"].AUDIO_TRACKS_UPDATED,q["default"].AUDIO_TRACK_SWITCHING,q["default"].AUDIO_TRACK_LOADED,q["default"].KEY_LOADED,q["default"].FRAG_LOADED,q["default"].FRAG_PARSING_INIT_SEGMENT,q["default"].FRAG_PARSING_DATA,q["default"].FRAG_PARSED,q["default"].ERROR,q["default"].BUFFER_RESET,q["default"].BUFFER_CREATED,q["default"].BUFFER_APPENDED,q["default"].BUFFER_FLUSHED,
q["default"].INIT_PTS_FOUND)||this;d.fragmentTracker=c;d.config=b.config;d.audioCodecSwap=!1;d._state="STOPPED";d.initPTS=[];d.waitingFragment=null;d.videoTrackCC=null;d.waitingVideoCC=null;return d}Va(b,a);var c=b.prototype;c.onInitPtsFound=function(a){var b=a.frag.cc,c=a.initPTS;"main"===a.id&&(this.initPTS[b]=c,this.videoTrackCC=b,p.logger.log("InitPTS for cc: "+b+" found from main: "+c),"WAITING_INIT_PTS"===this.state&&this.tick())};c.startLoad=function(a){if(this.tracks){var b=this.lastCurrentTime;
this.stopLoad();this.setInterval(100);this.fragLoadError=0;0<b&&-1===a?(p.logger.log("audio:override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state="IDLE"):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state="STARTING");this.nextLoadPosition=this.startPosition=this.lastCurrentTime;this.tick()}else this.startPosition=a,this.state="STOPPED"};c.doTick=function(){var a=this.hls;var b=a.config;switch(this.state){case "STARTING":this.state="WAITING_TRACK";this.loadedmetadata=
!1;break;case "IDLE":var c=this.tracks;if(!c)break;if(!this.media&&(this.startFragRequested||!b.startFragPrefetch))break;if(this.loadedmetadata)var d=this.media.currentTime;else if(d=this.nextLoadPosition,void 0===d)break;var e=this.mediaBuffer?this.mediaBuffer:this.media,f=this.videoBuffer?this.videoBuffer:this.media,v=d<b.maxBufferHole?Math.max(2,b.maxBufferHole):b.maxBufferHole;e=ja.bufferInfo(e,d,v);var h=ja.bufferInfo(f,d,v),k=e.end;f=this.fragPrevious;v=this.audioSwitch;var l=this.trackId;if((e.len<
Math.max(Math.min(b.maxBufferLength,b.maxMaxBufferLength),h.len)||v)&&l<c.length)if(c=c[l].details,"undefined"===typeof c)this.state="WAITING_TRACK";else if(!v&&this._streamEnded(e,c))this.hls.trigger(q["default"].BUFFER_EOS,{type:"audio"}),this.state="ENDED";else{h=c.fragments;var t=h.length,C=h[0].start,n=h[t-1].start+h[t-1].duration;if(v)if(c.live&&!c.PTSKnown)p.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),k=0;else if(k=d,c.PTSKnown&&d<C)if(e.end>C||e.nextStart)p.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),
this.media.currentTime=C+.05;else break;if(c.initSegment&&!c.initSegment.data)var m=c.initSegment;else if(k<=C){if(m=h[0],null!==this.videoTrackCC&&m.cc!==this.videoTrackCC&&(m=ia(h,this.videoTrackCC)),c.live&&m.loadIdx&&m.loadIdx===this.fragLoadIdx){b=e.nextStart?e.nextStart:C;p.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(b+.05));this.media.currentTime=b+.05;break}}else{var r=b.maxFragLookUpTolerance;b=f?h[f.sn-h[0].sn+1]:void 0;k<n?(k>n-r&&(r=0),b=b&&
!L(k,r,b)?b:eb.search(h,function(a){return L(k,r,a)})):b=h[t-1];b&&(m=b,C=b.start,f&&m.level===f.level&&m.sn===f.sn&&(m.sn<c.endSN?(m=h[m.sn+1-c.startSN],"OK"!==this.fragmentTracker.getState(m)&&p.logger.log("SN just loaded, load next one: "+m.sn)):m=null))}if(m)if(m.encrypted)p.logger.log("Loading key for "+m.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+l),this.state="KEY_LOADING",a.trigger(q["default"].KEY_LOADING,{frag:m});else if(this.fragCurrent=m,v||"NOT_LOADED"===this.fragmentTracker.getState(m))p.logger.log("Loading "+
m.sn+", cc: "+m.cc+" of ["+c.startSN+" ,"+c.endSN+"],track "+l+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+d+", bufferEnd: "+k.toFixed(3)),"initSegment"!==m.sn&&(this.startFragRequested=!0),Object(Q.isFiniteNumber)(m.sn)&&(this.nextLoadPosition=m.start+m.duration),a.trigger(q["default"].FRAG_LOADING,{frag:m}),this.state="FRAG_LOADING"}break;case "WAITING_TRACK":(b=this.tracks[this.trackId])&&b.details&&(this.state="IDLE");break;case "FRAG_LOADING_WAITING_RETRY":b=ab.now();d=this.retryDate;
a=(e=this.media)&&e.seeking;if(!d||b>=d||a)p.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state="IDLE";break;case "WAITING_INIT_PTS":(d=this.waitingFragment)?(a=d.frag.cc,void 0!==this.initPTS[a]?(this.waitingFragment=null,this.state="FRAG_LOADING",this.onFragLoaded(d)):this.videoTrackCC!==this.waitingVideoCC?(p.logger.log("Waiting fragment cc ("+a+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment()):(m=ja.bufferInfo(this.mediaBuffer,
this.media.currentTime,b.maxBufferHole),0>L(m.end,b.maxFragLookUpTolerance,d.frag)&&(p.logger.log("Waiting fragment cc ("+a+") @ "+d.frag.start+" cancelled because another fragment at "+m.end+" is needed"),this.clearWaitingFragment()))):this.state="IDLE"}};c.clearWaitingFragment=function(){var a=this.waitingFragment;a&&(this.fragmentTracker.removeFragment(a.frag),this.waitingVideoCC=this.waitingFragment=null,this.state="IDLE")};c.onMediaAttached=function(a){a=this.media=this.mediaBuffer=a.media;this.onvseeking=
this.onMediaSeeking.bind(this);this.onvended=this.onMediaEnded.bind(this);a.addEventListener("seeking",this.onvseeking);a.addEventListener("ended",this.onvended);a=this.config;this.tracks&&a.autoStartLoad&&this.startLoad(a.startPosition)};c.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(p.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),
this.onvseeking=this.onvseeked=this.onvended=null);this.media=this.mediaBuffer=this.videoBuffer=null;this.loadedmetadata=!1;this.fragmentTracker.removeAllFragments();this.stopLoad()};c.onAudioTracksUpdated=function(a){p.logger.log("audio tracks updated");this.tracks=a.audioTracks};c.onAudioTrackSwitching=function(a){var b=!!a.url;this.trackId=a.id;this.fragCurrent=null;this.clearWaitingFragment();this.state="PAUSED";b?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null);
b&&(this.audioSwitch=!0,this.state="IDLE");this.tick()};c.onAudioTrackLoaded=function(a){var b=a.details,c=a.id,d=this.tracks[c],g=d.details;a=0;p.logger.log("track "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+b.totalduration);b.live||g&&g.live?g&&0<b.fragments.length?(W(g,b),a=b.fragments[0].start,b.PTSKnown?p.logger.log("live audio playlist sliding:"+a.toFixed(3)):p.logger.log("live audio playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,p.logger.log("live audio playlist - first load, unknown sliding")):
b.PTSKnown=!1;d.details=b;this.startFragRequested||(-1===this.startPosition&&(c=b.startTimeOffset,Object(Q.isFiniteNumber)(c)?(p.logger.log("start time offset found in playlist, adjust startPosition to "+c),this.startPosition=c):b.live?(this.startPosition=this.computeLivePosition(a,b),p.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0),this.nextLoadPosition=this.startPosition);"WAITING_TRACK"===this.state&&(this.state="IDLE");this.tick()};c.onKeyLoaded=
function(){"KEY_LOADING"===this.state&&(this.state="IDLE",this.tick())};c.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag;if("FRAG_LOADING"===this.state&&b&&"audio"===c.type&&c.level===b.level&&c.sn===b.sn){var d=this.tracks[this.trackId];c=d.details;var g=c.totalduration,e=b.level,f=b.sn,v=b.cc;d=this.config.defaultAudioCodec||d.audioCodec||"mp4a.40.2";var h=this.stats=a.stats;if("initSegment"===f)this.state="IDLE",h.tparsed=h.tbuffered=ab.now(),c.initSegment.data=a.payload,this.hls.trigger(q["default"].FRAG_BUFFERED,
{stats:h,frag:b,id:"audio"}),this.tick();else{this.state="PARSING";this.appended=!1;this.demuxer||(this.demuxer=new vb(this.hls,"audio"));h=this.initPTS[v];var k=c.initSegment?c.initSegment.data:[];void 0!==h?(this.pendingBuffering=!0,p.logger.log("Demuxing "+f+" of ["+c.startSN+" ,"+c.endSN+"],track "+e),this.demuxer.push(a.payload,k,d,null,b,g,!1,h)):(p.logger.log("Unknown video PTS for cc "+v+", waiting for video PTS before demuxing audio frag "+f+" of ["+c.startSN+" ,"+c.endSN+"],track "+e),this.waitingFragment=
a,this.waitingVideoCC=this.videoTrackCC,this.state="WAITING_INIT_PTS")}}this.fragLoadError=0};c.onFragParsingInitSegment=function(a){var b=this.fragCurrent,c=a.frag;if(b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&"PARSING"===this.state&&(b=a.tracks,b.video&&delete b.video,c=b.audio)){c.levelCodec=c.codec;c.id=a.id;this.hls.trigger(q["default"].BUFFER_CODECS,b);p.logger.log("audio track:audio,container:"+c.container+",codecs[level/parsed]=["+c.levelCodec+"/"+c.codec+"]");if(a=c.initSegment)a=
{type:"audio",data:a,parent:"audio",content:"initSegment"},this.audioSwitch?this.pendingData=[a]:(this.pendingBuffering=this.appended=!0,this.hls.trigger(q["default"].BUFFER_APPENDING,a));this.tick()}};c.onFragParsingData=function(a){var b=this,c=this.fragCurrent,d=a.frag;if(c&&"audio"===a.id&&"audio"===a.type&&d.sn===c.sn&&d.level===c.level&&"PARSING"===this.state){d=this.trackId;var g=this.tracks[d],e=this.hls;Object(Q.isFiniteNumber)(a.endPTS)||(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+
c.duration);c.addElementaryStream(ua.AUDIO);p.logger.log("parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb);R(g.details,c,a.startPTS,a.endPTS);g=this.media;c=!1;this.audioSwitch&&(g&&g.readyState?(g=g.currentTime,p.logger.log("switching audio track : currentTime:"+g),g>=a.startPTS&&(p.logger.log("switching audio track : flushing all audio"),this.state="BUFFER_FLUSHING",e.trigger(q["default"].BUFFER_FLUSHING,
{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),c=!0,this.audioSwitch=!1,e.trigger(q["default"].AUDIO_TRACK_SWITCHED,{id:d}))):(this.audioSwitch=!1,e.trigger(q["default"].AUDIO_TRACK_SWITCHED,{id:d})));var f=this.pendingData;f?(this.audioSwitch||([a.data1,a.data2].forEach(function(b){b&&b.length&&f.push({type:a.type,data:b,parent:"audio",content:"data"})}),!c&&f.length&&(f.forEach(function(a){"PARSING"===b.state&&(b.pendingBuffering=!0,b.hls.trigger(q["default"].BUFFER_APPENDING,
a))}),this.pendingData=[],this.appended=!0)),this.tick()):(p.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),e.trigger(q["default"].ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0}))}};c.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&"PARSING"===this.state&&(this.stats.tparsed=ab.now(),this.state="PARSED",this._checkAppendedParsed())};c.onBufferReset=function(){this.mediaBuffer=
this.videoBuffer=null;this.loadedmetadata=!1};c.onBufferCreated=function(a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer,this.loadedmetadata=!0);a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer)};c.onBufferAppended=function(a){if("audio"===a.parent){var b=this.state;if("PARSING"===b||"PARSED"===b)this.pendingBuffering=0<a.pending,this._checkAppendedParsed()}};c._checkAppendedParsed=function(){if(!("PARSED"!==this.state||this.appended&&this.pendingBuffering)){var a=this.fragCurrent,b=
this.stats,c=this.hls;a&&(this.fragPrevious=a,b.tbuffered=ab.now(),c.trigger(q["default"].FRAG_BUFFERED,{stats:b,frag:a,id:"audio"}),(a=this.mediaBuffer?this.mediaBuffer:this.media)&&p.logger.log("audio buffered : "+Xb.toString(a.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,c.trigger(q["default"].AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state="IDLE");this.tick()}};c.onError=function(a){var b=a.frag;if(!b||"audio"===b.type)switch(a.details){case B.ErrorDetails.FRAG_LOAD_ERROR:case B.ErrorDetails.FRAG_LOAD_TIMEOUT:if((b=
a.frag)&&"audio"!==b.type)break;if(!a.fatal){(b=this.fragLoadError)?b++:b=1;var c=this.config;b<=c.fragLoadingMaxRetry?(this.fragLoadError=b,a=Math.min(Math.pow(2,b-1)*c.fragLoadingRetryDelay,c.fragLoadingMaxRetryTimeout),p.logger.warn("AudioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=ab.now()+a,this.state="FRAG_LOADING_WAITING_RETRY"):(p.logger.error("AudioStreamController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state="ERROR")}break;
case B.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case B.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case B.ErrorDetails.KEY_LOAD_ERROR:case B.ErrorDetails.KEY_LOAD_TIMEOUT:"ERROR"!==this.state&&(this.state=a.fatal?"ERROR":"IDLE",p.logger.warn("AudioStreamController: "+a.details+" while loading frag, now switching to "+this.state+" state ..."));break;case B.ErrorDetails.BUFFER_FULL_ERROR:"audio"!==a.parent||"PARSING"!==this.state&&"PARSED"!==this.state||(a=this.mediaBuffer,b=this.media.currentTime,a&&ja.isBuffered(a,
b)&&ja.isBuffered(a,b+.5)?(a=this.config,a.maxMaxBufferLength>=a.maxBufferLength&&(a.maxMaxBufferLength/=2,p.logger.warn("AudioStreamController: reduce max buffer length to "+a.maxMaxBufferLength+"s")),this.state="IDLE"):(p.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state="BUFFER_FLUSHING",this.hls.trigger(q["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})))}};
c.onBufferFlushed=function(){var a=this,b=this.pendingData;b&&b.length?(p.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),b.forEach(function(b){a.hls.trigger(q["default"].BUFFER_APPENDING,b)}),this.appended=!0,this.pendingData=[],this.state="PARSED"):(this.state="IDLE",this.fragPrevious=null,this.tick())};Ua(b,[{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a;p.logger.log("audio stream:"+b+"->"+a)}},get:function(){return this._state}}]);
return b}(wb),bc=function(){function a(a){return"string"!==typeof a?!1:e[a.toLowerCase()]?a.toLowerCase():!1}function b(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],d;for(d in c)a[d]=c[d]}return a}function c(c,g,e){var f={enumerable:!0};this.hasBeenReset=!1;var u="",v=!1,h=c,k=g,l=e,t=null,H="",m=!0,n="auto",C="start",p=50,q="middle",r=50,V="middle";Object.defineProperty(this,"id",b({},f,{get:function(){return u},set:function(a){u=""+a}}));Object.defineProperty(this,"pauseOnExit",b({},
f,{get:function(){return v},set:function(a){v=!!a}}));Object.defineProperty(this,"startTime",b({},f,{get:function(){return h},set:function(a){if("number"!==typeof a)throw new TypeError("Start time must be set to a number.");h=a;this.hasBeenReset=!0}}));Object.defineProperty(this,"endTime",b({},f,{get:function(){return k},set:function(a){if("number"!==typeof a)throw new TypeError("End time must be set to a number.");k=a;this.hasBeenReset=!0}}));Object.defineProperty(this,"text",b({},f,{get:function(){return l},
set:function(a){l=""+a;this.hasBeenReset=!0}}));Object.defineProperty(this,"region",b({},f,{get:function(){return t},set:function(a){t=a;this.hasBeenReset=!0}}));Object.defineProperty(this,"vertical",b({},f,{get:function(){return H},set:function(a){a="string"!==typeof a?!1:d[a.toLowerCase()]?a.toLowerCase():!1;if(!1===a)throw new SyntaxError("An invalid or illegal string was specified.");H=a;this.hasBeenReset=!0}}));Object.defineProperty(this,"snapToLines",b({},f,{get:function(){return m},set:function(a){m=
!!a;this.hasBeenReset=!0}}));Object.defineProperty(this,"line",b({},f,{get:function(){return n},set:function(a){if("number"!==typeof a&&"auto"!==a)throw new SyntaxError("An invalid number or illegal string was specified.");n=a;this.hasBeenReset=!0}}));Object.defineProperty(this,"lineAlign",b({},f,{get:function(){return C},set:function(b){b=a(b);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");C=b;this.hasBeenReset=!0}}));Object.defineProperty(this,"position",b({},f,{get:function(){return p},
set:function(a){if(0>a||100<a)throw Error("Position must be between 0 and 100.");p=a;this.hasBeenReset=!0}}));Object.defineProperty(this,"positionAlign",b({},f,{get:function(){return q},set:function(b){b=a(b);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");q=b;this.hasBeenReset=!0}}));Object.defineProperty(this,"size",b({},f,{get:function(){return r},set:function(a){if(0>a||100<a)throw Error("Size must be between 0 and 100.");r=a;this.hasBeenReset=!0}}));Object.defineProperty(this,
"align",b({},f,{get:function(){return V},set:function(b){b=a(b);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");V=b;this.hasBeenReset=!0}}));this.displayState=void 0}if("undefined"!==typeof window&&window.VTTCue)return window.VTTCue;var d={"":!0,lr:!0,rl:!0},e={start:!0,middle:!0,end:!0,left:!0,right:!0};c.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)};return c}(),ic=function(){return{decode:function(a){if(!a)return"";if("string"!==
typeof a)throw Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))}}};Ja.prototype={set:function(a,b){this.get(a)||""===b||(this.values[a]=b)},get:function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},has:function(a){return a in this.values},alt:function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},integer:function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},percent:function(a,b){return b.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&
(b=parseFloat(b),0<=b&&100>=b)?(this.set(a,b),!0):!1}};var rb=new bc(0,0,0),gb="middle"===rb.align?"middle":"center";Ia.prototype={parse:function(a){function b(){var a=d.buffer,b=0;for(a=a.replace(/<br(?: \/)?>/gi,"\n");b<a.length&&"\r"!==a[b]&&"\n"!==a[b];)++b;var c=a.substr(0,b);"\r"===a[b]&&++b;"\n"===a[b]&&++b;d.buffer=a.substr(b);return c}function c(a){Ka(a,function(a,b){},/:/)}var d=this;a&&(d.buffer+=d.decoder.decode(a,{stream:!0}));try{if("INITIAL"===d.state){if(!/\r\n|\n/.test(d.buffer))return this;
var e=b();var f=e.match(/^(\u00ef\u00bb\u00bf)?WEBVTT([ \t].*)?$/);if(!f||!f[0])throw Error("Malformed WebVTT signature.");d.state="HEADER"}for(a=!1;d.buffer;){if(!/\r\n|\n/.test(d.buffer))return this;a?a=!1:e=b();switch(d.state){case "HEADER":/:/.test(e)?c(e):e||(d.state="ID");continue;case "NOTE":e||(d.state="ID");continue;case "ID":if(/^NOTE($|[ \t])/.test(e)){d.state="NOTE";break}if(!e)continue;d.cue=new bc(0,0,"");d.state="CUE";if(-1===e.indexOf("--\x3e")){d.cue.id=e;continue}case "CUE":try{Xa(e,
d.cue,d.regionList)}catch(va){d.cue=null;d.state="BADCUE";continue}d.state="CUETEXT";continue;case "CUETEXT":var h=-1!==e.indexOf("--\x3e");if(!e||h&&(a=!0)){if(d.oncue)d.oncue(d.cue);d.cue=null;d.state="ID";continue}d.cue.text&&(d.cue.text+="\n");d.cue.text+=e;continue;case "BADCUE":e||(d.state="ID")}}}catch(va){if("CUETEXT"===d.state&&d.cue&&d.oncue)d.oncue(d.cue);d.cue=null;d.state="INITIAL"===d.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{this.buffer+=this.decoder.decode();if(this.cue||
"HEADER"===this.state)this.buffer+="\n\n",this.parse();if("INITIAL"===this.state)throw Error("Malformed WebVTT signature.");}catch(La){throw La;}if(this.onflush)this.onflush();return this}};var cc={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,
156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},dc=function(a){var b=a;cc.hasOwnProperty(a)&&(b=cc[a]);return String.fromCharCode(b)},
Nc={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Oc={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Pc={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Qc={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Rc="white green blue cyan red yellow magenta black transparent".split(" "),S;(function(a){a[a.ERROR=0]="ERROR";a[a.TEXT=1]="TEXT";a[a.WARNING=2]="WARNING";a[a.INFO=2]="INFO";a[a.DEBUG=3]="DEBUG";a[a.DATA=3]="DATA"})(S||(S={}));var Sc=function(){function a(){this.time=null;this.verboseLevel=S.ERROR}a.prototype.log=function(a,
b){this.verboseLevel>=a&&p.logger.log(this.time+" ["+a+"] "+b)};return a}(),Ba=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},ec=function(){function a(a,b,c,d,e){this.flash=this.background=this.italics=this.underline=this.foreground=void 0;this.foreground=a||"white";this.underline=b||!1;this.italics=c||!1;this.background=d||"black";this.flash=e||!1}var b=a.prototype;b.reset=function(){this.foreground="white";this.italics=this.underline=!1;this.background="black";this.flash=
!1};b.setStyles=function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}};b.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash};b.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash};b.copy=function(a){this.foreground=a.foreground;
this.underline=a.underline;this.italics=a.italics;this.background=a.background;this.flash=a.flash};b.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash};return a}(),Tc=function(){function a(a,b,c,d,e,f){this.penState=this.uchar=void 0;this.uchar=a||" ";this.penState=new ec(b,c,d,e,f)}var b=a.prototype;b.reset=function(){this.uchar=" ";this.penState.reset()};b.setChar=function(a,b){this.uchar=
a;this.penState.copy(b)};b.setPenState=function(a){this.penState.copy(a)};b.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)};b.copy=function(a){this.uchar=a.uchar;this.penState.copy(a.penState)};b.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()};return a}(),Uc=function(){function a(a){this.logger=this.cueStartTime=this.currPenState=this.pos=this.chars=void 0;this.chars=[];for(var b=0;100>b;b++)this.chars.push(new Tc);this.logger=a;this.pos=0;this.currPenState=
new ec}var b=a.prototype;b.equals=function(a){for(var b=!0,c=0;100>c;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b};b.copy=function(a){for(var b=0;100>b;b++)this.chars[b].copy(a.chars[b])};b.isEmpty=function(){for(var a=!0,b=0;100>b;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a};b.setCursor=function(a){this.pos!==a&&(this.pos=a);0>this.pos?(this.logger.log(S.DEBUG,"Negative cursor position "+this.pos),this.pos=0):100<this.pos&&(this.logger.log(S.DEBUG,"Too large cursor position "+
this.pos),this.pos=100)};b.moveCursor=function(a){var b=this.pos+a;if(1<a)for(a=this.pos+1;a<b+1;a++)this.chars[a].setPenState(this.currPenState);this.setCursor(b)};b.backSpace=function(){this.moveCursor(-1);this.chars[this.pos].setChar(" ",this.currPenState)};b.insertChar=function(a){144<=a&&this.backSpace();var b=dc(a);100<=this.pos?this.logger.log(S.ERROR,"Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(b,this.currPenState),this.moveCursor(1))};
b.clearFromPos=function(a){for(;100>a;a++)this.chars[a].reset()};b.clear=function(){this.clearFromPos(0);this.pos=0;this.currPenState.reset()};b.clearToEndOfRow=function(){this.clearFromPos(this.pos)};b.getTextString=function(){for(var a=[],b=!0,c=0;100>c;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1);a.push(d)}return b?"":a.join("")};b.setPenStyles=function(a){this.currPenState.setStyles(a);this.chars[this.pos].setPenState(this.currPenState)};return a}(),yb=function(){function a(a){this.logger=this.lastOutputScreen=
this.nrRollUpRows=this.currRow=this.rows=void 0;this.rows=[];for(var b=0;15>b;b++)this.rows.push(new Uc(a));this.logger=a;this.currRow=14;this.lastOutputScreen=this.nrRollUpRows=null;this.reset()}var b=a.prototype;b.reset=function(){for(var a=0;15>a;a++)this.rows[a].clear();this.currRow=14};b.equals=function(a){for(var b=!0,c=0;15>c;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b};b.copy=function(a){for(var b=0;15>b;b++)this.rows[b].copy(a.rows[b])};b.isEmpty=function(){for(var a=!0,b=
0;15>b;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a};b.backSpace=function(){this.rows[this.currRow].backSpace()};b.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()};b.insertChar=function(a){this.rows[this.currRow].insertChar(a)};b.setPen=function(a){this.rows[this.currRow].setPenStyles(a)};b.moveCursor=function(a){this.rows[this.currRow].moveCursor(a)};b.setCursor=function(a){this.logger.log(S.INFO,"setCursor: "+a);this.rows[this.currRow].setCursor(a)};b.setPAC=function(a){this.logger.log(S.INFO,
"pacData = "+JSON.stringify(a));var b=a.row-1;this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1);if(this.nrRollUpRows&&this.currRow!==b){for(var c=0;15>c;c++)this.rows[c].clear();c=this.currRow+1-this.nrRollUpRows;var d=this.lastOutputScreen;if(d){var e=d.rows[c].cueStartTime,f=this.logger.time;if(e&&null!==f&&e<f)for(e=0;e<this.nrRollUpRows;e++)this.rows[b-this.nrRollUpRows+e+1].copy(d.rows[c+e])}}this.currRow=b;b=this.rows[this.currRow];null!==a.indent&&(c=Math.max(a.indent-1,0),
b.setCursor(a.indent),a.color=b.chars[c].penState.foreground);this.setPen({foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1})};b.setBkgData=function(a){this.logger.log(S.INFO,"bkgData = "+JSON.stringify(a));this.backSpace();this.setPen(a);this.insertChar(32)};b.setRollUpRows=function(a){this.nrRollUpRows=a};b.rollUp=function(){if(null===this.nrRollUpRows)this.logger.log(S.DEBUG,"roll_up but nrRollUpRows not set yet");else{this.logger.log(S.TEXT,this.getDisplayText());
var a=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];a.clear();this.rows.splice(this.currRow,0,a);this.logger.log(S.INFO,"Rolling up")}};b.getDisplayText=function(a){a=a||!1;for(var b=[],c="",d,e=0;15>e;e++){var f=this.rows[e].getTextString();f&&(d=e+1,a?b.push("Row "+d+": '"+f+"'"):b.push(f.trim()))}0<b.length&&(c=a?"["+b.join(" | ")+"]":b.join("\n"));return c};b.getTextAndFormat=function(){return this.rows};return a}(),fc=function(){function a(a,b,c){this.logger=this.cueStartTime=this.writeScreen=
this.currRollUpRow=this.lastOutputScreen=this.nonDisplayedMemory=this.displayedMemory=this.verbose=this.mode=this.outputFilter=this.chNr=void 0;this.chNr=a;this.outputFilter=b;this.mode=null;this.verbose=0;this.displayedMemory=new yb(c);this.nonDisplayedMemory=new yb(c);this.lastOutputScreen=new yb(c);this.currRollUpRow=this.displayedMemory.rows[14];this.writeScreen=this.displayedMemory;this.cueStartTime=this.mode=null;this.logger=c}var b=a.prototype;b.reset=function(){this.mode=null;this.displayedMemory.reset();
this.nonDisplayedMemory.reset();this.lastOutputScreen.reset();this.outputFilter.reset();this.currRollUpRow=this.displayedMemory.rows[14];this.writeScreen=this.displayedMemory;this.cueStartTime=this.mode=null};b.getHandler=function(){return this.outputFilter};b.setHandler=function(a){this.outputFilter=a};b.setPAC=function(a){this.writeScreen.setPAC(a)};b.setBkgData=function(a){this.writeScreen.setBkgData(a)};b.setMode=function(a){a!==this.mode&&(this.mode=a,this.logger.log(S.INFO,"MODE="+a),"MODE_POP-ON"===
this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)};b.insertChars=function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);this.logger.log(S.INFO,(this.writeScreen===this.displayedMemory?"DISP":"NON_DISP")+": "+this.writeScreen.getDisplayText(!0));if("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===
this.mode)this.logger.log(S.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate()};b.ccRCL=function(){this.logger.log(S.INFO,"RCL - Resume Caption Loading");this.setMode("MODE_POP-ON")};b.ccBS=function(){this.logger.log(S.INFO,"BS - BackSpace");"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())};b.ccAOF=function(){};b.ccAON=function(){};b.ccDER=function(){this.logger.log(S.INFO,"DER- Delete to End of Row");
this.writeScreen.clearToEndOfRow();this.outputDataUpdate()};b.ccRU=function(a){this.logger.log(S.INFO,"RU("+a+") - Roll Up");this.writeScreen=this.displayedMemory;this.setMode("MODE_ROLL-UP");this.writeScreen.setRollUpRows(a)};b.ccFON=function(){this.logger.log(S.INFO,"FON - Flash On");this.writeScreen.setPen({flash:!0})};b.ccRDC=function(){this.logger.log(S.INFO,"RDC - Resume Direct Captioning");this.setMode("MODE_PAINT-ON")};b.ccTR=function(){this.logger.log(S.INFO,"TR");this.setMode("MODE_TEXT")};
b.ccRTD=function(){this.logger.log(S.INFO,"RTD");this.setMode("MODE_TEXT")};b.ccEDM=function(){this.logger.log(S.INFO,"EDM - Erase Displayed Memory");this.displayedMemory.reset();this.outputDataUpdate(!0)};b.ccCR=function(){this.logger.log(S.INFO,"CR - Carriage Return");this.writeScreen.rollUp();this.outputDataUpdate(!0)};b.ccENM=function(){this.logger.log(S.INFO,"ENM - Erase Non-displayed Memory");this.nonDisplayedMemory.reset()};b.ccEOC=function(){this.logger.log(S.INFO,"EOC - End Of Caption");
if("MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory;this.writeScreen=this.nonDisplayedMemory=a;this.logger.log(S.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)};b.ccTO=function(a){this.logger.log(S.INFO,"TO("+a+") - Tab Offset");this.writeScreen.moveCursor(a)};b.ccMIDROW=function(a){var b={flash:!1};b.underline=1===a%2;b.italics=46<=a;b.foreground=b.italics?"white":"white green blue cyan red yellow magenta".split(" ")[Math.floor(a/
2)-16];this.logger.log(S.INFO,"MIDROW: "+JSON.stringify(b));this.writeScreen.setPen(b)};b.outputDataUpdate=function(a){void 0===a&&(a=!1);var b=this.logger.time;null!==b&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,b,this.lastOutputScreen),a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:b):this.cueStartTime=
b,this.lastOutputScreen.copy(this.displayedMemory))};b.cueSplitAtTime=function(a){this.outputFilter&&!this.displayedMemory.isEmpty()&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a)};return a}(),gc=function(){function a(a,b,c){this.channels=void 0;this.currentChannel=0;this.logger=this.cmdHistory=void 0;var d=new Sc;this.channels=[null,new fc(a,b,d),new fc(a+1,c,d)];this.cmdHistory={a:null,b:null};this.logger=d}var b=a.prototype;b.getHandler=
function(a){return this.channels[a].getHandler()};b.setHandler=function(a,b){this.channels[a].setHandler(b)};b.addData=function(a,b){var c=!1;this.logger.time=a;for(var d=0;d<b.length;d+=2){var e=b[d]&127;var g=b[d+1]&127;if(0!==e||0!==g){this.logger.log(S.DATA,"["+Ba([b[d],b[d+1]])+"] -> ("+Ba([e,g])+")");(a=this.parseCmd(e,g))||(a=this.parseMidrow(e,g));a||(a=this.parsePAC(e,g));a||(a=this.parseBackgroundAttributes(e,g));if(!a&&(c=this.parseChars(e,g))){var f=this.currentChannel;f&&0<f?this.channels[f].insertChars(c):
this.logger.log(S.WARNING,"No channel found yet. TEXT-MODE?")}a||c||this.logger.log(S.WARNING,"Couldn't parse cleaned data "+Ba([e,g])+" orig: "+Ba([b[d],b[d+1]]))}}};b.parseCmd=function(a,b){var c=this.cmdHistory;if(!((20===a||28===a||21===a||29===a)&&32<=b&&47>=b||(23===a||31===a)&&33<=b&&35>=b))return!1;if(c.a===a&&c.b===b)return c.a=null,c.b=null,this.logger.log(S.DEBUG,"Repeated command ("+Ba([a,b])+") is dropped"),!0;var d=20===a||21===a||23===a?1:2,e=this.channels[d];20===a||21===a||28===a||
29===a?32===b?e.ccRCL():33===b?e.ccBS():34===b?e.ccAOF():35===b?e.ccAON():36===b?e.ccDER():37===b?e.ccRU(2):38===b?e.ccRU(3):39===b?e.ccRU(4):40===b?e.ccFON():41===b?e.ccRDC():42===b?e.ccTR():43===b?e.ccRTD():44===b?e.ccEDM():45===b?e.ccCR():46===b?e.ccENM():47===b&&e.ccEOC():e.ccTO(b-32);c.a=a;c.b=b;this.currentChannel=d;return!0};b.parseMidrow=function(a,b){if((17===a||25===a)&&32<=b&&47>=b){var c=17===a?1:2;if(c!==this.currentChannel)return this.logger.log(S.ERROR,"Mismatch channel in midrow parsing"),
!1;c=this.channels[c];if(!c)return!1;c.ccMIDROW(b);this.logger.log(S.DEBUG,"MIDROW ("+Ba([a,b])+")");return!0}return!1};b.parsePAC=function(a,b){var c=this.cmdHistory;if(!((17<=a&&23>=a||25<=a&&31>=a)&&64<=b&&127>=b||(16===a||24===a)&&64<=b&&95>=b))return!1;if(c.a===a&&c.b===b)return c.a=null,c.b=null,!0;var d=23>=a?1:2,e=this.channels[d];if(!e)return!1;e.setPAC(this.interpretPAC(64<=b&&95>=b?1===d?Nc[a]:Pc[a]:1===d?Oc[a]:Qc[a],b));c.a=a;c.b=b;this.currentChannel=d;return!0};b.interpretPAC=function(a,
b){a={color:null,italics:!1,indent:null,underline:!1,row:a};b=95<b?b-96:b-64;a.underline=1===(b&1);13>=b?a.color="white green blue cyan red yellow magenta white".split(" ")[Math.floor(b/2)]:15>=b?(a.italics=!0,a.color="white"):a.indent=4*Math.floor((b-16)/2);return a};b.parseChars=function(a,b){var c=null;if(25<=a){var d=2;var e=a-8}else d=1,e=a;17<=e&&19>=e?(c=17===e?b+80:18===e?b+112:b+144,this.logger.log(S.INFO,"Special char '"+dc(c)+"' in channel "+d),c=[c]):32<=a&&127>=a&&(c=0===b?[a]:[a,b]);
c&&(d=Ba(c),this.logger.log(S.DEBUG,"Char codes =  "+d.join(",")),d=this.cmdHistory,d.a=a,d.b=b);return c};b.parseBackgroundAttributes=function(a,b){if(!((16===a||24===a)&&32<=b&&47>=b||(23===a||31===a)&&45<=b&&47>=b))return!1;var c={};if(16===a||24===a){var d=Math.floor((b-32)/2);c.background=Rc[d];1===b%2&&(c.background+="_semi")}else 45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0));this.channels[23>=a?1:2].setBkgData(c);d=this.cmdHistory;d.a=a;d.b=b;return!0};b.reset=
function(){for(var a=0;a<Object.keys(this.channels).length;a++){var b=this.channels[a];b&&b.reset()}this.cmdHistory={a:null,b:null}};b.cueSplitAtTime=function(a){for(var b=0;b<this.channels.length;b++){var c=this.channels[b];c&&c.cueSplitAtTime(a)}};return a}(),jb=function(){function a(a,b){this.timelineController=void 0;this.cueRanges=[];this.trackName=void 0;this.screen=this.endTime=this.startTime=null;this.timelineController=a;this.trackName=b}var b=a.prototype;b.dispatchCue=function(){null!==
this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)};b.newCue=function(a,b,c){if(null===this.startTime||this.startTime>a)this.startTime=a;this.endTime=b;this.screen=c;this.timelineController.createCaptionsTrack(this.trackName)};b.reset=function(){this.cueRanges=[]};return a}(),zb=function(a,b,c){return a.substr(c||0,b.length)===b},Vc=function(a){var b=parseInt(a.substr(-3)),c=parseInt(a.substr(-6,2)),d=parseInt(a.substr(-9,
2)),e=9<a.length?parseInt(a.substr(0,a.indexOf(":"))):0;if(!(Object(Q.isFiniteNumber)(b)&&Object(Q.isFiniteNumber)(c)&&Object(Q.isFiniteNumber)(d)&&Object(Q.isFiniteNumber)(e)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+a);return b=b+1E3*c+6E4*d+36E5*e},Ab=function(a){for(var b=5381,c=a.length;c;)b=33*b^a.charCodeAt(--c);return(b>>>0).toString()},Wc={parse:function(a,b,c,d,e,f){a=Object(xb.utf8ArrayToStr)(new Uint8Array(a)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n");var g="00:00.000",
h=0,u=0,k=0,l=[],t,m=!0,v=!1,n=new Ia;n.oncue=function(a){var b=c[d],e=c.ccOffset;if(b&&b.new)if(void 0!==u)e=c.ccOffset=b.start;else{b=k;var g=c[d],f=c[g.prevCC];if(!f||!f.new&&g.new)c.ccOffset=c.presentationOffset=g.start,g.new=!1;else{for(;f&&f.new;)c.ccOffset+=g.start-f.start,g.new=!1,g=f,f=c[g.prevCC];c.presentationOffset=b}}k&&(e=k-c.presentationOffset);v&&(a.startTime+=e-u,a.endTime+=e-u);a.id=Ab(a.startTime.toString())+Ab(a.endTime.toString())+Ab(a.text);a.text=decodeURIComponent(encodeURIComponent(a.text));
0<a.endTime&&l.push(a)};n.onparsingerror=function(a){t=a};n.onflush=function(){t&&f?f(t):e(l)};a.forEach(function(a){if(m){if(zb(a,"X-TIMESTAMP-MAP=")){m=!1;v=!0;a.substr(16).split(",").forEach(function(a){zb(a,"LOCAL:")?g=a.substr(6):zb(a,"MPEGTS:")&&(h=parseInt(a.substr(7)))});try{0>b+(9E4*c[d].start||0)&&(b+=8589934592),h-=b,u=Vc(g)/1E3,k=h/9E4}catch(qc){v=!1,t=qc}return}""===a&&(m=!1)}n.parse(a+"\n")});n.flush()}},Xc=function(a){function b(b){var c=a.call(this,b,q["default"].MEDIA_ATTACHING,q["default"].MEDIA_DETACHING,
q["default"].FRAG_PARSING_USERDATA,q["default"].FRAG_DECRYPTED,q["default"].MANIFEST_LOADING,q["default"].MANIFEST_LOADED,q["default"].FRAG_LOADED,q["default"].INIT_PTS_FOUND)||this;c.media=null;c.config=void 0;c.enabled=!0;c.Cues=void 0;c.textTracks=[];c.tracks=[];c.initPTS=[];c.unparsedVttFrags=[];c.captionsTracks={};c.nonNativeCaptionsTracks={};c.captionsProperties=void 0;c.cea608Parser1=void 0;c.cea608Parser2=void 0;c.lastSn=-1;c.prevCC=-1;c.vttCCs=Wa();c.hls=b;c.config=b.config;c.Cues=b.config.cueHandler;
c.captionsProperties={textTrack1:{label:c.config.captionsTextTrack1Label,languageCode:c.config.captionsTextTrack1LanguageCode},textTrack2:{label:c.config.captionsTextTrack2Label,languageCode:c.config.captionsTextTrack2LanguageCode},textTrack3:{label:c.config.captionsTextTrack3Label,languageCode:c.config.captionsTextTrack3LanguageCode},textTrack4:{label:c.config.captionsTextTrack4Label,languageCode:c.config.captionsTextTrack4LanguageCode}};if(c.config.enableCEA708Captions){b=new jb(db(c),"textTrack1");
var d=new jb(db(c),"textTrack2"),e=new jb(db(c),"textTrack3"),g=new jb(db(c),"textTrack4");c.cea608Parser1=new gc(1,b,d);c.cea608Parser2=new gc(3,e,g)}return c}bb(b,a);var c=b.prototype;c.addCues=function(a,b,c,d,e){for(var g=!1,f=e.length;f--;){var h=e[f],u=Math.min(h[1],c)-Math.max(h[0],b);if(0<=u&&(h[0]=Math.min(h[0],b),h[1]=Math.max(h[1],c),g=!0,.5<u/(c-b)))return}g||e.push([b,c]);this.config.renderTextTracksNatively?this.Cues.newCue(this.captionsTracks[a],b,c,d):(b=this.Cues.newCue(null,b,c,
d),this.hls.trigger(q["default"].CUES_PARSED,{type:"captions",cues:b,track:a}))};c.onInitPtsFound=function(a){var b=this,c=a.frag,d=a.initPTS,e=this.unparsedVttFrags;"main"===a.id&&(this.initPTS[c.cc]=d);e.length&&(this.unparsedVttFrags=[],e.forEach(function(a){b.onFragLoaded(a)}))};c.getExistingTrack=function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c];if(d[a])return d}return null};c.createCaptionsTrack=function(a){this.config.renderTextTracksNatively?this.createNativeTrack(a):
this.createNonNativeTrack(a)};c.createNativeTrack=function(a){if(!this.captionsTracks[a]){var b=this.captionsTracks,c=this.media,d=this.captionsProperties[a],e=d.label;d=d.languageCode;var g=this.getExistingTrack(a);if(g)b[a]=g,qa(b[a]),sa(b[a],c);else if(c=this.createTextTrack("captions",e,d))c[a]=!0,b[a]=c}};c.createNonNativeTrack=function(a){if(!this.nonNativeCaptionsTracks[a]){var b=this.captionsProperties[a];b&&(b={_id:a,label:b.label,kind:"captions",default:b.media?!!b.media.default:!1,closedCaptions:b.media},
this.nonNativeCaptionsTracks[a]=b,this.hls.trigger(q["default"].NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[b]}))}};c.createTextTrack=function(a,b,c){var d=this.media;if(d)return d.addTextTrack(a,b,c)};c.destroy=function(){a.prototype.destroy.call(this)};c.onMediaAttaching=function(a){this.media=a.media;this._cleanTracks()};c.onMediaDetaching=function(){var a=this.captionsTracks;Object.keys(a).forEach(function(b){qa(a[b]);delete a[b]});this.nonNativeCaptionsTracks={}};c.onManifestLoading=function(){this.prevCC=
this.lastSn=-1;this.vttCCs=Wa();this._cleanTracks();this.tracks=[];this.captionsTracks={};this.nonNativeCaptionsTracks={}};c._cleanTracks=function(){var a=this.media;if(a&&(a=a.textTracks))for(var b=0;b<a.length;b++)qa(a[b])};c.onManifestLoaded=function(a){var b=this;this.textTracks=[];this.unparsedVttFrags=this.unparsedVttFrags||[];this.initPTS=[];this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset());if(this.config.enableWebVTT){var c=a.subtitles||[];c=this.tracks&&
c&&this.tracks.length===c.length;this.tracks=a.subtitles||[];if(this.config.renderTextTracksNatively){var d=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,c){var e;if(c<d.length){c=null;for(var g=0;g<d.length;g++){var f=d[g];if(f&&f.label===a.name&&!f.textTrack1&&!f.textTrack2){c=d[g];break}}c&&(e=c)}e||(e=b.createTextTrack("subtitles",a.name,a.lang));e.mode=a.default?b.hls.subtitleDisplay?"showing":"hidden":"disabled";b.textTracks.push(e)})}else!c&&this.tracks&&this.tracks.length&&
(c=this.tracks.map(function(a){return{label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}}),this.hls.trigger(q["default"].NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:c}))}this.config.enableCEA708Captions&&a.captions&&a.captions.forEach(function(a){var c=/(?:CC|SERVICE)([1-4])/.exec(a.instreamId);c&&(c=b.captionsProperties["textTrack"+c[1]])&&(c.label=a.name,a.lang&&(c.languageCode=a.lang),c.media=a)})};c.onFragLoaded=function(a){var b=a.frag,c=a.payload,d=this.cea608Parser1,e=this.cea608Parser2,
g=this.initPTS,f=this.lastSn,h=this.unparsedVttFrags;"main"===b.type?(c=b.sn,b.sn!==f+1&&d&&e&&(d.reset(),e.reset()),this.lastSn=c):"subtitle"===b.type&&(c.byteLength?Object(Q.isFiniteNumber)(g[b.cc])?(d=b.decryptdata,null!=d&&null!=d.key&&"AES-128"===d.method||this._parseVTTs(b,c)):(h.push(a),g.length&&this.hls.trigger(q["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b})):this.hls.trigger(q["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b}))};c._parseVTTs=function(a,b){var c=this,d=this.hls,
e=this.prevCC,g=this.textTracks,f=this.vttCCs;f[a.cc]||(f[a.cc]={start:a.start,prevCC:e,new:!0},this.prevCC=a.cc);Wc.parse(b,this.initPTS[a.cc],f,a.cc,function(b){if(c.config.renderTextTracksNatively){var e=g[a.level];if("disabled"===e.mode){d.trigger(q["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a});return}b.forEach(function(a){if(!e.cues.getCueById(a.id))try{if(e.addCue(a),!e.cues.getCueById(a.id))throw Error("addCue is failed for: "+a);}catch(rc){p.logger.debug("Failed occurred on adding cues: "+
rc);var b=new window.TextTrackCue(a.startTime,a.endTime,a.text);b.id=a.id;e.addCue(b)}})}else d.trigger(q["default"].CUES_PARSED,{type:"subtitles",cues:b,track:c.tracks[a.level].default?"default":"subtitles"+a.level});d.trigger(q["default"].SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(b){p.logger.log("Failed to parse VTT cue: "+b);d.trigger(q["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a})})};c.onFragDecrypted=function(a){var b=a.frag,c=a.payload;"subtitle"===b.type&&(Object(Q.isFiniteNumber)(this.initPTS[b.cc])?
this._parseVTTs(b,c):this.unparsedVttFrags.push(a))};c.onFragParsingUserdata=function(a){var b=this.cea608Parser1,c=this.cea608Parser2;if(this.enabled&&b&&c)for(var d=0;d<a.samples.length;d++){var e=a.samples[d].bytes;e&&(e=this.extractCea608Data(e),b.addData(a.samples[d].pts,e[0]),c.addData(a.samples[d].pts,e[1]))}};c.extractCea608Data=function(a){for(var b=a[0]&31,c=2,d=[[],[]],e=0;e<b;e++){var g=a[c++],f=127&a[c++],h=127&a[c++],k=3&g;0===f&&0===h||0===(4&g)||0!==k&&1!==k||(d[k].push(f),d[k].push(h))}return d};
return b}(ca),Yc=function(a){function b(b){b=a.call(this,b,q["default"].MEDIA_ATTACHED,q["default"].MEDIA_DETACHING,q["default"].MANIFEST_LOADED,q["default"].SUBTITLE_TRACK_LOADED)||this;b.tracks=[];b.trackId=-1;b.media=null;b.stopped=!0;b.subtitleDisplay=!0;b.queuedDefaultTrack=null;return b}lb(b,a);var c=b.prototype;c.destroy=function(){ca.prototype.destroy.call(this)};c.onMediaAttached=function(a){var b=this;if(this.media=a.media)Object(Q.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=
this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),(this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks))?this.subtitlePollingInterval=setInterval(function(){b.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener)};c.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",
this.trackChangeListener),Object(Q.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),sb(this.media.textTracks).forEach(function(a){qa(a)}),this.subtitleTrack=-1,this.media=null)};c.onManifestLoaded=function(a){var b=this;this.tracks=a=a.subtitles||[];this.hls.trigger(q["default"].SUBTITLE_TRACKS_UPDATED,{subtitleTracks:a});a.forEach(function(a){a.default&&(b.media?b.subtitleTrack=a.id:b.queuedDefaultTrack=a.id)})};c.onSubtitleTrackLoaded=function(a){var b=this,c=a.id,
d=a.details,e=this.trackId,g=this.tracks,f=g[e];c>=g.length||c!==e||!f||this.stopped?this._clearReloadTimer():(p.logger.log("subtitle track "+c+" loaded"),d.live?(a=ba(f.details,d,a.stats.trequest),p.logger.log("Reloading live subtitle playlist in "+a+"ms"),this.timer=setTimeout(function(){b._loadCurrentTrack()},a)):this._clearReloadTimer())};c.startLoad=function(){this.stopped=!1;this._loadCurrentTrack()};c.stopLoad=function(){this.stopped=!0;this._clearReloadTimer()};c._clearReloadTimer=function(){this.timer&&
(clearTimeout(this.timer),this.timer=null)};c._loadCurrentTrack=function(){var a=this.trackId,b=this.hls,c=this.tracks[a];0>a||!c||c.details&&!c.details.live||(p.logger.log("Loading subtitle track "+a),b.trigger(q["default"].SUBTITLE_TRACK_LOADING,{url:c.url,id:a}))};c._toggleTrackModes=function(a){var b=this.media,c=this.subtitleDisplay,d=this.trackId;if(b){b=sb(b.textTracks);if(-1===a)[].slice.call(b).forEach(function(a){a.mode="disabled"});else if(d=b[d])d.mode="disabled";if(a=b[a])a.mode=c?"showing":
"hidden"}};c._setSubtitleTrackInternal=function(a){var b=this.hls,c=this.tracks;!Object(Q.isFiniteNumber)(a)||-1>a||a>=c.length||(this.trackId=a,p.logger.log("Switching to subtitle track "+a),b.trigger(q["default"].SUBTITLE_TRACK_SWITCH,{id:a}),this._loadCurrentTrack())};c._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var a=-1,b=sb(this.media.textTracks),c=0;c<b.length;c++)if("hidden"===b[c].mode)a=c;else if("showing"===b[c].mode){a=c;break}this.subtitleTrack=
a}};cb(b,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.trackId!==a&&(this._toggleTrackModes(a),this._setSubtitleTrackInternal(a))}}]);return b}(ca),Zc=e("./src/crypt/decrypter.js"),hc=window.performance,$c=function(a){function b(b,c){var d=a.call(this,b,q["default"].MEDIA_ATTACHED,q["default"].MEDIA_DETACHING,q["default"].ERROR,q["default"].KEY_LOADED,q["default"].FRAG_LOADED,q["default"].SUBTITLE_TRACKS_UPDATED,
q["default"].SUBTITLE_TRACK_SWITCH,q["default"].SUBTITLE_TRACK_LOADED,q["default"].SUBTITLE_FRAG_PROCESSED,q["default"].LEVEL_UPDATED)||this;d.fragmentTracker=c;d.config=b.config;d.state="STOPPED";d.tracks=[];d.tracksBuffered=[];d.currentTrackId=-1;d.decrypter=new Zc["default"](b,b.config);d.lastAVStart=0;d._onMediaSeeking=d.onMediaSeeking.bind(mb(d));return d}nb(b,a);var c=b.prototype;c.startLoad=function(){this.stopLoad();this.state="IDLE";var a=this.tracks[this.currentTrackId];a&&a.details&&(this.setInterval(500),
this.tick())};c.onSubtitleFragProcessed=function(a){var b=a.frag;a=a.success;this.fragPrevious=b;this.state="IDLE";if(a&&(a=this.tracksBuffered[this.currentTrackId])){for(var c,d=b.start,e=0;e<a.length;e++)if(d>=a[e].start&&d<=a[e].end){c=a[e];break}b=b.start+b.duration;c?c.end=b:(c={start:d,end:b},a.push(c))}};c.onMediaAttached=function(a){this.media=a=a.media;a.addEventListener("seeking",this._onMediaSeeking);this.state="IDLE"};c.onMediaDetaching=function(){var a=this;this.media&&(this.media.removeEventListener("seeking",
this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach(function(b){a.tracksBuffered[b.id]=[]}),this.media=null,this.state="STOPPED")};c.onError=function(a){(a=a.frag)&&"subtitle"===a.type&&(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state="IDLE")};c.onSubtitleTracksUpdated=function(a){var b=this;p.logger.log("subtitle tracks updated");this.tracksBuffered=[];this.tracks=a.subtitleTracks;this.tracks.forEach(function(a){b.tracksBuffered[a.id]=
[]})};c.onSubtitleTrackSwitch=function(a){this.currentTrackId=a.id;this.tracks&&this.tracks.length&&-1!==this.currentTrackId?(a=this.tracks[this.currentTrackId])&&a.details&&this.setInterval(500):this.clearInterval()};c.onSubtitleTrackLoaded=function(a){var b=a.id;a=a.details;var c=this.currentTrackId,d=this.tracks,e=d[c];b>=d.length||b!==c||!e||(a.live&&Y(e.details,a,this.lastAVStart),e.details=a,this.setInterval(500))};c.onKeyLoaded=function(){"KEY_LOADING"===this.state&&(this.state="IDLE")};c.onFragLoaded=
function(a){var b=this.fragCurrent,c=a.frag.decryptdata,d=a.frag,e=this.hls;if("FRAG_LOADING"===this.state&&b&&"subtitle"===a.frag.type&&b.sn===a.frag.sn&&0<a.payload.byteLength&&c&&c.key&&"AES-128"===c.method){var f=hc.now();this.decrypter.decrypt(a.payload,c.key.buffer,c.iv.buffer,function(a){var b=hc.now();e.trigger(q["default"].FRAG_DECRYPTED,{frag:d,payload:a,stats:{tstart:f,tdecrypt:b}})})}};c.onLevelUpdated=function(a){a=a.details.fragments;this.lastAVStart=a.length?a[0].start:0};c.doTick=
function(){if(this.media)switch(this.state){case "IDLE":var a=this.config,b=this.currentTrackId,c=this.fragmentTracker,d=this.media,e=this.tracks;if(e&&e[b]&&e[b].details){var f=a.maxBufferHole,h=a.maxFragLookUpTolerance;a=Math.min(a.maxBufferLength,a.maxMaxBufferLength);f=ja.bufferedInfo(this._getBuffered(),d.currentTime,f);d=f.end;b=e[b].details;e=b.fragments;var k=e.length;if(!(f.len>a)){var l;a=this.fragPrevious;d<e[k-1].start+e[k-1].duration?(a&&b.hasProgramDateTime&&(l=ka(e,a.endProgramDateTime,
h)),l||(l=M(a,e,d,h))):l=e[k-1];l&&l.encrypted?(p.logger.log("Loading key for "+l.sn),this.state="KEY_LOADING",this.hls.trigger(q["default"].KEY_LOADING,{frag:l})):l&&"NOT_LOADED"===c.getState(l)&&(this.fragCurrent=l,this.state="FRAG_LOADING",this.hls.trigger(q["default"].FRAG_LOADING,{frag:l}))}}}else this.state="IDLE"};c.stopLoad=function(){this.lastAVStart=0;this.fragPrevious=null;a.prototype.stopLoad.call(this)};c._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]};c.onMediaSeeking=
function(){if(this.fragCurrent){var a=this.media?this.media.currentTime:0,b=this.config.maxFragLookUpTolerance,c=this.fragCurrent.start+this.fragCurrent.duration+b;if(a<this.fragCurrent.start-b||a>c)this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragPrevious=this.fragCurrent=null,this.state="IDLE",this.tick()}};return b}(wb),Oa;(function(a){a.WIDEVINE="com.widevine.alpha";a.PLAYREADY="com.microsoft.playready"})(Oa||(Oa={}));var ad=
"undefined"!==typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;var bd=function(a,b,c){var d={audioCapabilities:[],videoCapabilities:[]};a.forEach(function(a){d.audioCapabilities.push({contentType:'audio/mp4; codecs="'+a+'"',robustness:c.audioRobustness||""})});b.forEach(function(a){d.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"',robustness:c.videoRobustness||""})});return[d]},cd=
function(a,b,c,d){switch(a){case Oa.WIDEVINE:return bd(b,c,d);default:throw Error("Unknown key-system: "+a);}},dd=function(a){function b(b){var c=a.call(this,b,q["default"].MEDIA_ATTACHED,q["default"].MEDIA_DETACHED,q["default"].MANIFEST_PARSED)||this;c._widevineLicenseUrl=void 0;c._licenseXhrSetup=void 0;c._emeEnabled=void 0;c._requestMediaKeySystemAccess=void 0;c._drmSystemOptions=void 0;c._config=void 0;c._mediaKeysList=[];c._media=null;c._hasSetMediaKeys=!1;c._requestLicenseFailureCount=0;c.mediaKeysPromise=
null;c._onMediaEncrypted=function(a){p.logger.log('Media is encrypted using "'+a.initDataType+'" init data type');if(c.mediaKeysPromise){var b=function(b){c._media&&(c._attemptSetMediaKeys(b),c._generateRequestWithPreferredKeySession(a.initDataType,a.initData))};c.mediaKeysPromise.then(b).catch(b)}else p.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),c.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.KEY_SYSTEM_ERROR,details:B.ErrorDetails.KEY_SYSTEM_NO_KEYS,
fatal:!0})};c._config=b.config;c._widevineLicenseUrl=c._config.widevineLicenseUrl;c._licenseXhrSetup=c._config.licenseXhrSetup;c._emeEnabled=c._config.emeEnabled;c._requestMediaKeySystemAccess=c._config.requestMediaKeySystemAccessFunc;c._drmSystemOptions=b.config.drmSystemOptions;return c}pb(b,a);var c=b.prototype;c.getLicenseServerUrl=function(a){switch(a){case Oa.WIDEVINE:if(this._widevineLicenseUrl)return this._widevineLicenseUrl}throw Error('no license server URL configured for key-system "'+
a+'"');};c._attemptKeySystemAccess=function(a,b,c){var d=this;b=cd(a,b,c,this._drmSystemOptions);p.logger.log("Requesting encrypted media key-system access");b=this.requestMediaKeySystemAccess(a,b);this.mediaKeysPromise=b.then(function(b){return d._onMediaKeySystemAccessObtained(a,b)});b.catch(function(b){p.logger.error('Failed to obtain key-system "'+a+'" access:',b)})};c._onMediaKeySystemAccessObtained=function(a,b){var c=this;p.logger.log('Access for key-system "'+a+'" obtained');var d={mediaKeysSessionInitialized:!1,
mediaKeySystemAccess:b,mediaKeySystemDomain:a};this._mediaKeysList.push(d);var e=Promise.resolve().then(function(){return b.createMediaKeys()}).then(function(b){d.mediaKeys=b;p.logger.log('Media-keys created for key-system "'+a+'"');c._onMediaKeysCreated();return b});e.catch(function(a){p.logger.error("Failed to create media-keys:",a)});return e};c._onMediaKeysCreated=function(){var a=this;this._mediaKeysList.forEach(function(b){b.mediaKeysSession||(b.mediaKeysSession=b.mediaKeys.createSession(),
a._onNewMediaKeySession(b.mediaKeysSession))})};c._onNewMediaKeySession=function(a){var b=this;p.logger.log("New key-system session "+a.sessionId);a.addEventListener("message",function(c){b._onKeySessionMessage(a,c.message)},!1)};c._onKeySessionMessage=function(a,b){p.logger.log("Got EME message event, creating license request");this._requestLicense(b,function(b){p.logger.log("Received license data (length: "+(b?b.byteLength:b)+"), updating key-session");a.update(b)})};c._attemptSetMediaKeys=function(a){if(!this._media)throw Error("Attempted to set mediaKeys without first attaching a media element");
this._hasSetMediaKeys||((a=this._mediaKeysList[0])&&a.mediaKeys?(p.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(a.mediaKeys),this._hasSetMediaKeys=!0):(p.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.KEY_SYSTEM_ERROR,details:B.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0})))};c._generateRequestWithPreferredKeySession=function(a,b){var c=this,d=this._mediaKeysList[0];if(d)if(d.mediaKeysSessionInitialized)p.logger.warn("Key-Session already initialized but requested again");
else{var e=d.mediaKeysSession;e?b?(p.logger.log('Generating key-session request for "'+a+'" init data type'),d.mediaKeysSessionInitialized=!0,e.generateRequest(a,b).then(function(){p.logger.debug("Key-session generation succeeded")}).catch(function(a){p.logger.error("Error generating key-session request:",a);c.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.KEY_SYSTEM_ERROR,details:B.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})):(p.logger.warn("Fatal: initData required for generating a key session is null"),
this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.KEY_SYSTEM_ERROR,details:B.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0})):(p.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.KEY_SYSTEM_ERROR,details:B.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}))}else p.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.KEY_SYSTEM_ERROR,
details:B.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0})};c._createLicenseXhr=function(a,b,c){var d=new XMLHttpRequest,e=this._licenseXhrSetup;try{if(e)try{e(d,a)}catch(Eb){d.open("POST",a,!0),e(d,a)}d.readyState||d.open("POST",a,!0)}catch(Eb){throw Error("issue setting up KeySystem license XHR "+Eb);}d.responseType="arraybuffer";d.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,d,a,b,c);return d};c._onLicenseRequestReadyStageChange=function(a,b,c,d){switch(a.readyState){case 4:200===
a.status?(this._requestLicenseFailureCount=0,p.logger.log("License request succeeded"),"arraybuffer"!==a.responseType&&p.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),d(a.response)):(p.logger.error("License Request XHR failed ("+b+"). Status: "+a.status+" ("+a.statusText+")"),this._requestLicenseFailureCount++,3<this._requestLicenseFailureCount?this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.KEY_SYSTEM_ERROR,details:B.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,
fatal:!0}):(p.logger.warn("Retrying license request, "+(3-this._requestLicenseFailureCount+1)+" attempts left"),this._requestLicense(c,d)))}};c._generateLicenseRequestChallenge=function(a,b){switch(a.mediaKeySystemDomain){case Oa.WIDEVINE:return b}throw Error("unsupported key-system: "+a.mediaKeySystemDomain);};c._requestLicense=function(a,b){p.logger.log("Requesting content license for key-system");var c=this._mediaKeysList[0];if(c)try{var d=this.getLicenseServerUrl(c.mediaKeySystemDomain),e=this._createLicenseXhr(d,
a,b);p.logger.log("Sending license request to URL: "+d);var f=this._generateLicenseRequestChallenge(c,a);e.send(f)}catch(fb){p.logger.error("Failure requesting DRM license: "+fb),this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.KEY_SYSTEM_ERROR,details:B.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}else p.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(q["default"].ERROR,{type:B.ErrorTypes.KEY_SYSTEM_ERROR,details:B.ErrorDetails.KEY_SYSTEM_NO_ACCESS,
fatal:!0})};c.onMediaAttached=function(a){this._emeEnabled&&(this._media=a=a.media,a.addEventListener("encrypted",this._onMediaEncrypted))};c.onMediaDetached=function(){var a=this._media,b=this._mediaKeysList;a&&(a.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(b.map(function(a){if(a.mediaKeysSession)return a.mediaKeysSession.close().catch(function(){})})).then(function(){return a.setMediaKeys(null)}).catch(function(){}))};c.onManifestParsed=
function(a){if(this._emeEnabled){var b=a.levels.map(function(a){return a.audioCodec});a=a.levels.map(function(a){return a.videoCodec});this._attemptKeySystemAccess(Oa.WIDEVINE,b,a)}};ob(b,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]);return b}(ca),ed=Ib(Ib({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,
capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6E7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:Infinity,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1E4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1E3,
manifestLoadingMaxRetryTimeout:64E3,startLevel:void 0,levelLoadingTimeOut:1E4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1E3,levelLoadingMaxRetryTimeout:64E3,fragLoadingTimeOut:2E4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1E3,fragLoadingMaxRetryTimeout:64E3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5E3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Kc,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Fc,bufferController:Gc,capLevelController:Hc,
fpsController:Jc,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5E5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:ad,testBandwidth:!0},{cueHandler:tb,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",
captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:$c,subtitleTrackController:Yc,timelineController:Xc,audioStreamController:Mc,audioTrackController:Lc,emeController:dd}),Nb=function(a){function b(c){void 0===c&&(c={});var d=a.call(this)||this;d.config=
void 0;d._autoLevelCapping=void 0;d.abrController=void 0;d.capLevelController=void 0;d.levelController=void 0;d.streamController=void 0;d.networkControllers=void 0;d.audioTrackController=void 0;d.subtitleTrackController=void 0;d.emeController=void 0;d.coreComponents=void 0;d.media=null;d.url=null;var e=b.DefaultConfig;if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");
d.config=Kb(Kb({},e),c);c=ea(d).config;if(void 0!==c.liveMaxLatencyDurationCount&&c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount)throw Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==c.liveMaxLatencyDuration&&(void 0===c.liveSyncDuration||c.liveMaxLatencyDuration<=c.liveSyncDuration))throw Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(p.enableLogs)(c.debug);d._autoLevelCapping=-1;var f=
d.abrController=new c.abrController(ea(d)),g=new c.bufferController(ea(d)),h=d.capLevelController=new c.capLevelController(ea(d)),k=new c.fpsController(ea(d)),l=new sc(ea(d)),t=new tc(ea(d)),m=new uc(ea(d)),n=new Cc(ea(d)),q=d.levelController=new Bc(ea(d));e=new vc(ea(d));var r=d.streamController=new Ac(ea(d),e);q=[q,r];(r=c.audioStreamController)&&q.push(new r(ea(d),e));d.networkControllers=q;f=[l,t,m,f,g,h,k,n,e];if(r=c.audioTrackController)g=new r(ea(d)),d.audioTrackController=g,f.push(g);if(r=
c.subtitleTrackController)g=new r(ea(d)),d.subtitleTrackController=g,q.push(g);if(r=c.emeController)g=new r(ea(d)),d.emeController=g,f.push(g);(r=c.subtitleStreamController)&&q.push(new r(ea(d),e));(r=c.timelineController)&&f.push(new r(ea(d)));d.coreComponents=f;return d}qb(b,a);b.isSupported=function(){var a=window.MediaSource||window.WebKitMediaSource;if(a){var b=self.SourceBuffer||self.WebKitSourceBuffer;a=a&&"function"===typeof a.isTypeSupported&&a.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');
b=!b||b.prototype&&"function"===typeof b.prototype.appendBuffer&&"function"===typeof b.prototype.remove;b=!!a&&!!b}else b=!1;return b};Mb(b,null,[{key:"version",get:function(){return"0.14.17"}},{key:"Events",get:function(){return q["default"]}},{key:"ErrorTypes",get:function(){return B.ErrorTypes}},{key:"ErrorDetails",get:function(){return B.ErrorDetails}},{key:"DefaultConfig",get:function(){return b.defaultConfig?b.defaultConfig:ed},set:function(a){b.defaultConfig=a}}]);var c=b.prototype;c.destroy=
function(){p.logger.log("destroy");this.trigger(q["default"].DESTROYING);this.detachMedia();this.coreComponents.concat(this.networkControllers).forEach(function(a){a.destroy()});this.url=null;this.removeAllListeners();this._autoLevelCapping=-1};c.attachMedia=function(a){p.logger.log("attachMedia");this.media=a;this.trigger(q["default"].MEDIA_ATTACHING,{media:a})};c.detachMedia=function(){p.logger.log("detachMedia");this.trigger(q["default"].MEDIA_DETACHING);this.media=null};c.loadSource=function(a){a=
hb.buildAbsoluteURL(window.location.href,a,{alwaysNormalize:!0});p.logger.log("loadSource:"+a);this.url=a;this.trigger(q["default"].MANIFEST_LOADING,{url:a})};c.startLoad=function(a){void 0===a&&(a=-1);p.logger.log("startLoad("+a+")");this.networkControllers.forEach(function(b){b.startLoad(a)})};c.stopLoad=function(){p.logger.log("stopLoad");this.networkControllers.forEach(function(a){a.stopLoad()})};c.swapAudioCodec=function(){p.logger.log("swapAudioCodec");this.streamController.swapAudioCodec()};
c.recoverMediaError=function(){p.logger.log("recoverMediaError");var a=this.media;this.detachMedia();a&&this.attachMedia(a)};c.removeLevel=function(a,b){void 0===b&&(b=0);this.levelController.removeLevel(a,b)};Mb(b,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){p.logger.log("set currentLevel:"+a);this.loadLevel=a;this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},
set:function(a){p.logger.log("set nextLevel:"+a);this.levelController.manualLevel=a;this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){p.logger.log("set loadLevel:"+a);this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},
set:function(a){p.logger.log("set firstLevel:"+a);this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){p.logger.log("set startLevel:"+a);-1!==a&&(a=Math.max(a,this.minAutoLevel));this.levelController.startLevel=a}},{key:"capLevelToPlayerSize",set:function(a){a=!!a;a!==this.config.capLevelToPlayerSize&&(a?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),
this.config.capLevelToPlayerSize=a)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(a){p.logger.log("set autoLevelCapping:"+a);this._autoLevelCapping=a}},{key:"bandwidthEstimate",get:function(){var a=this.abrController._bwEstimator;return a?a.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var a=
this.levels,b=this.config.minAutoBitrate,c=a?a.length:0,d=0;d<c;d++)if((a[d].realBitrate?Math.max(a[d].realBitrate,a[d].bitrate):a[d].bitrate)>b)return d;return 0}},{key:"maxAutoLevel",get:function(){var a=this.levels,b=this.autoLevelCapping;return-1===b&&a&&a.length?a.length-1:b}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(a){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,a)}},{key:"audioTracks",
get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]}},{key:"audioTrack",get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var b=this.audioTrackController;b&&(b.audioTrack=a)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var a=this.subtitleTrackController;return a?
a.subtitleTrack:-1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleTrack=a)}},{key:"subtitleDisplay",get:function(){var a=this.subtitleTrackController;return a?a.subtitleDisplay:!1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleDisplay=a)}}]);return b}(Vb);Nb.defaultConfig=void 0},"./src/polyfills/number.js":function(a,b,e){e.r(b);e.d(b,"isFiniteNumber",function(){return c});e.d(b,"MAX_SAFE_INTEGER",function(){return d});var c=Number.isFinite||function(a){return"number"===
typeof a&&isFinite(a)},d=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":function(a,b,e){function c(){return"undefined"===typeof window?self:window}e.r(b);e.d(b,"getSelfScope",function(){return c})},"./src/utils/logger.js":function(a,b,e){function c(){}function d(a){var b=n.console[a];return b?function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];d[0]&&(d[0]="["+a+"] > "+d[0]);b.apply(n.console,d)}:c}function f(a){for(var b=arguments.length,c=Array(1<
b?b-1:0),e=1;e<b;e++)c[e-1]=arguments[e];c.forEach(function(b){m[b]=a[b]?a[b].bind(a):d(b)})}e.r(b);e.d(b,"enableLogs",function(){return w});e.d(b,"logger",function(){return h});a=e("./src/utils/get-self-scope.js");var k={trace:c,debug:c,log:c,warn:c,info:c,error:c},m=k,n=Object(a.getSelfScope)(),w=function(a){if(n.console&&!0===a||"object"===typeof a){f(a,"debug","log","info","warn","error");try{m.log()}catch(J){m=k}}else m=k},h=m}})["default"]})}));ia.prototype=Object.assign(Object.create(A.prototype),
{constructor:ia,setupHlsListeners:function(){var a=this;this.hls.on(Ra.Events.LEVEL_UPDATED,function(b){a.qualityLevel=b.data.level})},load:function(){A.prototype.load.call(this,!1);var a=this.options,b=a.muted,c=a.loop,d=a.autoplay,e=a.playsinline,f=a.crossOrigin,r=a.maxDuration,l=this.videoElement,k=this.onProgress.bind(this),m=this.onLoad.bind(this);this.maxDuration=r||60;l.loop=c;l.autoplay=d;l.playsinline=e;l.crossOrigin=f;l.muted=b;e&&(l.setAttribute("playsinline",""),l.setAttribute("webkit-playsinline",
""));a=function(){var a=this.setVideoTexture(l);d&&this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1});b||this.dispatchEvent({type:"panolens-viewer-handler",method:"toggleVideoSound"});qb&&(l.pause(),d&&b?this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1}):this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0}));window.requestAnimationFrame(function(){setTimeout(function(){k({loaded:1,
total:1});m(a)},1E3)})};2<l.readyState?a.call(this):(0===l.querySelectorAll("source").length&&(e=document.createElement("source"),e.src=this.src,l.appendChild(e)),l.load());l.addEventListener("loadeddata",a.bind(this));l.addEventListener("timeupdate",function(){this.isBuffering=!1;this.videoProgress=0<=l.duration?l.currentTime/this.maxDuration||l.duration:0;r&&l.currentTime>=this.maxDuration&&(l.currentTime=0);this.dispatchEvent({type:"panolens-viewer-handler",method:"onVideoUpdate",data:{percentage:this.videoProgress,
quality:this.qualityLevel}})}.bind(this));l.addEventListener("ended",function(){c||(this.resetVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0}))}.bind(this),!1)},onLoad:function(){A.prototype.onLoad.call(this);this.maxDuration=Math.min(this.maxDuration,this.videoElement.duration)},setVideoTexture:function(a){if(a)return a=new f.VideoTexture(a),a.minFilter=f.LinearFilter,a.magFilter=f.LinearFilter,a.format=f.RGBFormat,this.updateTexture(a),a},reset:function(){this.videoElement=
void 0;A.prototype.reset.call(this)},isVideoPaused:function(){return this.videoElement.paused},toggleVideo:function(a){var b=this.videoElement;if(b)if(a.toggleMute)b&&this.isVideoMuted()?this.unmuteVideo():this.muteVideo();else b[b.paused?"play":"pause"]()},setVideoCurrentTime:function(a){a=a.percentage;var b=this.videoElement;b&&!Number.isNaN(a)&&1!==a&&(b.currentTime=this.maxDuration*a,this.dispatchEvent({type:"panolens-viewer-handler",method:"onVideoUpdate",data:a}))},playVideo:function(){var a=
this.videoElement,b=this.playVideo.bind(this),c=this.dispatchEvent.bind(this),d=function(){c({type:"play"})},e=function(a){window.requestAnimationFrame(b);c({type:"play-error",error:a})};a&&a.paused&&a.play().then(d).catch(e)},pauseVideo:function(){var a=this.videoElement;a&&!a.paused&&a.pause();this.dispatchEvent({type:"pause"});this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0})},resumeVideoProgress:function(){var a=this.videoElement;4<=a.readyState&&a.autoplay&&
!this.isMobile?(this.playVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1})):(this.pauseVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0}));this.setVideoCurrentTime({percentage:this.videoProgress})},resetVideo:function(){this.videoElement&&this.setVideoCurrentTime({percentage:0})},isVideoMuted:function(){return this.videoElement.muted},muteVideo:function(){this.videoElement.muted=!0;this.dispatchEvent({type:"volumechange"})},
unmuteVideo:function(){this.videoElement.muted=!1;this.dispatchEvent({type:"volumechange"})},getVideoElement:function(){return this.videoElement},add:function(a){a instanceof ha&&(this.floorPlane=a);A.prototype.add.call(this,a)},addFloorPlane:function(){this.floorPlane&&this.floorPlane instanceof ha||(this.floorPlane=new ha,this.add(this.floorPlane))},removeFloorPlane:function(){this.floorPlane&&this.floorPlane instanceof ha&&(this.floorPlane.dispose(),this.floorPlane=null)},dispose:function(){this.pauseVideo();
this.removeEventListener("leave",this.pauseVideo.bind(this));this.removeEventListener("enter-fade-start",this.resumeVideoProgress.bind(this));this.removeEventListener("video-toggle",this.toggleVideo.bind(this));this.removeEventListener("video-time",this.setVideoCurrentTime.bind(this));this.floorPlane=null;A.prototype.dispose.call(this)}});var Bb={tDiffuse:{value:new f.Texture},resolution:{value:1},transform:{value:new f.Matrix4},zoom:{value:1},opacity:{value:1}};ta.prototype=Object.assign(Object.create(ba.prototype),
{constructor:ta,add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}a instanceof Y&&(a.material.depthTest=!1);ba.prototype.add.call(this,a)},createGeometry:function(a){return new f.PlaneBufferGeometry(a,.5*a)},createMaterial:function(a){a=void 0===a?this.edgeLength:a;var b=f.UniformsUtils.clone(Bb);b.zoom.value=a;b.opacity.value=0;return new f.ShaderMaterial({vertexShader:"\n\n        varying vec2 vUv;\n\n        void main() {\n\n            vUv = uv;\n            gl_Position = vec4( position, 1.0 );\n\n        }\n\n    ",
fragmentShader:"\n\n        uniform sampler2D tDiffuse;\n        uniform float resolution;\n        uniform mat4 transform;\n        uniform float zoom;\n        uniform float opacity;\n\n        varying vec2 vUv;\n\n        const float PI = 3.141592653589793;\n\n        void main(){\n\n            vec2 position = -1.0 +  2.0 * vUv;\n\n            position *= vec2( zoom * resolution, zoom * 0.5 );\n\n            float x2y2 = position.x * position.x + position.y * position.y;\n            vec3 sphere_pnt = vec3( 2. * position, x2y2 - 1. ) / ( x2y2 + 1. );\n\n            sphere_pnt = vec3( transform * vec4( sphere_pnt, 1.0 ) );\n\n            vec2 sampleUV = vec2(\n                (atan(sphere_pnt.y, sphere_pnt.x) / PI + 1.0) * 0.5,\n                (asin(sphere_pnt.z) / PI + 0.5)\n            );\n\n            gl_FragColor = texture2D( tDiffuse, sampleUV );\n            gl_FragColor.a *= opacity;\n\n        }\n    ",
uniforms:b,transparent:!0,opacity:0})},registerMouseEvents:function(){this.container.addEventListener("mousedown",this.onMouseDown.bind(this),{passive:!0});this.container.addEventListener("mousemove",this.onMouseMove.bind(this),{passive:!0});this.container.addEventListener("mouseup",this.onMouseUp.bind(this),{passive:!0});this.container.addEventListener("touchstart",this.onMouseDown.bind(this),{passive:!0});this.container.addEventListener("touchmove",this.onMouseMove.bind(this),{passive:!0});this.container.addEventListener("touchend",
this.onMouseUp.bind(this),{passive:!0});this.container.addEventListener("mousewheel",this.onMouseWheel.bind(this),{passive:!1});this.container.addEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),{passive:!1});this.container.addEventListener("contextmenu",this.onContextMenu.bind(this),{passive:!0})},unregisterMouseEvents:function(){this.container.removeEventListener("mousedown",this.onMouseDown.bind(this),!1);this.container.removeEventListener("mousemove",this.onMouseMove.bind(this),!1);
this.container.removeEventListener("mouseup",this.onMouseUp.bind(this),!1);this.container.removeEventListener("touchstart",this.onMouseDown.bind(this),!1);this.container.removeEventListener("touchmove",this.onMouseMove.bind(this),!1);this.container.removeEventListener("touchend",this.onMouseUp.bind(this),!1);this.container.removeEventListener("mousewheel",this.onMouseWheel.bind(this),!1);this.container.removeEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),!1);this.container.removeEventListener("contextmenu",
this.onContextMenu.bind(this),!1)},onMouseDown:function(a){switch(a.touches&&a.touches.length||1){case 1:var b=0<=a.clientX?a.clientX:a.touches[0].clientX;a=0<=a.clientY?a.clientY:a.touches[0].clientY;this.dragging=!0;this.userMouse.set(b,a);break;case 2:b=a.touches[0].pageX-a.touches[1].pageX,a=a.touches[0].pageY-a.touches[1].pageY,this.userMouse.pinchDistance=Math.sqrt(b*b+a*a)}this.onUpdateCallback()},onMouseMove:function(a){switch(a.touches&&a.touches.length||1){case 1:var b=0<=a.clientX?a.clientX:
a.touches[0].clientX;a=0<=a.clientY?a.clientY:a.touches[0].clientY;var c=.4*f.Math.degToRad(b-this.userMouse.x),d=.4*f.Math.degToRad(a-this.userMouse.y);this.dragging&&(this.quatA.setFromAxisAngle(this.vectorY,c),this.quatB.setFromAxisAngle(this.vectorX,d),this.quatCur.multiply(this.quatA).multiply(this.quatB),this.userMouse.set(b,a));break;case 2:b=a.touches[0].pageX-a.touches[1].pageX,a=a.touches[0].pageY-a.touches[1].pageY,this.addZoomDelta(this.userMouse.pinchDistance-Math.sqrt(b*b+a*a))}},onMouseUp:function(){this.dragging=
!1},onMouseWheel:function(a){a.preventDefault();a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);this.addZoomDelta(b);this.onUpdateCallback()},addZoomDelta:function(a){var b=this.material.uniforms,c=.1*this.size,d=10*this.size;b.zoom.value+=a;b.zoom.value<=c?b.zoom.value=c:b.zoom.value>=d&&(b.zoom.value=d)},onUpdateCallback:function(){this.frameId=window.requestAnimationFrame(this.onUpdateCallback.bind(this));this.quatSlerp.slerp(this.quatCur,.1);this.material&&
this.material.uniforms.transform.value.makeRotationFromQuaternion(this.quatSlerp);!this.dragging&&1-this.quatSlerp.clone().dot(this.quatCur)<this.EPS&&window.cancelAnimationFrame(this.frameId)},reset:function(){this.quatCur.set(0,0,0,1);this.quatSlerp.set(0,0,0,1);this.onUpdateCallback()},updateTexture:function(a){this.material.uniforms.tDiffuse.value=a},getTexture:function(){return this.material.uniforms.tDiffuse.value},onLoad:function(a){this.material.uniforms.resolution.value=this.container.clientWidth/
this.container.clientHeight;this.registerMouseEvents();this.onUpdateCallback();this.dispatchEvent({type:"panolens-viewer-handler",method:"disableControl"});ba.prototype.onLoad.call(this,a)},onLeave:function(){this.unregisterMouseEvents();this.dispatchEvent({type:"panolens-viewer-handler",method:"enableControl",data:da.ORBIT});window.cancelAnimationFrame(this.frameId);ba.prototype.onLeave.call(this)},onWindowResize:function(){this.material.uniforms.resolution.value=this.container.clientWidth/this.container.clientHeight},
onContextMenu:function(){this.dragging=!1},dispose:function(){this.unregisterMouseEvents();ba.prototype.dispose.call(this)}});var Fa={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:0},threshold:{value:.3},useTexture:{value:0},tMixTexture:{value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mixRatio;\nuniform sampler2D tDiffuse1;\nuniform sampler2D tDiffuse2;\nuniform sampler2D tMixTexture;\nuniform int useTexture;\nuniform float threshold;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texel1 = texture2D( tDiffuse1, vUv );\n\tvec4 texel2 = texture2D( tDiffuse2, vUv );\n\tif (useTexture==1) {\n\t\tvec4 transitionTexel = texture2D( tMixTexture, vUv );\n\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t} else {\n\t\tgl_FragColor = mix( texel2, texel1, mixRatio );\n\t}\n}"};
Ea.prototype={constructor:Ea};Ta.prototype=Object.assign(Object.create(f.EventDispatcher.prototype),{constructor:Ta,add:function(a){this.viewer&&this.viewer.panorama instanceof ia&&this.viewer.removeWidget();this.viewer?(this.targetViewer=a,this.viewersQueue.push(a)):(this.viewer=a,this.viewersQueue.push(a),this.transition=new Sa(null,this.viewer,this.renderer,this.options.transitionParams),this.transition.execute());this.shareStateBetweenViewers()},updateTransitionType:function(a){a={type:a};this.options.transitionParams=
Object.assign({},this.options.transitionParams,a);this.viewer.options.transitionParams=Object.assign({},this.viewer.options.transitionParams,a)},setControlEnabled:function(a){a={controlEnabled:void 0===a?!0:a};this.options.transitionParams=Object.assign({},this.options.transitionParams,a);this.viewer.options.transitionParams=Object.assign({},this.viewer.options.transitionParams,a);this.updateTransition()},updateTransition:function(){this.transition=new Sa(null,this.viewer,this.renderer,this.options.transitionParams);
this.transition.execute()},shareStateBetweenViewers:function(a){var b=this;this.options=this.viewer.options;this.mode=this.viewer.mode;this.controlIndex=this.viewer.getControlIndex();this.targetViewer&&(this.mode!=this.targetViewer.mode&&this.targetViewer.enableEffect(this.mode),this.controlIndex!=this.targetViewer.getControlIndex()&&this.targetViewer.enableControl(this.controlIndex,!1),this.targetViewer.OrbitControls.minPolarAngle=this.viewer.OrbitControls.minPolarAngle,this.targetViewer.OrbitControls.maxPolarAngle=
this.viewer.OrbitControls.maxPolarAngle,"slider_panorama"==this.targetViewer.panorama.subtype?(this.targetViewer.OrbitControls.enableDamping=!1,this.targetViewer.OrbitControls.autoRotate=!1,this.targetViewer.OrbitControls.update(),this.targetViewer.OrbitControls.enableDamping=!0):(this.targetViewer.OrbitControls.enableDamping=!1,this.targetViewer.OrbitControls.autoRotate="slider_panorama"==this.viewer.panorama.subtype?this.autoRotate:this.viewer.OrbitControls.autoRotate,this.targetViewer.OrbitControls.update(),
this.targetViewer.OrbitControls.enableDamping=!0,this.viewer.addEventListener("enableAutoRotate",function(){return b.viewer.OrbitControls.autoRotate=!0})))},setScene:function(a,b){a===this.targetViewer&&(this.transition=new Sa(this.viewer,this.targetViewer,this.renderer,this.options.transitionParams,void 0===b?!1:b),this.transition.execute(),2<this.viewersQueue.length&&(b=this.viewersQueue.shift(),b.dispose(),b.destroy()),this.viewer=a,this.targetViewer=null)},getRenderer:function(){return this.renderer},
getContainer:function(){return this.container},render:function(){this.isRenderingDisabled||this.transition&&this.transition.render()},disableRendering:function(a){this.isRenderingDisabled=a},animate:function(){this.requestAnimationId=requestAnimationFrame(this.animate.bind(this));this.render()},destroy:function(){this.render();window.cancelAnimationFrame(this.requestAnimationId)}});Ga.prototype=Object.assign(Object.create(ta.prototype),{constructor:Ga,onLoad:function(a){this.updateTexture(a);ta.prototype.onLoad.call(this,
a)},updateTexture:function(a){a.minFilter=a.magFilter=f.LinearFilter;this.material.uniforms.tDiffuse.value=a},dispose:function(){var a=this.material.uniforms.tDiffuse;a&&a.value&&a.value.dispose();ta.prototype.dispose.call(this)}});Ua.prototype=Object.assign(Object.create(f.EventDispatcher.prototype),{constructor:Ua});Va.prototype=Object.assign(Object.create(f.EventDispatcher.prototype),{constructor:Va});Ha.prototype=Object.create(f.EventDispatcher.prototype);Ha.prototype.constructor=Ha;Object.assign(Aa.prototype,
{constructor:Aa,updateUniformByFormat:function(a,b){this.format=a;var c=b.repeat.value;b=b.offset.value;var d=this.loffset,e=this.roffset;switch(a){case sa.TAB:c.set(1,.5);b.set(0,.5);d.set(0,.5);e.set(0,0);break;case sa.SBS:c.set(.5,1),b.set(0,0),d.set(0,0),e.set(.5,0)}},updateTextureToLeft:function(a){a.copy(this.loffset)},updateTextureToRight:function(a){a.copy(this.roffset)}});Ia.prototype=Object.assign(Object.create(ba.prototype),{constructor:Ia,onLoad:function(a){var b=a.image;this.stereo.updateUniformByFormat(4===
b.width/b.height?sa.SBS:sa.TAB,this.material.uniforms);this.material.uniforms.tEquirect.value=a;ba.prototype.onLoad.call(this,a)},updateTextureToLeft:function(){this.stereo.updateTextureToLeft(this.material.uniforms.offset.value)},updateTextureToRight:function(){this.stereo.updateTextureToRight(this.material.uniforms.offset.value)},dispose:function(){var a=this.material.uniforms.tEquirect.value;a instanceof f.Texture&&a.dispose();ba.prototype.dispose.call(this)}});Ja.prototype=Object.assign(Object.create(ia.prototype),
{constructor:Ja,onLoad:function(a){var b=a.image;this.stereo.updateUniformByFormat(4===b.videoWidth/b.videoHeight?sa.SBS:sa.TAB,this.material.uniforms);this.material.uniforms.tEquirect.value=a;ia.prototype.onLoad.call(this)},updateTextureToLeft:function(){this.stereo.updateTextureToLeft(this.material.uniforms.offset.value)},updateTextureToRight:function(){this.stereo.updateTextureToRight(this.material.uniforms.offset.value)},dispose:function(){var a=this.material.uniforms.tEquirect.value;a instanceof
f.Texture&&a.dispose();ia.prototype.dispose.call(this)}});var Cb=function(a){var b=new f.StereoCamera;b.aspect=.5;var c=new f.Vector2;this.setEyeSeparation=function(a){b.eyeSep=a};this.setSize=function(b,c){a.setSize(b,c)};this.render=function(d,e){d.updateMatrixWorld();null===e.parent&&e.updateMatrixWorld();b.update(e);a.getSize(c);a.autoClear&&a.clear();a.setScissorTest(!0);a.setScissor(0,0,c.width/2,c.height);a.setViewport(0,0,c.width/2,c.height);a.render(d,b.cameraL);a.setScissor(c.width/2,0,
c.width/2,c.height);a.setViewport(c.width/2,0,c.width/2,c.height);a.render(d,b.cameraR);a.setScissorTest(!1)}},Wa=navigator.userAgent.match(/iPhone|iPad|iPod/i)?!0:!1;Ka.prototype=Object.assign(Object.create(f.EventDispatcher.prototype),{constructor:Ka,setupScene:function(a){return a=void 0===a?new f.Scene:a},setupCamera:function(a,b,c){c=void 0===c?new f.PerspectiveCamera(a,b,1,1E4):c;c.position.z=1;return c},setupRenderer:function(a,b){return a=void 0===a?new f.WebGLRenderer({alpha:!0,antialias:!1}):
a},setupControls:function(a,b){var c=this.options,d=c.autoRotate,e=c.autoRotateSpeed,f=c.horizontalView,r=c.momentum,l=c.rotateSpeed,k=c.dampingFactor;c=new Ua(a,b);c.id="orbit";c.index=da.ORBIT;c.minDistance=1;c.noPan=!0;c.autoRotate=d;c.autoRotateSpeed=e;c.momentum=r;c.rotateSpeed=l;c.dampingFactor=k;c.enabled=!0;a=new Va(a,b);a.id="device-orientation";a.index=da.DEVICEORIENTATION;a.enabled=!1;f&&(c.minPolarAngle=Math.PI/2,c.maxPolarAngle=Math.PI/2);f={id:"object"};f.index=da.OBJECT;f.enabled=!1;
b={id:"drag"};b.index=da.DRAG;b.enabled=!1;this.controls=[c,a,f,b];this.OrbitControls=c;this.DeviceOrientationControls=a;this.ObjectControls=f;this.DragControls=b;return c},setupEffects:function(a,b){var c=b.clientWidth;b=b.clientHeight;var d=new lb(a);d.setSize(c,b);a=new Cb(a);a.setSize(c,b);this.CardboardEffect=d;this.StereoEffect=a;return d},setupContainer:function(a){a._width=a.clientWidth;a._height=a.clientHeight;return a},setupTween:function(){this.tweenCanvasOpacityOut.to({},500).easing(z.Easing.Exponential.Out);
this.tweenCanvasOpacityIn.to({},500).easing(z.Easing.Exponential.Out);this.tweenCanvasOpacityOut.chain(this.tweenCanvasOpacityIn)},setupFloorCursor:function(){this.floorCursor=new xa;this.add(this.floorCursor)},setContainerCursor:function(a){this.containerCursor=a;this.container&&(this.container.style.cursor=a)},applyDefaultContainerCursor:function(){this.container&&(this.container.style.cursor=this.containerCursor)},add:function(a){var b=this,c=this.container,d=this.scene,e=this.camera,f=this.controls;
if(1<arguments.length){for(d=0;d<arguments.length;d++)this.add(arguments[d]);return this}d.add(a);a.addEventListener&&a.addEventListener("panolens-viewer-handler",this.eventHandler.bind(this));a instanceof xa&&(this.floorCursor=a);a instanceof A&&(a.dispatchEvent({type:"panolens-container",container:c}),a.dispatchEvent({type:"panolens-scene",scene:d}),a.dispatchEvent({type:"panolens-camera",camera:e}),a.dispatchEvent({type:"panolens-controls",controls:f}),this.addPanoramaEventListener(a),this.panorama||
(c=this.options.initialLookAt,this.setPanorama(a),this.setControlCenter(c)));if(a instanceof ya){this.camera.position.set(0,0,1);d.add(a);this.ObjectControls={};this.controls[da.OBJECT]={};var r=!1,l=(new z.Tween(a.position)).to({x:0,y:0,z:0},500).easing(z.Easing.Cubic.Out).onStart(function(){return r=!0}).onComplete(function(){return r=!1});a.addEventListener("addChild",this.fitObjectToScreenEvent.bind(this));a.addEventListener("ready",function(){b.OrbitControls.addEventListener("start",function(){b.DragControls.enabled=
!1});b.OrbitControls.addEventListener("end",function(){b.camera.fov<b.defaultFov?b.DragControls.enabled=!0:r||l.start()});b.OrbitControls.addEventListener("change",function(){b.DragControls.enabled=!1});b.DragControls=Object.assign(new Ha([a],b.camera,b.container),b.DragControls);b.DragControls.activate();b.camera.fov<b.defaultFov&&(b.DragControls.enabled=!0)});a.addEventListener("ready",this.fitObjectToScreenEvent.bind(this))}},fitObjectToScreenEvent:function(a){a.target instanceof ya&&this.fitObjectToScreen(a.target)},
fitObjectToScreen:function(a){var b=a.desiredWidth/a.desiredHeight;this.camera.lookAt(a.position);var c=2*Math.tan(Math.PI*this.camera.fov/360),d=this.defaultFov||60,e=1;e=c>c/this.camera.aspect*b?c:c*this.camera.aspect/b;e*=d/this.camera.fov;a.scale.set(e*b,e,1);a.children.forEach(function(a){if(!a.alreadyScaled){a.hide();a.scale.set(a.scale.x/b,a.scale.y,a.scale.z);a._parentRatio=b;var c=new f.Vector3;c.copy(a.scale);a.scaleUpAnimation=(new z.Tween(a.scale)).to({x:1.3*c.x,y:1.3*c.y},500).easing(z.Easing.Elastic.Out);
a.scaleDownAnimation=(new z.Tween(a.scale)).to({x:c.x,y:c.y},500).easing(z.Easing.Elastic.Out);null!=a.map&&(a.map.needsUpdate=!0);a.needsUpdate=!0;a.updateMatrix();a.alreadyScaled=!0;a.show()}});this.currentScale=e;this.currentRatio=b},remove:function(a){a.removeEventListener&&a.removeEventListener("panolens-viewer-handler",this.eventHandler.bind(this));this.scene.remove(a)},addDefaultControlBar:function(a){if(!this.widget){var b=new ka(this.container);b.addEventListener("panolens-viewer-handler",
this.eventHandler.bind(this));b.addControlBar();a.forEach(function(a){b.addControlButton(a)});this.widget=b}},setPanorama:function(a){var b=this.panorama;if(a instanceof A&&b!==a){this.hideInfospot();b&&(b._onReady&&(b.removeEventListener("ready",b._onReady),delete b._onReady),b.onLeave());a._onLeaveComplete&&(a.removeEventListener("leave-complete",a._onLeaveComplete),delete a._onLeaveComplete);var c=function(){a.removeEventListener("ready",c);delete a._onReady;a.active&&a.fadeIn()};a.addEventListener("ready",
c);a._onReady=c;this.panorama=a;this.panorama.onEnter()}},eventHandler:function(a){if(a.method&&this[a.method])this[a.method](a.data)},dispatchEventToChildren:function(a){this.scene.traverse(function(b){b.dispatchEvent&&b.dispatchEvent(a)})},activateWidgetItem:function(a,b){var c=this.widget.mainMenu,d=c.children[0];c=c.children[1];if(void 0!==a){switch(a){case 0:a=d.subMenu.children[1];break;case 1:a=d.subMenu.children[2];break;default:a=d.subMenu.children[1]}d.subMenu.setActiveItem(a);d.setSelectionTitle(a.textContent)}if(void 0!==
b){switch(b){case K.CARDBOARD:a=c.subMenu.children[2];break;case K.STEREO:a=c.subMenu.children[3];break;default:a=c.subMenu.children[1]}c.subMenu.setActiveItem(a);c.setSelectionTitle(a.textContent)}},enableEffect:function(a){if(this.mode!==a)if(a===K.NORMAL)this.disableEffect();else{this.mode=a;var b=this.camera.fov;switch(a){case K.CARDBOARD:this.effect=this.CardboardEffect;this.enableReticleControl();break;case K.STEREO:this.effect=this.StereoEffect;this.enableReticleControl();break;default:this.effect=
null,this.disableReticleControl()}this.dispatchEventToChildren({type:"panolens-dual-eye-effect",mode:this.mode});this.camera.fov=b+.01;this.effect.setSize(this.container.clientWidth,this.container.clientHeight);this.render();this.camera.fov=b;this.dispatchEvent({type:"mode-change",mode:this.mode});this.dispatchEvent({type:"viewerStateUpdate"})}},disableEffect:function(){this.mode!==K.NORMAL&&(this.mode=K.NORMAL,this.disableReticleControl(),this.dispatchEventToChildren({type:"panolens-dual-eye-effect",
mode:this.mode}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.render(),this.dispatchEvent({type:"mode-change",mode:this.mode}),this.dispatchEvent({type:"viewerStateUpdate"}))},enableReticleControl:function(){this.reticle.visible||(this.tempEnableReticle=!0,this.unregisterMouseAndTouchEvents(),this.reticle.show(),this.registerReticleEvent(),this.updateReticleEvent())},disableReticleControl:function(){this.tempEnableReticle=!1;this.options.enableReticle?this.updateReticleEvent():
(this.reticle.hide(),this.unregisterReticleEvent(),this.registerMouseAndTouchEvents())},enableAutoRate:function(){this.options.autoRotate=!0;this.OrbitControls.autoRotate=!0;this.dispatchEvent({type:"enableAutoRotate"})},disableAutoRate:function(){clearTimeout(this.autoRotateRequestId);this.dispatchEvent({type:"viewerStateUpdate"});this.options.autoRotate=!1;this.OrbitControls.autoRotate=!1},toggleVideoPlay:function(a){this.panorama instanceof ia&&this.panorama.dispatchEvent({type:"video-toggle",
pause:a})},toggleVideoSound:function(){this.panorama instanceof ia&&this.panorama.dispatchEvent({type:"video-toggle",toggleMute:!0})},setVideoCurrentTime:function(a){this.panorama instanceof ia&&this.panorama.dispatchEvent({type:"video-time",percentage:a})},onVideoUpdate:function(a){var b=this.widget;b&&b.dispatchEvent({type:"video-update",percentage:a.percentage,quality:a.quality})},addUpdateCallback:function(a){a&&this.updateCallbacks.push(a)},removeUpdateCallback:function(a){var b=this.updateCallbacks.indexOf(a);
a&&0<=b&&this.updateCallbacks.splice(b,1)},showVideoWidget:function(){var a=this.widget;a&&a.dispatchEvent({type:"video-control-show"})},hideVideoWidget:function(){var a=this.widget;a&&a.dispatchEvent({type:"video-control-hide"})},updateVideoPlayButton:function(a){var b=this.widget;b&&b.videoElement&&b.videoElement.controlButton&&b.videoElement.controlButton.update(a)},addPanoramaEventListener:function(a){a instanceof ia&&(a.addEventListener("enter-fade-start",this.showVideoWidget.bind(this)),a.addEventListener("leave-start",
function(){this.panorama instanceof ia||this.hideVideoWidget.call(this)}.bind(this)))},setControl:function(a){this.control=this.controls[a];this.dispatchEvent({type:"viewerStateUpdate"})},getControl:function(){return this.control},getScene:function(){return this.scene},getCamera:function(){return this.camera},getRenderer:function(){return this.renderer},getContainer:function(){return this.container},getControlId:function(){return this.control.id},getNextControlId:function(){return this.controls[this.getNextControlIndex()].id},
getNextControlIndex:function(){var a=this.controls,b=a.indexOf(this.control)+1;return b>=a.length?0:b},getControlIndex:function(){return this.controls.indexOf(this.control)},setCameraFov:function(a){this.camera.fov=a;this.camera.updateProjectionMatrix()},getRaycastViewCenter:function(){var a=new f.Raycaster;a.setFromCamera(new f.Vector2(0,0),this.camera);a=a.intersectObject(this.panorama);return 0<a.length?a[0].point:new f.Vector3(0,0,-1)},enableControl:function(a,b){a=void 0===a?da.ORBIT:a;b=void 0===
b?!0:b;var c=this.control.index,d=this.OrbitControls,e=this.DeviceOrientationControls,t=this.container,r=t.querySelector("canvas");if(a!==c){if(a===da.DEVICEORIENTATION)this.tweenCanvasOpacityOut.onStart(function(){d.enabled=!1;e.enabled=!1;b?r.style.opacity=0:null}),this.tweenCanvasOpacityIn.onStart(function(){d.enabled=!0;e.updateAlphaOffsetAngle(d.publicSphericalDelta.data.theta);e.connect();b?r.style.opacity=1:null}),this.tweenCanvasOpacityOut.start();else if(a===da.DEVICEORIENTATION){c=e.getRotations;
c();var l=this.getRaycastViewCenter();this.tweenCanvasOpacityOut.onStart(function(){d.enabled=!1;e.disconnect();r.style.opacity=0});this.tweenCanvasOpacityIn.onStart(function(){d.enabled=!0;this.setControlCenter(l);r.style.opacity=1}.bind(this));this.tweenCanvasOpacityOut.start()}else a==da.OBJECT&&(d.enabled=!1,e.enabled=!1,ObjectControls=Object.assign(new ObjectControls(camera,t,new f.MeshBasicMaterial),ObjectControls),ObjectControls.enableVerticalRotation(),ObjectControls.setMaxVerticalRotationAngle(f.Math.degToRad(0),
Math.PI/2),ObjectControls.setDistance(-10,10),ObjectControls.setZoomSpeed(.07),ObjectControls.setRotationSpeed(.03));this.control=this.controls[a]}},disableControl:function(){this.control.enabled=!1},toggleNextControl:function(){this.enableControl(this.getNextControlIndex())},getScreenVector:function(a){a=a.clone();var b=this.container.clientWidth/2,c=this.container.clientHeight/2;a.project(this.camera);a.x=a.x*b+b;a.y=-(a.y*c)+c;a.z=0;return a},checkSpriteInViewport:function(a){this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld);
this.cameraViewProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse);this.cameraFrustum.setFromMatrix(this.cameraViewProjectionMatrix);return a.visible&&this.cameraFrustum.intersectsSprite(a)},reverseDraggingDirection:function(){console.warn("reverseDragging option is deprecated. Please use rotateSpeed to indicate strength and direction");this.OrbitControls.rotateSpeed*=-1},addReticle:function(a,b){var c=new wa(16777215,!0,this.options.dwellTime);c.hide();
a.add(c);b.add(a);return c},rotateControlLeft:function(a){this.OrbitControls.rotateLeftStatic(a)},rotateControlUp:function(a){this.OrbitControls.rotateUpStatic(a)},rotateControl:function(a,b){this.rotateControlLeft(a);this.rotateControlUp(b)},calculateCameraDirectionDelta:function(a){var b=this.camera.getWorldDirection(new f.Vector3);var c=b.clone();var d=this.panorama.getWorldPosition(new f.Vector3).sub(this.camera.getWorldPosition(new f.Vector3));a=a.clone();a.add(d).normalize();var e=a.clone();
b.y=0;a.y=0;d=Math.atan2(a.z,a.x)-Math.atan2(b.z,b.x);d=d>Math.PI?d-2*Math.PI:d;d=d<-Math.PI?d+2*Math.PI:d;b=Math.abs(c.angleTo(b)+(0>=c.y*e.y?e.angleTo(a):-e.angleTo(a)));b*=e.y<c.y?1:-1;return{left:d,up:b}},setControlCenter:function(a){a=void 0===a?this.options.initialLookAt:a;a=this.calculateCameraDirectionDelta(a);this.rotateControl(a.left,a.up)},tweenControlCenter:function(a,b,c){a instanceof Array&&(c=a[2],b=a[1],a=a[0]);b=void 0!==b?b:1E3;c=c||z.Easing.Exponential.Out;var d=this.calculateCameraDirectionDelta(a);
a=d.left;d=d.up;var e=this.rotateControlLeft.bind(this),f=this.rotateControlUp.bind(this),r={left:0,up:0},l=0,k=0;this.tweenLeftAnimation.stop();this.tweenUpAnimation.stop();this.tweenLeftAnimation=(new z.Tween(r)).to({left:a},b).easing(c).onUpdate(function(a){e(a.left-l);l=a.left}).start();this.tweenUpAnimation=(new z.Tween(r)).to({up:d},b).easing(c).onUpdate(function(a){f(a.up-k);k=a.up}).start()},tweenControlCenterByObject:function(a,b,c){this.tweenControlCenter(a.getWorldPosition(new f.Vector3),
b,c)},onWindowResize:function(a,b){var c=this.container.classList.contains("panolens-container")||this.container.isFullscreen;if(void 0!==a&&void 0!==b){var d=a;var e=b;this.container._width=a;this.container._height=b}else a=cb?Math.min(document.documentElement.clientWidth,window.innerWidth||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0),b=cb?Math.min(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientHeight,window.innerHeight||
0),d=c?a:this.container.clientWidth,e=c?b:this.container.clientHeight,this.container._width=d,this.container._height=e;this.camera.aspect=d/e;this.camera.updateProjectionMatrix();this.renderer.setSize(d,e);this.panorama&&"slider_panorama"==this.panorama.subtype&&(this.renderer.clear(),this.renderer.clearDepth(),this.fitObjectToScreen(this.panorama));(this.options.enableReticle||this.tempEnableReticle)&&this.updateReticleEvent();this.dispatchEvent({type:"window-resize",width:d,height:e});this.scene.traverse(function(a){a.dispatchEvent&&
a.dispatchEvent({type:"window-resize",width:d,height:e})})},addOutputElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="10px";a.style.top="10px";a.style.color="#fff";this.container.appendChild(a);this.outputDivElement=a},getPlanePosition:function(a){var b=new f.Vector3(-1,1,1),c=a.point.clone();c.multiply(b);a=Math.round(Math.abs(a.point.y))!==Math.abs(qa.Y);if(0!==c.length()&&!a)return c},getSliderPosition:function(a){a=a.point.clone();new f.Vector3(-((a.x+
this.panorama.position.x)/this.currentScale/this.currentRatio).toFixed(6),+((a.y-this.panorama.position.y)/this.currentScale).toFixed(6),+(0).toFixed(2));return a},get360Position:function(a){var b=new f.Vector3(-1,1,1);a=a.point.clone();a.multiply(b);if(0!==a.length())return a},outputPosition:function(){var a=this,b=this.raycaster.intersectObject(this.panorama,!0);if(0<b.length){var c={plane:null,scene:null};b.forEach(function(b){if("hotspotPlane"==b.object.subtype){if(b=a.getPlanePosition(b))b.y+=
+Math.random().toFixed(2);c.plane=b}else if("slider_panorama"==b.object.subtype)c.scene=a.getSliderPosition(b);else if("image_panorama"==b.object.type||"video_panorama"==b.object.type)c.scene=a.get360Position(b)});return this.lastTouch=c}},onMouseDown:function(a){a.preventDefault();this.userMouse.x=0<=a.clientX?a.clientX:a.touches[0].clientX;this.userMouse.y=0<=a.clientY?a.clientY:a.touches[0].clientY;this.userMouse.type="mousedown";this.onTap(a)},onMouseMove:function(a){a.preventDefault();this.userMouse.type=
"mousemove";this.onTap(a)},onMouseUp:function(a){this.userMouse.type="mouseup";var b=this.userMouse.x>=a.clientX-this.options.clickTolerance&&this.userMouse.x<=a.clientX+this.options.clickTolerance&&this.userMouse.y>=a.clientY-this.options.clickTolerance&&this.userMouse.y<=a.clientY+this.options.clickTolerance||a.changedTouches&&this.userMouse.x>=a.changedTouches[0].clientX-this.options.clickTolerance&&this.userMouse.x<=a.changedTouches[0].clientX+this.options.clickTolerance&&this.userMouse.y>=a.changedTouches[0].clientY-
this.options.clickTolerance&&this.userMouse.y<=a.changedTouches[0].clientY+this.options.clickTolerance?"click":void 0;if(!a||!a.target||a.target.classList.contains("panolens-canvas"))if(a.preventDefault(),a=a.changedTouches&&1===a.changedTouches.length?this.onTap({clientX:a.changedTouches[0].clientX,clientY:a.changedTouches[0].clientY},b):this.onTap(a,b),this.userMouse.type="none",!a&&"click"===b){b=this.options;a=b.autoHideControlBar;var c=this.panorama;b.autoHideInfospot&&c&&c.toggleInfospotVisibility();
a&&this.toggleControlBar()}},onTap:function(a,b){var c=this.container.getBoundingClientRect(),d=c.top,e=this.container,f=e.clientHeight;this.raycasterPoint.x=(a.clientX-c.left)/e.clientWidth*2-1;this.raycasterPoint.y=2*-((a.clientY-d)/f)+1;this.raycaster.setFromCamera(this.raycasterPoint,this.camera);if(this.panorama){"mousedown"!==a.type&&this.outputPosition();this.floorCursor&&this.floorCursor.enabled&&(this.lastTouch&&this.lastTouch.plane&&this.floorCursor.position.set(-this.lastTouch.plane.x,
this.lastTouch.plane.y+1,this.lastTouch.plane.z),this.floorCursor.onMove());c=this.raycaster.intersectObjects(this.panorama.children,!0);d=this.getConvertedIntersect(c);e=0<c.length?c[0].object:void 0;"mouseup"===this.userMouse.type&&(d&&this.pressEntityObject===d&&this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressstop-entity",mouseEvent:a}),this.pressEntityObject=void 0);"mouseup"===this.userMouse.type&&(e&&this.pressObject===e&&this.pressObject.dispatchEvent&&
this.pressObject.dispatchEvent({type:"pressstop",mouseEvent:a}),this.pressObject=void 0);if("click"===b)this.panorama.dispatchEvent({type:"click",intersects:c,mouseEvent:a}),d&&d.dispatchEvent&&d.dispatchEvent({type:"click-entity",mouseEvent:a}),e&&e.dispatchEvent&&e.dispatchEvent({type:"click",mouseEvent:a});else{this.panorama.dispatchEvent({type:"hover",intersects:c,mouseEvent:a});if(this.hoverObject&&0<c.length&&this.hoverObject!==d||this.hoverObject&&0===c.length)this.hoverObject.dispatchEvent&&
(this.hoverObject.dispatchEvent({type:"hoverleave",mouseEvent:a}),this.reticle.end()),this.hoverObject=void 0;d&&0<c.length&&(this.hoverObject!==d&&(this.hoverObject=d,this.hoverObject.dispatchEvent&&(this.hoverObject.dispatchEvent({type:"hoverenter",mouseEvent:a}),(this.options.autoReticleSelect&&this.options.enableReticle||this.tempEnableReticle)&&this.reticle.start(this.onTap.bind(this,a,"click")))),"mousedown"===this.userMouse.type&&this.pressEntityObject!=d&&(this.pressEntityObject=d,this.pressEntityObject.dispatchEvent&&
this.pressEntityObject.dispatchEvent({type:"pressstart-entity",mouseEvent:a})),"mousedown"===this.userMouse.type&&this.pressObject!=e&&(this.pressObject=e,this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressstart",mouseEvent:a})),"mousemove"===this.userMouse.type||this.options.enableReticle)&&(e&&e.dispatchEvent&&e.dispatchEvent({type:"hover",mouseEvent:a}),this.pressEntityObject&&this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressmove-entity",
mouseEvent:a}),this.pressObject&&this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressmove",mouseEvent:a}));!d&&this.pressEntityObject&&this.pressEntityObject.dispatchEvent&&(this.pressEntityObject.dispatchEvent({type:"pressstop-entity",mouseEvent:a}),this.pressEntityObject=void 0);!e&&this.pressObject&&this.pressObject.dispatchEvent&&(this.pressObject.dispatchEvent({type:"pressstop",mouseEvent:a}),this.pressObject=void 0)}if(e&&(e instanceof Y||e instanceof W)){if(this.infospot=
e,"click"===b)return!0}else this.infospot&&this.hideInfospot();a=!this.infospot||this.infospot&&"toScene"!=this.infospot.type;this.options.autoRotate&&"mousemove"!==this.userMouse.type&&a&&(clearTimeout(this.autoRotateRequestId),this.control===this.OrbitControls&&(this.OrbitControls.autoRotate=!1,this.dispatchEvent({type:"pauseAutoRotate"}),this.autoRotateRequestId=window.setTimeout(this.enableAutoRate.bind(this),this.options.autoRotateActivationDuration)))}},getConvertedIntersect:function(a){for(var b,
c=0;c<a.length;c++)if(0<=a[c].distance&&a[c].object&&!a[c].object.passThrough&&(!a[c].object.entity||!a[c].object.entity.passThrough)){b=a[c].object.entity&&!a[c].object.entity.passThrough?a[c].object.entity:a[c].object;break}return b},hideInfospot:function(){this.infospot&&(this.infospot.onHoverEnd(),this.infospot=void 0)},toggleControlBar:function(){var a=this.widget;a&&a.dispatchEvent({type:"control-bar-toggle"})},onKeyDown:function(a){this.options.output&&"none"!==this.options.output&&"Control"===
a.key&&(this.outputEnabled=!0)},onKeyUp:function(){this.outputEnabled=!1},update:function(){var a=this.scene,b=this.control,c=this.OrbitControls,d=this.DeviceOrientationControls;z.update();this.updateCallbacks.forEach(function(a){return a()});c.enabled&&c.update();b===d&&d.update();var e=new f.Vector3;a.traverse(function(a){if(a instanceof Y||a instanceof W&&a.element&&(this.hoverObject===a||"none"!==a.element.style.display||a.element.left&&"none"!==a.element.left.style.display||a.element.right&&
"none"!==a.element.right.style.display))if(this.checkSpriteInViewport(a)){var b=this.getScreenVector(a.getWorldPosition(e));a.translateElement(b.x,b.y)}else a.onDismiss()}.bind(this))},renderEffect:function(a){this.renderer.setRenderTarget(null);this.renderer.clear();this.effect.render(this.scene,this.camera,this.panorama);this.effect.render(this.sceneReticle,this.camera);this.renderer.clearDepth()},renderNormal:function(a){void 0===a||a?this.renderer.setRenderTarget(this.fbo):this.renderer.setRenderTarget(null);
this.renderer.clear();this.renderer.render(this.scene,this.camera);this.renderer.render(this.sceneReticle,this.camera);this.renderer.clearDepth()},render:function(a){a=void 0===a?!0:a;this.panorama&&(this.mode==K.NORMAL?this.renderNormal(a):this.renderEffect(a))},animate:function(){Wa||(this.requestAnimationId=window.requestAnimationFrame(this.animate.bind(this)));this.onChange()},onChange:function(){this.update();this.render()},registerMouseAndTouchEvents:function(){var a={passive:!1};this.container.addEventListener("mousedown",
this.handlerMouseDown,a);this.container.addEventListener("mousemove",this.handlerMouseMove,a);this.container.addEventListener("mouseup",this.handlerMouseUp,a);this.container.addEventListener("touchstart",this.handlerMouseDown,a);this.container.addEventListener("touchend",this.handlerMouseUp,a)},unregisterMouseAndTouchEvents:function(){this.container.removeEventListener("mousedown",this.handlerMouseDown,!1);this.container.removeEventListener("mousemove",this.handlerMouseMove,!1);this.container.removeEventListener("mouseup",
this.handlerMouseUp,!1);this.container.removeEventListener("touchstart",this.handlerMouseDown,!1);this.container.removeEventListener("touchend",this.handlerMouseUp,!1)},registerReticleEvent:function(){this.addUpdateCallback(this.handlerTap)},unregisterReticleEvent:function(){this.removeUpdateCallback(this.handlerTap)},updateReticleEvent:function(){var a=this.container.clientWidth/2+this.container.offsetLeft,b=this.container.clientHeight/2;this.removeUpdateCallback(this.handlerTap);this.handlerTap=
this.onTap.bind(this,{clientX:a,clientY:b});this.addUpdateCallback(this.handlerTap)},registerEventListeners:function(){window.addEventListener("resize",this.handlerWindowResize,!0);window.addEventListener("keydown",this.handlerKeyDown,!0);window.addEventListener("keyup",this.handlerKeyUp,!0)},unregisterEventListeners:function(){window.removeEventListener("resize",this.handlerWindowResize,!0);window.removeEventListener("keydown",this.handlerKeyDown,!0);window.removeEventListener("keyup",this.handlerKeyUp,
!0)},dispose:function(){function a(b){for(var c=b.children.length-1;0<=c;c--)a(b.children[c]),b.remove(b.children[c]);b instanceof A||b instanceof Y||b instanceof W?b.dispose():b.dispatchEvent&&b.dispatchEvent("dispose")}this.disableAutoRate();this.tweenLeftAnimation.stop();this.tweenUpAnimation.stop();this.unregisterEventListeners();this.fbo.dispose();this.reticleFbo.dispose();a(this.scene);this.DragControls&&this.DragControls.dispose&&this.DragControls.dispose();this.widget&&(this.widget.dispose(),
this.widget=null);f.Cache&&f.Cache.enabled&&f.Cache.clear();this.floorCursor&&(this.floorCursor=null)},removeWidget:function(){this.widget&&(this.widget.dispose(),this.widget=null)},destroy:function(){this.dispose();this.render();window.cancelAnimationFrame(this.requestAnimationId)},onPanoramaDispose:function(a){var b=function(b){return b.toPanorama!==a?b:b.dispose()};this.scene.traverse(function(a){a instanceof A&&(a.linkedSpots=a.linkedSpots.map(b).filter(function(a){return!!a}))});a===this.panorama&&
(this.panorama=null)},loadAsyncRequest:function(a,b){b=void 0===b?function(){}:b;var c=new window.XMLHttpRequest;c.onloadend=function(a){b(a)};c.open("GET",a,!0);c.send(null)},addViewIndicator:function(){var a=this;this.loadAsyncRequest(R.ViewIndicator,function(b){if(0!==b.loaded){b=b.target.responseXML.documentElement;b.style.width=a.viewIndicatorSize+"px";b.style.height=a.viewIndicatorSize+"px";b.style.position="absolute";b.style.top="10px";b.style.left="10px";b.style.opacity="0.5";b.style.cursor=
"-webkit-grab";b.id="panolens-view-indicator-container";a.container.appendChild(b);var c=b.querySelector("#indicator");a.addUpdateCallback(function(){a.radius=.225*a.viewIndicatorSize;a.currentPanoAngle=a.camera.rotation.y-f.Math.degToRad(90);a.fovAngle=f.Math.degToRad(a.camera.fov);a.leftAngle=-a.currentPanoAngle-a.fovAngle/2;a.rightAngle=-a.currentPanoAngle+a.fovAngle/2;a.leftX=a.radius*Math.cos(a.leftAngle);a.leftY=a.radius*Math.sin(a.leftAngle);a.rightX=a.radius*Math.cos(a.rightAngle);a.rightY=
a.radius*Math.sin(a.rightAngle);a.indicatorD="M "+a.leftX+" "+a.leftY+" A "+a.radius+" "+a.radius+" 0 0 1 "+a.rightX+" "+a.rightY;a.leftX&&a.leftY&&a.rightX&&a.rightY&&a.radius&&c.setAttribute("d",a.indicatorD)});b.addEventListener("mouseenter",function(){this.style.opacity="1"});b.addEventListener("mouseleave",function(){this.style.opacity="0.5"})}})},appendControlItem:function(a){var b=this.widget.createCustomItem(a);"video"===a.group?this.widget.videoElement.appendChild(b):this.widget.barElement.appendChild(b);
return b},clearAllCache:function(){f.Cache.clear()}});"105"!=f.REVISION&&console.warn("three.js version is not matched. Please consider use the target revision 105");window.TWEEN=z;w.BasicPanorama=Qa;w.CONTROLS=da;w.CURSORS=oa;w.CubeTextureLoader=Ya;w.DataImage=R;w.EmptyPanorama=Pa;w.FLOOR_PLANE_POSITION=qa;w.FloorCursor=xa;w.FloorPlane=ha;w.FloorRingInfospot=W;w.ImageLittlePlanet=Ga;w.ImageLoader=Xa;w.ImagePanorama=ba;w.Infospot=Y;w.LittlePlanet=ta;w.MODES=K;w.Panorama=A;w.REVISION="11";w.Reticle=
wa;w.STEREOFORMAT=sa;w.SliderPanorama=ya;w.THREE_REVISION="105";w.THREE_VERSION=mb;w.TextureLoader=Ca;w.VERSION="0.11.0";w.VideoPanorama=ia;w.Viewer=Ka;w.ViewerManager=Ta;w.Widget=ka;Object.defineProperty(w,"__esModule",{value:!0})});
